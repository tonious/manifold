import"./preload-helper.js";import{E as Z,P as M,G as jn,B as be,g as Hs,A as Y,M as dt,I as Wt,a as vt,b as ie,T as he,c as Ve,R as Bn,d as Gs,W as Mt,e as Vs,f as zs,h as Ks,s as Xs,i as $s,r as Ws,j as qs,w as Ys,p as Zs}from"./gltf-io.js";import{M as Qs}from"./manifold.js";import"./_commonjsHelpers.js";const Js=0,ei=0,ti=0,ni=2,si=0,ii=163,ri=166,oi=0,ai=2,ci=1,ui=64,fi=0;function li(){return{vkFormat:fi,typeSize:1,pixelWidth:0,pixelHeight:0,pixelDepth:0,layerCount:0,faceCount:1,levelCount:0,supercompressionScheme:Js,levels:[],dataFormatDescriptor:[{vendorId:ti,descriptorType:ei,versionNumber:ni,colorModel:si,colorPrimaries:ci,transferFunction:ai,flags:oi,texelBlockDimension:[0,0,0,0],bytesPlane:[0,0,0,0,0,0,0,0],samples:[]}],keyValue:{},globalData:null}}class st{constructor(e,t,n,i){this._dataView=void 0,this._littleEndian=void 0,this._offset=void 0,this._dataView=new DataView(e.buffer,e.byteOffset+t,n),this._littleEndian=i,this._offset=0}_nextUint8(){const e=this._dataView.getUint8(this._offset);return this._offset+=1,e}_nextUint16(){const e=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,e}_nextUint32(){const e=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint64(){const e=this._dataView.getUint32(this._offset,this._littleEndian),t=this._dataView.getUint32(this._offset+4,this._littleEndian),n=e+2**32*t;return this._offset+=8,n}_nextInt32(){const e=this._dataView.getInt32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint8Array(e){const t=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._offset,e);return this._offset+=e,t}_skip(e){return this._offset+=e,this}_scan(e,t=0){const n=this._offset;let i=0;for(;this._dataView.getUint8(this._offset)!==t&&i<e;)i++,this._offset++;return i<e&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+n,i)}}const xe=[171,75,84,88,32,50,48,187,13,10,26,10];function on(s){return new TextDecoder().decode(s)}function Dt(s){const e=new Uint8Array(s.buffer,s.byteOffset,xe.length);if(e[0]!==xe[0]||e[1]!==xe[1]||e[2]!==xe[2]||e[3]!==xe[3]||e[4]!==xe[4]||e[5]!==xe[5]||e[6]!==xe[6]||e[7]!==xe[7]||e[8]!==xe[8]||e[9]!==xe[9]||e[10]!==xe[10]||e[11]!==xe[11])throw new Error("Missing KTX 2.0 identifier.");const t=li(),n=17*Uint32Array.BYTES_PER_ELEMENT,i=new st(s,xe.length,n,!0);t.vkFormat=i._nextUint32(),t.typeSize=i._nextUint32(),t.pixelWidth=i._nextUint32(),t.pixelHeight=i._nextUint32(),t.pixelDepth=i._nextUint32(),t.layerCount=i._nextUint32(),t.faceCount=i._nextUint32(),t.levelCount=i._nextUint32(),t.supercompressionScheme=i._nextUint32();const o=i._nextUint32(),r=i._nextUint32(),a=i._nextUint32(),u=i._nextUint32(),f=i._nextUint64(),h=i._nextUint64(),p=Math.max(t.levelCount,1)*3*8,T=new st(s,xe.length+n,p,!0);for(let ce=0,te=Math.max(t.levelCount,1);ce<te;ce++)t.levels.push({levelData:new Uint8Array(s.buffer,s.byteOffset+T._nextUint64(),T._nextUint64()),uncompressedByteLength:T._nextUint64()});const y=new st(s,o,r,!0);y._skip(4);const l=y._nextUint16(),g=y._nextUint16(),c=y._nextUint16(),d=y._nextUint16(),_=y._nextUint8(),m=y._nextUint8(),x=y._nextUint8(),I=y._nextUint8(),E=[y._nextUint8(),y._nextUint8(),y._nextUint8(),y._nextUint8()],w=[y._nextUint8(),y._nextUint8(),y._nextUint8(),y._nextUint8(),y._nextUint8(),y._nextUint8(),y._nextUint8(),y._nextUint8()],U={vendorId:l,descriptorType:g,versionNumber:c,colorModel:_,colorPrimaries:m,transferFunction:x,flags:I,texelBlockDimension:E,bytesPlane:w,samples:[]},b=(d/4-6)/4;for(let ce=0;ce<b;ce++){const te={bitOffset:y._nextUint16(),bitLength:y._nextUint8(),channelType:y._nextUint8(),samplePosition:[y._nextUint8(),y._nextUint8(),y._nextUint8(),y._nextUint8()],sampleLower:Number.NEGATIVE_INFINITY,sampleUpper:Number.POSITIVE_INFINITY};te.channelType&ui?(te.sampleLower=y._nextInt32(),te.sampleUpper=y._nextInt32()):(te.sampleLower=y._nextUint32(),te.sampleUpper=y._nextUint32()),U.samples[ce]=te}t.dataFormatDescriptor.length=0,t.dataFormatDescriptor.push(U);const k=new st(s,a,u,!0);for(;k._offset<u;){const ce=k._nextUint32(),te=k._scan(ce),Re=on(te);if(t.keyValue[Re]=k._nextUint8Array(ce-te.byteLength-1),Re.match(/^ktx/i)){const ge=on(t.keyValue[Re]);t.keyValue[Re]=ge.substring(0,ge.lastIndexOf("\0"))}const ue=ce%4?4-ce%4:0;k._skip(ue)}if(h<=0)return t;const F=new st(s,f,h,!0),L=F._nextUint16(),j=F._nextUint16(),$=F._nextUint32(),pe=F._nextUint32(),ee=F._nextUint32(),P=F._nextUint32(),Ee=[];for(let ce=0,te=Math.max(t.levelCount,1);ce<te;ce++)Ee.push({imageFlags:F._nextUint32(),rgbSliceByteOffset:F._nextUint32(),rgbSliceByteLength:F._nextUint32(),alphaSliceByteOffset:F._nextUint32(),alphaSliceByteLength:F._nextUint32()});const V=f+F._offset,z=V+$,oe=z+pe,H=oe+ee,We=new Uint8Array(s.buffer,s.byteOffset+V,$),qe=new Uint8Array(s.buffer,s.byteOffset+z,pe),tt=new Uint8Array(s.buffer,s.byteOffset+oe,ee),ht=new Uint8Array(s.buffer,s.byteOffset+H,P);return t.globalData={endpointCount:L,selectorCount:j,imageDescs:Ee,endpointsData:We,selectorsData:qe,tablesData:tt,extendedData:ht},t}const Se="EXT_mesh_gpu_instancing",fe="EXT_meshopt_compression",rt="EXT_texture_webp",ot="EXT_texture_avif",Q="KHR_draco_mesh_compression",Te="KHR_lights_punctual",Ae="KHR_materials_anisotropy",Ne="KHR_materials_clearcoat",ve="KHR_materials_diffuse_transmission",Me="KHR_materials_dispersion",Ce="KHR_materials_emissive_strength",Oe="KHR_materials_ior",Ue="KHR_materials_iridescence",ke="KHR_materials_pbrSpecularGlossiness",Fe="KHR_materials_sheen",je="KHR_materials_specular",Be="KHR_materials_transmission",$e="KHR_materials_unlit",Le="KHR_materials_volume",de="KHR_materials_variants",Ln="KHR_mesh_quantization",at="KHR_texture_basisu",Pe="KHR_texture_transform",ye="KHR_xmp_json_ld",Ct="INSTANCE_ATTRIBUTE";class Pn extends ie{init(){this.extensionName=Se,this.propertyType="InstancedMesh",this.parentTypes=[M.NODE]}getDefaults(){return Object.assign(super.getDefaults(),{attributes:new Gs})}getAttribute(e){return this.getRefMap("attributes",e)}setAttribute(e,t){return this.setRefMap("attributes",e,t,{usage:Ct})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}}Pn.EXTENSION_NAME=Se;class Hn extends Z{constructor(...e){super(...e),this.extensionName=Se,this.provideTypes=[M.NODE],this.prewriteTypes=[M.ACCESSOR]}createInstancedMesh(){return new Pn(this.document.getGraph())}read(e){return(e.jsonDoc.json.nodes||[]).forEach((i,o)=>{if(!i.extensions||!i.extensions[Se])return;const r=i.extensions[Se],a=this.createInstancedMesh();for(const u in r.attributes)a.setAttribute(u,e.accessors[r.attributes[u]]);e.nodes[o].setExtension(Se,a)}),this}prewrite(e){e.accessorUsageGroupedByParent.add(Ct);for(const t of this.properties)for(const n of t.listAttributes())e.addAccessorToUsageGroup(n,Ct);return this}write(e){const t=e.jsonDoc;return this.document.getRoot().listNodes().forEach(n=>{const i=n.getExtension(Se);if(i){const o=e.nodeIndexMap.get(n),r=t.json.nodes[o],a={attributes:{}};i.listSemantics().forEach(u=>{const f=i.getAttribute(u);a.attributes[u]=e.accessorIndexMap.get(f)}),r.extensions=r.extensions||{},r.extensions[Se]=a}}),this}}Hn.EXTENSION_NAME=Se;function Ge(){return Ge=Object.assign?Object.assign.bind():function(s){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)({}).hasOwnProperty.call(t,n)&&(s[n]=t[n])}return s},Ge.apply(null,arguments)}var ft;(function(s){s.QUANTIZE="quantize",s.FILTER="filter"})(ft||(ft={}));var Je;(function(s){s.ATTRIBUTES="ATTRIBUTES",s.TRIANGLES="TRIANGLES",s.INDICES="INDICES"})(Je||(Je={}));var J;(function(s){s.NONE="NONE",s.OCTAHEDRAL="OCTAHEDRAL",s.QUATERNION="QUATERNION",s.EXPONENTIAL="EXPONENTIAL"})(J||(J={}));function di(s){return!s.extensions||!s.extensions[fe]?!1:!!s.extensions[fe].fallback}const{BYTE:hi,SHORT:an,FLOAT:pi}=Y.ComponentType,{encodeNormalizedInt:cn,decodeNormalizedInt:Ot}=dt;function xi(s,e,t,n){const{filter:i,bits:o}=n,r={array:s.getArray(),byteStride:s.getElementSize()*s.getComponentSize(),componentType:s.getComponentType(),normalized:s.getNormalized()};if(t!==Je.ATTRIBUTES)return r;if(i!==J.NONE){let a=s.getNormalized()?gi(s):new Float32Array(r.array);switch(i){case J.EXPONENTIAL:r.byteStride=s.getElementSize()*4,r.componentType=pi,r.normalized=!1,r.array=e.encodeFilterExp(a,s.getCount(),r.byteStride,o);break;case J.OCTAHEDRAL:r.byteStride=o>8?8:4,r.componentType=o>8?an:hi,r.normalized=!0,a=s.getElementSize()===3?mi(a):a,r.array=e.encodeFilterOct(a,s.getCount(),r.byteStride,o);break;case J.QUATERNION:r.byteStride=8,r.componentType=an,r.normalized=!0,r.array=e.encodeFilterQuat(a,s.getCount(),r.byteStride,o);break;default:throw new Error("Invalid filter.")}r.min=s.getMin([]),r.max=s.getMax([]),s.getNormalized()&&(r.min=r.min.map(u=>Ot(u,s.getComponentType())),r.max=r.max.map(u=>Ot(u,s.getComponentType()))),r.normalized&&(r.min=r.min.map(u=>cn(u,r.componentType)),r.max=r.max.map(u=>cn(u,r.componentType)))}else r.byteStride%4&&(r.array=_i(r.array,s.getElementSize()),r.byteStride=r.array.byteLength/s.getCount());return r}function gi(s){const e=s.getComponentType(),t=s.getArray(),n=new Float32Array(t.length);for(let i=0;i<t.length;i++)n[i]=Ot(t[i],e);return n}function _i(s,e){const n=be.padNumber(s.BYTES_PER_ELEMENT*e)/s.BYTES_PER_ELEMENT,i=s.length/e,o=new s.constructor(i*n);for(let r=0;r*e<s.length;r++)for(let a=0;a<e;a++)o[r*n+a]=s[r*e+a];return o}function mi(s){const e=new Float32Array(s.length*4/3);for(let t=0,n=s.length/3;t<n;t++)e[t*4]=s[t*3],e[t*4+1]=s[t*3+1],e[t*4+2]=s[t*3+2];return e}function Ti(s,e){return e===Mt.BufferViewUsage.ELEMENT_ARRAY_BUFFER?s.listParents().some(n=>n instanceof vt&&n.getMode()===vt.Mode.TRIANGLES)?Je.TRIANGLES:Je.INDICES:Je.ATTRIBUTES}function yi(s,e){const t=e.getGraph().listParentEdges(s).filter(n=>!(n.getParent()instanceof Ks));for(const n of t){const i=n.getName(),o=n.getAttributes().key||"",r=n.getParent().propertyType===M.PRIMITIVE_TARGET;if(i==="indices")return{filter:J.NONE};if(i==="attributes"){if(o==="POSITION")return{filter:J.NONE};if(o==="TEXCOORD_0")return{filter:J.NONE};if(o.startsWith("JOINTS_"))return{filter:J.NONE};if(o.startsWith("WEIGHTS_"))return{filter:J.NONE};if(o==="NORMAL"||o==="TANGENT")return r?{filter:J.NONE}:{filter:J.OCTAHEDRAL,bits:8}}if(i==="output"){const a=Gn(s);return a==="rotation"?{filter:J.QUATERNION,bits:16}:a==="translation"?{filter:J.EXPONENTIAL,bits:12}:a==="scale"?{filter:J.EXPONENTIAL,bits:12}:{filter:J.NONE}}if(i==="input")return{filter:J.NONE};if(i==="inverseBindMatrices")return{filter:J.NONE}}return{filter:J.NONE}}function Gn(s){for(const e of s.listParents())if(e instanceof Vs){for(const t of e.listParents())if(t instanceof zs)return t.getTargetPath()}return null}const un={method:ft.QUANTIZE};class qt extends Z{constructor(...e){super(...e),this.extensionName=fe,this.prereadTypes=[M.BUFFER,M.PRIMITIVE],this.prewriteTypes=[M.BUFFER,M.ACCESSOR],this.readDependencies=["meshopt.decoder"],this.writeDependencies=["meshopt.encoder"],this._decoder=null,this._decoderFallbackBufferMap=new Map,this._encoder=null,this._encoderOptions=un,this._encoderFallbackBuffer=null,this._encoderBufferViews={},this._encoderBufferViewData={},this._encoderBufferViewAccessors={}}install(e,t){return e==="meshopt.decoder"&&(this._decoder=t),e==="meshopt.encoder"&&(this._encoder=t),this}setEncoderOptions(e){return this._encoderOptions=Ge({},un,e),this}preread(e,t){if(!this._decoder){if(!this.isRequired())return this;throw new Error(`[${fe}] Please install extension dependency, "meshopt.decoder".`)}if(!this._decoder.supported){if(!this.isRequired())return this;throw new Error(`[${fe}]: Missing WASM support.`)}return t===M.BUFFER?this._prereadBuffers(e):t===M.PRIMITIVE&&this._prereadPrimitives(e),this}_prereadBuffers(e){const t=e.jsonDoc;(t.json.bufferViews||[]).forEach((i,o)=>{if(!i.extensions||!i.extensions[fe])return;const r=i.extensions[fe],a=r.byteOffset||0,u=r.byteLength||0,f=r.count,h=r.byteStride,p=new Uint8Array(f*h),T=t.json.buffers[r.buffer],y=T.uri?t.resources[T.uri]:t.resources[jn],l=be.toView(y,a,u);this._decoder.decodeGltfBuffer(p,f,h,l,r.mode,r.filter),e.bufferViews[o]=p})}_prereadPrimitives(e){const t=e.jsonDoc;(t.json.bufferViews||[]).forEach(i=>{if(!i.extensions||!i.extensions[fe])return;const o=i.extensions[fe],r=e.buffers[o.buffer],a=e.buffers[i.buffer],u=t.json.buffers[i.buffer];di(u)&&this._decoderFallbackBufferMap.set(a,r)})}read(e){if(!this.isRequired())return this;for(const[t,n]of this._decoderFallbackBufferMap){for(const i of t.listParents())i instanceof Y&&i.swap(t,n);t.dispose()}return this}prewrite(e,t){return t===M.ACCESSOR?this._prewriteAccessors(e):t===M.BUFFER&&this._prewriteBuffers(e),this}_prewriteAccessors(e){const t=e.jsonDoc.json,n=this._encoder,i=this._encoderOptions,o=this.document.getGraph(),r=this.document.createBuffer(),a=this.document.getRoot().listBuffers().indexOf(r);let u=1;const f=new Map,h=p=>{for(const T of o.listParents(p)){if(T.propertyType===M.ROOT)continue;let y=f.get(p);return y===void 0&&f.set(p,y=u++),y}return-1};this._encoderFallbackBuffer=r,this._encoderBufferViews={},this._encoderBufferViewData={},this._encoderBufferViewAccessors={};for(const p of this.document.getRoot().listAccessors()){if(Gn(p)==="weights"||p.getSparse())continue;const T=e.getAccessorUsage(p),y=e.accessorUsageGroupedByParent.has(T)?h(p):null,l=Ti(p,T),g=i.method===ft.FILTER?yi(p,this.document):{filter:J.NONE},c=xi(p,n,l,g),{array:d,byteStride:_}=c,m=p.getBuffer();if(!m)throw new Error(`${fe}: Missing buffer for accessor.`);const x=this.document.getRoot().listBuffers().indexOf(m),I=[T,y,l,g.filter,_,x].join(":");let E=this._encoderBufferViews[I],w=this._encoderBufferViewData[I],D=this._encoderBufferViewAccessors[I];(!E||!w)&&(D=this._encoderBufferViewAccessors[I]=[],w=this._encoderBufferViewData[I]=[],E=this._encoderBufferViews[I]={buffer:a,target:Mt.USAGE_TO_TARGET[T],byteOffset:0,byteLength:0,byteStride:T===Mt.BufferViewUsage.ARRAY_BUFFER?_:void 0,extensions:{[fe]:{buffer:x,byteOffset:0,byteLength:0,mode:l,filter:g.filter!==J.NONE?g.filter:void 0,byteStride:_,count:0}}});const U=e.createAccessorDef(p);U.componentType=c.componentType,U.normalized=c.normalized,U.byteOffset=E.byteLength,U.min&&c.min&&(U.min=c.min),U.max&&c.max&&(U.max=c.max),e.accessorIndexMap.set(p,t.accessors.length),t.accessors.push(U),D.push(U),w.push(new Uint8Array(d.buffer,d.byteOffset,d.byteLength)),E.byteLength+=d.byteLength,E.extensions.EXT_meshopt_compression.count+=p.getCount()}}_prewriteBuffers(e){const t=this._encoder;for(const n in this._encoderBufferViews){const i=this._encoderBufferViews[n],o=this._encoderBufferViewData[n],r=this.document.getRoot().listBuffers()[i.extensions[fe].buffer],a=e.otherBufferViews.get(r)||[],{count:u,byteStride:f,mode:h}=i.extensions[fe],p=be.concat(o),T=t.encodeGltfBuffer(p,u,f,h),y=be.pad(T);i.extensions[fe].byteLength=T.byteLength,o.length=0,o.push(y),a.push(y),e.otherBufferViews.set(r,a)}}write(e){let t=0;for(const r in this._encoderBufferViews){const a=this._encoderBufferViews[r],u=this._encoderBufferViewData[r][0],f=e.otherBufferViewsIndexMap.get(u),h=this._encoderBufferViewAccessors[r];for(const l of h)l.bufferView=f;const p=e.jsonDoc.json.bufferViews[f],T=p.byteOffset||0;Object.assign(p,a),p.byteOffset=t;const y=p.extensions[fe];y.byteOffset=T,t+=be.padNumber(a.byteLength)}const n=this._encoderFallbackBuffer,i=e.bufferIndexMap.get(n),o=e.jsonDoc.json.buffers[i];return o.byteLength=t,o.extensions={[fe]:{fallback:!0}},n.dispose(),this}}qt.EXTENSION_NAME=fe;qt.EncoderMethod=ft;class wi{match(e){return e.length>=12&&be.decodeText(e.slice(4,12))==="ftypavif"}getSize(e){if(!this.match(e))return null;const t=new DataView(e.buffer,e.byteOffset,e.byteLength);let n=fn(t,0);if(!n)return null;let i=n.end;for(;n=fn(t,i);)if(n.type==="meta")i=n.start+4;else if(n.type==="iprp"||n.type==="ipco")i=n.start;else{if(n.type==="ispe")return[t.getUint32(n.start+4),t.getUint32(n.start+8)];if(n.type==="mdat")break;i=n.end}return null}getChannels(e){return 4}}class Vn extends Z{constructor(...e){super(...e),this.extensionName=ot,this.prereadTypes=[M.TEXTURE]}static register(){Wt.registerFormat("image/avif",new wi)}preread(e){return(e.jsonDoc.json.textures||[]).forEach(n=>{n.extensions&&n.extensions[ot]&&(n.source=n.extensions[ot].source)}),this}read(e){return this}write(e){const t=e.jsonDoc;return this.document.getRoot().listTextures().forEach(n=>{if(n.getMimeType()==="image/avif"){const i=e.imageIndexMap.get(n);(t.json.textures||[]).forEach(r=>{r.source===i&&(r.extensions=r.extensions||{},r.extensions[ot]={source:r.source},delete r.source)})}}),this}}Vn.EXTENSION_NAME=ot;function fn(s,e){if(s.byteLength<4+e)return null;const t=s.getUint32(e);return s.byteLength<t+e||t<8?null:{type:be.decodeText(new Uint8Array(s.buffer,s.byteOffset+e+4,4)),start:e+8,end:e+t}}class Ei{match(e){return e.length>=12&&e[8]===87&&e[9]===69&&e[10]===66&&e[11]===80}getSize(e){const t=be.decodeText(e.slice(0,4)),n=be.decodeText(e.slice(8,12));if(t!=="RIFF"||n!=="WEBP")return null;const i=new DataView(e.buffer,e.byteOffset);let o=12;for(;o<i.byteLength;){const r=be.decodeText(new Uint8Array([i.getUint8(o),i.getUint8(o+1),i.getUint8(o+2),i.getUint8(o+3)])),a=i.getUint32(o+4,!0);if(r==="VP8 "){const u=i.getInt16(o+14,!0)&16383,f=i.getInt16(o+16,!0)&16383;return[u,f]}else if(r==="VP8L"){const u=i.getUint8(o+9),f=i.getUint8(o+10),h=i.getUint8(o+11),p=i.getUint8(o+12),T=1+((f&63)<<8|u),y=1+((p&15)<<10|h<<2|(f&192)>>6);return[T,y]}o+=8+a+a%2}return null}getChannels(e){return 4}}class zn extends Z{constructor(...e){super(...e),this.extensionName=rt,this.prereadTypes=[M.TEXTURE]}static register(){Wt.registerFormat("image/webp",new Ei)}preread(e){return(e.jsonDoc.json.textures||[]).forEach(n=>{n.extensions&&n.extensions[rt]&&(n.source=n.extensions[rt].source)}),this}read(e){return this}write(e){const t=e.jsonDoc;return this.document.getRoot().listTextures().forEach(n=>{if(n.getMimeType()==="image/webp"){const i=e.imageIndexMap.get(n);(t.json.textures||[]).forEach(r=>{r.source===i&&(r.extensions=r.extensions||{},r.extensions[rt]={source:r.source},delete r.source)})}}),this}}zn.EXTENSION_NAME=rt;let re,Kn,Xn;function Ii(s,e){const t=new re.DecoderBuffer;try{if(t.Init(e,e.length),s.GetEncodedGeometryType(t)!==re.TRIANGULAR_MESH)throw new Error(`[${Q}] Unknown geometry type.`);const i=new re.Mesh;if(!s.DecodeBufferToMesh(t,i).ok()||i.ptr===0)throw new Error(`[${Q}] Decoding failure.`);return i}finally{re.destroy(t)}}function bi(s,e){const n=e.num_faces()*3;let i,o;if(e.num_points()<=65534){const r=n*Uint16Array.BYTES_PER_ELEMENT;i=re._malloc(r),s.GetTrianglesUInt16Array(e,r,i),o=new Uint16Array(re.HEAPU16.buffer,i,n).slice()}else{const r=n*Uint32Array.BYTES_PER_ELEMENT;i=re._malloc(r),s.GetTrianglesUInt32Array(e,r,i),o=new Uint32Array(re.HEAPU32.buffer,i,n).slice()}return re._free(i),o}function Ri(s,e,t,n){const i=Xn[n.componentType],o=Kn[n.componentType],r=t.num_components(),u=e.num_points()*r,f=u*o.BYTES_PER_ELEMENT,h=re._malloc(f);s.GetAttributeDataArrayForAllPoints(e,t,i,f,h);const p=new o(re.HEAPF32.buffer,h,u).slice();return re._free(h),p}function Di(s){re=s,Kn={[Y.ComponentType.FLOAT]:Float32Array,[Y.ComponentType.UNSIGNED_INT]:Uint32Array,[Y.ComponentType.UNSIGNED_SHORT]:Uint16Array,[Y.ComponentType.UNSIGNED_BYTE]:Uint8Array,[Y.ComponentType.SHORT]:Int16Array,[Y.ComponentType.BYTE]:Int8Array},Xn={[Y.ComponentType.FLOAT]:re.DT_FLOAT32,[Y.ComponentType.UNSIGNED_INT]:re.DT_UINT32,[Y.ComponentType.UNSIGNED_SHORT]:re.DT_UINT16,[Y.ComponentType.UNSIGNED_BYTE]:re.DT_UINT8,[Y.ComponentType.SHORT]:re.DT_INT16,[Y.ComponentType.BYTE]:re.DT_INT8}}let me;var lt;(function(s){s[s.EDGEBREAKER=1]="EDGEBREAKER",s[s.SEQUENTIAL=0]="SEQUENTIAL"})(lt||(lt={}));var we;(function(s){s.POSITION="POSITION",s.NORMAL="NORMAL",s.COLOR="COLOR",s.TEX_COORD="TEX_COORD",s.GENERIC="GENERIC"})(we||(we={}));const $n={[we.POSITION]:14,[we.NORMAL]:10,[we.COLOR]:8,[we.TEX_COORD]:12,[we.GENERIC]:12},ln={decodeSpeed:5,encodeSpeed:5,method:lt.EDGEBREAKER,quantizationBits:$n,quantizationVolume:"mesh"};function Si(s){me=s}function Ai(s,e=ln){const t=Ge({},ln,e);t.quantizationBits=Ge({},$n,e.quantizationBits);const n=new me.MeshBuilder,i=new me.Mesh,o=new me.ExpertEncoder(i),r={},a=new me.DracoInt8Array,u=s.listTargets().length>0;let f=!1;for(const g of s.listSemantics()){const c=s.getAttribute(g);if(c.getSparse()){f=!0;continue}const d=Ni(g),_=vi(n,c.getComponentType(),i,me[d],c.getCount(),c.getElementSize(),c.getArray());if(_===-1)throw new Error(`Error compressing "${g}" attribute.`);if(r[g]=_,t.quantizationVolume==="mesh"||g!=="POSITION")o.SetAttributeQuantization(_,t.quantizationBits[d]);else if(typeof t.quantizationVolume=="object"){const{quantizationVolume:m}=t,x=Math.max(m.max[0]-m.min[0],m.max[1]-m.min[1],m.max[2]-m.min[2]);o.SetAttributeExplicitQuantization(_,t.quantizationBits[d],c.getElementSize(),m.min,x)}else throw new Error("Invalid quantization volume state.")}const h=s.getIndices();if(!h)throw new Ut("Primitive must have indices.");n.AddFacesToMesh(i,h.getCount()/3,h.getArray()),o.SetSpeedOptions(t.encodeSpeed,t.decodeSpeed),o.SetTrackEncodedProperties(!0),t.method===lt.SEQUENTIAL||u||f?o.SetEncodingMethod(me.MESH_SEQUENTIAL_ENCODING):o.SetEncodingMethod(me.MESH_EDGEBREAKER_ENCODING);const p=o.EncodeToDracoBuffer(!(u||f),a);if(p<=0)throw new Ut("Error applying Draco compression.");const T=new Uint8Array(p);for(let g=0;g<p;++g)T[g]=a.GetValue(g);const y=o.GetNumberOfEncodedPoints(),l=o.GetNumberOfEncodedFaces()*3;return me.destroy(a),me.destroy(i),me.destroy(n),me.destroy(o),{numVertices:y,numIndices:l,data:T,attributeIDs:r}}function Ni(s){return s==="POSITION"?we.POSITION:s==="NORMAL"?we.NORMAL:s.startsWith("COLOR_")?we.COLOR:s.startsWith("TEXCOORD_")?we.TEX_COORD:we.GENERIC}function vi(s,e,t,n,i,o,r){switch(e){case Y.ComponentType.UNSIGNED_BYTE:return s.AddUInt8Attribute(t,n,i,o,r);case Y.ComponentType.BYTE:return s.AddInt8Attribute(t,n,i,o,r);case Y.ComponentType.UNSIGNED_SHORT:return s.AddUInt16Attribute(t,n,i,o,r);case Y.ComponentType.SHORT:return s.AddInt16Attribute(t,n,i,o,r);case Y.ComponentType.UNSIGNED_INT:return s.AddUInt32Attribute(t,n,i,o,r);case Y.ComponentType.FLOAT:return s.AddFloatAttribute(t,n,i,o,r);default:throw new Error(`Unexpected component type, "${e}".`)}}class Ut extends Error{}class Yt extends Z{constructor(...e){super(...e),this.extensionName=Q,this.prereadTypes=[M.PRIMITIVE],this.prewriteTypes=[M.ACCESSOR],this.readDependencies=["draco3d.decoder"],this.writeDependencies=["draco3d.encoder"],this._decoderModule=null,this._encoderModule=null,this._encoderOptions={}}install(e,t){return e==="draco3d.decoder"&&(this._decoderModule=t,Di(this._decoderModule)),e==="draco3d.encoder"&&(this._encoderModule=t,Si(this._encoderModule)),this}setEncoderOptions(e){return this._encoderOptions=e,this}preread(e){if(!this._decoderModule)throw new Error(`[${Q}] Please install extension dependency, "draco3d.decoder".`);const t=this.document.getLogger(),n=e.jsonDoc,i=new Map;try{const o=n.json.meshes||[];for(const r of o)for(const a of r.primitives){if(!a.extensions||!a.extensions[Q])continue;const u=a.extensions[Q];let[f,h]=i.get(u.bufferView)||[];if(!h||!f){const p=n.json.bufferViews[u.bufferView],T=n.json.buffers[p.buffer],y=T.uri?n.resources[T.uri]:n.resources[jn],l=p.byteOffset||0,g=p.byteLength,c=be.toView(y,l,g);f=new this._decoderModule.Decoder,h=Ii(f,c),i.set(u.bufferView,[f,h]),t.debug(`[${Q}] Decompressed ${c.byteLength} bytes.`)}for(const p in u.attributes){const T=e.jsonDoc.json.accessors[a.attributes[p]],y=f.GetAttributeByUniqueId(h,u.attributes[p]),l=Ri(f,h,y,T);e.accessors[a.attributes[p]].setArray(l)}a.indices!==void 0&&e.accessors[a.indices].setArray(bi(f,h))}}finally{for(const[o,r]of Array.from(i.values()))this._decoderModule.destroy(o),this._decoderModule.destroy(r)}return this}read(e){return this}prewrite(e,t){if(!this._encoderModule)throw new Error(`[${Q}] Please install extension dependency, "draco3d.encoder".`);const n=this.document.getLogger();n.debug(`[${Q}] Compression options: ${JSON.stringify(this._encoderOptions)}`);const i=Mi(this.document),o=new Map;let r="mesh";this._encoderOptions.quantizationVolume==="scene"&&(this.document.getRoot().listScenes().length!==1?n.warn(`[${Q}]: quantizationVolume=scene requires exactly 1 scene.`):r=Hs(this.document.getRoot().listScenes().pop()));for(const a of Array.from(i.keys())){const u=i.get(a);if(!u)throw new Error("Unexpected primitive.");if(o.has(u)){o.set(u,o.get(u));continue}const f=a.getIndices(),h=e.jsonDoc.json.accessors;let p;try{p=Ai(a,Ge({},this._encoderOptions,{quantizationVolume:r}))}catch(l){if(l instanceof Ut){n.warn(`[${Q}]: ${l.message} Skipping primitive compression.`);continue}throw l}o.set(u,p);const T=e.createAccessorDef(f);T.count=p.numIndices,e.accessorIndexMap.set(f,h.length),h.push(T),p.numVertices>65534&&Y.getComponentSize(T.componentType)<=2?T.componentType=Y.ComponentType.UNSIGNED_INT:p.numVertices>254&&Y.getComponentSize(T.componentType)<=1&&(T.componentType=Y.ComponentType.UNSIGNED_SHORT);for(const l of a.listSemantics()){const g=a.getAttribute(l);if(p.attributeIDs[l]===void 0)continue;const c=e.createAccessorDef(g);c.count=p.numVertices,e.accessorIndexMap.set(g,h.length),h.push(c)}const y=a.getAttribute("POSITION").getBuffer()||this.document.getRoot().listBuffers()[0];e.otherBufferViews.has(y)||e.otherBufferViews.set(y,[]),e.otherBufferViews.get(y).push(p.data)}return n.debug(`[${Q}] Compressed ${i.size} primitives.`),e.extensionData[Q]={primitiveHashMap:i,primitiveEncodingMap:o},this}write(e){const t=e.extensionData[Q];for(const n of this.document.getRoot().listMeshes()){const i=e.jsonDoc.json.meshes[e.meshIndexMap.get(n)];for(let o=0;o<n.listPrimitives().length;o++){const r=n.listPrimitives()[o],a=i.primitives[o],u=t.primitiveHashMap.get(r);if(!u)continue;const f=t.primitiveEncodingMap.get(u);f&&(a.extensions=a.extensions||{},a.extensions[Q]={bufferView:e.otherBufferViewsIndexMap.get(f.data),attributes:f.attributeIDs})}}if(!t.primitiveHashMap.size){const n=e.jsonDoc.json;n.extensionsUsed=(n.extensionsUsed||[]).filter(i=>i!==Q),n.extensionsRequired=(n.extensionsRequired||[]).filter(i=>i!==Q)}return this}}Yt.EXTENSION_NAME=Q;Yt.EncoderMethod=lt;function Mi(s){const e=s.getLogger(),t=new Set,n=new Set;let i=0,o=0;for(const p of s.getRoot().listMeshes())for(const T of p.listPrimitives())T.getIndices()?T.getMode()!==vt.Mode.TRIANGLES?(n.add(T),o++):t.add(T):(n.add(T),i++);i>0&&e.warn(`[${Q}] Skipping Draco compression of ${i} non-indexed primitives.`),o>0&&e.warn(`[${Q}] Skipping Draco compression of ${o} non-TRIANGLES primitives.`);const r=s.getRoot().listAccessors(),a=new Map;for(let p=0;p<r.length;p++)a.set(r[p],p);const u=new Map,f=new Set,h=new Map;for(const p of Array.from(t)){let T=dn(p,a);if(f.has(T)){h.set(p,T);continue}if(u.has(p.getIndices())){const y=p.getIndices(),l=y.clone();a.set(l,s.getRoot().listAccessors().length-1),p.swap(y,l)}for(const y of p.listAttributes())if(u.has(y)){const l=y.clone();a.set(l,s.getRoot().listAccessors().length-1),p.swap(y,l)}T=dn(p,a),f.add(T),h.set(p,T),u.set(p.getIndices(),T);for(const y of p.listAttributes())u.set(y,T)}for(const p of Array.from(u.keys())){const T=new Set(p.listParents().map(y=>y.propertyType));if(T.size!==2||!T.has(M.PRIMITIVE)||!T.has(M.ROOT))throw new Error(`[${Q}] Compressed accessors must only be used as indices or vertex attributes.`)}for(const p of Array.from(t)){const T=h.get(p),y=p.getIndices();if(u.get(y)!==T||p.listAttributes().some(l=>u.get(l)!==T))throw new Error(`[${Q}] Draco primitives must share all, or no, accessors.`)}for(const p of Array.from(n)){const T=p.getIndices();if(u.has(T)||p.listAttributes().some(y=>u.has(y)))throw new Error(`[${Q}] Accessor cannot be shared by compressed and uncompressed primitives.`)}return h}function dn(s,e){const t=[],n=s.getIndices();t.push(e.get(n));for(const i of s.listAttributes())t.push(e.get(i));return t.sort().join("|")}class et extends ie{init(){this.extensionName=Te,this.propertyType="Light",this.parentTypes=[M.NODE]}getDefaults(){return Object.assign(super.getDefaults(),{color:[1,1,1],intensity:1,type:et.Type.POINT,range:null,innerConeAngle:0,outerConeAngle:Math.PI/4})}getColor(){return this.get("color")}setColor(e){return this.set("color",e)}getIntensity(){return this.get("intensity")}setIntensity(e){return this.set("intensity",e)}getType(){return this.get("type")}setType(e){return this.set("type",e)}getRange(){return this.get("range")}setRange(e){return this.set("range",e)}getInnerConeAngle(){return this.get("innerConeAngle")}setInnerConeAngle(e){return this.set("innerConeAngle",e)}getOuterConeAngle(){return this.get("outerConeAngle")}setOuterConeAngle(e){return this.set("outerConeAngle",e)}}et.EXTENSION_NAME=Te;et.Type={POINT:"point",SPOT:"spot",DIRECTIONAL:"directional"};class Wn extends Z{constructor(...e){super(...e),this.extensionName=Te}createLight(e=""){return new et(this.document.getGraph(),e)}read(e){const t=e.jsonDoc;if(!t.json.extensions||!t.json.extensions[Te])return this;const o=(t.json.extensions[Te].lights||[]).map(r=>{var a,u;const f=this.createLight().setName(r.name||"").setType(r.type);return r.color!==void 0&&f.setColor(r.color),r.intensity!==void 0&&f.setIntensity(r.intensity),r.range!==void 0&&f.setRange(r.range),((a=r.spot)==null?void 0:a.innerConeAngle)!==void 0&&f.setInnerConeAngle(r.spot.innerConeAngle),((u=r.spot)==null?void 0:u.outerConeAngle)!==void 0&&f.setOuterConeAngle(r.spot.outerConeAngle),f});return t.json.nodes.forEach((r,a)=>{if(!r.extensions||!r.extensions[Te])return;const u=r.extensions[Te];e.nodes[a].setExtension(Te,o[u.light])}),this}write(e){const t=e.jsonDoc;if(this.properties.size===0)return this;const n=[],i=new Map;for(const o of this.properties){const r=o,a={type:r.getType()};dt.eq(r.getColor(),[1,1,1])||(a.color=r.getColor()),r.getIntensity()!==1&&(a.intensity=r.getIntensity()),r.getRange()!=null&&(a.range=r.getRange()),r.getName()&&(a.name=r.getName()),r.getType()===et.Type.SPOT&&(a.spot={innerConeAngle:r.getInnerConeAngle(),outerConeAngle:r.getOuterConeAngle()}),n.push(a),i.set(r,n.length-1)}return this.document.getRoot().listNodes().forEach(o=>{const r=o.getExtension(Te);if(r){const a=e.nodeIndexMap.get(o),u=t.json.nodes[a];u.extensions=u.extensions||{},u.extensions[Te]={light:i.get(r)}}}),t.json.extensions=t.json.extensions||{},t.json.extensions[Te]={lights:n},this}}Wn.EXTENSION_NAME=Te;const{R:Ci,G:Oi,B:Ui}=Ve;class qn extends ie{init(){this.extensionName=Ae,this.propertyType="Anisotropy",this.parentTypes=[M.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{anisotropyStrength:0,anisotropyRotation:0,anisotropyTexture:null,anisotropyTextureInfo:new he(this.graph,"anisotropyTextureInfo")})}getAnisotropyStrength(){return this.get("anisotropyStrength")}setAnisotropyStrength(e){return this.set("anisotropyStrength",e)}getAnisotropyRotation(){return this.get("anisotropyRotation")}setAnisotropyRotation(e){return this.set("anisotropyRotation",e)}getAnisotropyTexture(){return this.getRef("anisotropyTexture")}getAnisotropyTextureInfo(){return this.getRef("anisotropyTexture")?this.getRef("anisotropyTextureInfo"):null}setAnisotropyTexture(e){return this.setRef("anisotropyTexture",e,{channels:Ci|Oi|Ui})}}qn.EXTENSION_NAME=Ae;class Yn extends Z{constructor(...e){super(...e),this.extensionName=Ae,this.prereadTypes=[M.MESH],this.prewriteTypes=[M.MESH]}createAnisotropy(){return new qn(this.document.getGraph())}read(e){return this}write(e){return this}preread(e){const t=e.jsonDoc,n=t.json.materials||[],i=t.json.textures||[];return n.forEach((o,r)=>{if(o.extensions&&o.extensions[Ae]){const a=this.createAnisotropy();e.materials[r].setExtension(Ae,a);const u=o.extensions[Ae];if(u.anisotropyStrength!==void 0&&a.setAnisotropyStrength(u.anisotropyStrength),u.anisotropyRotation!==void 0&&a.setAnisotropyRotation(u.anisotropyRotation),u.anisotropyTexture!==void 0){const f=u.anisotropyTexture,h=e.textures[i[f.index].source];a.setAnisotropyTexture(h),e.setTextureInfo(a.getAnisotropyTextureInfo(),f)}}}),this}prewrite(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const i=n.getExtension(Ae);if(i){const o=e.materialIndexMap.get(n),r=t.json.materials[o];r.extensions=r.extensions||{};const a=r.extensions[Ae]={};if(i.getAnisotropyStrength()>0&&(a.anisotropyStrength=i.getAnisotropyStrength()),i.getAnisotropyRotation()!==0&&(a.anisotropyRotation=i.getAnisotropyRotation()),i.getAnisotropyTexture()){const u=i.getAnisotropyTexture(),f=i.getAnisotropyTextureInfo();a.anisotropyTexture=e.createTextureInfoDef(u,f)}}}),this}}Yn.EXTENSION_NAME=Ae;const{R:hn,G:pn,B:ki}=Ve;class Zn extends ie{init(){this.extensionName=Ne,this.propertyType="Clearcoat",this.parentTypes=[M.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{clearcoatFactor:0,clearcoatTexture:null,clearcoatTextureInfo:new he(this.graph,"clearcoatTextureInfo"),clearcoatRoughnessFactor:0,clearcoatRoughnessTexture:null,clearcoatRoughnessTextureInfo:new he(this.graph,"clearcoatRoughnessTextureInfo"),clearcoatNormalScale:1,clearcoatNormalTexture:null,clearcoatNormalTextureInfo:new he(this.graph,"clearcoatNormalTextureInfo")})}getClearcoatFactor(){return this.get("clearcoatFactor")}setClearcoatFactor(e){return this.set("clearcoatFactor",e)}getClearcoatTexture(){return this.getRef("clearcoatTexture")}getClearcoatTextureInfo(){return this.getRef("clearcoatTexture")?this.getRef("clearcoatTextureInfo"):null}setClearcoatTexture(e){return this.setRef("clearcoatTexture",e,{channels:hn})}getClearcoatRoughnessFactor(){return this.get("clearcoatRoughnessFactor")}setClearcoatRoughnessFactor(e){return this.set("clearcoatRoughnessFactor",e)}getClearcoatRoughnessTexture(){return this.getRef("clearcoatRoughnessTexture")}getClearcoatRoughnessTextureInfo(){return this.getRef("clearcoatRoughnessTexture")?this.getRef("clearcoatRoughnessTextureInfo"):null}setClearcoatRoughnessTexture(e){return this.setRef("clearcoatRoughnessTexture",e,{channels:pn})}getClearcoatNormalScale(){return this.get("clearcoatNormalScale")}setClearcoatNormalScale(e){return this.set("clearcoatNormalScale",e)}getClearcoatNormalTexture(){return this.getRef("clearcoatNormalTexture")}getClearcoatNormalTextureInfo(){return this.getRef("clearcoatNormalTexture")?this.getRef("clearcoatNormalTextureInfo"):null}setClearcoatNormalTexture(e){return this.setRef("clearcoatNormalTexture",e,{channels:hn|pn|ki})}}Zn.EXTENSION_NAME=Ne;class Qn extends Z{constructor(...e){super(...e),this.extensionName=Ne,this.prereadTypes=[M.MESH],this.prewriteTypes=[M.MESH]}createClearcoat(){return new Zn(this.document.getGraph())}read(e){return this}write(e){return this}preread(e){const t=e.jsonDoc,n=t.json.materials||[],i=t.json.textures||[];return n.forEach((o,r)=>{if(o.extensions&&o.extensions[Ne]){const a=this.createClearcoat();e.materials[r].setExtension(Ne,a);const u=o.extensions[Ne];if(u.clearcoatFactor!==void 0&&a.setClearcoatFactor(u.clearcoatFactor),u.clearcoatRoughnessFactor!==void 0&&a.setClearcoatRoughnessFactor(u.clearcoatRoughnessFactor),u.clearcoatTexture!==void 0){const f=u.clearcoatTexture,h=e.textures[i[f.index].source];a.setClearcoatTexture(h),e.setTextureInfo(a.getClearcoatTextureInfo(),f)}if(u.clearcoatRoughnessTexture!==void 0){const f=u.clearcoatRoughnessTexture,h=e.textures[i[f.index].source];a.setClearcoatRoughnessTexture(h),e.setTextureInfo(a.getClearcoatRoughnessTextureInfo(),f)}if(u.clearcoatNormalTexture!==void 0){const f=u.clearcoatNormalTexture,h=e.textures[i[f.index].source];a.setClearcoatNormalTexture(h),e.setTextureInfo(a.getClearcoatNormalTextureInfo(),f),f.scale!==void 0&&a.setClearcoatNormalScale(f.scale)}}}),this}prewrite(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const i=n.getExtension(Ne);if(i){const o=e.materialIndexMap.get(n),r=t.json.materials[o];r.extensions=r.extensions||{};const a=r.extensions[Ne]={clearcoatFactor:i.getClearcoatFactor(),clearcoatRoughnessFactor:i.getClearcoatRoughnessFactor()};if(i.getClearcoatTexture()){const u=i.getClearcoatTexture(),f=i.getClearcoatTextureInfo();a.clearcoatTexture=e.createTextureInfoDef(u,f)}if(i.getClearcoatRoughnessTexture()){const u=i.getClearcoatRoughnessTexture(),f=i.getClearcoatRoughnessTextureInfo();a.clearcoatRoughnessTexture=e.createTextureInfoDef(u,f)}if(i.getClearcoatNormalTexture()){const u=i.getClearcoatNormalTexture(),f=i.getClearcoatNormalTextureInfo();a.clearcoatNormalTexture=e.createTextureInfoDef(u,f),i.getClearcoatNormalScale()!==1&&(a.clearcoatNormalTexture.scale=i.getClearcoatNormalScale())}}}),this}}Qn.EXTENSION_NAME=Ne;const{R:Fi,G:ji,B:Bi,A:Li}=Ve;class Jn extends ie{init(){this.extensionName=ve,this.propertyType="DiffuseTransmission",this.parentTypes=[M.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{diffuseTransmissionFactor:0,diffuseTransmissionTexture:null,diffuseTransmissionTextureInfo:new he(this.graph,"diffuseTransmissionTextureInfo"),diffuseTransmissionColorFactor:[1,1,1],diffuseTransmissionColorTexture:null,diffuseTransmissionColorTextureInfo:new he(this.graph,"diffuseTransmissionColorTextureInfo")})}getDiffuseTransmissionFactor(){return this.get("diffuseTransmissionFactor")}setDiffuseTransmissionFactor(e){return this.set("diffuseTransmissionFactor",e)}getDiffuseTransmissionTexture(){return this.getRef("diffuseTransmissionTexture")}getDiffuseTransmissionTextureInfo(){return this.getRef("diffuseTransmissionTexture")?this.getRef("diffuseTransmissionTextureInfo"):null}setDiffuseTransmissionTexture(e){return this.setRef("diffuseTransmissionTexture",e,{channels:Li})}getDiffuseTransmissionColorFactor(){return this.get("diffuseTransmissionColorFactor")}setDiffuseTransmissionColorFactor(e){return this.set("diffuseTransmissionColorFactor",e)}getDiffuseTransmissionColorTexture(){return this.getRef("diffuseTransmissionColorTexture")}getDiffuseTransmissionColorTextureInfo(){return this.getRef("diffuseTransmissionColorTexture")?this.getRef("diffuseTransmissionColorTextureInfo"):null}setDiffuseTransmissionColorTexture(e){return this.setRef("diffuseTransmissionColorTexture",e,{channels:Fi|ji|Bi})}}Jn.EXTENSION_NAME=ve;class es extends Z{constructor(...e){super(...e),this.extensionName=ve}createDiffuseTransmission(){return new Jn(this.document.getGraph())}read(e){const t=e.jsonDoc,n=t.json.materials||[],i=t.json.textures||[];return n.forEach((o,r)=>{if(o.extensions&&o.extensions[ve]){const a=this.createDiffuseTransmission();e.materials[r].setExtension(ve,a);const u=o.extensions[ve];if(u.diffuseTransmissionFactor!==void 0&&a.setDiffuseTransmissionFactor(u.diffuseTransmissionFactor),u.diffuseTransmissionColorFactor!==void 0&&a.setDiffuseTransmissionColorFactor(u.diffuseTransmissionColorFactor),u.diffuseTransmissionTexture!==void 0){const f=u.diffuseTransmissionTexture,h=e.textures[i[f.index].source];a.setDiffuseTransmissionTexture(h),e.setTextureInfo(a.getDiffuseTransmissionTextureInfo(),f)}if(u.diffuseTransmissionColorTexture!==void 0){const f=u.diffuseTransmissionColorTexture,h=e.textures[i[f.index].source];a.setDiffuseTransmissionColorTexture(h),e.setTextureInfo(a.getDiffuseTransmissionColorTextureInfo(),f)}}}),this}write(e){const t=e.jsonDoc;for(const n of this.document.getRoot().listMaterials()){const i=n.getExtension(ve);if(!i)continue;const o=e.materialIndexMap.get(n),r=t.json.materials[o];r.extensions=r.extensions||{};const a=r.extensions[ve]={diffuseTransmissionFactor:i.getDiffuseTransmissionFactor(),diffuseTransmissionColorFactor:i.getDiffuseTransmissionColorFactor()};if(i.getDiffuseTransmissionTexture()){const u=i.getDiffuseTransmissionTexture(),f=i.getDiffuseTransmissionTextureInfo();a.diffuseTransmissionTexture=e.createTextureInfoDef(u,f)}if(i.getDiffuseTransmissionColorTexture()){const u=i.getDiffuseTransmissionColorTexture(),f=i.getDiffuseTransmissionColorTextureInfo();a.diffuseTransmissionColorTexture=e.createTextureInfoDef(u,f)}}return this}}es.EXTENSION_NAME=ve;class ts extends ie{init(){this.extensionName=Me,this.propertyType="Dispersion",this.parentTypes=[M.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{dispersion:0})}getDispersion(){return this.get("dispersion")}setDispersion(e){return this.set("dispersion",e)}}ts.EXTENSION_NAME=Me;class ns extends Z{constructor(...e){super(...e),this.extensionName=Me,this.prereadTypes=[M.MESH],this.prewriteTypes=[M.MESH]}createDispersion(){return new ts(this.document.getGraph())}read(e){return this}write(e){return this}preread(e){return(e.jsonDoc.json.materials||[]).forEach((i,o)=>{if(i.extensions&&i.extensions[Me]){const r=this.createDispersion();e.materials[o].setExtension(Me,r);const a=i.extensions[Me];a.dispersion!==void 0&&r.setDispersion(a.dispersion)}}),this}prewrite(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const i=n.getExtension(Me);if(i){const o=e.materialIndexMap.get(n),r=t.json.materials[o];r.extensions=r.extensions||{},r.extensions[Me]={dispersion:i.getDispersion()}}}),this}}ns.EXTENSION_NAME=Me;class ss extends ie{init(){this.extensionName=Ce,this.propertyType="EmissiveStrength",this.parentTypes=[M.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{emissiveStrength:1})}getEmissiveStrength(){return this.get("emissiveStrength")}setEmissiveStrength(e){return this.set("emissiveStrength",e)}}ss.EXTENSION_NAME=Ce;class is extends Z{constructor(...e){super(...e),this.extensionName=Ce,this.prereadTypes=[M.MESH],this.prewriteTypes=[M.MESH]}createEmissiveStrength(){return new ss(this.document.getGraph())}read(e){return this}write(e){return this}preread(e){return(e.jsonDoc.json.materials||[]).forEach((i,o)=>{if(i.extensions&&i.extensions[Ce]){const r=this.createEmissiveStrength();e.materials[o].setExtension(Ce,r);const a=i.extensions[Ce];a.emissiveStrength!==void 0&&r.setEmissiveStrength(a.emissiveStrength)}}),this}prewrite(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const i=n.getExtension(Ce);if(i){const o=e.materialIndexMap.get(n),r=t.json.materials[o];r.extensions=r.extensions||{},r.extensions[Ce]={emissiveStrength:i.getEmissiveStrength()}}}),this}}is.EXTENSION_NAME=Ce;class rs extends ie{init(){this.extensionName=Oe,this.propertyType="IOR",this.parentTypes=[M.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{ior:1.5})}getIOR(){return this.get("ior")}setIOR(e){return this.set("ior",e)}}rs.EXTENSION_NAME=Oe;class os extends Z{constructor(...e){super(...e),this.extensionName=Oe,this.prereadTypes=[M.MESH],this.prewriteTypes=[M.MESH]}createIOR(){return new rs(this.document.getGraph())}read(e){return this}write(e){return this}preread(e){return(e.jsonDoc.json.materials||[]).forEach((i,o)=>{if(i.extensions&&i.extensions[Oe]){const r=this.createIOR();e.materials[o].setExtension(Oe,r);const a=i.extensions[Oe];a.ior!==void 0&&r.setIOR(a.ior)}}),this}prewrite(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const i=n.getExtension(Oe);if(i){const o=e.materialIndexMap.get(n),r=t.json.materials[o];r.extensions=r.extensions||{},r.extensions[Oe]={ior:i.getIOR()}}}),this}}os.EXTENSION_NAME=Oe;const{R:Pi,G:Hi}=Ve;class as extends ie{init(){this.extensionName=Ue,this.propertyType="Iridescence",this.parentTypes=[M.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{iridescenceFactor:0,iridescenceTexture:null,iridescenceTextureInfo:new he(this.graph,"iridescenceTextureInfo"),iridescenceIOR:1.3,iridescenceThicknessMinimum:100,iridescenceThicknessMaximum:400,iridescenceThicknessTexture:null,iridescenceThicknessTextureInfo:new he(this.graph,"iridescenceThicknessTextureInfo")})}getIridescenceFactor(){return this.get("iridescenceFactor")}setIridescenceFactor(e){return this.set("iridescenceFactor",e)}getIridescenceTexture(){return this.getRef("iridescenceTexture")}getIridescenceTextureInfo(){return this.getRef("iridescenceTexture")?this.getRef("iridescenceTextureInfo"):null}setIridescenceTexture(e){return this.setRef("iridescenceTexture",e,{channels:Pi})}getIridescenceIOR(){return this.get("iridescenceIOR")}setIridescenceIOR(e){return this.set("iridescenceIOR",e)}getIridescenceThicknessMinimum(){return this.get("iridescenceThicknessMinimum")}setIridescenceThicknessMinimum(e){return this.set("iridescenceThicknessMinimum",e)}getIridescenceThicknessMaximum(){return this.get("iridescenceThicknessMaximum")}setIridescenceThicknessMaximum(e){return this.set("iridescenceThicknessMaximum",e)}getIridescenceThicknessTexture(){return this.getRef("iridescenceThicknessTexture")}getIridescenceThicknessTextureInfo(){return this.getRef("iridescenceThicknessTexture")?this.getRef("iridescenceThicknessTextureInfo"):null}setIridescenceThicknessTexture(e){return this.setRef("iridescenceThicknessTexture",e,{channels:Hi})}}as.EXTENSION_NAME=Ue;class cs extends Z{constructor(...e){super(...e),this.extensionName=Ue,this.prereadTypes=[M.MESH],this.prewriteTypes=[M.MESH]}createIridescence(){return new as(this.document.getGraph())}read(e){return this}write(e){return this}preread(e){const t=e.jsonDoc,n=t.json.materials||[],i=t.json.textures||[];return n.forEach((o,r)=>{if(o.extensions&&o.extensions[Ue]){const a=this.createIridescence();e.materials[r].setExtension(Ue,a);const u=o.extensions[Ue];if(u.iridescenceFactor!==void 0&&a.setIridescenceFactor(u.iridescenceFactor),u.iridescenceIor!==void 0&&a.setIridescenceIOR(u.iridescenceIor),u.iridescenceThicknessMinimum!==void 0&&a.setIridescenceThicknessMinimum(u.iridescenceThicknessMinimum),u.iridescenceThicknessMaximum!==void 0&&a.setIridescenceThicknessMaximum(u.iridescenceThicknessMaximum),u.iridescenceTexture!==void 0){const f=u.iridescenceTexture,h=e.textures[i[f.index].source];a.setIridescenceTexture(h),e.setTextureInfo(a.getIridescenceTextureInfo(),f)}if(u.iridescenceThicknessTexture!==void 0){const f=u.iridescenceThicknessTexture,h=e.textures[i[f.index].source];a.setIridescenceThicknessTexture(h),e.setTextureInfo(a.getIridescenceThicknessTextureInfo(),f)}}}),this}prewrite(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const i=n.getExtension(Ue);if(i){const o=e.materialIndexMap.get(n),r=t.json.materials[o];r.extensions=r.extensions||{};const a=r.extensions[Ue]={};if(i.getIridescenceFactor()>0&&(a.iridescenceFactor=i.getIridescenceFactor()),i.getIridescenceIOR()!==1.3&&(a.iridescenceIor=i.getIridescenceIOR()),i.getIridescenceThicknessMinimum()!==100&&(a.iridescenceThicknessMinimum=i.getIridescenceThicknessMinimum()),i.getIridescenceThicknessMaximum()!==400&&(a.iridescenceThicknessMaximum=i.getIridescenceThicknessMaximum()),i.getIridescenceTexture()){const u=i.getIridescenceTexture(),f=i.getIridescenceTextureInfo();a.iridescenceTexture=e.createTextureInfoDef(u,f)}if(i.getIridescenceThicknessTexture()){const u=i.getIridescenceThicknessTexture(),f=i.getIridescenceThicknessTextureInfo();a.iridescenceThicknessTexture=e.createTextureInfoDef(u,f)}}}),this}}cs.EXTENSION_NAME=Ue;const{R:xn,G:gn,B:_n,A:mn}=Ve;class us extends ie{init(){this.extensionName=ke,this.propertyType="PBRSpecularGlossiness",this.parentTypes=[M.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{diffuseFactor:[1,1,1,1],diffuseTexture:null,diffuseTextureInfo:new he(this.graph,"diffuseTextureInfo"),specularFactor:[1,1,1],glossinessFactor:1,specularGlossinessTexture:null,specularGlossinessTextureInfo:new he(this.graph,"specularGlossinessTextureInfo")})}getDiffuseFactor(){return this.get("diffuseFactor")}setDiffuseFactor(e){return this.set("diffuseFactor",e)}getDiffuseTexture(){return this.getRef("diffuseTexture")}getDiffuseTextureInfo(){return this.getRef("diffuseTexture")?this.getRef("diffuseTextureInfo"):null}setDiffuseTexture(e){return this.setRef("diffuseTexture",e,{channels:xn|gn|_n|mn,isColor:!0})}getSpecularFactor(){return this.get("specularFactor")}setSpecularFactor(e){return this.set("specularFactor",e)}getGlossinessFactor(){return this.get("glossinessFactor")}setGlossinessFactor(e){return this.set("glossinessFactor",e)}getSpecularGlossinessTexture(){return this.getRef("specularGlossinessTexture")}getSpecularGlossinessTextureInfo(){return this.getRef("specularGlossinessTexture")?this.getRef("specularGlossinessTextureInfo"):null}setSpecularGlossinessTexture(e){return this.setRef("specularGlossinessTexture",e,{channels:xn|gn|_n|mn})}}us.EXTENSION_NAME=ke;class fs extends Z{constructor(...e){super(...e),this.extensionName=ke,this.prereadTypes=[M.MESH],this.prewriteTypes=[M.MESH]}createPBRSpecularGlossiness(){return new us(this.document.getGraph())}read(e){return this}write(e){return this}preread(e){const t=e.jsonDoc,n=t.json.materials||[],i=t.json.textures||[];return n.forEach((o,r)=>{if(o.extensions&&o.extensions[ke]){const a=this.createPBRSpecularGlossiness();e.materials[r].setExtension(ke,a);const u=o.extensions[ke];if(u.diffuseFactor!==void 0&&a.setDiffuseFactor(u.diffuseFactor),u.specularFactor!==void 0&&a.setSpecularFactor(u.specularFactor),u.glossinessFactor!==void 0&&a.setGlossinessFactor(u.glossinessFactor),u.diffuseTexture!==void 0){const f=u.diffuseTexture,h=e.textures[i[f.index].source];a.setDiffuseTexture(h),e.setTextureInfo(a.getDiffuseTextureInfo(),f)}if(u.specularGlossinessTexture!==void 0){const f=u.specularGlossinessTexture,h=e.textures[i[f.index].source];a.setSpecularGlossinessTexture(h),e.setTextureInfo(a.getSpecularGlossinessTextureInfo(),f)}}}),this}prewrite(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const i=n.getExtension(ke);if(i){const o=e.materialIndexMap.get(n),r=t.json.materials[o];r.extensions=r.extensions||{};const a=r.extensions[ke]={diffuseFactor:i.getDiffuseFactor(),specularFactor:i.getSpecularFactor(),glossinessFactor:i.getGlossinessFactor()};if(i.getDiffuseTexture()){const u=i.getDiffuseTexture(),f=i.getDiffuseTextureInfo();a.diffuseTexture=e.createTextureInfoDef(u,f)}if(i.getSpecularGlossinessTexture()){const u=i.getSpecularGlossinessTexture(),f=i.getSpecularGlossinessTextureInfo();a.specularGlossinessTexture=e.createTextureInfoDef(u,f)}}}),this}}fs.EXTENSION_NAME=ke;const{R:Gi,G:Vi,B:zi,A:Ki}=Ve;class ls extends ie{init(){this.extensionName=Fe,this.propertyType="Sheen",this.parentTypes=[M.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{sheenColorFactor:[0,0,0],sheenColorTexture:null,sheenColorTextureInfo:new he(this.graph,"sheenColorTextureInfo"),sheenRoughnessFactor:0,sheenRoughnessTexture:null,sheenRoughnessTextureInfo:new he(this.graph,"sheenRoughnessTextureInfo")})}getSheenColorFactor(){return this.get("sheenColorFactor")}setSheenColorFactor(e){return this.set("sheenColorFactor",e)}getSheenColorTexture(){return this.getRef("sheenColorTexture")}getSheenColorTextureInfo(){return this.getRef("sheenColorTexture")?this.getRef("sheenColorTextureInfo"):null}setSheenColorTexture(e){return this.setRef("sheenColorTexture",e,{channels:Gi|Vi|zi,isColor:!0})}getSheenRoughnessFactor(){return this.get("sheenRoughnessFactor")}setSheenRoughnessFactor(e){return this.set("sheenRoughnessFactor",e)}getSheenRoughnessTexture(){return this.getRef("sheenRoughnessTexture")}getSheenRoughnessTextureInfo(){return this.getRef("sheenRoughnessTexture")?this.getRef("sheenRoughnessTextureInfo"):null}setSheenRoughnessTexture(e){return this.setRef("sheenRoughnessTexture",e,{channels:Ki})}}ls.EXTENSION_NAME=Fe;class ds extends Z{constructor(...e){super(...e),this.extensionName=Fe,this.prereadTypes=[M.MESH],this.prewriteTypes=[M.MESH]}createSheen(){return new ls(this.document.getGraph())}read(e){return this}write(e){return this}preread(e){const t=e.jsonDoc,n=t.json.materials||[],i=t.json.textures||[];return n.forEach((o,r)=>{if(o.extensions&&o.extensions[Fe]){const a=this.createSheen();e.materials[r].setExtension(Fe,a);const u=o.extensions[Fe];if(u.sheenColorFactor!==void 0&&a.setSheenColorFactor(u.sheenColorFactor),u.sheenRoughnessFactor!==void 0&&a.setSheenRoughnessFactor(u.sheenRoughnessFactor),u.sheenColorTexture!==void 0){const f=u.sheenColorTexture,h=e.textures[i[f.index].source];a.setSheenColorTexture(h),e.setTextureInfo(a.getSheenColorTextureInfo(),f)}if(u.sheenRoughnessTexture!==void 0){const f=u.sheenRoughnessTexture,h=e.textures[i[f.index].source];a.setSheenRoughnessTexture(h),e.setTextureInfo(a.getSheenRoughnessTextureInfo(),f)}}}),this}prewrite(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const i=n.getExtension(Fe);if(i){const o=e.materialIndexMap.get(n),r=t.json.materials[o];r.extensions=r.extensions||{};const a=r.extensions[Fe]={sheenColorFactor:i.getSheenColorFactor(),sheenRoughnessFactor:i.getSheenRoughnessFactor()};if(i.getSheenColorTexture()){const u=i.getSheenColorTexture(),f=i.getSheenColorTextureInfo();a.sheenColorTexture=e.createTextureInfoDef(u,f)}if(i.getSheenRoughnessTexture()){const u=i.getSheenRoughnessTexture(),f=i.getSheenRoughnessTextureInfo();a.sheenRoughnessTexture=e.createTextureInfoDef(u,f)}}}),this}}ds.EXTENSION_NAME=Fe;const{R:Xi,G:$i,B:Wi,A:qi}=Ve;class hs extends ie{init(){this.extensionName=je,this.propertyType="Specular",this.parentTypes=[M.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{specularFactor:1,specularTexture:null,specularTextureInfo:new he(this.graph,"specularTextureInfo"),specularColorFactor:[1,1,1],specularColorTexture:null,specularColorTextureInfo:new he(this.graph,"specularColorTextureInfo")})}getSpecularFactor(){return this.get("specularFactor")}setSpecularFactor(e){return this.set("specularFactor",e)}getSpecularColorFactor(){return this.get("specularColorFactor")}setSpecularColorFactor(e){return this.set("specularColorFactor",e)}getSpecularTexture(){return this.getRef("specularTexture")}getSpecularTextureInfo(){return this.getRef("specularTexture")?this.getRef("specularTextureInfo"):null}setSpecularTexture(e){return this.setRef("specularTexture",e,{channels:qi})}getSpecularColorTexture(){return this.getRef("specularColorTexture")}getSpecularColorTextureInfo(){return this.getRef("specularColorTexture")?this.getRef("specularColorTextureInfo"):null}setSpecularColorTexture(e){return this.setRef("specularColorTexture",e,{channels:Xi|$i|Wi,isColor:!0})}}hs.EXTENSION_NAME=je;class ps extends Z{constructor(...e){super(...e),this.extensionName=je,this.prereadTypes=[M.MESH],this.prewriteTypes=[M.MESH]}createSpecular(){return new hs(this.document.getGraph())}read(e){return this}write(e){return this}preread(e){const t=e.jsonDoc,n=t.json.materials||[],i=t.json.textures||[];return n.forEach((o,r)=>{if(o.extensions&&o.extensions[je]){const a=this.createSpecular();e.materials[r].setExtension(je,a);const u=o.extensions[je];if(u.specularFactor!==void 0&&a.setSpecularFactor(u.specularFactor),u.specularColorFactor!==void 0&&a.setSpecularColorFactor(u.specularColorFactor),u.specularTexture!==void 0){const f=u.specularTexture,h=e.textures[i[f.index].source];a.setSpecularTexture(h),e.setTextureInfo(a.getSpecularTextureInfo(),f)}if(u.specularColorTexture!==void 0){const f=u.specularColorTexture,h=e.textures[i[f.index].source];a.setSpecularColorTexture(h),e.setTextureInfo(a.getSpecularColorTextureInfo(),f)}}}),this}prewrite(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const i=n.getExtension(je);if(i){const o=e.materialIndexMap.get(n),r=t.json.materials[o];r.extensions=r.extensions||{};const a=r.extensions[je]={};if(i.getSpecularFactor()!==1&&(a.specularFactor=i.getSpecularFactor()),dt.eq(i.getSpecularColorFactor(),[1,1,1])||(a.specularColorFactor=i.getSpecularColorFactor()),i.getSpecularTexture()){const u=i.getSpecularTexture(),f=i.getSpecularTextureInfo();a.specularTexture=e.createTextureInfoDef(u,f)}if(i.getSpecularColorTexture()){const u=i.getSpecularColorTexture(),f=i.getSpecularColorTextureInfo();a.specularColorTexture=e.createTextureInfoDef(u,f)}}}),this}}ps.EXTENSION_NAME=je;const{R:Yi}=Ve;class xs extends ie{init(){this.extensionName=Be,this.propertyType="Transmission",this.parentTypes=[M.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{transmissionFactor:0,transmissionTexture:null,transmissionTextureInfo:new he(this.graph,"transmissionTextureInfo")})}getTransmissionFactor(){return this.get("transmissionFactor")}setTransmissionFactor(e){return this.set("transmissionFactor",e)}getTransmissionTexture(){return this.getRef("transmissionTexture")}getTransmissionTextureInfo(){return this.getRef("transmissionTexture")?this.getRef("transmissionTextureInfo"):null}setTransmissionTexture(e){return this.setRef("transmissionTexture",e,{channels:Yi})}}xs.EXTENSION_NAME=Be;class gs extends Z{constructor(...e){super(...e),this.extensionName=Be,this.prereadTypes=[M.MESH],this.prewriteTypes=[M.MESH]}createTransmission(){return new xs(this.document.getGraph())}read(e){return this}write(e){return this}preread(e){const t=e.jsonDoc,n=t.json.materials||[],i=t.json.textures||[];return n.forEach((o,r)=>{if(o.extensions&&o.extensions[Be]){const a=this.createTransmission();e.materials[r].setExtension(Be,a);const u=o.extensions[Be];if(u.transmissionFactor!==void 0&&a.setTransmissionFactor(u.transmissionFactor),u.transmissionTexture!==void 0){const f=u.transmissionTexture,h=e.textures[i[f.index].source];a.setTransmissionTexture(h),e.setTextureInfo(a.getTransmissionTextureInfo(),f)}}}),this}prewrite(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const i=n.getExtension(Be);if(i){const o=e.materialIndexMap.get(n),r=t.json.materials[o];r.extensions=r.extensions||{};const a=r.extensions[Be]={transmissionFactor:i.getTransmissionFactor()};if(i.getTransmissionTexture()){const u=i.getTransmissionTexture(),f=i.getTransmissionTextureInfo();a.transmissionTexture=e.createTextureInfoDef(u,f)}}}),this}}gs.EXTENSION_NAME=Be;class _s extends ie{init(){this.extensionName=$e,this.propertyType="Unlit",this.parentTypes=[M.MATERIAL]}}_s.EXTENSION_NAME=$e;class ms extends Z{constructor(...e){super(...e),this.extensionName=$e,this.prereadTypes=[M.MESH],this.prewriteTypes=[M.MESH]}createUnlit(){return new _s(this.document.getGraph())}read(e){return this}write(e){return this}preread(e){return(e.jsonDoc.json.materials||[]).forEach((n,i)=>{n.extensions&&n.extensions[$e]&&e.materials[i].setExtension($e,this.createUnlit())}),this}prewrite(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{if(n.getExtension($e)){const i=e.materialIndexMap.get(n),o=t.json.materials[i];o.extensions=o.extensions||{},o.extensions[$e]={}}}),this}}ms.EXTENSION_NAME=$e;class Ts extends ie{init(){this.extensionName=de,this.propertyType="Mapping",this.parentTypes=["MappingList"]}getDefaults(){return Object.assign(super.getDefaults(),{material:null,variants:new Bn})}getMaterial(){return this.getRef("material")}setMaterial(e){return this.setRef("material",e)}addVariant(e){return this.addRef("variants",e)}removeVariant(e){return this.removeRef("variants",e)}listVariants(){return this.listRefs("variants")}}Ts.EXTENSION_NAME=de;class ys extends ie{init(){this.extensionName=de,this.propertyType="MappingList",this.parentTypes=[M.PRIMITIVE]}getDefaults(){return Object.assign(super.getDefaults(),{mappings:new Bn})}addMapping(e){return this.addRef("mappings",e)}removeMapping(e){return this.removeRef("mappings",e)}listMappings(){return this.listRefs("mappings")}}ys.EXTENSION_NAME=de;class kt extends ie{init(){this.extensionName=de,this.propertyType="Variant",this.parentTypes=["MappingList"]}}kt.EXTENSION_NAME=de;class ws extends Z{constructor(...e){super(...e),this.extensionName=de}createMappingList(){return new ys(this.document.getGraph())}createVariant(e=""){return new kt(this.document.getGraph(),e)}createMapping(){return new Ts(this.document.getGraph())}listVariants(){return Array.from(this.properties).filter(e=>e instanceof kt)}read(e){const t=e.jsonDoc;if(!t.json.extensions||!t.json.extensions[de])return this;const o=(t.json.extensions[de].variants||[]).map(a=>this.createVariant().setName(a.name||""));return(t.json.meshes||[]).forEach((a,u)=>{const f=e.meshes[u];(a.primitives||[]).forEach((p,T)=>{if(!p.extensions||!p.extensions[de])return;const y=this.createMappingList(),l=p.extensions[de];for(const g of l.mappings){const c=this.createMapping();g.material!==void 0&&c.setMaterial(e.materials[g.material]);for(const d of g.variants||[])c.addVariant(o[d]);y.addMapping(c)}f.listPrimitives()[T].setExtension(de,y)})}),this}write(e){const t=e.jsonDoc,n=this.listVariants();if(!n.length)return this;const i=[],o=new Map;for(const r of n)o.set(r,i.length),i.push(e.createPropertyDef(r));for(const r of this.document.getRoot().listMeshes()){const a=e.meshIndexMap.get(r);r.listPrimitives().forEach((u,f)=>{const h=u.getExtension(de);if(!h)return;const p=e.jsonDoc.json.meshes[a].primitives[f],T=h.listMappings().map(y=>{const l=e.createPropertyDef(y),g=y.getMaterial();return g&&(l.material=e.materialIndexMap.get(g)),l.variants=y.listVariants().map(c=>o.get(c)),l});p.extensions=p.extensions||{},p.extensions[de]={mappings:T}})}return t.json.extensions=t.json.extensions||{},t.json.extensions[de]={variants:i},this}}ws.EXTENSION_NAME=de;const{G:Zi}=Ve;class Es extends ie{init(){this.extensionName=Le,this.propertyType="Volume",this.parentTypes=[M.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{thicknessFactor:0,thicknessTexture:null,thicknessTextureInfo:new he(this.graph,"thicknessTexture"),attenuationDistance:1/0,attenuationColor:[1,1,1]})}getThicknessFactor(){return this.get("thicknessFactor")}setThicknessFactor(e){return this.set("thicknessFactor",e)}getThicknessTexture(){return this.getRef("thicknessTexture")}getThicknessTextureInfo(){return this.getRef("thicknessTexture")?this.getRef("thicknessTextureInfo"):null}setThicknessTexture(e){return this.setRef("thicknessTexture",e,{channels:Zi})}getAttenuationDistance(){return this.get("attenuationDistance")}setAttenuationDistance(e){return this.set("attenuationDistance",e)}getAttenuationColor(){return this.get("attenuationColor")}setAttenuationColor(e){return this.set("attenuationColor",e)}}Es.EXTENSION_NAME=Le;class Is extends Z{constructor(...e){super(...e),this.extensionName=Le,this.prereadTypes=[M.MESH],this.prewriteTypes=[M.MESH]}createVolume(){return new Es(this.document.getGraph())}read(e){return this}write(e){return this}preread(e){const t=e.jsonDoc,n=t.json.materials||[],i=t.json.textures||[];return n.forEach((o,r)=>{if(o.extensions&&o.extensions[Le]){const a=this.createVolume();e.materials[r].setExtension(Le,a);const u=o.extensions[Le];if(u.thicknessFactor!==void 0&&a.setThicknessFactor(u.thicknessFactor),u.attenuationDistance!==void 0&&a.setAttenuationDistance(u.attenuationDistance),u.attenuationColor!==void 0&&a.setAttenuationColor(u.attenuationColor),u.thicknessTexture!==void 0){const f=u.thicknessTexture,h=e.textures[i[f.index].source];a.setThicknessTexture(h),e.setTextureInfo(a.getThicknessTextureInfo(),f)}}}),this}prewrite(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const i=n.getExtension(Le);if(i){const o=e.materialIndexMap.get(n),r=t.json.materials[o];r.extensions=r.extensions||{};const a=r.extensions[Le]={};if(i.getThicknessFactor()>0&&(a.thicknessFactor=i.getThicknessFactor()),Number.isFinite(i.getAttenuationDistance())&&(a.attenuationDistance=i.getAttenuationDistance()),dt.eq(i.getAttenuationColor(),[1,1,1])||(a.attenuationColor=i.getAttenuationColor()),i.getThicknessTexture()){const u=i.getThicknessTexture(),f=i.getThicknessTextureInfo();a.thicknessTexture=e.createTextureInfoDef(u,f)}}}),this}}Is.EXTENSION_NAME=Le;class bs extends Z{constructor(...e){super(...e),this.extensionName=Ln}read(e){return this}write(e){return this}}bs.EXTENSION_NAME=Ln;class Qi{match(e){return e[0]===171&&e[1]===75&&e[2]===84&&e[3]===88&&e[4]===32&&e[5]===50&&e[6]===48&&e[7]===187&&e[8]===13&&e[9]===10&&e[10]===26&&e[11]===10}getSize(e){const t=Dt(e);return[t.pixelWidth,t.pixelHeight]}getChannels(e){const n=Dt(e).dataFormatDescriptor[0];if(n.colorModel===ii)return n.samples.length===2&&(n.samples[1].channelType&15)===15?4:3;if(n.colorModel===ri)return(n.samples[0].channelType&15)===3?4:3;throw new Error(`Unexpected KTX2 colorModel, "${n.colorModel}".`)}getVRAMByteLength(e){const t=Dt(e),n=this.getChannels(e)>3;let i=0;for(let o=0;o<t.levels.length;o++){const r=t.levels[o];if(r.uncompressedByteLength)i+=r.uncompressedByteLength;else{const a=Math.max(1,Math.floor(t.pixelWidth/Math.pow(2,o))),u=Math.max(1,Math.floor(t.pixelHeight/Math.pow(2,o))),f=n?16:8;i+=a/4*(u/4)*f}}return i}}class Rs extends Z{constructor(...e){super(...e),this.extensionName=at,this.prereadTypes=[M.TEXTURE]}static register(){Wt.registerFormat("image/ktx2",new Qi)}preread(e){return e.jsonDoc.json.textures.forEach(t=>{if(t.extensions&&t.extensions[at]){const n=t.extensions[at];t.source=n.source}}),this}read(e){return this}write(e){const t=e.jsonDoc;return this.document.getRoot().listTextures().forEach(n=>{if(n.getMimeType()==="image/ktx2"){const i=e.imageIndexMap.get(n);t.json.textures.forEach(o=>{o.source===i&&(o.extensions=o.extensions||{},o.extensions[at]={source:o.source},delete o.source)})}}),this}}Rs.EXTENSION_NAME=at;class Ds extends ie{init(){this.extensionName=Pe,this.propertyType="Transform",this.parentTypes=[M.TEXTURE_INFO]}getDefaults(){return Object.assign(super.getDefaults(),{offset:[0,0],rotation:0,scale:[1,1],texCoord:null})}getOffset(){return this.get("offset")}setOffset(e){return this.set("offset",e)}getRotation(){return this.get("rotation")}setRotation(e){return this.set("rotation",e)}getScale(){return this.get("scale")}setScale(e){return this.set("scale",e)}getTexCoord(){return this.get("texCoord")}setTexCoord(e){return this.set("texCoord",e)}}Ds.EXTENSION_NAME=Pe;class Ss extends Z{constructor(...e){super(...e),this.extensionName=Pe}createTransform(){return new Ds(this.document.getGraph())}read(e){for(const[t,n]of Array.from(e.textureInfos.entries())){if(!n.extensions||!n.extensions[Pe])continue;const i=this.createTransform(),o=n.extensions[Pe];o.offset!==void 0&&i.setOffset(o.offset),o.rotation!==void 0&&i.setRotation(o.rotation),o.scale!==void 0&&i.setScale(o.scale),o.texCoord!==void 0&&i.setTexCoord(o.texCoord),t.setExtension(Pe,i)}return this}write(e){const t=Array.from(e.textureInfoDefMap.entries());for(const[n,i]of t){const o=n.getExtension(Pe);if(!o)continue;i.extensions=i.extensions||{};const r={},a=dt.eq;a(o.getOffset(),[0,0])||(r.offset=o.getOffset()),o.getRotation()!==0&&(r.rotation=o.getRotation()),a(o.getScale(),[1,1])||(r.scale=o.getScale()),o.getTexCoord()!=null&&(r.texCoord=o.getTexCoord()),i.extensions[Pe]=r}return this}}Ss.EXTENSION_NAME=Pe;const Ji=[M.ROOT,M.SCENE,M.NODE,M.MESH,M.MATERIAL,M.TEXTURE,M.ANIMATION];class As extends ie{init(){this.extensionName=ye,this.propertyType="Packet",this.parentTypes=Ji}getDefaults(){return Object.assign(super.getDefaults(),{context:{},properties:{}})}getContext(){return this.get("context")}setContext(e){return this.set("context",Ge({},e))}listProperties(){return Object.keys(this.get("properties"))}getProperty(e){const t=this.get("properties");return e in t?t[e]:null}setProperty(e,t){this._assertContext(e);const n=Ge({},this.get("properties"));return t?n[e]=t:delete n[e],this.set("properties",n)}toJSONLD(){const e=St(this.get("context")),t=St(this.get("properties"));return Ge({"@context":e},t)}fromJSONLD(e){e=St(e);const t=e["@context"];return t&&this.set("context",t),delete e["@context"],this.set("properties",e)}_assertContext(e){if(!(e.split(":")[0]in this.get("context")))throw new Error(`${ye}: Missing context for term, "${e}".`)}}As.EXTENSION_NAME=ye;function St(s){return JSON.parse(JSON.stringify(s))}class Ns extends Z{constructor(...e){super(...e),this.extensionName=ye}createPacket(){return new As(this.document.getGraph())}listPackets(){return Array.from(this.properties)}read(e){var t;const n=(t=e.jsonDoc.json.extensions)==null?void 0:t[ye];if(!n||!n.packets)return this;const i=e.jsonDoc.json,o=this.document.getRoot(),r=n.packets.map(f=>this.createPacket().fromJSONLD(f)),a=[[i.asset],i.scenes,i.nodes,i.meshes,i.materials,i.images,i.animations],u=[[o],o.listScenes(),o.listNodes(),o.listMeshes(),o.listMaterials(),o.listTextures(),o.listAnimations()];for(let f=0;f<a.length;f++){const h=a[f]||[];for(let p=0;p<h.length;p++){const T=h[p];if(T.extensions&&T.extensions[ye]){const y=T.extensions[ye];u[f][p].setExtension(ye,r[y.packet])}}}return this}write(e){const{json:t}=e.jsonDoc,n=[];for(const i of this.properties){n.push(i.toJSONLD());for(const o of i.listParents()){let r;switch(o.propertyType){case M.ROOT:r=t.asset;break;case M.SCENE:r=t.scenes[e.sceneIndexMap.get(o)];break;case M.NODE:r=t.nodes[e.nodeIndexMap.get(o)];break;case M.MESH:r=t.meshes[e.meshIndexMap.get(o)];break;case M.MATERIAL:r=t.materials[e.materialIndexMap.get(o)];break;case M.TEXTURE:r=t.images[e.imageIndexMap.get(o)];break;case M.ANIMATION:r=t.animations[e.animationIndexMap.get(o)];break;default:r=null,this.document.getLogger().warn(`[${ye}]: Unsupported parent property, "${o.propertyType}"`);break}r&&(r.extensions=r.extensions||{},r.extensions[ye]={packet:n.length-1})}}return n.length>0&&(t.extensions=t.extensions||{},t.extensions[ye]={packets:n}),this}}Ns.EXTENSION_NAME=ye;const vs=[Yt,Wn,Yn,Qn,es,ns,is,os,cs,fs,ps,ds,gs,ms,ws,Is,bs,Rs,Ss,Ns];[...vs];var Tn=[0,1,2,3,4,4,5,5,6,6,6,6,7,7,7,7,8,8,8,8,8,8,8,8,9,9,9,9,9,9,9,9,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,0,0,16,17,18,18,19,19,20,20,20,20,21,21,21,21,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29];function q(){var s=this;function e(t,n){var i=0;do i|=1&t,t>>>=1,i<<=1;while(--n>0);return i>>>1}s.build_tree=function(t){var n,i,o,r=s.dyn_tree,a=s.stat_desc.static_tree,u=s.stat_desc.elems,f=-1;for(t.heap_len=0,t.heap_max=573,n=0;n<u;n++)r[2*n]!==0?(t.heap[++t.heap_len]=f=n,t.depth[n]=0):r[2*n+1]=0;for(;t.heap_len<2;)r[2*(o=t.heap[++t.heap_len]=f<2?++f:0)]=1,t.depth[o]=0,t.opt_len--,a&&(t.static_len-=a[2*o+1]);for(s.max_code=f,n=Math.floor(t.heap_len/2);n>=1;n--)t.pqdownheap(r,n);o=u;do n=t.heap[1],t.heap[1]=t.heap[t.heap_len--],t.pqdownheap(r,1),i=t.heap[1],t.heap[--t.heap_max]=n,t.heap[--t.heap_max]=i,r[2*o]=r[2*n]+r[2*i],t.depth[o]=Math.max(t.depth[n],t.depth[i])+1,r[2*n+1]=r[2*i+1]=o,t.heap[1]=o++,t.pqdownheap(r,1);while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],(function(h){var p,T,y,l,g,c,d=s.dyn_tree,_=s.stat_desc.static_tree,m=s.stat_desc.extra_bits,x=s.stat_desc.extra_base,I=s.stat_desc.max_length,E=0;for(l=0;l<=15;l++)h.bl_count[l]=0;for(d[2*h.heap[h.heap_max]+1]=0,p=h.heap_max+1;p<573;p++)(l=d[2*d[2*(T=h.heap[p])+1]+1]+1)>I&&(l=I,E++),d[2*T+1]=l,T>s.max_code||(h.bl_count[l]++,g=0,T>=x&&(g=m[T-x]),h.opt_len+=(c=d[2*T])*(l+g),_&&(h.static_len+=c*(_[2*T+1]+g)));if(E!==0){do{for(l=I-1;h.bl_count[l]===0;)l--;h.bl_count[l]--,h.bl_count[l+1]+=2,h.bl_count[I]--,E-=2}while(E>0);for(l=I;l!==0;l--)for(T=h.bl_count[l];T!==0;)(y=h.heap[--p])>s.max_code||(d[2*y+1]!=l&&(h.opt_len+=(l-d[2*y+1])*d[2*y],d[2*y+1]=l),T--)}})(t),(function(h,p,T){var y,l,g,c=[],d=0;for(y=1;y<=15;y++)c[y]=d=d+T[y-1]<<1;for(l=0;l<=p;l++)(g=h[2*l+1])!==0&&(h[2*l]=e(c[g]++,g))})(r,s.max_code,t.bl_count)}}function le(s,e,t,n,i){var o=this;o.static_tree=s,o.extra_bits=e,o.extra_base=t,o.elems=n,o.max_length=i}function De(s,e,t,n,i){var o=this;o.good_length=s,o.max_lazy=e,o.nice_length=t,o.max_chain=n,o.func=i}q._length_code=[0,1,2,3,4,5,6,7,8,8,9,9,10,10,11,11,12,12,12,12,13,13,13,13,14,14,14,14,15,15,15,15,16,16,16,16,16,16,16,16,17,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,28],q.base_length=[0,1,2,3,4,5,6,7,8,10,12,14,16,20,24,28,32,40,48,56,64,80,96,112,128,160,192,224,0],q.base_dist=[0,1,2,3,4,6,8,12,16,24,32,48,64,96,128,192,256,384,512,768,1024,1536,2048,3072,4096,6144,8192,12288,16384,24576],q.d_code=function(s){return s<256?Tn[s]:Tn[256+(s>>>7)]},q.extra_lbits=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],q.extra_dbits=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],q.extra_blbits=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],q.bl_order=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],le.static_ltree=[12,8,140,8,76,8,204,8,44,8,172,8,108,8,236,8,28,8,156,8,92,8,220,8,60,8,188,8,124,8,252,8,2,8,130,8,66,8,194,8,34,8,162,8,98,8,226,8,18,8,146,8,82,8,210,8,50,8,178,8,114,8,242,8,10,8,138,8,74,8,202,8,42,8,170,8,106,8,234,8,26,8,154,8,90,8,218,8,58,8,186,8,122,8,250,8,6,8,134,8,70,8,198,8,38,8,166,8,102,8,230,8,22,8,150,8,86,8,214,8,54,8,182,8,118,8,246,8,14,8,142,8,78,8,206,8,46,8,174,8,110,8,238,8,30,8,158,8,94,8,222,8,62,8,190,8,126,8,254,8,1,8,129,8,65,8,193,8,33,8,161,8,97,8,225,8,17,8,145,8,81,8,209,8,49,8,177,8,113,8,241,8,9,8,137,8,73,8,201,8,41,8,169,8,105,8,233,8,25,8,153,8,89,8,217,8,57,8,185,8,121,8,249,8,5,8,133,8,69,8,197,8,37,8,165,8,101,8,229,8,21,8,149,8,85,8,213,8,53,8,181,8,117,8,245,8,13,8,141,8,77,8,205,8,45,8,173,8,109,8,237,8,29,8,157,8,93,8,221,8,61,8,189,8,125,8,253,8,19,9,275,9,147,9,403,9,83,9,339,9,211,9,467,9,51,9,307,9,179,9,435,9,115,9,371,9,243,9,499,9,11,9,267,9,139,9,395,9,75,9,331,9,203,9,459,9,43,9,299,9,171,9,427,9,107,9,363,9,235,9,491,9,27,9,283,9,155,9,411,9,91,9,347,9,219,9,475,9,59,9,315,9,187,9,443,9,123,9,379,9,251,9,507,9,7,9,263,9,135,9,391,9,71,9,327,9,199,9,455,9,39,9,295,9,167,9,423,9,103,9,359,9,231,9,487,9,23,9,279,9,151,9,407,9,87,9,343,9,215,9,471,9,55,9,311,9,183,9,439,9,119,9,375,9,247,9,503,9,15,9,271,9,143,9,399,9,79,9,335,9,207,9,463,9,47,9,303,9,175,9,431,9,111,9,367,9,239,9,495,9,31,9,287,9,159,9,415,9,95,9,351,9,223,9,479,9,63,9,319,9,191,9,447,9,127,9,383,9,255,9,511,9,0,7,64,7,32,7,96,7,16,7,80,7,48,7,112,7,8,7,72,7,40,7,104,7,24,7,88,7,56,7,120,7,4,7,68,7,36,7,100,7,20,7,84,7,52,7,116,7,3,8,131,8,67,8,195,8,35,8,163,8,99,8,227,8],le.static_dtree=[0,5,16,5,8,5,24,5,4,5,20,5,12,5,28,5,2,5,18,5,10,5,26,5,6,5,22,5,14,5,30,5,1,5,17,5,9,5,25,5,5,5,21,5,13,5,29,5,3,5,19,5,11,5,27,5,7,5,23,5],le.static_l_desc=new le(le.static_ltree,q.extra_lbits,257,286,15),le.static_d_desc=new le(le.static_dtree,q.extra_dbits,0,30,15),le.static_bl_desc=new le(null,q.extra_blbits,0,19,7);var Ie=[new De(0,0,0,0,0),new De(4,4,8,4,1),new De(4,5,16,8,1),new De(4,6,32,32,1),new De(4,4,16,16,2),new De(8,16,32,32,2),new De(8,16,128,128,2),new De(8,32,128,256,2),new De(32,128,258,1024,2),new De(32,258,258,4096,2)],pt=["need dictionary","stream end","","","stream error","data error","","buffer error","",""];function yn(s,e,t,n){var i=s[2*e],o=s[2*t];return i<o||i==o&&n[e]<=n[t]}function er(){var s,e,t,n,i,o,r,a,u,f,h,p,T,y,l,g,c,d,_,m,x,I,E,w,D,U,S,R,b,k,F,L,j,$,pe,ee,P,Ee,V,z,oe,H=this,We=new q,qe=new q,tt=new q;function ht(){var v;for(v=0;v<286;v++)F[2*v]=0;for(v=0;v<30;v++)L[2*v]=0;for(v=0;v<19;v++)j[2*v]=0;F[512]=1,H.opt_len=H.static_len=0,ee=Ee=0}function ce(v,A){var O,C,N=-1,B=v[1],G=0,K=7,X=4;for(B===0&&(K=138,X=3),v[2*(A+1)+1]=65535,O=0;O<=A;O++)C=B,B=v[2*(O+1)+1],++G<K&&C==B||(G<X?j[2*C]+=G:C!==0?(C!=N&&j[2*C]++,j[32]++):G<=10?j[34]++:j[36]++,G=0,N=C,B===0?(K=138,X=3):C==B?(K=6,X=3):(K=7,X=4))}function te(v){H.pending_buf[H.pending++]=v}function Re(v){te(255&v),te(v>>>8&255)}function ue(v,A){var O,C=A;oe>16-C?(Re(z|=(O=v)<<oe&65535),z=O>>>16-oe,oe+=C-16):(z|=v<<oe&65535,oe+=C)}function ge(v,A){var O=2*v;ue(65535&A[O],65535&A[O+1])}function Jt(v,A){var O,C,N=-1,B=v[1],G=0,K=7,X=4;for(B===0&&(K=138,X=3),O=0;O<=A;O++)if(C=B,B=v[2*(O+1)+1],!(++G<K&&C==B)){if(G<X)do ge(C,j);while(--G!=0);else C!==0?(C!=N&&(ge(C,j),G--),ge(16,j),ue(G-3,2)):G<=10?(ge(17,j),ue(G-3,3)):(ge(18,j),ue(G-11,7));G=0,N=C,B===0?(K=138,X=3):C==B?(K=6,X=3):(K=7,X=4)}}function en(){oe==16?(Re(z),z=0,oe=0):oe>=8&&(te(255&z),z>>>=8,oe-=8)}function nt(v,A){var O,C,N;if(H.pending_buf[P+2*ee]=v>>>8&255,H.pending_buf[P+2*ee+1]=255&v,H.pending_buf[$+ee]=255&A,ee++,v===0?F[2*A]++:(Ee++,v--,F[2*(q._length_code[A]+256+1)]++,L[2*q.d_code(v)]++),(8191&ee)==0&&S>2){for(O=8*ee,C=x-c,N=0;N<30;N++)O+=L[2*N]*(5+q.extra_dbits[N]);if(O>>>=3,Ee<Math.floor(ee/2)&&O<Math.floor(C/2))return!0}return ee==pe-1}function tn(v,A){var O,C,N,B,G=0;if(ee!==0)do O=H.pending_buf[P+2*G]<<8&65280|255&H.pending_buf[P+2*G+1],C=255&H.pending_buf[$+G],G++,O===0?ge(C,v):(ge((N=q._length_code[C])+256+1,v),(B=q.extra_lbits[N])!==0&&ue(C-=q.base_length[N],B),O--,ge(N=q.d_code(O),A),(B=q.extra_dbits[N])!==0&&ue(O-=q.base_dist[N],B));while(G<ee);ge(256,v),V=v[513]}function nn(){oe>8?Re(z):oe>0&&te(255&z),z=0,oe=0}function sn(v,A,O){ue(0+(O?1:0),3),(function(C,N,B){nn(),V=8,Re(N),Re(~N),H.pending_buf.set(a.subarray(C,C+N),H.pending),H.pending+=N})(v,A)}function ze(v){(function(A,O,C){var N,B,G=0;S>0?(We.build_tree(H),qe.build_tree(H),G=(function(){var K;for(ce(F,We.max_code),ce(L,qe.max_code),tt.build_tree(H),K=18;K>=3&&j[2*q.bl_order[K]+1]===0;K--);return H.opt_len+=3*(K+1)+5+5+4,K})(),(B=H.static_len+3+7>>>3)<=(N=H.opt_len+3+7>>>3)&&(N=B)):N=B=O+5,O+4<=N&&A!=-1?sn(A,O,C):B==N?(ue(2+(C?1:0),3),tn(le.static_ltree,le.static_dtree)):(ue(4+(C?1:0),3),(function(K,X,ne){var se;for(ue(K-257,5),ue(X-1,5),ue(ne-4,4),se=0;se<ne;se++)ue(j[2*q.bl_order[se]+1],3);Jt(F,K-1),Jt(L,X-1)})(We.max_code+1,qe.max_code+1,G+1),tn(F,L)),ht(),C&&nn()})(c>=0?c:-1,x-c,v),c=x,s.flush_pending()}function Rt(){var v,A,O,C;do{if((C=u-E-x)==0&&x===0&&E===0)C=i;else if(C==-1)C--;else if(x>=i+i-262){a.set(a.subarray(i,i+i),0),I-=i,x-=i,c-=i,O=v=T;do A=65535&h[--O],h[O]=A>=i?A-i:0;while(--v!=0);O=v=i;do A=65535&f[--O],f[O]=A>=i?A-i:0;while(--v!=0);C+=i}if(s.avail_in===0)return;v=s.read_buf(a,x+E,C),(E+=v)>=3&&(p=((p=255&a[x])<<g^255&a[x+1])&l)}while(E<262&&s.avail_in!==0)}function rn(v){var A,O,C=D,N=x,B=w,G=x>i-262?x-(i-262):0,K=k,X=r,ne=x+258,se=a[N+B-1],Ke=a[N+B];w>=b&&(C>>=2),K>E&&(K=E);do if(a[(A=v)+B]==Ke&&a[A+B-1]==se&&a[A]==a[N]&&a[++A]==a[N+1]){N+=2,A++;do;while(a[++N]==a[++A]&&a[++N]==a[++A]&&a[++N]==a[++A]&&a[++N]==a[++A]&&a[++N]==a[++A]&&a[++N]==a[++A]&&a[++N]==a[++A]&&a[++N]==a[++A]&&N<ne);if(O=258-(ne-N),N=ne-258,O>B){if(I=v,B=O,O>=K)break;se=a[N+B-1],Ke=a[N+B]}}while((v=65535&f[v&X])>G&&--C!=0);return B<=E?B:E}H.depth=[],H.bl_count=[],H.heap=[],F=[],L=[],j=[],H.pqdownheap=function(v,A){for(var O=H.heap,C=O[A],N=A<<1;N<=H.heap_len&&(N<H.heap_len&&yn(v,O[N+1],O[N],H.depth)&&N++,!yn(v,C,O[N],H.depth));)O[A]=O[N],A=N,N<<=1;O[A]=C},H.deflateInit=function(v,A,O,C,N,B){return C||(C=8),N||(N=8),B||(B=0),v.msg=null,A==-1&&(A=6),N<1||N>9||C!=8||O<9||O>15||A<0||A>9||B<0||B>2?-2:(v.dstate=H,r=(i=1<<(o=O))-1,l=(T=1<<(y=N+7))-1,g=Math.floor((y+3-1)/3),a=new Uint8Array(2*i),f=[],h=[],pe=1<<N+6,H.pending_buf=new Uint8Array(4*pe),t=4*pe,P=Math.floor(pe/2),$=3*pe,S=A,R=B,(function(G){return G.total_in=G.total_out=0,G.msg=null,H.pending=0,H.pending_out=0,e=113,n=0,We.dyn_tree=F,We.stat_desc=le.static_l_desc,qe.dyn_tree=L,qe.stat_desc=le.static_d_desc,tt.dyn_tree=j,tt.stat_desc=le.static_bl_desc,z=0,oe=0,V=8,ht(),(function(){var K;for(u=2*i,h[T-1]=0,K=0;K<T-1;K++)h[K]=0;U=Ie[S].max_lazy,b=Ie[S].good_length,k=Ie[S].nice_length,D=Ie[S].max_chain,x=0,c=0,E=0,d=w=2,m=0,p=0})(),0})(v))},H.deflateEnd=function(){return e!=42&&e!=113&&e!=666?-2:(H.pending_buf=null,h=null,f=null,a=null,H.dstate=null,e==113?-3:0)},H.deflateParams=function(v,A,O){var C=0;return A==-1&&(A=6),A<0||A>9||O<0||O>2?-2:(Ie[S].func!=Ie[A].func&&v.total_in!==0&&(C=v.deflate(1)),S!=A&&(U=Ie[S=A].max_lazy,b=Ie[S].good_length,k=Ie[S].nice_length,D=Ie[S].max_chain),R=O,C)},H.deflateSetDictionary=function(v,A,O){var C,N=O,B=0;if(!A||e!=42)return-2;if(N<3)return 0;for(N>i-262&&(B=O-(N=i-262)),a.set(A.subarray(B,B+N),0),x=N,c=N,p=((p=255&a[0])<<g^255&a[1])&l,C=0;C<=N-3;C++)f[C&r]=h[p=(p<<g^255&a[C+2])&l],h[p]=C;return 0},H.deflate=function(v,A){var O,C,N,B,G,K;if(A>4||A<0)return-2;if(!v.next_out||!v.next_in&&v.avail_in!==0||e==666&&A!=4)return v.msg=pt[4],-2;if(v.avail_out===0)return v.msg=pt[7],-5;if(s=v,B=n,n=A,e==42&&(C=8+(o-8<<4)<<8,(N=(S-1&255)>>1)>3&&(N=3),C|=N<<6,x!==0&&(C|=32),e=113,te((K=C+=31-C%31)>>8&255),te(255&K)),H.pending!==0){if(s.flush_pending(),s.avail_out===0)return n=-1,0}else if(s.avail_in===0&&A<=B&&A!=4)return s.msg=pt[7],-5;if(e==666&&s.avail_in!==0)return v.msg=pt[7],-5;if(s.avail_in!==0||E!==0||A!=0&&e!=666){switch(G=-1,Ie[S].func){case 0:G=(function(X){var ne,se=65535;for(se>t-5&&(se=t-5);;){if(E<=1){if(Rt(),E===0&&X==0)return 0;if(E===0)break}if(x+=E,E=0,ne=c+se,(x===0||x>=ne)&&(E=x-ne,x=ne,ze(!1),s.avail_out===0)||x-c>=i-262&&(ze(!1),s.avail_out===0))return 0}return ze(X==4),s.avail_out===0?X==4?2:0:X==4?3:1})(A);break;case 1:G=(function(X){for(var ne,se=0;;){if(E<262){if(Rt(),E<262&&X==0)return 0;if(E===0)break}if(E>=3&&(se=65535&h[p=(p<<g^255&a[x+2])&l],f[x&r]=h[p],h[p]=x),se!==0&&(x-se&65535)<=i-262&&R!=2&&(d=rn(se)),d>=3)if(ne=nt(x-I,d-3),E-=d,d<=U&&E>=3){d--;do x++,se=65535&h[p=(p<<g^255&a[x+2])&l],f[x&r]=h[p],h[p]=x;while(--d!=0);x++}else x+=d,d=0,p=((p=255&a[x])<<g^255&a[x+1])&l;else ne=nt(0,255&a[x]),E--,x++;if(ne&&(ze(!1),s.avail_out===0))return 0}return ze(X==4),s.avail_out===0?X==4?2:0:X==4?3:1})(A);break;case 2:G=(function(X){for(var ne,se,Ke=0;;){if(E<262){if(Rt(),E<262&&X==0)return 0;if(E===0)break}if(E>=3&&(Ke=65535&h[p=(p<<g^255&a[x+2])&l],f[x&r]=h[p],h[p]=x),w=d,_=I,d=2,Ke!==0&&w<U&&(x-Ke&65535)<=i-262&&(R!=2&&(d=rn(Ke)),d<=5&&(R==1||d==3&&x-I>4096)&&(d=2)),w>=3&&d<=w){se=x+E-3,ne=nt(x-1-_,w-3),E-=w-1,w-=2;do++x<=se&&(Ke=65535&h[p=(p<<g^255&a[x+2])&l],f[x&r]=h[p],h[p]=x);while(--w!=0);if(m=0,d=2,x++,ne&&(ze(!1),s.avail_out===0))return 0}else if(m!==0){if((ne=nt(0,255&a[x-1]))&&ze(!1),x++,E--,s.avail_out===0)return 0}else m=1,x++,E--}return m!==0&&(ne=nt(0,255&a[x-1]),m=0),ze(X==4),s.avail_out===0?X==4?2:0:X==4?3:1})(A)}if(G!=2&&G!=3||(e=666),G==0||G==2)return s.avail_out===0&&(n=-1),0;if(G==1){if(A==1)ue(2,3),ge(256,le.static_ltree),en(),1+V+10-oe<9&&(ue(2,3),ge(256,le.static_ltree),en()),V=7;else if(sn(0,0,!1),A==3)for(O=0;O<T;O++)h[O]=0;if(s.flush_pending(),s.avail_out===0)return n=-1,0}}return A!=4?0:1}}function Ms(){var s=this;s.next_in_index=0,s.next_out_index=0,s.avail_in=0,s.total_in=0,s.avail_out=0,s.total_out=0}function Cs(s){var e=new Ms,t=512,n=new Uint8Array(t),i=s?s.level:-1;i===void 0&&(i=-1),e.deflateInit(i),e.next_out=n,this.append=function(o,r){var a,u=[],f=0,h=0,p=0;if(o.length){e.next_in_index=0,e.next_in=o,e.avail_in=o.length;do{if(e.next_out_index=0,e.avail_out=t,e.deflate(0)!=0)throw new Error("deflating: "+e.msg);e.next_out_index&&u.push(e.next_out_index==t?new Uint8Array(n):new Uint8Array(n.subarray(0,e.next_out_index))),p+=e.next_out_index,r&&e.next_in_index>0&&e.next_in_index!=f&&(r(e.next_in_index),f=e.next_in_index)}while(e.avail_in>0||e.avail_out===0);return a=new Uint8Array(p),u.forEach(function(T){a.set(T,h),h+=T.length}),a}},this.flush=function(){var o,r,a=[],u=0,f=0;do{if(e.next_out_index=0,e.avail_out=t,(o=e.deflate(4))!=1&&o!=0)throw new Error("deflating: "+e.msg);t-e.avail_out>0&&a.push(new Uint8Array(n.subarray(0,e.next_out_index))),f+=e.next_out_index}while(e.avail_in>0||e.avail_out===0);return e.deflateEnd(),r=new Uint8Array(f),a.forEach(function(h){r.set(h,u),u+=h.length}),r}}Ms.prototype={deflateInit:function(s,e){var t=this;return t.dstate=new er,e||(e=15),t.dstate.deflateInit(t,s,e)},deflate:function(s){var e=this;return e.dstate?e.dstate.deflate(e,s):-2},deflateEnd:function(){var s=this;if(!s.dstate)return-2;var e=s.dstate.deflateEnd();return s.dstate=null,e},deflateParams:function(s,e){var t=this;return t.dstate?t.dstate.deflateParams(t,s,e):-2},deflateSetDictionary:function(s,e){var t=this;return t.dstate?t.dstate.deflateSetDictionary(t,s,e):-2},read_buf:function(s,e,t){var n=this,i=n.avail_in;return i>t&&(i=t),i===0?0:(n.avail_in-=i,s.set(n.next_in.subarray(n.next_in_index,n.next_in_index+i),e),n.next_in_index+=i,n.total_in+=i,i)},flush_pending:function(){var s=this,e=s.dstate.pending;e>s.avail_out&&(e=s.avail_out),e!==0&&(s.next_out.set(s.dstate.pending_buf.subarray(s.dstate.pending_out,s.dstate.pending_out+e),s.next_out_index),s.next_out_index+=e,s.dstate.pending_out+=e,s.total_out+=e,s.avail_out-=e,s.dstate.pending-=e,s.dstate.pending===0&&(s.dstate.pending_out=0))}},self._zipjs_Deflater=Cs;var _e=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535],tr=[96,7,256,0,8,80,0,8,16,84,8,115,82,7,31,0,8,112,0,8,48,0,9,192,80,7,10,0,8,96,0,8,32,0,9,160,0,8,0,0,8,128,0,8,64,0,9,224,80,7,6,0,8,88,0,8,24,0,9,144,83,7,59,0,8,120,0,8,56,0,9,208,81,7,17,0,8,104,0,8,40,0,9,176,0,8,8,0,8,136,0,8,72,0,9,240,80,7,4,0,8,84,0,8,20,85,8,227,83,7,43,0,8,116,0,8,52,0,9,200,81,7,13,0,8,100,0,8,36,0,9,168,0,8,4,0,8,132,0,8,68,0,9,232,80,7,8,0,8,92,0,8,28,0,9,152,84,7,83,0,8,124,0,8,60,0,9,216,82,7,23,0,8,108,0,8,44,0,9,184,0,8,12,0,8,140,0,8,76,0,9,248,80,7,3,0,8,82,0,8,18,85,8,163,83,7,35,0,8,114,0,8,50,0,9,196,81,7,11,0,8,98,0,8,34,0,9,164,0,8,2,0,8,130,0,8,66,0,9,228,80,7,7,0,8,90,0,8,26,0,9,148,84,7,67,0,8,122,0,8,58,0,9,212,82,7,19,0,8,106,0,8,42,0,9,180,0,8,10,0,8,138,0,8,74,0,9,244,80,7,5,0,8,86,0,8,22,192,8,0,83,7,51,0,8,118,0,8,54,0,9,204,81,7,15,0,8,102,0,8,38,0,9,172,0,8,6,0,8,134,0,8,70,0,9,236,80,7,9,0,8,94,0,8,30,0,9,156,84,7,99,0,8,126,0,8,62,0,9,220,82,7,27,0,8,110,0,8,46,0,9,188,0,8,14,0,8,142,0,8,78,0,9,252,96,7,256,0,8,81,0,8,17,85,8,131,82,7,31,0,8,113,0,8,49,0,9,194,80,7,10,0,8,97,0,8,33,0,9,162,0,8,1,0,8,129,0,8,65,0,9,226,80,7,6,0,8,89,0,8,25,0,9,146,83,7,59,0,8,121,0,8,57,0,9,210,81,7,17,0,8,105,0,8,41,0,9,178,0,8,9,0,8,137,0,8,73,0,9,242,80,7,4,0,8,85,0,8,21,80,8,258,83,7,43,0,8,117,0,8,53,0,9,202,81,7,13,0,8,101,0,8,37,0,9,170,0,8,5,0,8,133,0,8,69,0,9,234,80,7,8,0,8,93,0,8,29,0,9,154,84,7,83,0,8,125,0,8,61,0,9,218,82,7,23,0,8,109,0,8,45,0,9,186,0,8,13,0,8,141,0,8,77,0,9,250,80,7,3,0,8,83,0,8,19,85,8,195,83,7,35,0,8,115,0,8,51,0,9,198,81,7,11,0,8,99,0,8,35,0,9,166,0,8,3,0,8,131,0,8,67,0,9,230,80,7,7,0,8,91,0,8,27,0,9,150,84,7,67,0,8,123,0,8,59,0,9,214,82,7,19,0,8,107,0,8,43,0,9,182,0,8,11,0,8,139,0,8,75,0,9,246,80,7,5,0,8,87,0,8,23,192,8,0,83,7,51,0,8,119,0,8,55,0,9,206,81,7,15,0,8,103,0,8,39,0,9,174,0,8,7,0,8,135,0,8,71,0,9,238,80,7,9,0,8,95,0,8,31,0,9,158,84,7,99,0,8,127,0,8,63,0,9,222,82,7,27,0,8,111,0,8,47,0,9,190,0,8,15,0,8,143,0,8,79,0,9,254,96,7,256,0,8,80,0,8,16,84,8,115,82,7,31,0,8,112,0,8,48,0,9,193,80,7,10,0,8,96,0,8,32,0,9,161,0,8,0,0,8,128,0,8,64,0,9,225,80,7,6,0,8,88,0,8,24,0,9,145,83,7,59,0,8,120,0,8,56,0,9,209,81,7,17,0,8,104,0,8,40,0,9,177,0,8,8,0,8,136,0,8,72,0,9,241,80,7,4,0,8,84,0,8,20,85,8,227,83,7,43,0,8,116,0,8,52,0,9,201,81,7,13,0,8,100,0,8,36,0,9,169,0,8,4,0,8,132,0,8,68,0,9,233,80,7,8,0,8,92,0,8,28,0,9,153,84,7,83,0,8,124,0,8,60,0,9,217,82,7,23,0,8,108,0,8,44,0,9,185,0,8,12,0,8,140,0,8,76,0,9,249,80,7,3,0,8,82,0,8,18,85,8,163,83,7,35,0,8,114,0,8,50,0,9,197,81,7,11,0,8,98,0,8,34,0,9,165,0,8,2,0,8,130,0,8,66,0,9,229,80,7,7,0,8,90,0,8,26,0,9,149,84,7,67,0,8,122,0,8,58,0,9,213,82,7,19,0,8,106,0,8,42,0,9,181,0,8,10,0,8,138,0,8,74,0,9,245,80,7,5,0,8,86,0,8,22,192,8,0,83,7,51,0,8,118,0,8,54,0,9,205,81,7,15,0,8,102,0,8,38,0,9,173,0,8,6,0,8,134,0,8,70,0,9,237,80,7,9,0,8,94,0,8,30,0,9,157,84,7,99,0,8,126,0,8,62,0,9,221,82,7,27,0,8,110,0,8,46,0,9,189,0,8,14,0,8,142,0,8,78,0,9,253,96,7,256,0,8,81,0,8,17,85,8,131,82,7,31,0,8,113,0,8,49,0,9,195,80,7,10,0,8,97,0,8,33,0,9,163,0,8,1,0,8,129,0,8,65,0,9,227,80,7,6,0,8,89,0,8,25,0,9,147,83,7,59,0,8,121,0,8,57,0,9,211,81,7,17,0,8,105,0,8,41,0,9,179,0,8,9,0,8,137,0,8,73,0,9,243,80,7,4,0,8,85,0,8,21,80,8,258,83,7,43,0,8,117,0,8,53,0,9,203,81,7,13,0,8,101,0,8,37,0,9,171,0,8,5,0,8,133,0,8,69,0,9,235,80,7,8,0,8,93,0,8,29,0,9,155,84,7,83,0,8,125,0,8,61,0,9,219,82,7,23,0,8,109,0,8,45,0,9,187,0,8,13,0,8,141,0,8,77,0,9,251,80,7,3,0,8,83,0,8,19,85,8,195,83,7,35,0,8,115,0,8,51,0,9,199,81,7,11,0,8,99,0,8,35,0,9,167,0,8,3,0,8,131,0,8,67,0,9,231,80,7,7,0,8,91,0,8,27,0,9,151,84,7,67,0,8,123,0,8,59,0,9,215,82,7,19,0,8,107,0,8,43,0,9,183,0,8,11,0,8,139,0,8,75,0,9,247,80,7,5,0,8,87,0,8,23,192,8,0,83,7,51,0,8,119,0,8,55,0,9,207,81,7,15,0,8,103,0,8,39,0,9,175,0,8,7,0,8,135,0,8,71,0,9,239,80,7,9,0,8,95,0,8,31,0,9,159,84,7,99,0,8,127,0,8,63,0,9,223,82,7,27,0,8,111,0,8,47,0,9,191,0,8,15,0,8,143,0,8,79,0,9,255],nr=[80,5,1,87,5,257,83,5,17,91,5,4097,81,5,5,89,5,1025,85,5,65,93,5,16385,80,5,3,88,5,513,84,5,33,92,5,8193,82,5,9,90,5,2049,86,5,129,192,5,24577,80,5,2,87,5,385,83,5,25,91,5,6145,81,5,7,89,5,1537,85,5,97,93,5,24577,80,5,4,88,5,769,84,5,49,92,5,12289,82,5,13,90,5,3073,86,5,193,192,5,24577],sr=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],ir=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,112,112],rr=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],or=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13];function Ft(){var s,e,t,n,i,o;function r(u,f,h,p,T,y,l,g,c,d,_){var m,x,I,E,w,D,U,S,R,b,k,F,L,j,$;b=0,w=h;do t[u[f+b]]++,b++,w--;while(w!==0);if(t[0]==h)return l[0]=-1,g[0]=0,0;for(S=g[0],D=1;D<=15&&t[D]===0;D++);for(U=D,S<D&&(S=D),w=15;w!==0&&t[w]===0;w--);for(I=w,S>w&&(S=w),g[0]=S,j=1<<D;D<w;D++,j<<=1)if((j-=t[D])<0)return-3;if((j-=t[w])<0)return-3;for(t[w]+=j,o[1]=D=0,b=1,L=2;--w!=0;)o[L]=D+=t[b],L++,b++;w=0,b=0;do(D=u[f+b])!==0&&(_[o[D]++]=w),b++;while(++w<h);for(h=o[I],o[0]=w=0,b=0,E=-1,F=-S,i[0]=0,k=0,$=0;U<=I;U++)for(m=t[U];m--!=0;){for(;U>F+S;){if(E++,$=($=I-(F+=S))>S?S:$,(x=1<<(D=U-F))>m+1&&(x-=m+1,L=U,D<$))for(;++D<$&&!((x<<=1)<=t[++L]);)x-=t[L];if(d[0]+($=1<<D)>1440)return-3;i[E]=k=d[0],d[0]+=$,E!==0?(o[E]=w,n[0]=D,n[1]=S,n[2]=k-i[E-1]-(D=w>>>F-S),c.set(n,3*(i[E-1]+D))):l[0]=k}for(n[1]=U-F,b>=h?n[0]=192:_[b]<p?(n[0]=_[b]<256?0:96,n[2]=_[b++]):(n[0]=y[_[b]-p]+16+64,n[2]=T[_[b++]-p]),x=1<<U-F,D=w>>>F;D<$;D+=x)c.set(n,3*(k+D));for(D=1<<U-1;(w&D)!=0;D>>>=1)w^=D;for(w^=D,R=(1<<F)-1;(w&R)!=o[E];)E--,R=(1<<(F-=S))-1}return j!==0&&I!=1?-5:0}function a(u){var f;for(s||(s=[],e=[],t=new Int32Array(16),n=[],i=new Int32Array(15),o=new Int32Array(16)),e.length<u&&(e=[]),f=0;f<u;f++)e[f]=0;for(f=0;f<16;f++)t[f]=0;for(f=0;f<3;f++)n[f]=0;i.set(t.subarray(0,15),0),o.set(t.subarray(0,16),0)}this.inflate_trees_bits=function(u,f,h,p,T){var y;return a(19),s[0]=0,(y=r(u,0,19,19,null,null,h,f,p,s,e))==-3?T.msg="oversubscribed dynamic bit lengths tree":y!=-5&&f[0]!==0||(T.msg="incomplete dynamic bit lengths tree",y=-3),y},this.inflate_trees_dynamic=function(u,f,h,p,T,y,l,g,c){var d;return a(288),s[0]=0,(d=r(h,0,u,257,sr,ir,y,p,g,s,e))!=0||p[0]===0?(d==-3?c.msg="oversubscribed literal/length tree":d!=-4&&(c.msg="incomplete literal/length tree",d=-3),d):(a(288),(d=r(h,u,f,0,rr,or,l,T,g,s,e))!=0||T[0]===0&&u>257?(d==-3?c.msg="oversubscribed distance tree":d==-5?(c.msg="incomplete distance tree",d=-3):d!=-4&&(c.msg="empty distance tree with lengths",d=-3),d):0)}}function ar(){var s,e,t,n,i=this,o=0,r=0,a=0,u=0,f=0,h=0,p=0,T=0,y=0,l=0;function g(c,d,_,m,x,I,E,w){var D,U,S,R,b,k,F,L,j,$,pe,ee,P,Ee,V,z;F=w.next_in_index,L=w.avail_in,b=E.bitb,k=E.bitk,$=(j=E.write)<E.read?E.read-j-1:E.end-j,pe=_e[c],ee=_e[d];do{for(;k<20;)L--,b|=(255&w.read_byte(F++))<<k,k+=8;if((R=(U=_)[z=3*((S=m)+(D=b&pe))])!==0)for(;;){if(b>>=U[z+1],k-=U[z+1],(16&R)!=0){for(P=U[z+2]+(b&_e[R&=15]),b>>=R,k-=R;k<15;)L--,b|=(255&w.read_byte(F++))<<k,k+=8;for(R=(U=x)[z=3*((S=I)+(D=b&ee))];;){if(b>>=U[z+1],k-=U[z+1],(16&R)!=0){for(R&=15;k<R;)L--,b|=(255&w.read_byte(F++))<<k,k+=8;if(Ee=U[z+2]+(b&_e[R]),b>>=R,k-=R,$-=P,j>=Ee)j-(V=j-Ee)>0&&2>j-V?(E.window[j++]=E.window[V++],E.window[j++]=E.window[V++],P-=2):(E.window.set(E.window.subarray(V,V+2),j),j+=2,V+=2,P-=2);else{V=j-Ee;do V+=E.end;while(V<0);if(P>(R=E.end-V)){if(P-=R,j-V>0&&R>j-V)do E.window[j++]=E.window[V++];while(--R!=0);else E.window.set(E.window.subarray(V,V+R),j),j+=R,V+=R,R=0;V=0}}if(j-V>0&&P>j-V)do E.window[j++]=E.window[V++];while(--P!=0);else E.window.set(E.window.subarray(V,V+P),j),j+=P,V+=P,P=0;break}if((64&R)!=0)return w.msg="invalid distance code",L+=P=k>>3<(P=w.avail_in-L)?k>>3:P,F-=P,k-=P<<3,E.bitb=b,E.bitk=k,w.avail_in=L,w.total_in+=F-w.next_in_index,w.next_in_index=F,E.write=j,-3;D+=U[z+2],R=U[z=3*(S+(D+=b&_e[R]))]}break}if((64&R)!=0)return(32&R)!=0?(L+=P=k>>3<(P=w.avail_in-L)?k>>3:P,F-=P,k-=P<<3,E.bitb=b,E.bitk=k,w.avail_in=L,w.total_in+=F-w.next_in_index,w.next_in_index=F,E.write=j,1):(w.msg="invalid literal/length code",L+=P=k>>3<(P=w.avail_in-L)?k>>3:P,F-=P,k-=P<<3,E.bitb=b,E.bitk=k,w.avail_in=L,w.total_in+=F-w.next_in_index,w.next_in_index=F,E.write=j,-3);if(D+=U[z+2],(R=U[z=3*(S+(D+=b&_e[R]))])===0){b>>=U[z+1],k-=U[z+1],E.window[j++]=U[z+2],$--;break}}else b>>=U[z+1],k-=U[z+1],E.window[j++]=U[z+2],$--}while($>=258&&L>=10);return L+=P=k>>3<(P=w.avail_in-L)?k>>3:P,F-=P,k-=P<<3,E.bitb=b,E.bitk=k,w.avail_in=L,w.total_in+=F-w.next_in_index,w.next_in_index=F,E.write=j,0}i.init=function(c,d,_,m,x,I){s=0,p=c,T=d,t=_,y=m,n=x,l=I,e=null},i.proc=function(c,d,_){var m,x,I,E,w,D,U,S=0,R=0,b=0;for(b=d.next_in_index,E=d.avail_in,S=c.bitb,R=c.bitk,D=(w=c.write)<c.read?c.read-w-1:c.end-w;;)switch(s){case 0:if(D>=258&&E>=10&&(c.bitb=S,c.bitk=R,d.avail_in=E,d.total_in+=b-d.next_in_index,d.next_in_index=b,c.write=w,_=g(p,T,t,y,n,l,c,d),b=d.next_in_index,E=d.avail_in,S=c.bitb,R=c.bitk,D=(w=c.write)<c.read?c.read-w-1:c.end-w,_!=0)){s=_==1?7:9;break}a=p,e=t,r=y,s=1;case 1:for(m=a;R<m;){if(E===0)return c.bitb=S,c.bitk=R,d.avail_in=E,d.total_in+=b-d.next_in_index,d.next_in_index=b,c.write=w,c.inflate_flush(d,_);_=0,E--,S|=(255&d.read_byte(b++))<<R,R+=8}if(S>>>=e[1+(x=3*(r+(S&_e[m])))],R-=e[x+1],(I=e[x])===0){u=e[x+2],s=6;break}if((16&I)!=0){f=15&I,o=e[x+2],s=2;break}if((64&I)==0){a=I,r=x/3+e[x+2];break}if((32&I)!=0){s=7;break}return s=9,d.msg="invalid literal/length code",_=-3,c.bitb=S,c.bitk=R,d.avail_in=E,d.total_in+=b-d.next_in_index,d.next_in_index=b,c.write=w,c.inflate_flush(d,_);case 2:for(m=f;R<m;){if(E===0)return c.bitb=S,c.bitk=R,d.avail_in=E,d.total_in+=b-d.next_in_index,d.next_in_index=b,c.write=w,c.inflate_flush(d,_);_=0,E--,S|=(255&d.read_byte(b++))<<R,R+=8}o+=S&_e[m],S>>=m,R-=m,a=T,e=n,r=l,s=3;case 3:for(m=a;R<m;){if(E===0)return c.bitb=S,c.bitk=R,d.avail_in=E,d.total_in+=b-d.next_in_index,d.next_in_index=b,c.write=w,c.inflate_flush(d,_);_=0,E--,S|=(255&d.read_byte(b++))<<R,R+=8}if(S>>=e[1+(x=3*(r+(S&_e[m])))],R-=e[x+1],(16&(I=e[x]))!=0){f=15&I,h=e[x+2],s=4;break}if((64&I)==0){a=I,r=x/3+e[x+2];break}return s=9,d.msg="invalid distance code",_=-3,c.bitb=S,c.bitk=R,d.avail_in=E,d.total_in+=b-d.next_in_index,d.next_in_index=b,c.write=w,c.inflate_flush(d,_);case 4:for(m=f;R<m;){if(E===0)return c.bitb=S,c.bitk=R,d.avail_in=E,d.total_in+=b-d.next_in_index,d.next_in_index=b,c.write=w,c.inflate_flush(d,_);_=0,E--,S|=(255&d.read_byte(b++))<<R,R+=8}h+=S&_e[m],S>>=m,R-=m,s=5;case 5:for(U=w-h;U<0;)U+=c.end;for(;o!==0;){if(D===0&&(w==c.end&&c.read!==0&&(D=(w=0)<c.read?c.read-w-1:c.end-w),D===0&&(c.write=w,_=c.inflate_flush(d,_),D=(w=c.write)<c.read?c.read-w-1:c.end-w,w==c.end&&c.read!==0&&(D=(w=0)<c.read?c.read-w-1:c.end-w),D===0)))return c.bitb=S,c.bitk=R,d.avail_in=E,d.total_in+=b-d.next_in_index,d.next_in_index=b,c.write=w,c.inflate_flush(d,_);c.window[w++]=c.window[U++],D--,U==c.end&&(U=0),o--}s=0;break;case 6:if(D===0&&(w==c.end&&c.read!==0&&(D=(w=0)<c.read?c.read-w-1:c.end-w),D===0&&(c.write=w,_=c.inflate_flush(d,_),D=(w=c.write)<c.read?c.read-w-1:c.end-w,w==c.end&&c.read!==0&&(D=(w=0)<c.read?c.read-w-1:c.end-w),D===0)))return c.bitb=S,c.bitk=R,d.avail_in=E,d.total_in+=b-d.next_in_index,d.next_in_index=b,c.write=w,c.inflate_flush(d,_);_=0,c.window[w++]=u,D--,s=0;break;case 7:if(R>7&&(R-=8,E++,b--),c.write=w,_=c.inflate_flush(d,_),D=(w=c.write)<c.read?c.read-w-1:c.end-w,c.read!=c.write)return c.bitb=S,c.bitk=R,d.avail_in=E,d.total_in+=b-d.next_in_index,d.next_in_index=b,c.write=w,c.inflate_flush(d,_);s=8;case 8:return _=1,c.bitb=S,c.bitk=R,d.avail_in=E,d.total_in+=b-d.next_in_index,d.next_in_index=b,c.write=w,c.inflate_flush(d,_);case 9:return _=-3,c.bitb=S,c.bitk=R,d.avail_in=E,d.total_in+=b-d.next_in_index,d.next_in_index=b,c.write=w,c.inflate_flush(d,_);default:return _=-2,c.bitb=S,c.bitk=R,d.avail_in=E,d.total_in+=b-d.next_in_index,d.next_in_index=b,c.write=w,c.inflate_flush(d,_)}},i.free=function(){}}Ft.inflate_trees_fixed=function(s,e,t,n){return s[0]=9,e[0]=5,t[0]=tr,n[0]=nr,0};var wn=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];function cr(s,e){var t,n=this,i=0,o=0,r=0,a=0,u=[0],f=[0],h=new ar,p=0,T=new Int32Array(4320),y=new Ft;n.bitk=0,n.bitb=0,n.window=new Uint8Array(e),n.end=e,n.read=0,n.write=0,n.reset=function(l,g){g&&(g[0]=0),i==6&&h.free(l),i=0,n.bitk=0,n.bitb=0,n.read=n.write=0},n.reset(s,null),n.inflate_flush=function(l,g){var c,d,_;return d=l.next_out_index,(c=((_=n.read)<=n.write?n.write:n.end)-_)>l.avail_out&&(c=l.avail_out),c!==0&&g==-5&&(g=0),l.avail_out-=c,l.total_out+=c,l.next_out.set(n.window.subarray(_,_+c),d),d+=c,(_+=c)==n.end&&(_=0,n.write==n.end&&(n.write=0),(c=n.write-_)>l.avail_out&&(c=l.avail_out),c!==0&&g==-5&&(g=0),l.avail_out-=c,l.total_out+=c,l.next_out.set(n.window.subarray(_,_+c),d),d+=c,_+=c),l.next_out_index=d,n.read=_,g},n.proc=function(l,g){var c,d,_,m,x,I,E,w;for(m=l.next_in_index,x=l.avail_in,d=n.bitb,_=n.bitk,E=(I=n.write)<n.read?n.read-I-1:n.end-I;;)switch(i){case 0:for(;_<3;){if(x===0)return n.bitb=d,n.bitk=_,l.avail_in=x,l.total_in+=m-l.next_in_index,l.next_in_index=m,n.write=I,n.inflate_flush(l,g);g=0,x--,d|=(255&l.read_byte(m++))<<_,_+=8}switch(p=1&(c=7&d),c>>>1){case 0:d>>>=3,d>>>=c=7&(_-=3),_-=c,i=1;break;case 1:var D=[],U=[],S=[[]],R=[[]];Ft.inflate_trees_fixed(D,U,S,R),h.init(D[0],U[0],S[0],0,R[0],0),d>>>=3,_-=3,i=6;break;case 2:d>>>=3,_-=3,i=3;break;case 3:return d>>>=3,_-=3,i=9,l.msg="invalid block type",g=-3,n.bitb=d,n.bitk=_,l.avail_in=x,l.total_in+=m-l.next_in_index,l.next_in_index=m,n.write=I,n.inflate_flush(l,g)}break;case 1:for(;_<32;){if(x===0)return n.bitb=d,n.bitk=_,l.avail_in=x,l.total_in+=m-l.next_in_index,l.next_in_index=m,n.write=I,n.inflate_flush(l,g);g=0,x--,d|=(255&l.read_byte(m++))<<_,_+=8}if((~d>>>16&65535)!=(65535&d))return i=9,l.msg="invalid stored block lengths",g=-3,n.bitb=d,n.bitk=_,l.avail_in=x,l.total_in+=m-l.next_in_index,l.next_in_index=m,n.write=I,n.inflate_flush(l,g);o=65535&d,d=_=0,i=o!==0?2:p!==0?7:0;break;case 2:if(x===0||E===0&&(I==n.end&&n.read!==0&&(E=(I=0)<n.read?n.read-I-1:n.end-I),E===0&&(n.write=I,g=n.inflate_flush(l,g),E=(I=n.write)<n.read?n.read-I-1:n.end-I,I==n.end&&n.read!==0&&(E=(I=0)<n.read?n.read-I-1:n.end-I),E===0)))return n.bitb=d,n.bitk=_,l.avail_in=x,l.total_in+=m-l.next_in_index,l.next_in_index=m,n.write=I,n.inflate_flush(l,g);if(g=0,(c=o)>x&&(c=x),c>E&&(c=E),n.window.set(l.read_buf(m,c),I),m+=c,x-=c,I+=c,E-=c,(o-=c)!=0)break;i=p!==0?7:0;break;case 3:for(;_<14;){if(x===0)return n.bitb=d,n.bitk=_,l.avail_in=x,l.total_in+=m-l.next_in_index,l.next_in_index=m,n.write=I,n.inflate_flush(l,g);g=0,x--,d|=(255&l.read_byte(m++))<<_,_+=8}if(r=c=16383&d,(31&c)>29||(c>>5&31)>29)return i=9,l.msg="too many length or distance symbols",g=-3,n.bitb=d,n.bitk=_,l.avail_in=x,l.total_in+=m-l.next_in_index,l.next_in_index=m,n.write=I,n.inflate_flush(l,g);if(c=258+(31&c)+(c>>5&31),!t||t.length<c)t=[];else for(w=0;w<c;w++)t[w]=0;d>>>=14,_-=14,a=0,i=4;case 4:for(;a<4+(r>>>10);){for(;_<3;){if(x===0)return n.bitb=d,n.bitk=_,l.avail_in=x,l.total_in+=m-l.next_in_index,l.next_in_index=m,n.write=I,n.inflate_flush(l,g);g=0,x--,d|=(255&l.read_byte(m++))<<_,_+=8}t[wn[a++]]=7&d,d>>>=3,_-=3}for(;a<19;)t[wn[a++]]=0;if(u[0]=7,(c=y.inflate_trees_bits(t,u,f,T,l))!=0)return(g=c)==-3&&(t=null,i=9),n.bitb=d,n.bitk=_,l.avail_in=x,l.total_in+=m-l.next_in_index,l.next_in_index=m,n.write=I,n.inflate_flush(l,g);a=0,i=5;case 5:for(;!(a>=258+(31&(c=r))+(c>>5&31));){var b,k;for(c=u[0];_<c;){if(x===0)return n.bitb=d,n.bitk=_,l.avail_in=x,l.total_in+=m-l.next_in_index,l.next_in_index=m,n.write=I,n.inflate_flush(l,g);g=0,x--,d|=(255&l.read_byte(m++))<<_,_+=8}if((k=T[3*(f[0]+(d&_e[c=T[3*(f[0]+(d&_e[c]))+1]]))+2])<16)d>>>=c,_-=c,t[a++]=k;else{for(w=k==18?7:k-14,b=k==18?11:3;_<c+w;){if(x===0)return n.bitb=d,n.bitk=_,l.avail_in=x,l.total_in+=m-l.next_in_index,l.next_in_index=m,n.write=I,n.inflate_flush(l,g);g=0,x--,d|=(255&l.read_byte(m++))<<_,_+=8}if(_-=c,b+=(d>>>=c)&_e[w],d>>>=w,_-=w,(w=a)+b>258+(31&(c=r))+(c>>5&31)||k==16&&w<1)return t=null,i=9,l.msg="invalid bit length repeat",g=-3,n.bitb=d,n.bitk=_,l.avail_in=x,l.total_in+=m-l.next_in_index,l.next_in_index=m,n.write=I,n.inflate_flush(l,g);k=k==16?t[w-1]:0;do t[w++]=k;while(--b!=0);a=w}}f[0]=-1;var F=[],L=[],j=[],$=[];if(F[0]=9,L[0]=6,(c=y.inflate_trees_dynamic(257+(31&(c=r)),1+(c>>5&31),t,F,L,j,$,T,l))!=0)return c==-3&&(t=null,i=9),g=c,n.bitb=d,n.bitk=_,l.avail_in=x,l.total_in+=m-l.next_in_index,l.next_in_index=m,n.write=I,n.inflate_flush(l,g);h.init(F[0],L[0],T,j[0],T,$[0]),i=6;case 6:if(n.bitb=d,n.bitk=_,l.avail_in=x,l.total_in+=m-l.next_in_index,l.next_in_index=m,n.write=I,(g=h.proc(n,l,g))!=1)return n.inflate_flush(l,g);if(g=0,h.free(l),m=l.next_in_index,x=l.avail_in,d=n.bitb,_=n.bitk,E=(I=n.write)<n.read?n.read-I-1:n.end-I,p===0){i=0;break}i=7;case 7:if(n.write=I,g=n.inflate_flush(l,g),E=(I=n.write)<n.read?n.read-I-1:n.end-I,n.read!=n.write)return n.bitb=d,n.bitk=_,l.avail_in=x,l.total_in+=m-l.next_in_index,l.next_in_index=m,n.write=I,n.inflate_flush(l,g);i=8;case 8:return g=1,n.bitb=d,n.bitk=_,l.avail_in=x,l.total_in+=m-l.next_in_index,l.next_in_index=m,n.write=I,n.inflate_flush(l,g);case 9:return g=-3,n.bitb=d,n.bitk=_,l.avail_in=x,l.total_in+=m-l.next_in_index,l.next_in_index=m,n.write=I,n.inflate_flush(l,g);default:return g=-2,n.bitb=d,n.bitk=_,l.avail_in=x,l.total_in+=m-l.next_in_index,l.next_in_index=m,n.write=I,n.inflate_flush(l,g)}},n.free=function(l){n.reset(l,null),n.window=null,T=null},n.set_dictionary=function(l,g,c){n.window.set(l.subarray(g,g+c),0),n.read=n.write=c},n.sync_point=function(){return i==1?1:0}}var ur=[0,0,255,255];function fr(){var s=this;function e(t){return t&&t.istate?(t.total_in=t.total_out=0,t.msg=null,t.istate.mode=7,t.istate.blocks.reset(t,null),0):-2}s.mode=0,s.method=0,s.was=[0],s.need=0,s.marker=0,s.wbits=0,s.inflateEnd=function(t){return s.blocks&&s.blocks.free(t),s.blocks=null,0},s.inflateInit=function(t,n){return t.msg=null,s.blocks=null,n<8||n>15?(s.inflateEnd(t),-2):(s.wbits=n,t.istate.blocks=new cr(t,1<<n),e(t),0)},s.inflate=function(t,n){var i,o;if(!t||!t.istate||!t.next_in)return-2;for(n=n==4?-5:0,i=-5;;)switch(t.istate.mode){case 0:if(t.avail_in===0)return i;if(i=n,t.avail_in--,t.total_in++,(15&(t.istate.method=t.read_byte(t.next_in_index++)))!=8){t.istate.mode=13,t.msg="unknown compression method",t.istate.marker=5;break}if(8+(t.istate.method>>4)>t.istate.wbits){t.istate.mode=13,t.msg="invalid window size",t.istate.marker=5;break}t.istate.mode=1;case 1:if(t.avail_in===0)return i;if(i=n,t.avail_in--,t.total_in++,o=255&t.read_byte(t.next_in_index++),((t.istate.method<<8)+o)%31!=0){t.istate.mode=13,t.msg="incorrect header check",t.istate.marker=5;break}if((32&o)==0){t.istate.mode=7;break}t.istate.mode=2;case 2:if(t.avail_in===0)return i;i=n,t.avail_in--,t.total_in++,t.istate.need=(255&t.read_byte(t.next_in_index++))<<24&4278190080,t.istate.mode=3;case 3:if(t.avail_in===0)return i;i=n,t.avail_in--,t.total_in++,t.istate.need+=(255&t.read_byte(t.next_in_index++))<<16&16711680,t.istate.mode=4;case 4:if(t.avail_in===0)return i;i=n,t.avail_in--,t.total_in++,t.istate.need+=(255&t.read_byte(t.next_in_index++))<<8&65280,t.istate.mode=5;case 5:return t.avail_in===0?i:(i=n,t.avail_in--,t.total_in++,t.istate.need+=255&t.read_byte(t.next_in_index++),t.istate.mode=6,2);case 6:return t.istate.mode=13,t.msg="need dictionary",t.istate.marker=0,-2;case 7:if((i=t.istate.blocks.proc(t,i))==-3){t.istate.mode=13,t.istate.marker=0;break}if(i==0&&(i=n),i!=1)return i;i=n,t.istate.blocks.reset(t,t.istate.was),t.istate.mode=12;case 12:return 1;case 13:return-3;default:return-2}},s.inflateSetDictionary=function(t,n,i){var o=0,r=i;return t&&t.istate&&t.istate.mode==6?(r>=1<<t.istate.wbits&&(o=i-(r=(1<<t.istate.wbits)-1)),t.istate.blocks.set_dictionary(n,o,r),t.istate.mode=7,0):-2},s.inflateSync=function(t){var n,i,o,r,a;if(!t||!t.istate)return-2;if(t.istate.mode!=13&&(t.istate.mode=13,t.istate.marker=0),(n=t.avail_in)===0)return-5;for(i=t.next_in_index,o=t.istate.marker;n!==0&&o<4;)t.read_byte(i)==ur[o]?o++:o=t.read_byte(i)!==0?0:4-o,i++,n--;return t.total_in+=i-t.next_in_index,t.next_in_index=i,t.avail_in=n,t.istate.marker=o,o!=4?-3:(r=t.total_in,a=t.total_out,e(t),t.total_in=r,t.total_out=a,t.istate.mode=7,0)},s.inflateSyncPoint=function(t){return t&&t.istate&&t.istate.blocks?t.istate.blocks.sync_point():-2}}function Os(){}function Us(){var s=new Os,e=new Uint8Array(512),t=!1;s.inflateInit(),s.next_out=e,this.append=function(n,i){var o,r,a=[],u=0,f=0,h=0;if(n.length!==0){s.next_in_index=0,s.next_in=n,s.avail_in=n.length;do{if(s.next_out_index=0,s.avail_out=512,s.avail_in!==0||t||(s.next_in_index=0,t=!0),o=s.inflate(0),t&&o===-5){if(s.avail_in!==0)throw new Error("inflating: bad input")}else if(o!==0&&o!==1)throw new Error("inflating: "+s.msg);if((t||o===1)&&s.avail_in===n.length)throw new Error("inflating: bad input");s.next_out_index&&a.push(s.next_out_index===512?new Uint8Array(e):new Uint8Array(e.subarray(0,s.next_out_index))),h+=s.next_out_index,i&&s.next_in_index>0&&s.next_in_index!=u&&(i(s.next_in_index),u=s.next_in_index)}while(s.avail_in>0||s.avail_out===0);return r=new Uint8Array(h),a.forEach(function(p){r.set(p,f),f+=p.length}),r}},this.flush=function(){s.inflateEnd()}}Os.prototype={inflateInit:function(s){var e=this;return e.istate=new fr,s||(s=15),e.istate.inflateInit(e,s)},inflate:function(s){var e=this;return e.istate?e.istate.inflate(e,s):-2},inflateEnd:function(){var s=this;if(!s.istate)return-2;var e=s.istate.inflateEnd(s);return s.istate=null,e},inflateSync:function(){var s=this;return s.istate?s.istate.inflateSync(s):-2},inflateSetDictionary:function(s,e){var t=this;return t.istate?t.istate.inflateSetDictionary(t,s,e):-2},read_byte:function(s){return this.next_in.subarray(s,s+1)[0]},read_buf:function(s,e){return this.next_in.subarray(s,s+e)}},self._zipjs_Inflater=Us;var Zt,it="File format is not recognized.",En="Error while reading zip file.";try{Zt=new Blob([new DataView(new ArrayBuffer(0))]).size===0}catch{}function gt(){this.crc=-1}function jt(){}function Xe(s,e){var t,n;return t=new ArrayBuffer(s),n=new Uint8Array(t),e&&n.set(e,0),{buffer:t,array:n,view:new DataView(t)}}function _t(){}function Bt(s){var e,t=this;t.size=0,t.init=function(n,i){var o=new Blob([s],{type:"text/plain"});(e=new Et(o)).init(function(){t.size=e.size,n()},i)},t.readUint8Array=function(n,i,o,r){e.readUint8Array(n,i,o,r)}}function Lt(s){var e,t=this;t.size=0,t.init=function(n){for(var i=s.length;s.charAt(i-1)=="=";)i--;e=s.indexOf(",")+1,t.size=Math.floor(.75*(i-e)),n()},t.readUint8Array=function(n,i,o){var r,a=Xe(i),u=4*Math.floor(n/3),f=4*Math.ceil((n+i)/3),h=self.atob(s.substring(u+e,f+e)),p=n-3*Math.floor(u/4);for(r=p;r<p+i;r++)a.array[r-p]=h.charCodeAt(r);o(a.array)}}function Et(s){var e=this;e.size=0,e.init=function(t){e.size=s.size,t()},e.readUint8Array=function(t,n,i,o){var r=new FileReader;r.onload=function(a){i(new Uint8Array(a.target.result))},r.onerror=o;try{r.readAsArrayBuffer((function(a,u,f){if(u<0||f<0||u+f>a.size)throw new RangeError("offset:"+u+", length:"+f+", size:"+a.size);return a.slice?a.slice(u,u+f):a.webkitSlice?a.webkitSlice(u,u+f):a.mozSlice?a.mozSlice(u,u+f):a.msSlice?a.msSlice(u,u+f):void 0})(s,t,n))}catch(a){o(a)}}}function ct(){}function Pt(s){var e,t=this;t.init=function(n){e=new Blob([],{type:"text/plain"}),n()},t.writeUint8Array=function(n,i){e=new Blob([e,Zt?n:n.buffer],{type:"text/plain"}),i()},t.getData=function(n,i){var o=new FileReader;o.onload=function(r){n(r.target.result)},o.onerror=i,o.readAsText(e,s)}}function Ht(s){var e=this,t="",n="";e.init=function(i){t+="data:"+(s||"")+";base64,",i()},e.writeUint8Array=function(i,o){var r,a=n.length,u=n;for(n="",r=0;r<3*Math.floor((a+i.length)/3)-a;r++)u+=String.fromCharCode(i[r]);for(;r<i.length;r++)n+=String.fromCharCode(i[r]);u.length>2?t+=self.btoa(u):n=u,o()},e.getData=function(i){i(t+self.btoa(n))}}function Gt(s){var e,t=this;t.init=function(n){e=new Blob([],{type:s}),n()},t.writeUint8Array=function(n,i){e=new Blob([e,Zt?n:n.buffer],{type:s}),i()},t.getData=function(n){n(e)}}function Vt(s,e,t,n,i,o,r,a,u,f){var h,p,T,y=0,l=e.sn;function g(){s.removeEventListener("message",c,!1),a(p,T)}function c(_){var m=_.data,x=m.data,I=m.error;if(I)return I.toString=function(){return"Error: "+this.message},void u(I);if(m.sn===l)switch(typeof m.codecTime=="number"&&(s.codecTime+=m.codecTime),typeof m.crcTime=="number"&&(s.crcTime+=m.crcTime),m.type){case"append":x?(p+=x.length,n.writeUint8Array(x,function(){d()},f)):d();break;case"flush":T=m.crc,x?(p+=x.length,n.writeUint8Array(x,function(){g()},f)):g();break;case"progress":r&&r(h+m.loaded,o);break;case"importScripts":case"newTask":case"echo":break;default:console.warn("zip.js:launchWorkerProcess: unknown message: ",m)}}function d(){(h=524288*y)<=o?t.readUint8Array(i+h,Math.min(524288,o-h),function(_){r&&r(h,o);var m=h===0?e:{sn:l};m.type="append",m.data=_;try{s.postMessage(m,[_.buffer])}catch{s.postMessage(m)}y++},u):s.postMessage({sn:l,type:"flush"})}p=0,s.addEventListener("message",c,!1),d()}function zt(s,e,t,n,i,o,r,a,u,f){var h,p=0,T=0,y=o==="input",l=o==="output",g=new gt;(function c(){var d;if((h=524288*p)<i)e.readUint8Array(n+h,Math.min(524288,i-h),function(_){var m;try{m=s.append(_,function(x){r&&r(h+x,i)})}catch(x){return void u(x)}m?(T+=m.length,t.writeUint8Array(m,function(){p++,setTimeout(c,1)},f),l&&g.append(m)):(p++,setTimeout(c,1)),y&&g.append(_),r&&r(h,i)},u);else{try{d=s.flush()}catch(_){return void u(_)}d?(l&&g.append(d),T+=d.length,t.writeUint8Array(d,function(){a(T,g.get())},f)):a(T,g.get())}})()}function In(s,e,t,n,i,o,r,a,u,f,h){var p="input";W.useWebWorkers&&r?Vt(s,{sn:e,codecClass:"_zipjs_NOOP",crcType:p},t,n,i,o,u,a,f,h):zt(new jt,t,n,i,o,p,u,a,f,h)}function bn(s){var e,t,n="",i=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","_","_","_","","","","","","","","","+","+","","","+","+","-","-","+","-","+","","","+","+","-","-","","-","+","","","","","","","i","","","","+","+","_","_","","","_","","","","","","","","","","","","","","","","","","","_","","","","","","","","","","","","_"," "];for(e=0;e<s.length;e++)n+=(t=255&s.charCodeAt(e))>127?i[t-128]:String.fromCharCode(t);return n}function Rn(s){return decodeURIComponent(escape(s))}function Dn(s){var e,t="";for(e=0;e<s.length;e++)t+=String.fromCharCode(s[e]);return t}function Sn(s,e,t,n,i){s.version=e.view.getUint16(t,!0),s.bitFlag=e.view.getUint16(t+2,!0),s.compressionMethod=e.view.getUint16(t+4,!0),s.lastModDateRaw=e.view.getUint32(t+6,!0),s.lastModDate=(function(o){var r=(4294901760&o)>>16,a=65535&o;try{return new Date(1980+((65024&r)>>9),((480&r)>>5)-1,31&r,(63488&a)>>11,(2016&a)>>5,2*(31&a),0)}catch{}})(s.lastModDateRaw),(1&s.bitFlag)!=1?((n||(8&s.bitFlag)!=8)&&(s.crc32=e.view.getUint32(t+10,!0),s.compressedSize=e.view.getUint32(t+14,!0),s.uncompressedSize=e.view.getUint32(t+18,!0)),s.compressedSize!==4294967295&&s.uncompressedSize!==4294967295?(s.filenameLength=e.view.getUint16(t+22,!0),s.extraFieldLength=e.view.getUint16(t+24,!0)):i("File is using Zip64 (4gb+ file size).")):i("File contains encrypted entry.")}function An(s){return unescape(encodeURIComponent(s))}function Nn(s){var e,t=[];for(e=0;e<s.length;e++)t.push(s.charCodeAt(e));return t}gt.prototype.append=function(s){for(var e=0|this.crc,t=this.table,n=0,i=0|s.length;n<i;n++)e=e>>>8^t[255&(e^s[n])];this.crc=e},gt.prototype.get=function(){return~this.crc},gt.prototype.table=(function(){var s,e,t,n=[];for(s=0;s<256;s++){for(t=s,e=0;e<8;e++)1&t?t=t>>>1^3988292384:t>>>=1;n[s]=t}return n})(),jt.prototype.append=function(s,e){return s},jt.prototype.flush=function(){},(Bt.prototype=new _t).constructor=Bt,(Lt.prototype=new _t).constructor=Lt,(Et.prototype=new _t).constructor=Et,ct.prototype.getData=function(s){s(this.data)},(Pt.prototype=new ct).constructor=Pt,(Ht.prototype=new ct).constructor=Ht,(Gt.prototype=new ct).constructor=Gt;var lr={deflater:["z-worker.js","deflate.js"],inflater:["z-worker.js","inflate.js"]};function vn(s,e,t){if(W.workerScripts===null||W.workerScriptsPath===null){var n,i,o;if(W.workerScripts){if(n=W.workerScripts[s],!Array.isArray(n))return void t(new Error("zip.workerScripts."+s+" is not an array!"));i=n,o=document.createElement("a"),n=i.map(function(u){return o.href=u,o.href})}else(n=lr[s].slice(0))[0]=(W.workerScriptsPath||"")+n[0];var r=new Worker(n[0]);r.codecTime=r.crcTime=0,r.postMessage({type:"importScripts",scripts:n.slice(1)}),r.addEventListener("message",function u(f){var h=f.data;if(h.error)return r.terminate(),void t(h.error);h.type==="importScripts"&&(r.removeEventListener("message",u),r.removeEventListener("error",a),e(r))}),r.addEventListener("error",a)}else t(new Error("Either zip.workerScripts or zip.workerScriptsPath may be set, not both."));function a(u){r.terminate(),t(u)}}function Mn(s){console.error(s)}const W={Reader:_t,Writer:ct,BlobReader:Et,Data64URIReader:Lt,TextReader:Bt,BlobWriter:Gt,Data64URIWriter:Ht,TextWriter:Pt,createReader:function(s,e,t){s.init(function(){(function(n,i,o){var r=0;function a(){}a.prototype.getData=function(f,h,p,T){var y=this;function l(d,_){T&&!(function(m){var x=Xe(4);return x.view.setUint32(0,m),y.crc32==x.view.getUint32(0)})(_)?o("CRC failed."):f.getData(function(m){h(m)})}function g(d){o(d||"Error while reading file data.")}function c(d){o(d||"Error while writing file data.")}n.readUint8Array(y.offset,30,function(d){var _,m=Xe(d.length,d);m.view.getUint32(0)==1347093252?(Sn(y,m,4,!1,o),_=y.offset+30+y.filenameLength+y.extraFieldLength,f.init(function(){y.compressionMethod===0?In(y._worker,r++,n,f,_,y.compressedSize,T,l,p,g,c):(function(x,I,E,w,D,U,S,R,b,k,F){var L=S?"output":"none";W.useWebWorkers?Vt(x,{sn:I,codecClass:"_zipjs_Inflater",crcType:L},E,w,D,U,b,R,k,F):zt(new Us,E,w,D,U,L,b,R,k,F)})(y._worker,r++,n,f,_,y.compressedSize,T,l,p,g,c)},c)):o(it)},g)};var u={getEntries:function(f){var h=this._worker;(function(p){function T(y,l){n.readUint8Array(n.size-y,y,function(g){for(var c=g.length-22;c>=0;c--)if(g[c]===80&&g[c+1]===75&&g[c+2]===5&&g[c+3]===6)return void p(new DataView(g.buffer,c,22));l()},function(){o(En)})}n.size<22?o(it):T(22,function(){T(Math.min(65558,n.size),function(){o(it)})})})(function(p){var T,y;T=p.getUint32(16,!0),y=p.getUint16(8,!0),T<0||T>=n.size?o(it):n.readUint8Array(T,n.size-T,function(l){var g,c,d,_,m=0,x=[],I=Xe(l.length,l);for(g=0;g<y;g++){if((c=new a)._worker=h,I.view.getUint32(m)!=1347092738)return void o(it);Sn(c,I,m+6,!0,o),c.commentLength=I.view.getUint16(m+32,!0),c.directory=(16&I.view.getUint8(m+38))==16,c.offset=I.view.getUint32(m+42,!0),d=Dn(I.array.subarray(m+46,m+46+c.filenameLength)),c.filename=(2048&c.bitFlag)==2048?Rn(d):bn(d),c.directory||c.filename.charAt(c.filename.length-1)!="/"||(c.directory=!0),_=Dn(I.array.subarray(m+46+c.filenameLength+c.extraFieldLength,m+46+c.filenameLength+c.extraFieldLength+c.commentLength)),c.comment=(2048&c.bitFlag)==2048?Rn(_):bn(_),x.push(c),m+=46+c.filenameLength+c.extraFieldLength+c.commentLength}f(x)},function(){o(En)})})},close:function(f){this._worker&&(this._worker.terminate(),this._worker=null),f&&f()},_worker:null};W.useWebWorkers?vn("inflater",function(f){u._worker=f,i(u)},function(f){o(f)}):i(u)})(s,e,t)},t=t||Mn)},createWriter:function(s,e,t,n){n=!!n,s.init(function(){(function(i,o,r,a){var u={},f=[],h=0,p=0;function T(g){r(g||"Error while writing zip file.")}function y(g){r(g||"Error while reading file data.")}var l={add:function(g,c,d,_,m){var x,I,E,w=this._worker;function D(S,R){var b=Xe(16);h+=S||0,b.view.setUint32(0,1347094280),R!==void 0&&(x.view.setUint32(10,R,!0),b.view.setUint32(4,R,!0)),c&&(b.view.setUint32(8,S,!0),x.view.setUint32(14,S,!0),b.view.setUint32(12,c.size,!0),x.view.setUint32(18,c.size,!0)),i.writeUint8Array(b.array,function(){h+=16,d()},T)}function U(){var S;m=m||{},g=g.trim(),m.directory&&g.charAt(g.length-1)!="/"&&(g+="/"),u.hasOwnProperty(g)?r("File already exists."):(I=Nn(An(g)),f.push(g),E=m.lastModDate||new Date,x=Xe(26),u[g]={headerArray:x.array,directory:m.directory,filename:I,offset:h,comment:Nn(An(m.comment||""))},x.view.setUint32(0,335546376),m.version&&x.view.setUint8(0,m.version),a||m.level===0||m.directory||x.view.setUint16(4,2048),x.view.setUint16(6,(E.getHours()<<6|E.getMinutes())<<5|E.getSeconds()/2,!0),x.view.setUint16(8,(E.getFullYear()-1980<<4|E.getMonth()+1)<<5|E.getDate(),!0),x.view.setUint16(22,I.length,!0),(S=Xe(30+I.length)).view.setUint32(0,1347093252),S.array.set(x.array,4),S.array.set(I,30),h+=S.array.length,i.writeUint8Array(S.array,function(){c?a||m.level===0?In(w,p++,c,i,0,c.size,!0,D,_,y,T):(function(R,b,k,F,L,j,$,pe,ee){var P="input";W.useWebWorkers?Vt(R,{sn:b,options:{level:L},codecClass:"_zipjs_Deflater",crcType:P},k,F,0,k.size,$,j,pe,ee):zt(new Cs,k,F,0,k.size,P,$,j,pe,ee)})(w,p++,c,i,m.level,D,_,y,T):D()},T))}c?c.init(U,y):U()},close:function(g){this._worker&&(this._worker.terminate(),this._worker=null);var c,d,_,m=0,x=0;for(d=0;d<f.length;d++)m+=46+(_=u[f[d]]).filename.length+_.comment.length;for(c=Xe(m+22),d=0;d<f.length;d++)_=u[f[d]],c.view.setUint32(x,1347092738),c.view.setUint16(x+4,5120),c.array.set(_.headerArray,x+6),c.view.setUint16(x+32,_.comment.length,!0),_.directory&&c.view.setUint8(x+38,16),c.view.setUint32(x+42,_.offset,!0),c.array.set(_.filename,x+46),c.array.set(_.comment,x+46+_.filename.length),x+=46+_.filename.length+_.comment.length;c.view.setUint32(x,1347093766),c.view.setUint16(x+8,f.length,!0),c.view.setUint16(x+10,f.length,!0),c.view.setUint32(x+12,m,!0),c.view.setUint32(x+16,h,!0),i.writeUint8Array(c.array,function(){i.getData(g)},T)},_worker:null};W.useWebWorkers?vn("deflater",function(g){l._worker=g,o(l)},function(g){r(g)}):o(l)})(s,e,t,n)},t=t||Mn)},useWebWorkers:!0,workerScriptsPath:null,workerScripts:null};var Ye,ae,At=W.TextWriter,mt=W.BlobWriter,Nt=W.Data64URIWriter,Cn=W.TextReader,Kt=W.BlobReader,On=W.Data64URIReader,dr=W.createReader,hr=W.createWriter;function xt(s){var e,t=this;t.size=0,t.init=function(n){t.size=s.uncompressedSize,n()},t.readUint8Array=function(n,i,o,r){(function(a){t.data?a():s.getData(new mt,function(u){t.data=u,e=new Kt(u),a()},null,t.checkCrc32)})(function(){e.readUint8Array(n,i,o,r)})}}function Un(s){var e=0;return(function t(n){e+=n.uncompressedSize||0,n.children.forEach(t)})(s),e}function Xt(s,e,t){var n=0;function i(){++n<s.children.length?o(s.children[n]):e()}function o(r){r.directory?Xt(r,i,t):(r.reader=new r.Reader(r.data,t),r.reader.init(function(){r.uncompressedSize=r.reader.size,i()}))}s.children.length?o(s.children[n]):e()}function kn(s){var e=s.parent.children;e.forEach(function(t,n){t.id==s.id&&e.splice(n,1)})}function Tt(s){s.entries=[],s.root=new ut(s)}function Ze(s,e,t,n){if(s.directory)return n?new ut(s.fs,e,t,s):new $t(s.fs,e,t,s);throw"Parent entry is not a directory."}function Qe(){}function $t(s,e,t,n){var i=this;Qe.prototype.init.call(i,s,e,t,n),i.Reader=t.Reader,i.Writer=t.Writer,i.data=t.data,t.getData&&(i.getData=t.getData)}function ut(s,e,t,n){Qe.prototype.init.call(this,s,e,t,n),this.directory=!0}function ks(){Tt(this)}(xt.prototype=new W.Reader).constructor=xt,xt.prototype.checkCrc32=!1,(Qe.prototype={init:function(s,e,t,n){var i=this;if(s.root&&n&&n.getChildByName(e))throw"Entry filename already exists.";t||(t={}),i.fs=s,i.name=e,i.id=s.entries.length,i.parent=n,i.children=[],i.zipVersion=t.zipVersion||20,i.uncompressedSize=0,s.entries.push(i),n&&i.parent.children.push(i)},getFileEntry:function(s,e,t,n,i){var o=this;Xt(o,function(){(function(r,a,u,f,h,p,T){var y=0;a.directory?(function l(g,c,d,_,m,x){var I=0;(function E(){var w=c.children[I];w?(function(D){function U(S){y+=D.uncompressedSize||0,l(S,D,function(){I++,E()},_,m,x)}D.directory?g.getDirectory(D.name,{create:!0},U,m):g.getFile(D.name,{create:!0},function(S){D.getData(new W.FileWriter(S,W.getMimeType(D.name)),U,function(R){_&&_(y+R,x)},T)},m)})(w):d()})()})(r,a,u,f,h,p):a.getData(new W.FileWriter(r,W.getMimeType(a.name)),u,f,T)})(s,o,e,t,n,Un(o),i)},n)},moveTo:function(s){var e=this;if(!s.directory)throw"Target entry is not a directory.";if(s.isDescendantOf(e))throw"Entry is a ancestor of target entry.";if(e!=s){if(s.getChildByName(e.name))throw"Entry filename already exists.";kn(e),e.parent=s,s.children.push(e)}},getFullname:function(){for(var s=this.name,e=this.parent;e;)s=(e.name?e.name+"/":"")+s,e=e.parent;return s},isDescendantOf:function(s){for(var e=this.parent;e&&e.id!=s.id;)e=e.parent;return!!e}}).constructor=Qe,$t.prototype=Ye=new Qe,Ye.constructor=$t,Ye.getData=function(s,e,t,n){var i=this;!s||s.constructor==i.Writer&&i.data?e(i.data):(i.reader||(i.reader=new i.Reader(i.data,n)),i.reader.init(function(){s.init(function(){(function(o,r,a,u,f){var h=0;(function p(){var T=524288*h;u&&u(T,o.size),T<o.size?o.readUint8Array(T,Math.min(524288,o.size-T),function(y){r.writeUint8Array(new Uint8Array(y),function(){h++,p()})},f):r.getData(a)})()})(i.reader,s,e,t,n)},n)}))},Ye.getText=function(s,e,t,n){this.getData(new At(n),s,e,t)},Ye.getBlob=function(s,e,t,n){this.getData(new mt(s),e,t,n)},Ye.getData64URI=function(s,e,t,n){this.getData(new Nt(s),e,t,n)},ut.prototype=ae=new Qe,ae.constructor=ut,ae.addDirectory=function(s){return Ze(this,s,null,!0)},ae.addText=function(s,e){return Ze(this,s,{data:e,Reader:Cn,Writer:At})},ae.addBlob=function(s,e){return Ze(this,s,{data:e,Reader:Kt,Writer:mt})},ae.addData64URI=function(s,e){return Ze(this,s,{data:e,Reader:On,Writer:Nt})},ae.addFileEntry=function(s,e,t){(function(n,i,o,r){i.isDirectory?(function a(u,f,h){(function(p,T){p.isDirectory&&p.createReader().readEntries(T),p.isFile&&T([])})(f,function(p){var T=0;(function y(){var l=p[T];l?(function(g){function c(d){a(d,g,function(){T++,y()})}g.isDirectory&&c(u.addDirectory(g.name)),g.isFile&&g.file(function(d){var _=u.addBlob(g.name,d);_.uncompressedSize=d.size,c(_)},r)})(l):h()})()})})(n,i,o):i.file(function(a){n.addBlob(i.name,a),o()},r)})(this,s,e,t)},ae.addData=function(s,e){return Ze(this,s,e)},ae.importBlob=function(s,e,t){this.importZip(new Kt(s),e,t)},ae.importText=function(s,e,t){this.importZip(new Cn(s),e,t)},ae.importData64URI=function(s,e,t){this.importZip(new On(s),e,t)},ae.exportBlob=function(s,e,t){this.exportZip(new mt("application/zip"),s,e,t)},ae.exportText=function(s,e,t){this.exportZip(new At,s,e,t)},ae.exportFileEntry=function(s,e,t,n){this.exportZip(new W.FileWriter(s,"application/zip"),e,t,n)},ae.exportData64URI=function(s,e,t){this.exportZip(new Nt("application/zip"),s,e,t)},ae.importZip=function(s,e,t){var n=this;dr(s,function(i){i.getEntries(function(o){o.forEach(function(r){var a=n,u=r.filename.split("/"),f=u.pop();u.forEach(function(h){a=a.getChildByName(h)||new ut(n.fs,h,null,a)}),r.directory||Ze(a,f,{data:r,Reader:xt})}),e()})},t)},ae.exportZip=function(s,e,t,n){var i=this;Xt(i,function(){hr(s,function(o){(function(r,a,u,f,h){var p=0;(function T(y,l,g,c,d){var _=0;(function m(){var x=l.children[_];x?y.add(x.getFullname(),x.reader,function(){p+=x.uncompressedSize||0,T(y,x,function(){_++,m()},c,d)},function(I){c&&c(p+I,d)},{directory:x.directory,version:x.zipVersion}):g()})()})(r,a,u,f,h)})(o,i,function(){o.close(e)},t,Un(i))},n)},n)},ae.getChildByName=function(s){var e,t;for(e=0;e<this.children.length;e++)if((t=this.children[e]).name==s)return t},ks.prototype={remove:function(s){kn(s),this.entries[s.id]=null},find:function(s){var e,t=s.split("/"),n=this.root;for(e=0;n&&e<t.length;e++)n=n.getChildByName(t[e]);return n},getById:function(s){return this.entries[s]},importBlob:function(s,e,t){Tt(this),this.root.importBlob(s,e,t)},importText:function(s,e,t){Tt(this),this.root.importText(s,e,t)},importData64URI:function(s,e,t){Tt(this),this.root.importData64URI(s,e,t)},exportBlob:function(s,e,t){this.root.exportBlob(s,e,t)},exportText:function(s,e,t){this.root.exportText(s,e,t)},exportFileEntry:function(s,e,t,n){this.root.exportFileEntry(s,e,t,n)},exportData64URI:function(s,e,t){this.root.exportData64URI(s,e,t)}},W.getMimeType=function(){return"application/octet-stream"};var pr={FS:ks};W.useWebWorkers=!1;var xr=(function(){function s(t,n){this.el=t,this.inputEl=n,this.listeners={drop:[],dropstart:[],droperror:[]},this._onDragover=this._onDragover.bind(this),this._onDrop=this._onDrop.bind(this),this._onSelect=this._onSelect.bind(this),t.addEventListener("dragover",this._onDragover,!1),t.addEventListener("drop",this._onDrop,!1),n.addEventListener("change",this._onSelect)}var e=s.prototype;return e.on=function(t,n){return this.listeners[t].push(n),this},e._emit=function(t,n){return this.listeners[t].forEach(function(i){return i(n)}),this},e.destroy=function(){var t=this.el,n=this.inputEl;t.removeEventListener("dragover",this._onDragover,!1),t.removeEventListener("drop",this._onDrop,!1),n.removeEventListener("change",this._onSelect),delete this.el,delete this.inputEl,delete this.listeners},e._onDrop=function(t){t.stopPropagation(),t.preventDefault(),this._emit("dropstart");var n=Array.from(t.dataTransfer.files||[]),i=Array.from(t.dataTransfer.items||[]);if(n.length!==0||i.length!==0)if(i.length>0){var o=i.map(function(r){return r.webkitGetAsEntry()}).filter(function(r){return r!==null});o.length>0&&(o[0].name.match(/\.zip$/)?this._loadZip(i[0].getAsFile()):this._loadNextEntry(new Map,o))}else n.length===1&&n[0].name.match(/\.zip$/)&&this._loadZip(n[0]),this._emit("drop",{files:new Map(n.map(function(r){return[r.name,r]}))});else this._fail("Required drag-and-drop APIs are not supported in this browser.")},e._onDragover=function(t){t.stopPropagation(),t.preventDefault(),t.dataTransfer.dropEffect="copy"},e._onSelect=function(t){this._emit("dropstart");var n=[].slice.call(this.inputEl.files);if(n.length===1&&this._isZip(n[0]))this._loadZip(n[0]);else{var i=new Map;n.forEach(function(o){return i.set(o.webkitRelativePath||o.name,o)}),this._emit("drop",{files:i})}},e._loadNextEntry=function(t,n){var i=this,o=n.pop();if(o)if(o.isFile)o.file(function(a){t.set(o.fullPath,a),i._loadNextEntry(t,n)},function(){return console.error("Could not load file: %s",o.fullPath)});else if(o.isDirectory){var r=o.createReader();r.readEntries(function a(u){u.length?(n=n.concat(u),r.readEntries(a)):i._loadNextEntry(t,n)})}else console.warn("Unknown asset type: "+o.fullPath),this._loadNextEntry(t,n);else this._emit("drop",{files:t})},e._loadZip=function(t){var n=this,i=[],o=new Map,r=new pr.FS,a=function u(f){f.directory?f.children.forEach(u):f.name[0]!=="."&&i.push(new Promise(function(h){f.getData(new W.BlobWriter,function(p){p.name=f.name,o.set(f.getFullname(),p),h()})}))};r.importBlob(t,function(){a(r.root),Promise.all(i).then(function(){n._emit("drop",{files:o,archive:t})})})},e._isZip=function(t){return t.type==="application/zip"||t.name.match(/\.zip$/)},e._fail=function(t){this._emit("droperror",{message:t})},s})();const Qt=Xs(new $s);Qt.registerExtensions(vs);const Fs=await Qs();Fs.setup();const{Manifold:Fn,Mesh:gr}=Fs,js=document.querySelector("model-viewer"),_r=document.querySelector("#input"),Bs=document.querySelector("#download"),He=document.querySelector("#viewFinal"),mr=new xr(js,_r);let yt="",It="",wt=!0,bt=!1;mr.on("drop",async({files:s})=>{for(const[e,t]of s)if(t.name.toLowerCase().match(/\.(gltf|glb)$/)){URL.revokeObjectURL(yt),yt=URL.createObjectURL(t),await Tr(await yr(yt)),Ls();break}});function Ls(){wt?(He.checked=!0,He.disabled=!0):bt?(He.checked=!1,He.disabled=!1):(He.checked=!1,He.disabled=!0),Ps()}He.onclick=Ps;function Ps(){js.src=He.checked?It:yt,Bs.disabled=!He.checked}Bs.onclick=()=>{const s=document.createElement("a");s.download="manifold.glb",s.href=It,s.click()};async function Tr(s){if(URL.revokeObjectURL(It),!bt)return;const e=await Qt.writeBinary(s),t=new Blob([e],{type:"application/octet-stream"});It=URL.createObjectURL(t)}async function yr(s){wt=!1,bt=!1,Ls(),wt=!0;const e=await Qt.read(s),t=e.getRoot().listNodes();for(const n of t){const i=n.getMesh();if(!i)continue;const o=Ws(i);if(!o)continue;const r=new Map,a=o.runProperties.length,u=Fn.reserveIDs(a);o.mesh.runOriginalID=new Uint32Array(a);for(let h=0;h<a;++h)o.mesh.runOriginalID[h]=u+h,r.set(u+h,o.runProperties[h]);const f=new gr(o.mesh);qs(i),f.merge();try{const h=new Fn(f);n.setMesh(Ys(e,h.getMesh(),r)),h.delete(),bt=!0}catch(h){console.log(i.getName(),h),wt=!1}}return await e.transform(Zs()),e}
