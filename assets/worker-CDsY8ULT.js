class mo{constructor(){this._listeners={}}addEventListener(e,t){const n=this._listeners;return n[e]===void 0&&(n[e]=[]),n[e].indexOf(t)===-1&&n[e].push(t),this}removeEventListener(e,t){const s=this._listeners[e];if(s!==void 0){const i=s.indexOf(t);i!==-1&&s.splice(i,1)}return this}dispatchEvent(e){const n=this._listeners[e.type];if(n!==void 0){const s=n.slice(0);for(let i=0,o=s.length;i<o;i++)s[i].call(this,e)}return this}dispose(){for(const e in this._listeners)delete this._listeners[e]}}class rr{constructor(e,t,n,s={}){if(this._name=void 0,this._parent=void 0,this._child=void 0,this._attributes=void 0,this._disposed=!1,this._name=e,this._parent=t,this._child=n,this._attributes=s,!t.isOnGraph(n))throw new Error("Cannot connect disconnected graphs.")}getName(){return this._name}getParent(){return this._parent}getChild(){return this._child}setChild(e){return this._child=e,this}getAttributes(){return this._attributes}dispose(){this._disposed||(this._parent._destroyRef(this),this._disposed=!0)}isDisposed(){return this._disposed}}class Xc extends mo{constructor(...e){super(...e),this._emptySet=new Set,this._edges=new Set,this._parentEdges=new Map,this._childEdges=new Map}listEdges(){return Array.from(this._edges)}listParentEdges(e){return Array.from(this._childEdges.get(e)||this._emptySet)}listParents(e){const t=new Set;for(const n of this.listParentEdges(e))t.add(n.getParent());return Array.from(t)}listChildEdges(e){return Array.from(this._parentEdges.get(e)||this._emptySet)}listChildren(e){const t=new Set;for(const n of this.listChildEdges(e))t.add(n.getChild());return Array.from(t)}disconnectParents(e,t){for(const n of this.listParentEdges(e))(!t||t(n.getParent()))&&n.dispose();return this}_createEdge(e,t,n,s){const i=new rr(e,t,n,s);this._edges.add(i);const o=i.getParent();this._parentEdges.has(o)||this._parentEdges.set(o,new Set),this._parentEdges.get(o).add(i);const a=i.getChild();return this._childEdges.has(a)||this._childEdges.set(a,new Set),this._childEdges.get(a).add(i),i}_destroyEdge(e){return this._edges.delete(e),this._parentEdges.get(e.getParent()).delete(e),this._childEdges.get(e.getChild()).delete(e),this}}function Rr(){return Rr=Object.assign||function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n])}return r},Rr.apply(this,arguments)}class kn{constructor(e){if(this.list=[],e)for(const t of e)this.list.push(t)}add(e){this.list.push(e)}remove(e){const t=this.list.indexOf(e);t>=0&&this.list.splice(t,1)}removeChild(e){const t=[];for(const n of this.list)n.getChild()===e&&t.push(n);for(const n of t)this.remove(n);return t}listRefsByChild(e){const t=[];for(const n of this.list)n.getChild()===e&&t.push(n);return t}values(){return this.list}}class Je{constructor(e){if(this.set=new Set,this.map=new Map,e)for(const t of e)this.add(t)}add(e){const t=e.getChild();this.removeChild(t),this.set.add(e),this.map.set(t,e)}remove(e){this.set.delete(e),this.map.delete(e.getChild())}removeChild(e){const t=this.map.get(e)||null;return t&&this.remove(t),t}getRefByChild(e){return this.map.get(e)||null}values(){return Array.from(this.set)}}class Qt{constructor(e){this.map={},e&&Object.assign(this.map,e)}set(e,t){this.map[e]=t}delete(e){delete this.map[e]}get(e){return this.map[e]||null}keys(){return Object.keys(this.map)}values(){return Object.values(this.map)}}const ze=Symbol("attributes"),zn=Symbol("immutableKeys");class ri extends mo{constructor(e){super(),this._disposed=!1,this.graph=void 0,this[ze]=void 0,this[zn]=void 0,this.graph=e,this[zn]=new Set,this[ze]=this._createAttributes()}getDefaults(){return{}}_createAttributes(){const e=this.getDefaults(),t={};for(const n in e){const s=e[n];if(s instanceof ri){const i=this.graph._createEdge(n,this,s);this[zn].add(n),t[n]=i}else t[n]=s}return t}isOnGraph(e){return this.graph===e.graph}isDisposed(){return this._disposed}dispose(){this._disposed||(this.graph.listChildEdges(this).forEach(e=>e.dispose()),this.graph.disconnectParents(this),this._disposed=!0,this.dispatchEvent({type:"dispose"}))}detach(){return this.graph.disconnectParents(this),this}swap(e,t){for(const n in this[ze]){const s=this[ze][n];if(s instanceof rr){const i=s;i.getChild()===e&&this.setRef(n,t,i.getAttributes())}else if(s instanceof kn)for(const i of s.listRefsByChild(e)){const o=i.getAttributes();this.removeRef(n,e),this.addRef(n,t,o)}else if(s instanceof Je){const i=s.getRefByChild(e);if(i){const o=i.getAttributes();this.removeRef(n,e),this.addRef(n,t,o)}}else if(s instanceof Qt)for(const i of s.keys()){const o=s.get(i);o.getChild()===e&&this.setRefMap(n,i,t,o.getAttributes())}}return this}get(e){return this[ze][e]}set(e,t){return this[ze][e]=t,this.dispatchEvent({type:"change",attribute:e})}getRef(e){const t=this[ze][e];return t?t.getChild():null}setRef(e,t,n){if(this[zn].has(e))throw new Error(`Cannot overwrite immutable attribute, "${e}".`);const s=this[ze][e];if(s&&s.dispose(),!t)return this;const i=this.graph._createEdge(e,this,t,n);return this[ze][e]=i,this.dispatchEvent({type:"change",attribute:e})}listRefs(e){return this.assertRefList(e).values().map(n=>n.getChild())}addRef(e,t,n){const s=this.graph._createEdge(e,this,t,n);return this.assertRefList(e).add(s),this.dispatchEvent({type:"change",attribute:e})}removeRef(e,t){const n=this.assertRefList(e);if(n instanceof kn)for(const s of n.listRefsByChild(t))s.dispose();else{const s=n.getRefByChild(t);s&&s.dispose()}return this}assertRefList(e){const t=this[ze][e];if(t instanceof kn||t instanceof Je)return t;throw new Error(`Expected RefList or RefSet for attribute "${e}"`)}listRefMapKeys(e){return this.assertRefMap(e).keys()}listRefMapValues(e){return this.assertRefMap(e).values().map(t=>t.getChild())}getRefMap(e,t){const s=this.assertRefMap(e).get(t);return s?s.getChild():null}setRefMap(e,t,n,s){const i=this.assertRefMap(e),o=i.get(t);if(o&&o.dispose(),!n)return this;s=Object.assign(s||{},{key:t});const a=this.graph._createEdge(e,this,n,Rr({},s,{key:t}));return i.set(t,a),this.dispatchEvent({type:"change",attribute:e,key:t})}assertRefMap(e){const t=this[ze][e];if(t instanceof Qt)return t;throw new Error(`Expected RefMap for attribute "${e}"`)}dispatchEvent(e){return super.dispatchEvent(Rr({},e,{target:this})),this.graph.dispatchEvent(Rr({},e,{target:this,type:`node:${e.type}`})),this}_destroyRef(e){const t=e.getName();if(this[ze][t]===e)this[ze][t]=null,this[zn].has(t)&&e.getChild().dispose();else if(this[ze][t]instanceof kn)this[ze][t].remove(e);else if(this[ze][t]instanceof Je)this[ze][t].remove(e);else if(this[ze][t]instanceof Qt){const n=this[ze][t];for(const s of n.keys())n.get(s)===e&&n.delete(s)}else return;this.graph._destroyEdge(e),this.dispatchEvent({type:"change",attribute:t})}}const yo="v4.2.1",ir="@glb.bin";var k;(function(r){r.ACCESSOR="Accessor",r.ANIMATION="Animation",r.ANIMATION_CHANNEL="AnimationChannel",r.ANIMATION_SAMPLER="AnimationSampler",r.BUFFER="Buffer",r.CAMERA="Camera",r.MATERIAL="Material",r.MESH="Mesh",r.PRIMITIVE="Primitive",r.PRIMITIVE_TARGET="PrimitiveTarget",r.NODE="Node",r.ROOT="Root",r.SCENE="Scene",r.SKIN="Skin",r.TEXTURE="Texture",r.TEXTURE_INFO="TextureInfo"})(k||(k={}));var ns;(function(r){r.INTERLEAVED="interleaved",r.SEPARATE="separate"})(ns||(ns={}));var Ut;(function(r){r.ARRAY_BUFFER="ARRAY_BUFFER",r.ELEMENT_ARRAY_BUFFER="ELEMENT_ARRAY_BUFFER",r.INVERSE_BIND_MATRICES="INVERSE_BIND_MATRICES",r.OTHER="OTHER",r.SPARSE="SPARSE"})(Ut||(Ut={}));var Wt;(function(r){r[r.R=4096]="R",r[r.G=256]="G",r[r.B=16]="B",r[r.A=1]="A"})(Wt||(Wt={}));var jn;(function(r){r.GLTF="GLTF",r.GLB="GLB"})(jn||(jn={}));const us={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};class Ne{static createBufferFromDataURI(e){if(typeof Buffer>"u"){const t=atob(e.split(",")[1]),n=new Uint8Array(t.length);for(let s=0;s<t.length;s++)n[s]=t.charCodeAt(s);return n}else{const t=e.split(",")[1],n=e.indexOf("base64")>=0;return Buffer.from(t,n?"base64":"utf8")}}static encodeText(e){return new TextEncoder().encode(e)}static decodeText(e){return new TextDecoder().decode(e)}static concat(e){let t=0;for(const i of e)t+=i.byteLength;const n=new Uint8Array(t);let s=0;for(const i of e)n.set(i,s),s+=i.byteLength;return n}static pad(e,t=0){const n=this.padNumber(e.byteLength);if(n===e.byteLength)return e;const s=new Uint8Array(n);if(s.set(e),t!==0)for(let i=e.byteLength;i<n;i++)s[i]=t;return s}static padNumber(e){return Math.ceil(e/4)*4}static equals(e,t){if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;let n=e.byteLength;for(;n--;)if(e[n]!==t[n])return!1;return!0}static toView(e,t=0,n=1/0){return new Uint8Array(e.buffer,e.byteOffset+t,Math.min(e.byteLength,n))}static assertView(e){if(e&&!ArrayBuffer.isView(e))throw new Error(`Method requires Uint8Array parameter; received "${typeof e}".`);return e}}class Kc{match(e){return e.length>=3&&e[0]===255&&e[1]===216&&e[2]===255}getSize(e){let t=new DataView(e.buffer,e.byteOffset+4),n,s;for(;t.byteLength;){if(n=t.getUint16(0,!1),qc(t,n),s=t.getUint8(n+1),s===192||s===193||s===194)return[t.getUint16(n+7,!1),t.getUint16(n+5,!1)];t=new DataView(e.buffer,t.byteOffset+n+2)}throw new TypeError("Invalid JPG, no size found")}getChannels(e){return 3}}class fs{match(e){return e.length>=8&&e[0]===137&&e[1]===80&&e[2]===78&&e[3]===71&&e[4]===13&&e[5]===10&&e[6]===26&&e[7]===10}getSize(e){const t=new DataView(e.buffer,e.byteOffset);return Ne.decodeText(e.slice(12,16))===fs.PNG_FRIED_CHUNK_NAME?[t.getUint32(32,!1),t.getUint32(36,!1)]:[t.getUint32(16,!1),t.getUint32(20,!1)]}getChannels(e){return 4}}fs.PNG_FRIED_CHUNK_NAME="CgBI";class sn{static registerFormat(e,t){this.impls[e]=t}static getMimeType(e){for(const t in this.impls)if(this.impls[t].match(e))return t;return null}static getSize(e,t){return this.impls[t]?this.impls[t].getSize(e):null}static getChannels(e,t){return this.impls[t]?this.impls[t].getChannels(e):null}static getVRAMByteLength(e,t){if(!this.impls[t])return null;if(this.impls[t].getVRAMByteLength)return this.impls[t].getVRAMByteLength(e);let n=0;const s=4,i=this.getSize(e,t);if(!i)return null;for(;i[0]>1||i[1]>1;)n+=i[0]*i[1]*s,i[0]=Math.max(Math.floor(i[0]/2),1),i[1]=Math.max(Math.floor(i[1]/2),1);return n+=1*s,n}static mimeTypeToExtension(e){return e==="image/jpeg"?"jpg":e.split("/").pop()}static extensionToMimeType(e){return e==="jpg"?"image/jpeg":e?`image/${e}`:""}}sn.impls={"image/jpeg":new Kc,"image/png":new fs};function qc(r,e){if(e>r.byteLength)throw new TypeError("Corrupt JPG, exceeded buffer limits");if(r.getUint8(e)!==255)throw new TypeError("Invalid JPG, marker table corrupted");return r}class or{static basename(e){const t=e.split(/[\\/]/).pop();return t.substring(0,t.lastIndexOf("."))}static extension(e){if(e.startsWith("data:image/")){const t=e.match(/data:(image\/\w+)/)[1];return sn.mimeTypeToExtension(t)}else{if(e.startsWith("data:model/gltf+json"))return"gltf";if(e.startsWith("data:model/gltf-binary"))return"glb";if(e.startsWith("data:application/"))return"bin"}return e.split(/[\\/]/).pop().split(/[.]/).pop()}}var Vs=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var r=0,e=arguments.length;e--;)r+=arguments[e]*arguments[e];return Math.sqrt(r)});function Yc(){var r=new Vs(3);return Vs!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r}function Os(r){var e=r[0],t=r[1],n=r[2];return Math.hypot(e,t,n)}function Jc(r,e,t){var n=e[0],s=e[1],i=e[2],o=t[3]*n+t[7]*s+t[11]*i+t[15];return o=o||1,r[0]=(t[0]*n+t[4]*s+t[8]*i+t[12])/o,r[1]=(t[1]*n+t[5]*s+t[9]*i+t[13])/o,r[2]=(t[2]*n+t[6]*s+t[10]*i+t[14])/o,r}(function(){var r=Yc();return function(e,t,n,s,i,o){var a,u;for(t||(t=3),n||(n=0),s?u=Math.min(s*t+n,e.length):u=e.length,a=n;a<u;a+=t)r[0]=e[a],r[1]=e[a+1],r[2]=e[a+2],i(r,r,o),e[a]=r[0],e[a+1]=r[1],e[a+2]=r[2];return e}})();function Zc(r){const e=To(),t=r.propertyType===k.NODE?[r]:r.listChildren();for(const n of t)n.traverse(s=>{const i=s.getMesh();if(!i)return;const o=Qc(i,s.getWorldMatrix());o.min.every(isFinite)&&o.max.every(isFinite)&&(Gs(o.min,e),Gs(o.max,e))});return e}function Qc(r,e){const t=To();for(const n of r.listPrimitives()){const s=n.getAttribute("POSITION"),i=n.getIndices();if(!s)continue;let o=[0,0,0],a=[0,0,0];for(let u=0,h=i?i.getCount():s.getCount();u<h;u++){const y=i?i.getScalar(u):u;o=s.getElement(y,o),a=Jc(a,o,e),Gs(a,t)}}return t}function Gs(r,e){for(let t=0;t<3;t++)e.min[t]=Math.min(r[t],e.min[t]),e.max[t]=Math.max(r[t],e.max[t])}function To(){return{min:[1/0,1/0,1/0],max:[-1/0,-1/0,-1/0]}}const Ai="https://null.example";class Ir{static dirname(e){const t=e.lastIndexOf("/");return t===-1?"./":e.substring(0,t+1)}static basename(e){return or.basename(new URL(e,Ai).pathname)}static extension(e){return or.extension(new URL(e,Ai).pathname)}static resolve(e,t){if(!this.isRelativePath(t))return t;const n=e.split("/"),s=t.split("/");n.pop();for(let i=0;i<s.length;i++)s[i]!=="."&&(s[i]===".."?n.pop():n.push(s[i]));return n.join("/")}static isAbsoluteURL(e){return this.PROTOCOL_REGEXP.test(e)}static isRelativePath(e){return!/^(?:[a-zA-Z]+:)?\//.test(e)}}Ir.DEFAULT_INIT={};Ir.PROTOCOL_REGEXP=/^[a-zA-Z]+:\/\//;function Mi(r){return Object.prototype.toString.call(r)==="[object Object]"}function Wn(r){if(Mi(r)===!1)return!1;const e=r.constructor;if(e===void 0)return!0;const t=e.prototype;return!(Mi(t)===!1||Object.hasOwn(t,"isPrototypeOf")===!1)}var Hs,zs;(function(r){r[r.SILENT=4]="SILENT",r[r.ERROR=3]="ERROR",r[r.WARN=2]="WARN",r[r.INFO=1]="INFO",r[r.DEBUG=0]="DEBUG"})(zs||(zs={}));class zt{constructor(e){this.verbosity=void 0,this.verbosity=e}debug(e){this.verbosity<=zt.Verbosity.DEBUG&&console.debug(e)}info(e){this.verbosity<=zt.Verbosity.INFO&&console.info(e)}warn(e){this.verbosity<=zt.Verbosity.WARN&&console.warn(e)}error(e){this.verbosity<=zt.Verbosity.ERROR&&console.error(e)}}Hs=zt;zt.Verbosity=zs;zt.DEFAULT_INSTANCE=new Hs(Hs.Verbosity.INFO);function el(r){var e=r[0],t=r[1],n=r[2],s=r[3],i=r[4],o=r[5],a=r[6],u=r[7],h=r[8],y=r[9],v=r[10],p=r[11],T=r[12],C=r[13],G=r[14],V=r[15],E=e*o-t*i,F=e*a-n*i,_=e*u-s*i,N=t*a-n*o,P=t*u-s*o,B=n*u-s*a,d=h*C-y*T,R=h*G-v*T,b=h*V-p*T,$=y*G-v*C,Q=y*V-p*C,ee=v*V-p*G;return E*ee-F*Q+_*$+N*b-P*R+B*d}function tl(r,e,t){var n=e[0],s=e[1],i=e[2],o=e[3],a=e[4],u=e[5],h=e[6],y=e[7],v=e[8],p=e[9],T=e[10],C=e[11],G=e[12],V=e[13],E=e[14],F=e[15],_=t[0],N=t[1],P=t[2],B=t[3];return r[0]=_*n+N*a+P*v+B*G,r[1]=_*s+N*u+P*p+B*V,r[2]=_*i+N*h+P*T+B*E,r[3]=_*o+N*y+P*C+B*F,_=t[4],N=t[5],P=t[6],B=t[7],r[4]=_*n+N*a+P*v+B*G,r[5]=_*s+N*u+P*p+B*V,r[6]=_*i+N*h+P*T+B*E,r[7]=_*o+N*y+P*C+B*F,_=t[8],N=t[9],P=t[10],B=t[11],r[8]=_*n+N*a+P*v+B*G,r[9]=_*s+N*u+P*p+B*V,r[10]=_*i+N*h+P*T+B*E,r[11]=_*o+N*y+P*C+B*F,_=t[12],N=t[13],P=t[14],B=t[15],r[12]=_*n+N*a+P*v+B*G,r[13]=_*s+N*u+P*p+B*V,r[14]=_*i+N*h+P*T+B*E,r[15]=_*o+N*y+P*C+B*F,r}function nl(r,e){var t=e[0],n=e[1],s=e[2],i=e[4],o=e[5],a=e[6],u=e[8],h=e[9],y=e[10];return r[0]=Math.hypot(t,n,s),r[1]=Math.hypot(i,o,a),r[2]=Math.hypot(u,h,y),r}function rl(r,e){var t=new Vs(3);nl(t,e);var n=1/t[0],s=1/t[1],i=1/t[2],o=e[0]*n,a=e[1]*s,u=e[2]*i,h=e[4]*n,y=e[5]*s,v=e[6]*i,p=e[8]*n,T=e[9]*s,C=e[10]*i,G=o+y+C,V=0;return G>0?(V=Math.sqrt(G+1)*2,r[3]=.25*V,r[0]=(v-T)/V,r[1]=(p-u)/V,r[2]=(a-h)/V):o>y&&o>C?(V=Math.sqrt(1+o-y-C)*2,r[3]=(v-T)/V,r[0]=.25*V,r[1]=(a+h)/V,r[2]=(p+u)/V):y>C?(V=Math.sqrt(1+y-o-C)*2,r[3]=(p-u)/V,r[0]=(a+h)/V,r[1]=.25*V,r[2]=(v+T)/V):(V=Math.sqrt(1+C-o-y)*2,r[3]=(a-h)/V,r[0]=(p+u)/V,r[1]=(v+T)/V,r[2]=.25*V),r}class Xe{static identity(e){return e}static eq(e,t,n=1e-5){if(e.length!==t.length)return!1;for(let s=0;s<e.length;s++)if(Math.abs(e[s]-t[s])>n)return!1;return!0}static clamp(e,t,n){return e<t?t:e>n?n:e}static decodeNormalizedInt(e,t){switch(t){case 5126:return e;case 5123:return e/65535;case 5121:return e/255;case 5122:return Math.max(e/32767,-1);case 5120:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}static encodeNormalizedInt(e,t){switch(t){case 5126:return e;case 5123:return Math.round(Xe.clamp(e,0,1)*65535);case 5121:return Math.round(Xe.clamp(e,0,1)*255);case 5122:return Math.round(Xe.clamp(e,-1,1)*32767);case 5120:return Math.round(Xe.clamp(e,-1,1)*127);default:throw new Error("Invalid component type.")}}static decompose(e,t,n,s){let i=Os([e[0],e[1],e[2]]);const o=Os([e[4],e[5],e[6]]),a=Os([e[8],e[9],e[10]]);el(e)<0&&(i=-i),t[0]=e[12],t[1]=e[13],t[2]=e[14];const h=e.slice(),y=1/i,v=1/o,p=1/a;h[0]*=y,h[1]*=y,h[2]*=y,h[4]*=v,h[5]*=v,h[6]*=v,h[8]*=p,h[9]*=p,h[10]*=p,rl(n,h),s[0]=i,s[1]=o,s[2]=a}static compose(e,t,n,s){const i=s,o=t[0],a=t[1],u=t[2],h=t[3],y=o+o,v=a+a,p=u+u,T=o*y,C=o*v,G=o*p,V=a*v,E=a*p,F=u*p,_=h*y,N=h*v,P=h*p,B=n[0],d=n[1],R=n[2];return i[0]=(1-(V+F))*B,i[1]=(C+P)*B,i[2]=(G-N)*B,i[3]=0,i[4]=(C-P)*d,i[5]=(1-(T+F))*d,i[6]=(E+_)*d,i[7]=0,i[8]=(G+N)*R,i[9]=(E-_)*R,i[10]=(1-(T+V))*R,i[11]=0,i[12]=e[0],i[13]=e[1],i[14]=e[2],i[15]=1,i}}function sl(r,e){if(!!r!=!!e)return!1;const t=r.getChild(),n=e.getChild();return t===n||t.equals(n)}function il(r,e){if(!!r!=!!e)return!1;const t=r.values(),n=e.values();if(t.length!==n.length)return!1;for(let s=0;s<t.length;s++){const i=t[s],o=n[s];if(i.getChild()!==o.getChild()&&!i.getChild().equals(o.getChild()))return!1}return!0}function ol(r,e){if(!!r!=!!e)return!1;const t=r.keys(),n=e.keys();if(t.length!==n.length)return!1;for(const s of t){const i=r.get(s),o=e.get(s);if(!!i!=!!o)return!1;const a=i.getChild(),u=o.getChild();if(a!==u&&!a.equals(u))return!1}return!0}function xo(r,e){if(r===e)return!0;if(!!r!=!!e||!r||!e||r.length!==e.length)return!1;for(let t=0;t<r.length;t++)if(r[t]!==e[t])return!1;return!0}function vo(r,e){if(r===e)return!0;if(!!r!=!!e)return!1;if(!Wn(r)||!Wn(e))return r===e;const t=r,n=e;let s=0,i=0,o;for(o in t)s++;for(o in n)i++;if(s!==i)return!1;for(o in t){const a=t[o],u=n[o];if(rs(a)&&rs(u)){if(!xo(a,u))return!1}else if(Wn(a)&&Wn(u)){if(!vo(a,u))return!1}else if(a!==u)return!1}return!0}function rs(r){return Array.isArray(r)||ArrayBuffer.isView(r)}const Ci="23456789abdegjkmnpqrvwxyzABDEGJKMNPQRVWXYZ",al=999,cl=6,Ni=new Set,ll=function(){let e="";for(let t=0;t<cl;t++)e+=Ci.charAt(Math.floor(Math.random()*Ci.length));return e},ul=function(){for(let e=0;e<al;e++){const t=ll();if(!Ni.has(t))return Ni.add(t),t}return""},Bn=r=>r,fl=new Set;class si extends ri{constructor(e,t=""){super(e),this[ze].name=t,this.init(),this.dispatchEvent({type:"create"})}getGraph(){return this.graph}getDefaults(){return Object.assign(super.getDefaults(),{name:"",extras:{}})}set(e,t){return Array.isArray(t)&&(t=t.slice()),super.set(e,t)}getName(){return this.get("name")}setName(e){return this.set("name",e)}getExtras(){return this.get("extras")}setExtras(e){return this.set("extras",e)}clone(){const e=this.constructor;return new e(this.graph).copy(this,Bn)}copy(e,t=Bn){for(const n in this[ze]){const s=this[ze][n];if(s instanceof rr)this[zn].has(n)||s.dispose();else if(s instanceof kn||s instanceof Je)for(const i of s.values())i.dispose();else if(s instanceof Qt)for(const i of s.values())i.dispose()}for(const n in e[ze]){const s=this[ze][n],i=e[ze][n];if(i instanceof rr)this[zn].has(n)?s.getChild().copy(t(i.getChild()),t):this.setRef(n,t(i.getChild()),i.getAttributes());else if(i instanceof Je||i instanceof kn)for(const o of i.values())this.addRef(n,t(o.getChild()),o.getAttributes());else if(i instanceof Qt)for(const o of i.keys()){const a=i.get(o);this.setRefMap(n,o,t(a.getChild()),a.getAttributes())}else Wn(i)?this[ze][n]=JSON.parse(JSON.stringify(i)):Array.isArray(i)||i instanceof ArrayBuffer||ArrayBuffer.isView(i)?this[ze][n]=i.slice():this[ze][n]=i}return this}equals(e,t=fl){if(this===e)return!0;if(this.propertyType!==e.propertyType)return!1;for(const n in this[ze]){if(t.has(n))continue;const s=this[ze][n],i=e[ze][n];if(s instanceof rr||i instanceof rr){if(!sl(s,i))return!1}else if(s instanceof Je||i instanceof Je||s instanceof kn||i instanceof kn){if(!il(s,i))return!1}else if(s instanceof Qt||i instanceof Qt){if(!ol(s,i))return!1}else if(Wn(s)||Wn(i)){if(!vo(s,i))return!1}else if(rs(s)||rs(i)){if(!xo(s,i))return!1}else if(s!==i)return!1}return!0}detach(){return this.graph.disconnectParents(this,e=>e.propertyType!=="Root"),this}listParents(){return this.graph.listParents(this)}}class At extends si{getDefaults(){return Object.assign(super.getDefaults(),{extensions:new Qt})}getExtension(e){return this.getRefMap("extensions",e)}setExtension(e,t){return t&&t._validateParent(this),this.setRefMap("extensions",e,t)}listExtensions(){return this.listRefMapValues("extensions")}}class oe extends At{init(){this.propertyType=k.ACCESSOR}getDefaults(){return Object.assign(super.getDefaults(),{array:null,type:oe.Type.SCALAR,componentType:oe.ComponentType.FLOAT,normalized:!1,sparse:!1,buffer:null})}static getElementSize(e){switch(e){case oe.Type.SCALAR:return 1;case oe.Type.VEC2:return 2;case oe.Type.VEC3:return 3;case oe.Type.VEC4:return 4;case oe.Type.MAT2:return 4;case oe.Type.MAT3:return 9;case oe.Type.MAT4:return 16;default:throw new Error("Unexpected type: "+e)}}static getComponentSize(e){switch(e){case oe.ComponentType.BYTE:return 1;case oe.ComponentType.UNSIGNED_BYTE:return 1;case oe.ComponentType.SHORT:return 2;case oe.ComponentType.UNSIGNED_SHORT:return 2;case oe.ComponentType.UNSIGNED_INT:return 4;case oe.ComponentType.FLOAT:return 4;default:throw new Error("Unexpected component type: "+e)}}getMinNormalized(e){const t=this.getNormalized(),n=this.getElementSize(),s=this.getComponentType();if(this.getMin(e),t)for(let i=0;i<n;i++)e[i]=Xe.decodeNormalizedInt(e[i],s);return e}getMin(e){const t=this.getArray(),n=this.getCount(),s=this.getElementSize();for(let i=0;i<s;i++)e[i]=1/0;for(let i=0;i<n*s;i+=s)for(let o=0;o<s;o++){const a=t[i+o];Number.isFinite(a)&&(e[o]=Math.min(e[o],a))}return e}getMaxNormalized(e){const t=this.getNormalized(),n=this.getElementSize(),s=this.getComponentType();if(this.getMax(e),t)for(let i=0;i<n;i++)e[i]=Xe.decodeNormalizedInt(e[i],s);return e}getMax(e){const t=this.get("array"),n=this.getCount(),s=this.getElementSize();for(let i=0;i<s;i++)e[i]=-1/0;for(let i=0;i<n*s;i+=s)for(let o=0;o<s;o++){const a=t[i+o];Number.isFinite(a)&&(e[o]=Math.max(e[o],a))}return e}getCount(){const e=this.get("array");return e?e.length/this.getElementSize():0}getType(){return this.get("type")}setType(e){return this.set("type",e)}getElementSize(){return oe.getElementSize(this.get("type"))}getComponentSize(){return this.get("array").BYTES_PER_ELEMENT}getComponentType(){return this.get("componentType")}getNormalized(){return this.get("normalized")}setNormalized(e){return this.set("normalized",e)}getScalar(e){const t=this.getElementSize(),n=this.getComponentType(),s=this.getArray();return this.getNormalized()?Xe.decodeNormalizedInt(s[e*t],n):s[e*t]}setScalar(e,t){const n=this.getElementSize(),s=this.getComponentType(),i=this.getArray();return this.getNormalized()?i[e*n]=Xe.encodeNormalizedInt(t,s):i[e*n]=t,this}getElement(e,t){const n=this.getNormalized(),s=this.getElementSize(),i=this.getComponentType(),o=this.getArray();for(let a=0;a<s;a++)n?t[a]=Xe.decodeNormalizedInt(o[e*s+a],i):t[a]=o[e*s+a];return t}setElement(e,t){const n=this.getNormalized(),s=this.getElementSize(),i=this.getComponentType(),o=this.getArray();for(let a=0;a<s;a++)n?o[e*s+a]=Xe.encodeNormalizedInt(t[a],i):o[e*s+a]=t[a];return this}getSparse(){return this.get("sparse")}setSparse(e){return this.set("sparse",e)}getBuffer(){return this.getRef("buffer")}setBuffer(e){return this.setRef("buffer",e)}getArray(){return this.get("array")}setArray(e){return this.set("componentType",e?hl(e):oe.ComponentType.FLOAT),this.set("array",e),this}getByteLength(){const e=this.get("array");return e?e.byteLength:0}}oe.Type={SCALAR:"SCALAR",VEC2:"VEC2",VEC3:"VEC3",VEC4:"VEC4",MAT2:"MAT2",MAT3:"MAT3",MAT4:"MAT4"};oe.ComponentType={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,UNSIGNED_INT:5125,FLOAT:5126};function hl(r){switch(r.constructor){case Float32Array:return oe.ComponentType.FLOAT;case Uint32Array:return oe.ComponentType.UNSIGNED_INT;case Uint16Array:return oe.ComponentType.UNSIGNED_SHORT;case Uint8Array:return oe.ComponentType.UNSIGNED_BYTE;case Int16Array:return oe.ComponentType.SHORT;case Int8Array:return oe.ComponentType.BYTE;default:throw new Error("Unknown accessor componentType.")}}class Eo extends At{init(){this.propertyType=k.ANIMATION}getDefaults(){return Object.assign(super.getDefaults(),{channels:new Je,samplers:new Je})}addChannel(e){return this.addRef("channels",e)}removeChannel(e){return this.removeRef("channels",e)}listChannels(){return this.listRefs("channels")}addSampler(e){return this.addRef("samplers",e)}removeSampler(e){return this.removeRef("samplers",e)}listSamplers(){return this.listRefs("samplers")}}class ii extends At{init(){this.propertyType=k.ANIMATION_CHANNEL}getDefaults(){return Object.assign(super.getDefaults(),{targetPath:null,targetNode:null,sampler:null})}getTargetPath(){return this.get("targetPath")}setTargetPath(e){return this.set("targetPath",e)}getTargetNode(){return this.getRef("targetNode")}setTargetNode(e){return this.setRef("targetNode",e)}getSampler(){return this.getRef("sampler")}setSampler(e){return this.setRef("sampler",e)}}ii.TargetPath={TRANSLATION:"translation",ROTATION:"rotation",SCALE:"scale",WEIGHTS:"weights"};class fr extends At{init(){this.propertyType=k.ANIMATION_SAMPLER}getDefaultAttributes(){return Object.assign(super.getDefaults(),{interpolation:fr.Interpolation.LINEAR,input:null,output:null})}getInterpolation(){return this.get("interpolation")}setInterpolation(e){return this.set("interpolation",e)}getInput(){return this.getRef("input")}setInput(e){return this.setRef("input",e,{usage:Ut.OTHER})}getOutput(){return this.getRef("output")}setOutput(e){return this.setRef("output",e,{usage:Ut.OTHER})}}fr.Interpolation={LINEAR:"LINEAR",STEP:"STEP",CUBICSPLINE:"CUBICSPLINE"};class wo extends At{init(){this.propertyType=k.BUFFER}getDefaults(){return Object.assign(super.getDefaults(),{uri:""})}getURI(){return this.get("uri")}setURI(e){return this.set("uri",e)}}class Yn extends At{init(){this.propertyType=k.CAMERA}getDefaults(){return Object.assign(super.getDefaults(),{type:Yn.Type.PERSPECTIVE,znear:.1,zfar:100,aspectRatio:null,yfov:Math.PI*2*50/360,xmag:1,ymag:1})}getType(){return this.get("type")}setType(e){return this.set("type",e)}getZNear(){return this.get("znear")}setZNear(e){return this.set("znear",e)}getZFar(){return this.get("zfar")}setZFar(e){return this.set("zfar",e)}getAspectRatio(){return this.get("aspectRatio")}setAspectRatio(e){return this.set("aspectRatio",e)}getYFov(){return this.get("yfov")}setYFov(e){return this.set("yfov",e)}getXMag(){return this.get("xmag")}setXMag(e){return this.set("xmag",e)}getYMag(){return this.get("ymag")}setYMag(e){return this.set("ymag",e)}}Yn.Type={PERSPECTIVE:"perspective",ORTHOGRAPHIC:"orthographic"};class st extends si{_validateParent(e){if(!this.parentTypes.includes(e.propertyType))throw new Error(`Parent "${e.propertyType}" invalid for child "${this.propertyType}".`)}}st.EXTENSION_NAME=void 0;class Ye extends At{init(){this.propertyType=k.TEXTURE_INFO}getDefaults(){return Object.assign(super.getDefaults(),{texCoord:0,magFilter:null,minFilter:null,wrapS:Ye.WrapMode.REPEAT,wrapT:Ye.WrapMode.REPEAT})}getTexCoord(){return this.get("texCoord")}setTexCoord(e){return this.set("texCoord",e)}getMagFilter(){return this.get("magFilter")}setMagFilter(e){return this.set("magFilter",e)}getMinFilter(){return this.get("minFilter")}setMinFilter(e){return this.set("minFilter",e)}getWrapS(){return this.get("wrapS")}setWrapS(e){return this.set("wrapS",e)}getWrapT(){return this.get("wrapT")}setWrapT(e){return this.set("wrapT",e)}}Ye.WrapMode={CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,REPEAT:10497};Ye.MagFilter={NEAREST:9728,LINEAR:9729};Ye.MinFilter={NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987};const{R:Gr,G:Hr,B:zr,A:dl}=Wt;class Ln extends At{init(){this.propertyType=k.MATERIAL}getDefaults(){return Object.assign(super.getDefaults(),{alphaMode:Ln.AlphaMode.OPAQUE,alphaCutoff:.5,doubleSided:!1,baseColorFactor:[1,1,1,1],baseColorTexture:null,baseColorTextureInfo:new Ye(this.graph,"baseColorTextureInfo"),emissiveFactor:[0,0,0],emissiveTexture:null,emissiveTextureInfo:new Ye(this.graph,"emissiveTextureInfo"),normalScale:1,normalTexture:null,normalTextureInfo:new Ye(this.graph,"normalTextureInfo"),occlusionStrength:1,occlusionTexture:null,occlusionTextureInfo:new Ye(this.graph,"occlusionTextureInfo"),roughnessFactor:1,metallicFactor:1,metallicRoughnessTexture:null,metallicRoughnessTextureInfo:new Ye(this.graph,"metallicRoughnessTextureInfo")})}getDoubleSided(){return this.get("doubleSided")}setDoubleSided(e){return this.set("doubleSided",e)}getAlpha(){return this.get("baseColorFactor")[3]}setAlpha(e){const t=this.get("baseColorFactor").slice();return t[3]=e,this.set("baseColorFactor",t)}getAlphaMode(){return this.get("alphaMode")}setAlphaMode(e){return this.set("alphaMode",e)}getAlphaCutoff(){return this.get("alphaCutoff")}setAlphaCutoff(e){return this.set("alphaCutoff",e)}getBaseColorFactor(){return this.get("baseColorFactor")}setBaseColorFactor(e){return this.set("baseColorFactor",e)}getBaseColorTexture(){return this.getRef("baseColorTexture")}getBaseColorTextureInfo(){return this.getRef("baseColorTexture")?this.getRef("baseColorTextureInfo"):null}setBaseColorTexture(e){return this.setRef("baseColorTexture",e,{channels:Gr|Hr|zr|dl,isColor:!0})}getEmissiveFactor(){return this.get("emissiveFactor")}setEmissiveFactor(e){return this.set("emissiveFactor",e)}getEmissiveTexture(){return this.getRef("emissiveTexture")}getEmissiveTextureInfo(){return this.getRef("emissiveTexture")?this.getRef("emissiveTextureInfo"):null}setEmissiveTexture(e){return this.setRef("emissiveTexture",e,{channels:Gr|Hr|zr,isColor:!0})}getNormalScale(){return this.get("normalScale")}setNormalScale(e){return this.set("normalScale",e)}getNormalTexture(){return this.getRef("normalTexture")}getNormalTextureInfo(){return this.getRef("normalTexture")?this.getRef("normalTextureInfo"):null}setNormalTexture(e){return this.setRef("normalTexture",e,{channels:Gr|Hr|zr})}getOcclusionStrength(){return this.get("occlusionStrength")}setOcclusionStrength(e){return this.set("occlusionStrength",e)}getOcclusionTexture(){return this.getRef("occlusionTexture")}getOcclusionTextureInfo(){return this.getRef("occlusionTexture")?this.getRef("occlusionTextureInfo"):null}setOcclusionTexture(e){return this.setRef("occlusionTexture",e,{channels:Gr})}getRoughnessFactor(){return this.get("roughnessFactor")}setRoughnessFactor(e){return this.set("roughnessFactor",e)}getMetallicFactor(){return this.get("metallicFactor")}setMetallicFactor(e){return this.set("metallicFactor",e)}getMetallicRoughnessTexture(){return this.getRef("metallicRoughnessTexture")}getMetallicRoughnessTextureInfo(){return this.getRef("metallicRoughnessTexture")?this.getRef("metallicRoughnessTextureInfo"):null}setMetallicRoughnessTexture(e){return this.setRef("metallicRoughnessTexture",e,{channels:Hr|zr})}}Ln.AlphaMode={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};class bo extends At{init(){this.propertyType=k.MESH}getDefaults(){return Object.assign(super.getDefaults(),{weights:[],primitives:new Je})}addPrimitive(e){return this.addRef("primitives",e)}removePrimitive(e){return this.removeRef("primitives",e)}listPrimitives(){return this.listRefs("primitives")}getWeights(){return this.get("weights")}setWeights(e){return this.set("weights",e)}}class _o extends At{init(){this.propertyType=k.NODE}getDefaults(){return Object.assign(super.getDefaults(),{translation:[0,0,0],rotation:[0,0,0,1],scale:[1,1,1],weights:[],camera:null,mesh:null,skin:null,children:new Je})}copy(e,t=Bn){if(t===Bn)throw new Error("Node cannot be copied.");return super.copy(e,t)}getTranslation(){return this.get("translation")}getRotation(){return this.get("rotation")}getScale(){return this.get("scale")}setTranslation(e){return this.set("translation",e)}setRotation(e){return this.set("rotation",e)}setScale(e){return this.set("scale",e)}getMatrix(){return Xe.compose(this.get("translation"),this.get("rotation"),this.get("scale"),[])}setMatrix(e){const t=this.get("translation").slice(),n=this.get("rotation").slice(),s=this.get("scale").slice();return Xe.decompose(e,t,n,s),this.set("translation",t).set("rotation",n).set("scale",s)}getWorldTranslation(){const e=[0,0,0];return Xe.decompose(this.getWorldMatrix(),e,[0,0,0,1],[1,1,1]),e}getWorldRotation(){const e=[0,0,0,1];return Xe.decompose(this.getWorldMatrix(),[0,0,0],e,[1,1,1]),e}getWorldScale(){const e=[1,1,1];return Xe.decompose(this.getWorldMatrix(),[0,0,0],[0,0,0,1],e),e}getWorldMatrix(){const e=[];for(let s=this;s!=null;s=s.getParentNode())e.push(s);let t;const n=e.pop().getMatrix();for(;t=e.pop();)tl(n,n,t.getMatrix());return n}addChild(e){const t=e.getParentNode();t&&t.removeChild(e);for(const n of e.listParents())n.propertyType===k.SCENE&&n.removeChild(e);return this.addRef("children",e)}removeChild(e){return this.removeRef("children",e)}listChildren(){return this.listRefs("children")}getParentNode(){for(const e of this.listParents())if(e.propertyType===k.NODE)return e;return null}getMesh(){return this.getRef("mesh")}setMesh(e){return this.setRef("mesh",e)}getCamera(){return this.getRef("camera")}setCamera(e){return this.setRef("camera",e)}getSkin(){return this.getRef("skin")}setSkin(e){return this.setRef("skin",e)}getWeights(){return this.get("weights")}setWeights(e){return this.set("weights",e)}traverse(e){e(this);for(const t of this.listChildren())t.traverse(e);return this}}class Xn extends At{init(){this.propertyType=k.PRIMITIVE}getDefaults(){return Object.assign(super.getDefaults(),{mode:Xn.Mode.TRIANGLES,material:null,indices:null,attributes:new Qt,targets:new Je})}getIndices(){return this.getRef("indices")}setIndices(e){return this.setRef("indices",e,{usage:Ut.ELEMENT_ARRAY_BUFFER})}getAttribute(e){return this.getRefMap("attributes",e)}setAttribute(e,t){return this.setRefMap("attributes",e,t,{usage:Ut.ARRAY_BUFFER})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}getMaterial(){return this.getRef("material")}setMaterial(e){return this.setRef("material",e)}getMode(){return this.get("mode")}setMode(e){return this.set("mode",e)}listTargets(){return this.listRefs("targets")}addTarget(e){return this.addRef("targets",e)}removeTarget(e){return this.removeRef("targets",e)}}Xn.Mode={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6};class pl extends si{init(){this.propertyType=k.PRIMITIVE_TARGET}getDefaults(){return Object.assign(super.getDefaults(),{attributes:new Qt})}getAttribute(e){return this.getRefMap("attributes",e)}setAttribute(e,t){return this.setRefMap("attributes",e,t,{usage:Ut.ARRAY_BUFFER})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}}function St(){return St=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)({}).hasOwnProperty.call(t,n)&&(r[n]=t[n])}return r},St.apply(null,arguments)}class Ro extends At{init(){this.propertyType=k.SCENE}getDefaults(){return Object.assign(super.getDefaults(),{children:new Je})}copy(e,t=Bn){if(t===Bn)throw new Error("Scene cannot be copied.");return super.copy(e,t)}addChild(e){const t=e.getParentNode();return t&&t.removeChild(e),this.addRef("children",e)}removeChild(e){return this.removeRef("children",e)}listChildren(){return this.listRefs("children")}traverse(e){for(const t of this.listChildren())t.traverse(e);return this}}class Io extends At{init(){this.propertyType=k.SKIN}getDefaults(){return Object.assign(super.getDefaults(),{skeleton:null,inverseBindMatrices:null,joints:new Je})}getSkeleton(){return this.getRef("skeleton")}setSkeleton(e){return this.setRef("skeleton",e)}getInverseBindMatrices(){return this.getRef("inverseBindMatrices")}setInverseBindMatrices(e){return this.setRef("inverseBindMatrices",e,{usage:Ut.INVERSE_BIND_MATRICES})}addJoint(e){return this.addRef("joints",e)}removeJoint(e){return this.removeRef("joints",e)}listJoints(){return this.listRefs("joints")}}class So extends At{init(){this.propertyType=k.TEXTURE}getDefaults(){return Object.assign(super.getDefaults(),{image:null,mimeType:"",uri:""})}getMimeType(){return this.get("mimeType")||sn.extensionToMimeType(or.extension(this.get("uri")))}setMimeType(e){return this.set("mimeType",e)}getURI(){return this.get("uri")}setURI(e){this.set("uri",e);const t=sn.extensionToMimeType(or.extension(e));return t&&this.set("mimeType",t),this}getImage(){return this.get("image")}setImage(e){return this.set("image",Ne.assertView(e))}getSize(){const e=this.get("image");return e?sn.getSize(e,this.getMimeType()):null}}class Ao extends At{init(){this.propertyType=k.ROOT}getDefaults(){return Object.assign(super.getDefaults(),{asset:{generator:`glTF-Transform ${yo}`,version:"2.0"},defaultScene:null,accessors:new Je,animations:new Je,buffers:new Je,cameras:new Je,materials:new Je,meshes:new Je,nodes:new Je,scenes:new Je,skins:new Je,textures:new Je})}constructor(e){super(e),this._extensions=new Set,e.addEventListener("node:create",t=>{this._addChildOfRoot(t.target)})}clone(){throw new Error("Root cannot be cloned.")}copy(e,t=Bn){if(t===Bn)throw new Error("Root cannot be copied.");this.set("asset",St({},e.get("asset"))),this.setName(e.getName()),this.setExtras(St({},e.getExtras())),this.setDefaultScene(e.getDefaultScene()?t(e.getDefaultScene()):null);for(const n of e.listRefMapKeys("extensions")){const s=e.getExtension(n);this.setExtension(n,t(s))}return this}_addChildOfRoot(e){return e instanceof Ro?this.addRef("scenes",e):e instanceof _o?this.addRef("nodes",e):e instanceof Yn?this.addRef("cameras",e):e instanceof Io?this.addRef("skins",e):e instanceof bo?this.addRef("meshes",e):e instanceof Ln?this.addRef("materials",e):e instanceof So?this.addRef("textures",e):e instanceof Eo?this.addRef("animations",e):e instanceof oe?this.addRef("accessors",e):e instanceof wo&&this.addRef("buffers",e),this}getAsset(){return this.get("asset")}listExtensionsUsed(){return Array.from(this._extensions)}listExtensionsRequired(){return this.listExtensionsUsed().filter(e=>e.isRequired())}_enableExtension(e){return this._extensions.add(e),this}_disableExtension(e){return this._extensions.delete(e),this}listScenes(){return this.listRefs("scenes")}setDefaultScene(e){return this.setRef("defaultScene",e)}getDefaultScene(){return this.getRef("defaultScene")}listNodes(){return this.listRefs("nodes")}listCameras(){return this.listRefs("cameras")}listSkins(){return this.listRefs("skins")}listMeshes(){return this.listRefs("meshes")}listMaterials(){return this.listRefs("materials")}listTextures(){return this.listRefs("textures")}listAnimations(){return this.listRefs("animations")}listAccessors(){return this.listRefs("accessors")}listBuffers(){return this.listRefs("buffers")}}class ar{static fromGraph(e){return ar._GRAPH_DOCUMENTS.get(e)||null}constructor(){this._graph=new Xc,this._root=new Ao(this._graph),this._logger=zt.DEFAULT_INSTANCE,ar._GRAPH_DOCUMENTS.set(this._graph,this)}getRoot(){return this._root}getGraph(){return this._graph}getLogger(){return this._logger}setLogger(e){return this._logger=e,this}clone(){throw new Error("Use 'cloneDocument(source)' from '@gltf-transform/functions'.")}merge(e){throw new Error("Use 'mergeDocuments(target, source)' from '@gltf-transform/functions'.")}async transform(...e){const t=e.map(n=>n.name);for(const n of e)await n(this,{stack:t});return this}createExtension(e){const t=e.EXTENSION_NAME;return this.getRoot().listExtensionsUsed().find(s=>s.extensionName===t)||new e(this)}createScene(e=""){return new Ro(this._graph,e)}createNode(e=""){return new _o(this._graph,e)}createCamera(e=""){return new Yn(this._graph,e)}createSkin(e=""){return new Io(this._graph,e)}createMesh(e=""){return new bo(this._graph,e)}createPrimitive(){return new Xn(this._graph)}createPrimitiveTarget(e=""){return new pl(this._graph,e)}createMaterial(e=""){return new Ln(this._graph,e)}createTexture(e=""){return new So(this._graph,e)}createAnimation(e=""){return new Eo(this._graph,e)}createAnimationChannel(e=""){return new ii(this._graph,e)}createAnimationSampler(e=""){return new fr(this._graph,e)}createAccessor(e="",t=null){return t||(t=this.getRoot().listBuffers()[0]),new oe(this._graph,e).setBuffer(t)}createBuffer(e=""){return new wo(this._graph,e)}}ar._GRAPH_DOCUMENTS=new WeakMap;class Ze{constructor(e){this.extensionName="",this.prereadTypes=[],this.prewriteTypes=[],this.readDependencies=[],this.writeDependencies=[],this.document=void 0,this.required=!1,this.properties=new Set,this._listener=void 0,this.document=e,e.getRoot()._enableExtension(this),this._listener=n=>{const s=n,i=s.target;i instanceof st&&i.extensionName===this.extensionName&&(s.type==="node:create"&&this._addExtensionProperty(i),s.type==="node:dispose"&&this._removeExtensionProperty(i))};const t=e.getGraph();t.addEventListener("node:create",this._listener),t.addEventListener("node:dispose",this._listener)}dispose(){this.document.getRoot()._disableExtension(this);const e=this.document.getGraph();e.removeEventListener("node:create",this._listener),e.removeEventListener("node:dispose",this._listener);for(const t of this.properties)t.dispose()}static register(){}isRequired(){return this.required}setRequired(e){return this.required=e,this}listProperties(){return Array.from(this.properties)}_addExtensionProperty(e){return this.properties.add(e),this}_removeExtensionProperty(e){return this.properties.delete(e),this}install(e,t){return this}preread(e,t){return this}prewrite(e,t){return this}}Ze.EXTENSION_NAME=void 0;class gl{constructor(e){this.jsonDoc=void 0,this.buffers=[],this.bufferViews=[],this.bufferViewBuffers=[],this.accessors=[],this.textures=[],this.textureInfos=new Map,this.materials=[],this.meshes=[],this.cameras=[],this.nodes=[],this.skins=[],this.animations=[],this.scenes=[],this.jsonDoc=e}setTextureInfo(e,t){this.textureInfos.set(e,t),t.texCoord!==void 0&&e.setTexCoord(t.texCoord),t.extras!==void 0&&e.setExtras(t.extras);const n=this.jsonDoc.json.textures[t.index];if(n.sampler===void 0)return;const s=this.jsonDoc.json.samplers[n.sampler];s.magFilter!==void 0&&e.setMagFilter(s.magFilter),s.minFilter!==void 0&&e.setMinFilter(s.minFilter),s.wrapS!==void 0&&e.setWrapS(s.wrapS),s.wrapT!==void 0&&e.setWrapT(s.wrapT)}}const Oi={logger:zt.DEFAULT_INSTANCE,extensions:[],dependencies:{}},ml=new Set([k.BUFFER,k.TEXTURE,k.MATERIAL,k.MESH,k.PRIMITIVE,k.NODE,k.SCENE]);class yl{static read(e,t=Oi){const n=St({},Oi,t),{json:s}=e,i=new ar().setLogger(n.logger);this.validate(e,n);const o=new gl(e),a=s.asset,u=i.getRoot().getAsset();a.copyright&&(u.copyright=a.copyright),a.extras&&(u.extras=a.extras),s.extras!==void 0&&i.getRoot().setExtras(St({},s.extras));const h=s.extensionsUsed||[],y=s.extensionsRequired||[];n.extensions.sort((d,R)=>d.EXTENSION_NAME>R.EXTENSION_NAME?1:-1);for(const d of n.extensions)if(h.includes(d.EXTENSION_NAME)){const R=i.createExtension(d).setRequired(y.includes(d.EXTENSION_NAME)),b=R.prereadTypes.filter($=>!ml.has($));b.length&&n.logger.warn(`Preread hooks for some types (${b.join()}), requested by extension ${R.extensionName}, are unsupported. Please file an issue or a PR.`);for(const $ of R.readDependencies)R.install($,n.dependencies[$])}const v=s.buffers||[];i.getRoot().listExtensionsUsed().filter(d=>d.prereadTypes.includes(k.BUFFER)).forEach(d=>d.preread(o,k.BUFFER)),o.buffers=v.map(d=>{const R=i.createBuffer(d.name);return d.extras&&R.setExtras(d.extras),d.uri&&d.uri.indexOf("__")!==0&&R.setURI(d.uri),R});const p=s.bufferViews||[];o.bufferViewBuffers=p.map((d,R)=>{if(!o.bufferViews[R]){const b=e.json.buffers[d.buffer],$=b.uri?e.resources[b.uri]:e.resources[ir],Q=d.byteOffset||0;o.bufferViews[R]=Ne.toView($,Q,d.byteLength)}return o.buffers[d.buffer]});const T=s.accessors||[];o.accessors=T.map(d=>{const R=o.bufferViewBuffers[d.bufferView],b=i.createAccessor(d.name,R).setType(d.type);return d.extras&&b.setExtras(d.extras),d.normalized!==void 0&&b.setNormalized(d.normalized),d.bufferView===void 0||b.setArray(qr(d,o)),b});const C=s.images||[],G=s.textures||[];i.getRoot().listExtensionsUsed().filter(d=>d.prereadTypes.includes(k.TEXTURE)).forEach(d=>d.preread(o,k.TEXTURE)),o.textures=C.map(d=>{const R=i.createTexture(d.name);if(d.extras&&R.setExtras(d.extras),d.bufferView!==void 0){const b=s.bufferViews[d.bufferView],$=e.json.buffers[b.buffer],Q=$.uri?e.resources[$.uri]:e.resources[ir],ee=b.byteOffset||0,fe=b.byteLength,Ee=Q.slice(ee,ee+fe);R.setImage(Ee)}else d.uri!==void 0&&(R.setImage(e.resources[d.uri]),d.uri.indexOf("__")!==0&&R.setURI(d.uri));if(d.mimeType!==void 0)R.setMimeType(d.mimeType);else if(d.uri){const b=or.extension(d.uri);R.setMimeType(sn.extensionToMimeType(b))}return R}),i.getRoot().listExtensionsUsed().filter(d=>d.prereadTypes.includes(k.MATERIAL)).forEach(d=>d.preread(o,k.MATERIAL));const V=s.materials||[];o.materials=V.map(d=>{const R=i.createMaterial(d.name);d.extras&&R.setExtras(d.extras),d.alphaMode!==void 0&&R.setAlphaMode(d.alphaMode),d.alphaCutoff!==void 0&&R.setAlphaCutoff(d.alphaCutoff),d.doubleSided!==void 0&&R.setDoubleSided(d.doubleSided);const b=d.pbrMetallicRoughness||{};if(b.baseColorFactor!==void 0&&R.setBaseColorFactor(b.baseColorFactor),d.emissiveFactor!==void 0&&R.setEmissiveFactor(d.emissiveFactor),b.metallicFactor!==void 0&&R.setMetallicFactor(b.metallicFactor),b.roughnessFactor!==void 0&&R.setRoughnessFactor(b.roughnessFactor),b.baseColorTexture!==void 0){const $=b.baseColorTexture,Q=o.textures[G[$.index].source];R.setBaseColorTexture(Q),o.setTextureInfo(R.getBaseColorTextureInfo(),$)}if(d.emissiveTexture!==void 0){const $=d.emissiveTexture,Q=o.textures[G[$.index].source];R.setEmissiveTexture(Q),o.setTextureInfo(R.getEmissiveTextureInfo(),$)}if(d.normalTexture!==void 0){const $=d.normalTexture,Q=o.textures[G[$.index].source];R.setNormalTexture(Q),o.setTextureInfo(R.getNormalTextureInfo(),$),d.normalTexture.scale!==void 0&&R.setNormalScale(d.normalTexture.scale)}if(d.occlusionTexture!==void 0){const $=d.occlusionTexture,Q=o.textures[G[$.index].source];R.setOcclusionTexture(Q),o.setTextureInfo(R.getOcclusionTextureInfo(),$),d.occlusionTexture.strength!==void 0&&R.setOcclusionStrength(d.occlusionTexture.strength)}if(b.metallicRoughnessTexture!==void 0){const $=b.metallicRoughnessTexture,Q=o.textures[G[$.index].source];R.setMetallicRoughnessTexture(Q),o.setTextureInfo(R.getMetallicRoughnessTextureInfo(),$)}return R}),i.getRoot().listExtensionsUsed().filter(d=>d.prereadTypes.includes(k.MESH)).forEach(d=>d.preread(o,k.MESH));const E=s.meshes||[];i.getRoot().listExtensionsUsed().filter(d=>d.prereadTypes.includes(k.PRIMITIVE)).forEach(d=>d.preread(o,k.PRIMITIVE)),o.meshes=E.map(d=>{const R=i.createMesh(d.name);return d.extras&&R.setExtras(d.extras),d.weights!==void 0&&R.setWeights(d.weights),(d.primitives||[]).forEach($=>{const Q=i.createPrimitive();$.extras&&Q.setExtras($.extras),$.material!==void 0&&Q.setMaterial(o.materials[$.material]),$.mode!==void 0&&Q.setMode($.mode);for(const[Ee,me]of Object.entries($.attributes||{}))Q.setAttribute(Ee,o.accessors[me]);$.indices!==void 0&&Q.setIndices(o.accessors[$.indices]);const ee=d.extras&&d.extras.targetNames||[];($.targets||[]).forEach((Ee,me)=>{const be=ee[me]||me.toString(),Ie=i.createPrimitiveTarget(be);for(const[He,We]of Object.entries(Ee))Ie.setAttribute(He,o.accessors[We]);Q.addTarget(Ie)}),R.addPrimitive(Q)}),R});const F=s.cameras||[];o.cameras=F.map(d=>{const R=i.createCamera(d.name).setType(d.type);if(d.extras&&R.setExtras(d.extras),d.type===Yn.Type.PERSPECTIVE){const b=d.perspective;R.setYFov(b.yfov),R.setZNear(b.znear),b.zfar!==void 0&&R.setZFar(b.zfar),b.aspectRatio!==void 0&&R.setAspectRatio(b.aspectRatio)}else{const b=d.orthographic;R.setZNear(b.znear).setZFar(b.zfar).setXMag(b.xmag).setYMag(b.ymag)}return R});const _=s.nodes||[];i.getRoot().listExtensionsUsed().filter(d=>d.prereadTypes.includes(k.NODE)).forEach(d=>d.preread(o,k.NODE)),o.nodes=_.map(d=>{const R=i.createNode(d.name);if(d.extras&&R.setExtras(d.extras),d.translation!==void 0&&R.setTranslation(d.translation),d.rotation!==void 0&&R.setRotation(d.rotation),d.scale!==void 0&&R.setScale(d.scale),d.matrix!==void 0){const b=[0,0,0],$=[0,0,0,1],Q=[1,1,1];Xe.decompose(d.matrix,b,$,Q),R.setTranslation(b),R.setRotation($),R.setScale(Q)}return d.weights!==void 0&&R.setWeights(d.weights),R});const N=s.skins||[];o.skins=N.map(d=>{const R=i.createSkin(d.name);d.extras&&R.setExtras(d.extras),d.inverseBindMatrices!==void 0&&R.setInverseBindMatrices(o.accessors[d.inverseBindMatrices]),d.skeleton!==void 0&&R.setSkeleton(o.nodes[d.skeleton]);for(const b of d.joints)R.addJoint(o.nodes[b]);return R}),_.map((d,R)=>{const b=o.nodes[R];(d.children||[]).forEach(Q=>b.addChild(o.nodes[Q])),d.mesh!==void 0&&b.setMesh(o.meshes[d.mesh]),d.camera!==void 0&&b.setCamera(o.cameras[d.camera]),d.skin!==void 0&&b.setSkin(o.skins[d.skin])});const P=s.animations||[];o.animations=P.map(d=>{const R=i.createAnimation(d.name);d.extras&&R.setExtras(d.extras);const $=(d.samplers||[]).map(ee=>{const fe=i.createAnimationSampler().setInput(o.accessors[ee.input]).setOutput(o.accessors[ee.output]).setInterpolation(ee.interpolation||fr.Interpolation.LINEAR);return ee.extras&&fe.setExtras(ee.extras),R.addSampler(fe),fe});return(d.channels||[]).forEach(ee=>{const fe=i.createAnimationChannel().setSampler($[ee.sampler]).setTargetPath(ee.target.path);ee.target.node!==void 0&&fe.setTargetNode(o.nodes[ee.target.node]),ee.extras&&fe.setExtras(ee.extras),R.addChannel(fe)}),R});const B=s.scenes||[];return i.getRoot().listExtensionsUsed().filter(d=>d.prereadTypes.includes(k.SCENE)).forEach(d=>d.preread(o,k.SCENE)),o.scenes=B.map(d=>{const R=i.createScene(d.name);return d.extras&&R.setExtras(d.extras),(d.nodes||[]).map($=>o.nodes[$]).forEach($=>R.addChild($)),R}),s.scene!==void 0&&i.getRoot().setDefaultScene(o.scenes[s.scene]),i.getRoot().listExtensionsUsed().forEach(d=>d.read(o)),T.forEach((d,R)=>{const b=o.accessors[R],$=!!d.sparse,Q=!d.bufferView&&!b.getArray();($||Q)&&b.setSparse(!0).setArray(xl(d,o))}),i}static validate(e,t){const n=e.json;if(n.asset.version!=="2.0")throw new Error(`Unsupported glTF version, "${n.asset.version}".`);if(n.extensionsRequired){for(const s of n.extensionsRequired)if(!t.extensions.find(i=>i.EXTENSION_NAME===s))throw new Error(`Missing required extension, "${s}".`)}if(n.extensionsUsed)for(const s of n.extensionsUsed)t.extensions.find(i=>i.EXTENSION_NAME===s)||t.logger.warn(`Missing optional extension, "${s}".`)}}function Tl(r,e){const t=e.jsonDoc,n=e.bufferViews[r.bufferView],s=t.json.bufferViews[r.bufferView],i=us[r.componentType],o=oe.getElementSize(r.type),a=i.BYTES_PER_ELEMENT,u=r.byteOffset||0,h=new i(r.count*o),y=new DataView(n.buffer,n.byteOffset,n.byteLength),v=s.byteStride;for(let p=0;p<r.count;p++)for(let T=0;T<o;T++){const C=u+p*v+T*a;let G;switch(r.componentType){case oe.ComponentType.FLOAT:G=y.getFloat32(C,!0);break;case oe.ComponentType.UNSIGNED_INT:G=y.getUint32(C,!0);break;case oe.ComponentType.UNSIGNED_SHORT:G=y.getUint16(C,!0);break;case oe.ComponentType.UNSIGNED_BYTE:G=y.getUint8(C);break;case oe.ComponentType.SHORT:G=y.getInt16(C,!0);break;case oe.ComponentType.BYTE:G=y.getInt8(C);break;default:throw new Error(`Unexpected componentType "${r.componentType}".`)}h[p*o+T]=G}return h}function qr(r,e){const t=e.jsonDoc,n=e.bufferViews[r.bufferView],s=t.json.bufferViews[r.bufferView],i=us[r.componentType],o=oe.getElementSize(r.type),a=i.BYTES_PER_ELEMENT,u=o*a;if(s.byteStride!==void 0&&s.byteStride!==u)return Tl(r,e);const h=n.byteOffset+(r.byteOffset||0),y=r.count*o*a;return new i(n.buffer.slice(h,h+y))}function xl(r,e){const t=us[r.componentType],n=oe.getElementSize(r.type);let s;r.bufferView!==void 0?s=qr(r,e):s=new t(r.count*n);const i=r.sparse;if(!i)return s;const o=i.count,a=St({},r,i.indices,{count:o,type:"SCALAR"}),u=St({},r,i.values,{count:o}),h=qr(a,e),y=qr(u,e);for(let v=0;v<a.count;v++)for(let p=0;p<n;p++)s[h[v]*n+p]=y[v*n+p];return s}var Mr;(function(r){r[r.ARRAY_BUFFER=34962]="ARRAY_BUFFER",r[r.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER"})(Mr||(Mr={}));class en{constructor(e,t,n){this._doc=void 0,this.jsonDoc=void 0,this.options=void 0,this.accessorIndexMap=new Map,this.animationIndexMap=new Map,this.bufferIndexMap=new Map,this.cameraIndexMap=new Map,this.skinIndexMap=new Map,this.materialIndexMap=new Map,this.meshIndexMap=new Map,this.nodeIndexMap=new Map,this.imageIndexMap=new Map,this.textureDefIndexMap=new Map,this.textureInfoDefMap=new Map,this.samplerDefIndexMap=new Map,this.sceneIndexMap=new Map,this.imageBufferViews=[],this.otherBufferViews=new Map,this.otherBufferViewsIndexMap=new Map,this.extensionData={},this.bufferURIGenerator=void 0,this.imageURIGenerator=void 0,this.logger=void 0,this._accessorUsageMap=new Map,this.accessorUsageGroupedByParent=new Set(["ARRAY_BUFFER"]),this.accessorParents=new Map,this._doc=e,this.jsonDoc=t,this.options=n;const s=e.getRoot(),i=s.listBuffers().length,o=s.listTextures().length;this.bufferURIGenerator=new Di(i>1,()=>n.basename||"buffer"),this.imageURIGenerator=new Di(o>1,a=>vl(e,a)||n.basename||"texture"),this.logger=e.getLogger()}createTextureInfoDef(e,t){const n={magFilter:t.getMagFilter()||void 0,minFilter:t.getMinFilter()||void 0,wrapS:t.getWrapS(),wrapT:t.getWrapT()},s=JSON.stringify(n);this.samplerDefIndexMap.has(s)||(this.samplerDefIndexMap.set(s,this.jsonDoc.json.samplers.length),this.jsonDoc.json.samplers.push(n));const i={source:this.imageIndexMap.get(e),sampler:this.samplerDefIndexMap.get(s)},o=JSON.stringify(i);this.textureDefIndexMap.has(o)||(this.textureDefIndexMap.set(o,this.jsonDoc.json.textures.length),this.jsonDoc.json.textures.push(i));const a={index:this.textureDefIndexMap.get(o)};return t.getTexCoord()!==0&&(a.texCoord=t.getTexCoord()),Object.keys(t.getExtras()).length>0&&(a.extras=t.getExtras()),this.textureInfoDefMap.set(t,a),a}createPropertyDef(e){const t={};return e.getName()&&(t.name=e.getName()),Object.keys(e.getExtras()).length>0&&(t.extras=e.getExtras()),t}createAccessorDef(e){const t=this.createPropertyDef(e);return t.type=e.getType(),t.componentType=e.getComponentType(),t.count=e.getCount(),this._doc.getGraph().listParentEdges(e).some(s=>s.getName()==="attributes"&&s.getAttributes().key==="POSITION"||s.getName()==="input")&&(t.max=e.getMax([]).map(Math.fround),t.min=e.getMin([]).map(Math.fround)),e.getNormalized()&&(t.normalized=e.getNormalized()),t}createImageData(e,t,n){if(this.options.format===jn.GLB)this.imageBufferViews.push(t),e.bufferView=this.jsonDoc.json.bufferViews.length,this.jsonDoc.json.bufferViews.push({buffer:0,byteOffset:-1,byteLength:t.byteLength});else{const s=sn.mimeTypeToExtension(n.getMimeType());e.uri=this.imageURIGenerator.createURI(n,s),this.assignResourceURI(e.uri,t,!1)}}assignResourceURI(e,t,n){const s=this.jsonDoc.resources;if(!(e in s)){s[e]=t;return}if(t===s[e]){this.logger.warn(`Duplicate resource URI, "${e}".`);return}const i=`Resource URI "${e}" already assigned to different data.`;if(!n){this.logger.warn(i);return}throw new Error(i)}getAccessorUsage(e){const t=this._accessorUsageMap.get(e);if(t)return t;if(e.getSparse())return Ut.SPARSE;for(const n of this._doc.getGraph().listParentEdges(e)){const{usage:s}=n.getAttributes();if(s)return s;n.getParent().propertyType!==k.ROOT&&this.logger.warn(`Missing attribute ".usage" on edge, "${n.getName()}".`)}return Ut.OTHER}addAccessorToUsageGroup(e,t){const n=this._accessorUsageMap.get(e);if(n&&n!==t)throw new Error(`Accessor with usage "${n}" cannot be reused as "${t}".`);return this._accessorUsageMap.set(e,t),this}}en.BufferViewTarget=Mr;en.BufferViewUsage=Ut;en.USAGE_TO_TARGET={[Ut.ARRAY_BUFFER]:Mr.ARRAY_BUFFER,[Ut.ELEMENT_ARRAY_BUFFER]:Mr.ELEMENT_ARRAY_BUFFER};class Di{constructor(e,t){this.multiple=void 0,this.basename=void 0,this.counter={},this.multiple=e,this.basename=t}createURI(e,t){if(e.getURI())return e.getURI();if(this.multiple){const n=this.basename(e);return this.counter[n]=this.counter[n]||1,`${n}_${this.counter[n]++}.${t}`}else return`${this.basename(e)}.${t}`}}function vl(r,e){const t=r.getGraph().listParentEdges(e).find(n=>n.getParent()!==r.getRoot());return t?t.getName().replace(/texture$/i,""):""}const{BufferViewUsage:Wr}=en,{UNSIGNED_INT:El,UNSIGNED_SHORT:wl,UNSIGNED_BYTE:bl}=oe.ComponentType,_l=new Set([k.ACCESSOR,k.BUFFER,k.MATERIAL,k.MESH]);class Rl{static write(e,t){const n=e.getGraph(),s=e.getRoot(),i={asset:St({generator:`glTF-Transform ${yo}`},s.getAsset()),extras:St({},s.getExtras())},o={json:i,resources:{}},a=new en(e,o,t),u=t.logger||zt.DEFAULT_INSTANCE,h=new Set(t.extensions.map(E=>E.EXTENSION_NAME)),y=e.getRoot().listExtensionsUsed().filter(E=>h.has(E.extensionName)).sort((E,F)=>E.extensionName>F.extensionName?1:-1),v=e.getRoot().listExtensionsRequired().filter(E=>h.has(E.extensionName)).sort((E,F)=>E.extensionName>F.extensionName?1:-1);y.length<e.getRoot().listExtensionsUsed().length&&u.warn("Some extensions were not registered for I/O, and will not be written.");for(const E of y){const F=E.prewriteTypes.filter(_=>!_l.has(_));F.length&&u.warn(`Prewrite hooks for some types (${F.join()}), requested by extension ${E.extensionName}, are unsupported. Please file an issue or a PR.`);for(const _ of E.writeDependencies)E.install(_,t.dependencies[_])}function p(E,F,_,N){const P=[];let B=0;for(const b of E){const $=a.createAccessorDef(b);$.bufferView=i.bufferViews.length;const Q=b.getArray(),ee=Ne.pad(Ne.toView(Q));$.byteOffset=B,B+=ee.byteLength,P.push(ee),a.accessorIndexMap.set(b,i.accessors.length),i.accessors.push($)}const d=Ne.concat(P),R={buffer:F,byteOffset:_,byteLength:d.byteLength};return N&&(R.target=N),i.bufferViews.push(R),{buffers:P,byteLength:B}}function T(E,F,_){const N=E[0].getCount();let P=0;for(const $ of E){const Q=a.createAccessorDef($);Q.bufferView=i.bufferViews.length,Q.byteOffset=P;const ee=$.getElementSize(),fe=$.getComponentSize();P+=Ne.padNumber(ee*fe),a.accessorIndexMap.set($,i.accessors.length),i.accessors.push(Q)}const B=N*P,d=new ArrayBuffer(B),R=new DataView(d);for(let $=0;$<N;$++){let Q=0;for(const ee of E){const fe=ee.getElementSize(),Ee=ee.getComponentSize(),me=ee.getComponentType(),be=ee.getArray();for(let Ie=0;Ie<fe;Ie++){const He=$*P+Q+Ie*Ee,We=be[$*fe+Ie];switch(me){case oe.ComponentType.FLOAT:R.setFloat32(He,We,!0);break;case oe.ComponentType.BYTE:R.setInt8(He,We);break;case oe.ComponentType.SHORT:R.setInt16(He,We,!0);break;case oe.ComponentType.UNSIGNED_BYTE:R.setUint8(He,We);break;case oe.ComponentType.UNSIGNED_SHORT:R.setUint16(He,We,!0);break;case oe.ComponentType.UNSIGNED_INT:R.setUint32(He,We,!0);break;default:throw new Error("Unexpected component type: "+me)}}Q+=Ne.padNumber(fe*Ee)}}const b={buffer:F,byteOffset:_,byteLength:B,byteStride:P,target:en.BufferViewTarget.ARRAY_BUFFER};return i.bufferViews.push(b),{byteLength:B,buffers:[new Uint8Array(d)]}}function C(E,F,_){const N=[];let P=0;const B=new Map;let d=-1/0,R=!1;for(const me of E){const be=a.createAccessorDef(me);i.accessors.push(be),a.accessorIndexMap.set(me,i.accessors.length-1);const Ie=[],He=[],We=[],kt=new Array(me.getElementSize()).fill(0);for(let tt=0,A=me.getCount();tt<A;tt++)if(me.getElement(tt,We),!Xe.eq(We,kt,0)){d=Math.max(tt,d),Ie.push(tt);for(let De=0;De<We.length;De++)He.push(We[De])}const lt=Ie.length,Tt={accessorDef:be,count:lt};if(B.set(me,Tt),lt===0)continue;lt>me.getCount()/2&&(R=!0);const Et=us[me.getComponentType()];Tt.indices=Ie,Tt.values=new Et(He)}if(!Number.isFinite(d))return{buffers:N,byteLength:P};R&&u.warn("Some sparse accessors have >50% non-zero elements, which may increase file size.");const b=d<255?Uint8Array:d<65535?Uint16Array:Uint32Array,$=d<255?bl:d<65535?wl:El,Q={buffer:F,byteOffset:_+P,byteLength:0};for(const me of E){const be=B.get(me);if(be.count===0)continue;be.indicesByteOffset=Q.byteLength;const Ie=Ne.pad(Ne.toView(new b(be.indices)));N.push(Ie),P+=Ie.byteLength,Q.byteLength+=Ie.byteLength}i.bufferViews.push(Q);const ee=i.bufferViews.length-1,fe={buffer:F,byteOffset:_+P,byteLength:0};for(const me of E){const be=B.get(me);if(be.count===0)continue;be.valuesByteOffset=fe.byteLength;const Ie=Ne.pad(Ne.toView(be.values));N.push(Ie),P+=Ie.byteLength,fe.byteLength+=Ie.byteLength}i.bufferViews.push(fe);const Ee=i.bufferViews.length-1;for(const me of E){const be=B.get(me);be.count!==0&&(be.accessorDef.sparse={count:be.count,indices:{bufferView:ee,byteOffset:be.indicesByteOffset,componentType:$},values:{bufferView:Ee,byteOffset:be.valuesByteOffset}})}return{buffers:N,byteLength:P}}if(i.accessors=[],i.bufferViews=[],i.samplers=[],i.textures=[],i.images=s.listTextures().map((E,F)=>{const _=a.createPropertyDef(E);E.getMimeType()&&(_.mimeType=E.getMimeType());const N=E.getImage();return N&&a.createImageData(_,N,E),a.imageIndexMap.set(E,F),_}),y.filter(E=>E.prewriteTypes.includes(k.ACCESSOR)).forEach(E=>E.prewrite(a,k.ACCESSOR)),s.listAccessors().forEach(E=>{const F=a.accessorUsageGroupedByParent,_=a.accessorParents;if(a.accessorIndexMap.has(E))return;const N=a.getAccessorUsage(E);if(a.addAccessorToUsageGroup(E,N),F.has(N)){const P=n.listParents(E).find(B=>B.propertyType!==k.ROOT);_.set(E,P)}}),y.filter(E=>E.prewriteTypes.includes(k.BUFFER)).forEach(E=>E.prewrite(a,k.BUFFER)),(s.listAccessors().length>0||a.otherBufferViews.size>0||s.listTextures().length>0&&t.format===jn.GLB)&&s.listBuffers().length===0)throw new Error("Buffer required for Document resources, but none was found.");i.buffers=[],s.listBuffers().forEach((E,F)=>{const _=a.createPropertyDef(E),N=a.accessorUsageGroupedByParent,P=E.listParents().filter(fe=>fe instanceof oe),B=new Set(P.map(fe=>a.accessorParents.get(fe))),d=new Map(Array.from(B).map((fe,Ee)=>[fe,Ee])),R={};for(const fe of P){var b;if(a.accessorIndexMap.has(fe))continue;const Ee=a.getAccessorUsage(fe);let me=Ee;if(N.has(Ee)){const be=a.accessorParents.get(fe);me+=`:${d.get(be)}`}R[b=me]||(R[b]={usage:Ee,accessors:[]}),R[me].accessors.push(fe)}const $=[],Q=i.buffers.length;let ee=0;for(const{usage:fe,accessors:Ee}of Object.values(R))if(fe===Wr.ARRAY_BUFFER&&t.vertexLayout===ns.INTERLEAVED){const me=T(Ee,Q,ee);ee+=me.byteLength;for(const be of me.buffers)$.push(be)}else if(fe===Wr.ARRAY_BUFFER)for(const me of Ee){const be=T([me],Q,ee);ee+=be.byteLength;for(const Ie of be.buffers)$.push(Ie)}else if(fe===Wr.SPARSE){const me=C(Ee,Q,ee);ee+=me.byteLength;for(const be of me.buffers)$.push(be)}else if(fe===Wr.ELEMENT_ARRAY_BUFFER){const me=en.BufferViewTarget.ELEMENT_ARRAY_BUFFER,be=p(Ee,Q,ee,me);ee+=be.byteLength;for(const Ie of be.buffers)$.push(Ie)}else{const me=p(Ee,Q,ee);ee+=me.byteLength;for(const be of me.buffers)$.push(be)}if(a.imageBufferViews.length&&F===0){for(let fe=0;fe<a.imageBufferViews.length;fe++)if(i.bufferViews[i.images[fe].bufferView].byteOffset=ee,ee+=a.imageBufferViews[fe].byteLength,$.push(a.imageBufferViews[fe]),ee%8){const Ee=8-ee%8;ee+=Ee,$.push(new Uint8Array(Ee))}}if(a.otherBufferViews.has(E))for(const fe of a.otherBufferViews.get(E))i.bufferViews.push({buffer:Q,byteOffset:ee,byteLength:fe.byteLength}),a.otherBufferViewsIndexMap.set(fe,i.bufferViews.length-1),ee+=fe.byteLength,$.push(fe);if(ee){let fe;t.format===jn.GLB?fe=ir:(fe=a.bufferURIGenerator.createURI(E,"bin"),_.uri=fe),_.byteLength=ee,a.assignResourceURI(fe,Ne.concat($),!0)}i.buffers.push(_),a.bufferIndexMap.set(E,F)}),s.listAccessors().find(E=>!E.getBuffer())&&u.warn("Skipped writing one or more Accessors: no Buffer assigned."),y.filter(E=>E.prewriteTypes.includes(k.MATERIAL)).forEach(E=>E.prewrite(a,k.MATERIAL)),i.materials=s.listMaterials().map((E,F)=>{const _=a.createPropertyDef(E);if(E.getAlphaMode()!==Ln.AlphaMode.OPAQUE&&(_.alphaMode=E.getAlphaMode()),E.getAlphaMode()===Ln.AlphaMode.MASK&&(_.alphaCutoff=E.getAlphaCutoff()),E.getDoubleSided()&&(_.doubleSided=!0),_.pbrMetallicRoughness={},Xe.eq(E.getBaseColorFactor(),[1,1,1,1])||(_.pbrMetallicRoughness.baseColorFactor=E.getBaseColorFactor()),Xe.eq(E.getEmissiveFactor(),[0,0,0])||(_.emissiveFactor=E.getEmissiveFactor()),E.getRoughnessFactor()!==1&&(_.pbrMetallicRoughness.roughnessFactor=E.getRoughnessFactor()),E.getMetallicFactor()!==1&&(_.pbrMetallicRoughness.metallicFactor=E.getMetallicFactor()),E.getBaseColorTexture()){const N=E.getBaseColorTexture(),P=E.getBaseColorTextureInfo();_.pbrMetallicRoughness.baseColorTexture=a.createTextureInfoDef(N,P)}if(E.getEmissiveTexture()){const N=E.getEmissiveTexture(),P=E.getEmissiveTextureInfo();_.emissiveTexture=a.createTextureInfoDef(N,P)}if(E.getNormalTexture()){const N=E.getNormalTexture(),P=E.getNormalTextureInfo(),B=a.createTextureInfoDef(N,P);E.getNormalScale()!==1&&(B.scale=E.getNormalScale()),_.normalTexture=B}if(E.getOcclusionTexture()){const N=E.getOcclusionTexture(),P=E.getOcclusionTextureInfo(),B=a.createTextureInfoDef(N,P);E.getOcclusionStrength()!==1&&(B.strength=E.getOcclusionStrength()),_.occlusionTexture=B}if(E.getMetallicRoughnessTexture()){const N=E.getMetallicRoughnessTexture(),P=E.getMetallicRoughnessTextureInfo();_.pbrMetallicRoughness.metallicRoughnessTexture=a.createTextureInfoDef(N,P)}return a.materialIndexMap.set(E,F),_}),y.filter(E=>E.prewriteTypes.includes(k.MESH)).forEach(E=>E.prewrite(a,k.MESH)),i.meshes=s.listMeshes().map((E,F)=>{const _=a.createPropertyDef(E);let N=null;return _.primitives=E.listPrimitives().map(P=>{const B={attributes:{}};B.mode=P.getMode();const d=P.getMaterial();d&&(B.material=a.materialIndexMap.get(d)),Object.keys(P.getExtras()).length&&(B.extras=P.getExtras());const R=P.getIndices();R&&(B.indices=a.accessorIndexMap.get(R));for(const b of P.listSemantics())B.attributes[b]=a.accessorIndexMap.get(P.getAttribute(b));for(const b of P.listTargets()){const $={};for(const Q of b.listSemantics())$[Q]=a.accessorIndexMap.get(b.getAttribute(Q));B.targets=B.targets||[],B.targets.push($)}return P.listTargets().length&&!N&&(N=P.listTargets().map(b=>b.getName())),B}),E.getWeights().length&&(_.weights=E.getWeights()),N&&(_.extras=_.extras||{},_.extras.targetNames=N),a.meshIndexMap.set(E,F),_}),i.cameras=s.listCameras().map((E,F)=>{const _=a.createPropertyDef(E);if(_.type=E.getType(),_.type===Yn.Type.PERSPECTIVE){_.perspective={znear:E.getZNear(),zfar:E.getZFar(),yfov:E.getYFov()};const N=E.getAspectRatio();N!==null&&(_.perspective.aspectRatio=N)}else _.orthographic={znear:E.getZNear(),zfar:E.getZFar(),xmag:E.getXMag(),ymag:E.getYMag()};return a.cameraIndexMap.set(E,F),_}),i.nodes=s.listNodes().map((E,F)=>{const _=a.createPropertyDef(E);return Xe.eq(E.getTranslation(),[0,0,0])||(_.translation=E.getTranslation()),Xe.eq(E.getRotation(),[0,0,0,1])||(_.rotation=E.getRotation()),Xe.eq(E.getScale(),[1,1,1])||(_.scale=E.getScale()),E.getWeights().length&&(_.weights=E.getWeights()),a.nodeIndexMap.set(E,F),_}),i.skins=s.listSkins().map((E,F)=>{const _=a.createPropertyDef(E),N=E.getInverseBindMatrices();N&&(_.inverseBindMatrices=a.accessorIndexMap.get(N));const P=E.getSkeleton();return P&&(_.skeleton=a.nodeIndexMap.get(P)),_.joints=E.listJoints().map(B=>a.nodeIndexMap.get(B)),a.skinIndexMap.set(E,F),_}),s.listNodes().forEach((E,F)=>{const _=i.nodes[F],N=E.getMesh();N&&(_.mesh=a.meshIndexMap.get(N));const P=E.getCamera();P&&(_.camera=a.cameraIndexMap.get(P));const B=E.getSkin();B&&(_.skin=a.skinIndexMap.get(B)),E.listChildren().length>0&&(_.children=E.listChildren().map(d=>a.nodeIndexMap.get(d)))}),i.animations=s.listAnimations().map((E,F)=>{const _=a.createPropertyDef(E),N=new Map;return _.samplers=E.listSamplers().map((P,B)=>{const d=a.createPropertyDef(P);return d.input=a.accessorIndexMap.get(P.getInput()),d.output=a.accessorIndexMap.get(P.getOutput()),d.interpolation=P.getInterpolation(),N.set(P,B),d}),_.channels=E.listChannels().map(P=>{const B=a.createPropertyDef(P);return B.sampler=N.get(P.getSampler()),B.target={node:a.nodeIndexMap.get(P.getTargetNode()),path:P.getTargetPath()},B}),a.animationIndexMap.set(E,F),_}),i.scenes=s.listScenes().map((E,F)=>{const _=a.createPropertyDef(E);return _.nodes=E.listChildren().map(N=>a.nodeIndexMap.get(N)),a.sceneIndexMap.set(E,F),_});const V=s.getDefaultScene();return V&&(i.scene=s.listScenes().indexOf(V)),i.extensionsUsed=y.map(E=>E.extensionName),i.extensionsRequired=v.map(E=>E.extensionName),y.forEach(E=>E.write(a)),Il(i),o}}function Il(r){const e=[];for(const t in r){const n=r[t];(Array.isArray(n)&&n.length===0||n===null||n===""||n&&typeof n=="object"&&Object.keys(n).length===0)&&e.push(t)}for(const t of e)delete r[t]}var ss;(function(r){r[r.JSON=1313821514]="JSON",r[r.BIN=5130562]="BIN"})(ss||(ss={}));class Sl{constructor(){this._logger=zt.DEFAULT_INSTANCE,this._extensions=new Set,this._dependencies={},this._vertexLayout=ns.INTERLEAVED,this.lastReadBytes=0,this.lastWriteBytes=0}setLogger(e){return this._logger=e,this}registerExtensions(e){for(const t of e)this._extensions.add(t),t.register();return this}registerDependencies(e){return Object.assign(this._dependencies,e),this}setVertexLayout(e){return this._vertexLayout=e,this}async read(e){return await this.readJSON(await this.readAsJSON(e))}async readAsJSON(e){const t=await this.readURI(e,"view");this.lastReadBytes=t.byteLength;const n=Pi(t)?this._binaryToJSON(t):{json:JSON.parse(Ne.decodeText(t)),resources:{}};return await this._readResourcesExternal(n,this.dirname(e)),this._readResourcesInternal(n),n}async readJSON(e){return e=this._copyJSON(e),this._readResourcesInternal(e),yl.read(e,{extensions:Array.from(this._extensions),dependencies:this._dependencies,logger:this._logger})}async binaryToJSON(e){const t=this._binaryToJSON(Ne.assertView(e));this._readResourcesInternal(t);const n=t.json;if(n.buffers&&n.buffers.some(s=>Al(t,s)))throw new Error("Cannot resolve external buffers with binaryToJSON().");if(n.images&&n.images.some(s=>Ml(t,s)))throw new Error("Cannot resolve external images with binaryToJSON().");return t}async readBinary(e){return this.readJSON(await this.binaryToJSON(Ne.assertView(e)))}async writeJSON(e,t={}){if(t.format===jn.GLB&&e.getRoot().listBuffers().length>1)throw new Error("GLB must have 01 buffers.");return Rl.write(e,{format:t.format||jn.GLTF,basename:t.basename||"",logger:this._logger,vertexLayout:this._vertexLayout,dependencies:St({},this._dependencies),extensions:Array.from(this._extensions)})}async writeBinary(e){const{json:t,resources:n}=await this.writeJSON(e,{format:jn.GLB}),s=new Uint32Array([1179937895,2,12]),i=JSON.stringify(t),o=Ne.pad(Ne.encodeText(i),32),a=Ne.toView(new Uint32Array([o.byteLength,1313821514])),u=Ne.concat([a,o]);s[s.length-1]+=u.byteLength;const h=Object.values(n)[0];if(!h||!h.byteLength)return Ne.concat([Ne.toView(s),u]);const y=Ne.pad(h,0),v=Ne.toView(new Uint32Array([y.byteLength,5130562])),p=Ne.concat([v,y]);return s[s.length-1]+=p.byteLength,Ne.concat([Ne.toView(s),u,p])}async _readResourcesExternal(e,t){var n=this;const s=e.json.images||[],i=e.json.buffers||[],o=[...s,...i].map(async function(a){const u=a.uri;if(!u||u.match(/data:/))return Promise.resolve();e.resources[u]=await n.readURI(n.resolve(t,u),"view"),n.lastReadBytes+=e.resources[u].byteLength});await Promise.all(o)}_readResourcesInternal(e){function t(i){if(i.uri){if(i.uri in e.resources){Ne.assertView(e.resources[i.uri]);return}if(i.uri.match(/data:/)){const o=`__${ul()}.${or.extension(i.uri)}`;e.resources[o]=Ne.createBufferFromDataURI(i.uri),i.uri=o}}}(e.json.images||[]).forEach(i=>{if(i.bufferView===void 0&&i.uri===void 0)throw new Error("Missing resource URI or buffer view.");t(i)}),(e.json.buffers||[]).forEach(t)}_copyJSON(e){const{images:t,buffers:n}=e.json;return e={json:St({},e.json),resources:St({},e.resources)},t&&(e.json.images=t.map(s=>St({},s))),n&&(e.json.buffers=n.map(s=>St({},s))),e}_binaryToJSON(e){if(!Pi(e))throw new Error("Invalid glTF 2.0 binary.");const t=new Uint32Array(e.buffer,e.byteOffset+12,2);if(t[1]!==ss.JSON)throw new Error("Missing required GLB JSON chunk.");const n=20,s=t[0],i=Ne.decodeText(Ne.toView(e,n,s)),o=JSON.parse(i),a=n+s;if(e.byteLength<=a)return{json:o,resources:{}};const u=new Uint32Array(e.buffer,e.byteOffset+a,2);if(u[1]!==ss.BIN)return{json:o,resources:{}};const h=u[0],y=Ne.toView(e,a+8,h);return{json:o,resources:{[ir]:y}}}}function Al(r,e){return e.uri!==void 0&&!(e.uri in r.resources)}function Ml(r,e){return e.uri!==void 0&&!(e.uri in r.resources)&&e.bufferView===void 0}function Pi(r){if(r.byteLength<3*Uint32Array.BYTES_PER_ELEMENT)return!1;const e=new Uint32Array(r.buffer,r.byteOffset,3);return e[0]===1179937895&&e[1]===2}class Cl extends Sl{constructor(e=Ir.DEFAULT_INIT){super(),this._fetchConfig=void 0,this._fetchConfig=e}async readURI(e,t){const n=await fetch(e,this._fetchConfig);switch(t){case"view":return new Uint8Array(await n.arrayBuffer());case"text":return n.text()}}resolve(e,t){return Ir.resolve(e,t)}dirname(e){return Ir.dirname(e)}}const{cos:Ds,sin:Ps,PI:Nl}=Math,nr=Nl*2;function Mo(r){const e=Ds(r[2]*.5*nr/360),t=Ps(r[2]*.5*nr/360),n=Ds(r[1]*.5*nr/360),s=Ps(r[1]*.5*nr/360),i=Ds(r[0]*.5*nr/360),o=Ps(r[0]*.5*nr/360),a=[0,0,0,0];return a[3]=e*n*i+t*s*o,a[2]=t*n*i-e*s*o,a[1]=e*s*i+t*n*o,a[0]=e*n*o-t*s*i,a}let Fr="loop",Cr=1,hs=30;const Ol=r=>{Fr=r},qh=()=>Fr,Dl=r=>{Cr=r},Yh=()=>Cr,Pl=r=>{hs=r},Jh=()=>hs,Kn=new Map;let cr,Nr,Ws,is,ds;function Fl(){Kn.clear(),Fr="loop",Cr=1,hs=30}function Fs(r,e,t,n){const s=t[e];if(s==null)return null;if(typeof s!="function")return s;const i=Nr.getCount(),o=e=="rotation"?4:3,a=new Float32Array(o*i);for(let v=0;v<i;++v){const p=v/(i-1),T=s(Fr!=="ping-pong"?p:(1-Math.cos(p*2*Math.PI))/2);a.set(o===4?Mo(T):T,o*v)}const u=r.createAccessor(t.name+" "+e+" frames").setBuffer(r.getRoot().listBuffers()[0]).setArray(a).setType(o===4?oe.Type.VEC4:oe.Type.VEC3),h=r.createAnimationSampler().setInput(Nr).setOutput(u).setInterpolation("LINEAR"),y=r.createAnimationChannel().setTargetPath(e).setTargetNode(n).setSampler(h);return cr.addSampler(h),cr.addChannel(y),ds=!0,s(0)}function Ul(r,e,t){if(Kn.has(t)){const n=r.createAnimationChannel().setTargetPath("weights").setTargetNode(e).setSampler(is);cr.addChannel(n),ds=!0}}const kl=r=>Kn.get(r);function jl(r,e){const t=[];if(e==null)return t;for(let n=0;n<r.numVert;++n)for(let s=0;s<3;++s)t[n*3+s]=r.vertProperties[n*r.numProp+s];if(e.start)for(let n=0;n<r.numVert;++n){const s=r.vertProperties,i=n*r.numProp,o=t.slice(i,i+3);e.start(o);for(let a=0;a<3;++a)s[i+a]=o[a]}return t}function Bl(r,e,t,n,s){s!=null&&(t.setWeights([0]),t.listPrimitives().forEach((i,o)=>{if(s.end)for(let p=0;p<e.numVert;++p){const T=n.slice(3*p,3*(p+1));s.end(T),n.splice(3*p,3,...T)}const a=i.getAttribute("POSITION").getArray(),u=new Float32Array(a.length),h=e.runIndex[o];for(let p=0;p<u.length;++p)u[p]=n[h+p]-a[p];const y=r.createAccessor(t.getName()+" morph target").setBuffer(r.getRoot().listBuffers()[0]).setArray(u).setType(oe.Type.VEC3),v=r.createPrimitiveTarget().setAttribute("POSITION",y);i.addTarget(v)}))}const Zh=(r,e)=>{const t=Kn.get(r);t!=null?t.start=e:Kn.set(r,{start:e})},Qh=(r,e)=>{const t=Kn.get(r);t!=null?t.end=e:Kn.set(r,{end:e})};function Ll(r){cr=r.createAnimation(""),ds=!1;const e=Math.round(Cr*hs)+1,t=new Float32Array(e),n=new Float32Array(e);for(let s=0;s<e;++s){const i=s/(e-1);t[s]=i*Cr,n[s]=Fr!=="ping-pong"?i:(1-Math.cos(i*2*Math.PI))/2}Nr=r.createAccessor("animation times").setBuffer(r.createBuffer()).setArray(t).setType(oe.Type.SCALAR),Ws=r.createAccessor("animation weights").setBuffer(r.getRoot().listBuffers()[0]).setArray(n).setType(oe.Type.SCALAR),is=r.createAnimationSampler().setInput(Nr).setOutput(Ws).setInterpolation("LINEAR"),cr.addSampler(is)}function $l(){ds||(Nr.dispose(),Ws.dispose(),is.dispose(),cr.dispose())}function Co(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var Us={exports:{}},Fi;function Vl(){return Fi||(Fi=1,(function(r){(e=>{var t=Object.defineProperty,n=Object.getOwnPropertyDescriptor,s=Object.getOwnPropertyNames,i=Object.prototype.hasOwnProperty,o=(m,w)=>{for(var S in w)t(m,S,{get:w[S],enumerable:!0})},a=(m,w,S,z)=>{if(w&&typeof w=="object"||typeof w=="function")for(let ie of s(w))!i.call(m,ie)&&ie!==S&&t(m,ie,{get:()=>w[ie],enumerable:!(z=n(w,ie))||z.enumerable});return m},u=m=>a(t({},"__esModule",{value:!0}),m),h=(m,w,S)=>new Promise((z,ie)=>{var ce=Y=>{try{xe(S.next(Y))}catch(Pe){ie(Pe)}},te=Y=>{try{xe(S.throw(Y))}catch(Pe){ie(Pe)}},xe=Y=>Y.done?z(Y.value):Promise.resolve(Y.value).then(ce,te);xe((S=S.apply(m,w)).next())}),y={};o(y,{analyzeMetafile:()=>Br,analyzeMetafileSync:()=>vs,build:()=>Gn,buildSync:()=>Qn,context:()=>Pn,default:()=>Bt,formatMessages:()=>Zn,formatMessagesSync:()=>xs,initialize:()=>ws,stop:()=>Es,transform:()=>fn,transformSync:()=>hn,version:()=>dr}),e.exports=u(y);function v(m){let w=z=>{if(z===null)S.write8(0);else if(typeof z=="boolean")S.write8(1),S.write8(+z);else if(typeof z=="number")S.write8(2),S.write32(z|0);else if(typeof z=="string")S.write8(3),S.write(C(z));else if(z instanceof Uint8Array)S.write8(4),S.write(z);else if(z instanceof Array){S.write8(5),S.write32(z.length);for(let ie of z)w(ie)}else{let ie=Object.keys(z);S.write8(6),S.write32(ie.length);for(let ce of ie)S.write(C(ce)),w(z[ce])}},S=new T;return S.write32(0),S.write32(m.id<<1|+!m.isRequest),w(m.value),F(S.buf,S.len-4,0),S.buf.subarray(0,S.len)}function p(m){let w=()=>{switch(S.read8()){case 0:return null;case 1:return!!S.read8();case 2:return S.read32();case 3:return G(S.read());case 4:return S.read();case 5:{let te=S.read32(),xe=[];for(let Y=0;Y<te;Y++)xe.push(w());return xe}case 6:{let te=S.read32(),xe={};for(let Y=0;Y<te;Y++)xe[G(S.read())]=w();return xe}default:throw new Error("Invalid packet")}},S=new T(m),z=S.read32(),ie=(z&1)===0;z>>>=1;let ce=w();if(S.ptr!==m.length)throw new Error("Invalid packet");return{id:z,isRequest:ie,value:ce}}var T=class{constructor(m=new Uint8Array(1024)){this.buf=m,this.len=0,this.ptr=0}_write(m){if(this.len+m>this.buf.length){let w=new Uint8Array((this.len+m)*2);w.set(this.buf),this.buf=w}return this.len+=m,this.len-m}write8(m){let w=this._write(1);this.buf[w]=m}write32(m){let w=this._write(4);F(this.buf,m,w)}write(m){let w=this._write(4+m.length);F(this.buf,m.length,w),this.buf.set(m,w+4)}_read(m){if(this.ptr+m>this.buf.length)throw new Error("Invalid packet");return this.ptr+=m,this.ptr-m}read8(){return this.buf[this._read(1)]}read32(){return E(this.buf,this._read(4))}read(){let m=this.read32(),w=new Uint8Array(m),S=this._read(w.length);return w.set(this.buf.subarray(S,S+m)),w}},C,G,V;if(typeof TextEncoder<"u"&&typeof TextDecoder<"u"){let m=new TextEncoder,w=new TextDecoder;C=S=>m.encode(S),G=S=>w.decode(S),V='new TextEncoder().encode("")'}else if(typeof Buffer<"u")C=m=>Buffer.from(m),G=m=>{let{buffer:w,byteOffset:S,byteLength:z}=m;return Buffer.from(w,S,z).toString()},V='Buffer.from("")';else throw new Error("No UTF-8 codec found");if(!(C("")instanceof Uint8Array))throw new Error(`Invariant violation: "${V} instanceof Uint8Array" is incorrectly false

This indicates that your JavaScript environment is broken. You cannot use
esbuild in this environment because esbuild relies on this invariant. This
is not a problem with esbuild. You need to fix your environment instead.
`);function E(m,w){return m[w++]|m[w++]<<8|m[w++]<<16|m[w++]<<24}function F(m,w,S){m[S++]=w,m[S++]=w>>8,m[S++]=w>>16,m[S++]=w>>24}var _=JSON.stringify,N="warning",P="silent";function B(m,w){const S=[];for(const z of m){if(Ve(z,w),z.indexOf(",")>=0)throw new Error(`Invalid ${w}: ${z}`);S.push(z)}return S.join(",")}var d=()=>null,R=m=>typeof m=="boolean"?null:"a boolean",b=m=>typeof m=="string"?null:"a string",$=m=>m instanceof RegExp?null:"a RegExp object",Q=m=>typeof m=="number"&&m===(m|0)?null:"an integer",ee=m=>typeof m=="number"&&m===(m|0)&&m>=0&&m<=65535?null:"a valid port number",fe=m=>typeof m=="function"?null:"a function",Ee=m=>Array.isArray(m)?null:"an array",me=m=>Array.isArray(m)&&m.every(w=>typeof w=="string")?null:"an array of strings",be=m=>typeof m=="object"&&m!==null&&!Array.isArray(m)?null:"an object",Ie=m=>typeof m=="object"&&m!==null?null:"an array or an object",He=m=>m instanceof WebAssembly.Module?null:"a WebAssembly.Module",We=m=>typeof m=="object"&&!Array.isArray(m)?null:"an object or null",kt=m=>typeof m=="string"||typeof m=="boolean"?null:"a string or a boolean",lt=m=>typeof m=="string"||typeof m=="object"&&m!==null&&!Array.isArray(m)?null:"a string or an object",Tt=m=>typeof m=="string"||Array.isArray(m)&&m.every(w=>typeof w=="string")?null:"a string or an array of strings",Et=m=>typeof m=="string"||m instanceof Uint8Array?null:"a string or a Uint8Array",tt=m=>typeof m=="string"||m instanceof URL?null:"a string or a URL";function A(m,w,S,z){let ie=m[S];if(w[S+""]=!0,ie===void 0)return;let ce=z(ie);if(ce!==null)throw new Error(`${_(S)} must be ${ce}`);return ie}function De(m,w,S){for(let z in m)if(!(z in w))throw new Error(`Invalid option ${S}: ${_(z)}`)}function Dn(m){let w=Object.create(null),S=A(m,w,"wasmURL",tt),z=A(m,w,"wasmModule",He),ie=A(m,w,"worker",R);return De(m,w,"in initialize() call"),{wasmURL:S,wasmModule:z,worker:ie}}function tn(m){let w;if(m!==void 0){w=Object.create(null);for(let S in m){let z=m[S];if(typeof z=="string"||z===!1)w[S]=z;else throw new Error(`Expected ${_(S)} in mangle cache to map to either a string or false`)}}return w}function _t(m,w,S,z,ie){let ce=A(w,S,"color",R),te=A(w,S,"logLevel",b),xe=A(w,S,"logLimit",Q);ce!==void 0?m.push(`--color=${ce}`):z&&m.push("--color=true"),m.push(`--log-level=${te||ie}`),m.push(`--log-limit=${xe||0}`)}function Ve(m,w,S){if(typeof m!="string")throw new Error(`Expected value for ${w}${S!==void 0?" "+_(S):""} to be a string, got ${typeof m} instead`);return m}function it(m,w,S){let z=A(w,S,"legalComments",b),ie=A(w,S,"sourceRoot",b),ce=A(w,S,"sourcesContent",R),te=A(w,S,"target",Tt),xe=A(w,S,"format",b),Y=A(w,S,"globalName",b),Pe=A(w,S,"mangleProps",$),Fe=A(w,S,"reserveProps",$),Re=A(w,S,"mangleQuoted",R),Be=A(w,S,"minify",R),Se=A(w,S,"minifySyntax",R),Le=A(w,S,"minifyWhitespace",R),$e=A(w,S,"minifyIdentifiers",R),ve=A(w,S,"lineLimit",Q),Qe=A(w,S,"drop",me),we=A(w,S,"dropLabels",me),ye=A(w,S,"charset",b),ae=A(w,S,"treeShaking",R),K=A(w,S,"ignoreAnnotations",R),D=A(w,S,"jsx",b),H=A(w,S,"jsxFactory",b),J=A(w,S,"jsxFragment",b),he=A(w,S,"jsxImportSource",b),ge=A(w,S,"jsxDev",R),X=A(w,S,"jsxSideEffects",R),ne=A(w,S,"define",be),x=A(w,S,"logOverride",be),L=A(w,S,"supported",be),le=A(w,S,"pure",me),de=A(w,S,"keepNames",R),_e=A(w,S,"platform",b),Oe=A(w,S,"tsconfigRaw",lt),Ke=A(w,S,"absPaths",me);if(z&&m.push(`--legal-comments=${z}`),ie!==void 0&&m.push(`--source-root=${ie}`),ce!==void 0&&m.push(`--sources-content=${ce}`),te&&m.push(`--target=${B(Array.isArray(te)?te:[te],"target")}`),xe&&m.push(`--format=${xe}`),Y&&m.push(`--global-name=${Y}`),_e&&m.push(`--platform=${_e}`),Oe&&m.push(`--tsconfig-raw=${typeof Oe=="string"?Oe:JSON.stringify(Oe)}`),Be&&m.push("--minify"),Se&&m.push("--minify-syntax"),Le&&m.push("--minify-whitespace"),$e&&m.push("--minify-identifiers"),ve&&m.push(`--line-limit=${ve}`),ye&&m.push(`--charset=${ye}`),ae!==void 0&&m.push(`--tree-shaking=${ae}`),K&&m.push("--ignore-annotations"),Qe)for(let pe of Qe)m.push(`--drop:${Ve(pe,"drop")}`);if(we&&m.push(`--drop-labels=${B(we,"drop label")}`),Ke&&m.push(`--abs-paths=${B(Ke,"abs paths")}`),Pe&&m.push(`--mangle-props=${un(Pe)}`),Fe&&m.push(`--reserve-props=${un(Fe)}`),Re!==void 0&&m.push(`--mangle-quoted=${Re}`),D&&m.push(`--jsx=${D}`),H&&m.push(`--jsx-factory=${H}`),J&&m.push(`--jsx-fragment=${J}`),he&&m.push(`--jsx-import-source=${he}`),ge&&m.push("--jsx-dev"),X&&m.push("--jsx-side-effects"),ne)for(let pe in ne){if(pe.indexOf("=")>=0)throw new Error(`Invalid define: ${pe}`);m.push(`--define:${pe}=${Ve(ne[pe],"define",pe)}`)}if(x)for(let pe in x){if(pe.indexOf("=")>=0)throw new Error(`Invalid log override: ${pe}`);m.push(`--log-override:${pe}=${Ve(x[pe],"log override",pe)}`)}if(L)for(let pe in L){if(pe.indexOf("=")>=0)throw new Error(`Invalid supported: ${pe}`);const ke=L[pe];if(typeof ke!="boolean")throw new Error(`Expected value for supported ${_(pe)} to be a boolean, got ${typeof ke} instead`);m.push(`--supported:${pe}=${ke}`)}if(le)for(let pe of le)m.push(`--pure:${Ve(pe,"pure")}`);de&&m.push("--keep-names")}function Mt(m,w,S,z,ie){var ce;let te=[],xe=[],Y=Object.create(null),Pe=null,Fe=null;_t(te,w,Y,S,z),it(te,w,Y);let Re=A(w,Y,"sourcemap",kt),Be=A(w,Y,"bundle",R),Se=A(w,Y,"splitting",R),Le=A(w,Y,"preserveSymlinks",R),$e=A(w,Y,"metafile",R),ve=A(w,Y,"outfile",b),Qe=A(w,Y,"outdir",b),we=A(w,Y,"outbase",b),ye=A(w,Y,"tsconfig",b),ae=A(w,Y,"resolveExtensions",me),K=A(w,Y,"nodePaths",me),D=A(w,Y,"mainFields",me),H=A(w,Y,"conditions",me),J=A(w,Y,"external",me),he=A(w,Y,"packages",b),ge=A(w,Y,"alias",be),X=A(w,Y,"loader",be),ne=A(w,Y,"outExtension",be),x=A(w,Y,"publicPath",b),L=A(w,Y,"entryNames",b),le=A(w,Y,"chunkNames",b),de=A(w,Y,"assetNames",b),_e=A(w,Y,"inject",me),Oe=A(w,Y,"banner",be),Ke=A(w,Y,"footer",be),pe=A(w,Y,"entryPoints",Ie),ke=A(w,Y,"absWorkingDir",b),je=A(w,Y,"stdin",be),Ce=(ce=A(w,Y,"write",R))!=null?ce:ie,dt=A(w,Y,"allowOverwrite",R),nt=A(w,Y,"mangleCache",be);if(Y.plugins=!0,De(w,Y,`in ${m}() call`),Re&&te.push(`--sourcemap${Re===!0?"":`=${Re}`}`),Be&&te.push("--bundle"),dt&&te.push("--allow-overwrite"),Se&&te.push("--splitting"),Le&&te.push("--preserve-symlinks"),$e&&te.push("--metafile"),ve&&te.push(`--outfile=${ve}`),Qe&&te.push(`--outdir=${Qe}`),we&&te.push(`--outbase=${we}`),ye&&te.push(`--tsconfig=${ye}`),he&&te.push(`--packages=${he}`),ae&&te.push(`--resolve-extensions=${B(ae,"resolve extension")}`),x&&te.push(`--public-path=${x}`),L&&te.push(`--entry-names=${L}`),le&&te.push(`--chunk-names=${le}`),de&&te.push(`--asset-names=${de}`),D&&te.push(`--main-fields=${B(D,"main field")}`),H&&te.push(`--conditions=${B(H,"condition")}`),J)for(let Te of J)te.push(`--external:${Ve(Te,"external")}`);if(ge)for(let Te in ge){if(Te.indexOf("=")>=0)throw new Error(`Invalid package name in alias: ${Te}`);te.push(`--alias:${Te}=${Ve(ge[Te],"alias",Te)}`)}if(Oe)for(let Te in Oe){if(Te.indexOf("=")>=0)throw new Error(`Invalid banner file type: ${Te}`);te.push(`--banner:${Te}=${Ve(Oe[Te],"banner",Te)}`)}if(Ke)for(let Te in Ke){if(Te.indexOf("=")>=0)throw new Error(`Invalid footer file type: ${Te}`);te.push(`--footer:${Te}=${Ve(Ke[Te],"footer",Te)}`)}if(_e)for(let Te of _e)te.push(`--inject:${Ve(Te,"inject")}`);if(X)for(let Te in X){if(Te.indexOf("=")>=0)throw new Error(`Invalid loader extension: ${Te}`);te.push(`--loader:${Te}=${Ve(X[Te],"loader",Te)}`)}if(ne)for(let Te in ne){if(Te.indexOf("=")>=0)throw new Error(`Invalid out extension: ${Te}`);te.push(`--out-extension:${Te}=${Ve(ne[Te],"out extension",Te)}`)}if(pe)if(Array.isArray(pe))for(let Te=0,qt=pe.length;Te<qt;Te++){let Rt=pe[Te];if(typeof Rt=="object"&&Rt!==null){let Dt=Object.create(null),Ct=A(Rt,Dt,"in",b),Nt=A(Rt,Dt,"out",b);if(De(Rt,Dt,"in entry point at index "+Te),Ct===void 0)throw new Error('Missing property "in" for entry point at index '+Te);if(Nt===void 0)throw new Error('Missing property "out" for entry point at index '+Te);xe.push([Nt,Ct])}else xe.push(["",Ve(Rt,"entry point at index "+Te)])}else for(let Te in pe)xe.push([Te,Ve(pe[Te],"entry point",Te)]);if(je){let Te=Object.create(null),qt=A(je,Te,"contents",Et),Rt=A(je,Te,"resolveDir",b),Dt=A(je,Te,"sourcefile",b),Ct=A(je,Te,"loader",b);De(je,Te,'in "stdin" object'),Dt&&te.push(`--sourcefile=${Dt}`),Ct&&te.push(`--loader=${Ct}`),Rt&&(Fe=Rt),typeof qt=="string"?Pe=C(qt):qt instanceof Uint8Array&&(Pe=qt)}let Lt=[];if(K)for(let Te of K)Te+="",Lt.push(Te);return{entries:xe,flags:te,write:Ce,stdinContents:Pe,stdinResolveDir:Fe,absWorkingDir:ke,nodePaths:Lt,mangleCache:tn(nt)}}function on(m,w,S,z){let ie=[],ce=Object.create(null);_t(ie,w,ce,S,z),it(ie,w,ce);let te=A(w,ce,"sourcemap",kt),xe=A(w,ce,"sourcefile",b),Y=A(w,ce,"loader",b),Pe=A(w,ce,"banner",b),Fe=A(w,ce,"footer",b),Re=A(w,ce,"mangleCache",be);return De(w,ce,`in ${m}() call`),te&&ie.push(`--sourcemap=${te===!0?"external":te}`),xe&&ie.push(`--sourcefile=${xe}`),Y&&ie.push(`--loader=${Y}`),Pe&&ie.push(`--banner=${Pe}`),Fe&&ie.push(`--footer=${Fe}`),{flags:ie,mangleCache:tn(Re)}}function Ot(m){const w={},S={didClose:!1,reason:""};let z={},ie=0,ce=0,te=new Uint8Array(16*1024),xe=0,Y=ye=>{let ae=xe+ye.length;if(ae>te.length){let D=new Uint8Array(ae*2);D.set(te),te=D}te.set(ye,xe),xe+=ye.length;let K=0;for(;K+4<=xe;){let D=E(te,K);if(K+4+D>xe)break;K+=4,Le(te.subarray(K,K+D)),K+=D}K>0&&(te.copyWithin(0,K,xe),xe-=K)},Pe=ye=>{S.didClose=!0,ye&&(S.reason=": "+(ye.message||ye));const ae="The service was stopped"+S.reason;for(let K in z)z[K](ae,null);z={}},Fe=(ye,ae,K)=>{if(S.didClose)return K("The service is no longer running"+S.reason,null);let D=ie++;z[D]=(H,J)=>{try{K(H,J)}finally{ye&&ye.unref()}},ye&&ye.ref(),m.writeToStdin(v({id:D,isRequest:!0,value:ae}))},Re=(ye,ae)=>{if(S.didClose)throw new Error("The service is no longer running"+S.reason);m.writeToStdin(v({id:ye,isRequest:!1,value:ae}))},Be=(ye,ae)=>h(null,null,function*(){try{if(ae.command==="ping"){Re(ye,{});return}if(typeof ae.key=="number"){const K=w[ae.key];if(!K)return;const D=K[ae.command];if(D){yield D(ye,ae);return}}throw new Error("Invalid command: "+ae.command)}catch(K){const D=[an(K,m,null,void 0,"")];try{Re(ye,{errors:D})}catch{}}}),Se=!0,Le=ye=>{if(Se){Se=!1;let K=String.fromCharCode(...ye);if(K!=="0.25.11")throw new Error(`Cannot start service: Host version "0.25.11" does not match binary version ${_(K)}`);return}let ae=p(ye);if(ae.isRequest)Be(ae.id,ae.value);else{let K=z[ae.id];delete z[ae.id],ae.value.error?K(ae.value.error,{}):K(null,ae.value)}};return{readFromStdout:Y,afterClose:Pe,service:{buildOrContext:({callName:ye,refs:ae,options:K,isTTY:D,defaultWD:H,callback:J})=>{let he=0;const ge=ce++,X={},ne={ref(){++he===1&&ae&&ae.ref()},unref(){--he===0&&(delete w[ge],ae&&ae.unref())}};w[ge]=X,ne.ref(),kr(ye,ge,Fe,Re,ne,m,X,K,D,H,(x,L)=>{try{J(x,L)}finally{ne.unref()}})},transform:({callName:ye,refs:ae,input:K,options:D,isTTY:H,fs:J,callback:he})=>{const ge=hr();let X=ne=>{try{if(typeof K!="string"&&!(K instanceof Uint8Array))throw new Error('The input to "transform" must be a string or a Uint8Array');let{flags:x,mangleCache:L}=on(ye,D,H,P),le={command:"transform",flags:x,inputFS:ne!==null,input:ne!==null?C(ne):typeof K=="string"?C(K):K};L&&(le.mangleCache=L),Fe(ae,le,(de,_e)=>{if(de)return he(new Error(de),null);let Oe=gt(_e.errors,ge),Ke=gt(_e.warnings,ge),pe=1,ke=()=>{if(--pe===0){let je={warnings:Ke,code:_e.code,map:_e.map,mangleCache:void 0,legalComments:void 0};"legalComments"in _e&&(je.legalComments=_e?.legalComments),_e.mangleCache&&(je.mangleCache=_e?.mangleCache),he(null,je)}};if(Oe.length>0)return he(cn("Transform failed",Oe,Ke),null);_e.codeFS&&(pe++,J.readFile(_e.code,(je,Ce)=>{je!==null?he(je,null):(_e.code=Ce,ke())})),_e.mapFS&&(pe++,J.readFile(_e.map,(je,Ce)=>{je!==null?he(je,null):(_e.map=Ce,ke())})),ke()})}catch(x){let L=[];try{_t(L,D,{},H,P)}catch{}const le=an(x,m,ge,void 0,"");Fe(ae,{command:"error",flags:L,error:le},()=>{le.detail=ge.load(le.detail),he(cn("Transform failed",[le],[]),null)})}};if((typeof K=="string"||K instanceof Uint8Array)&&K.length>1024*1024){let ne=X;X=()=>J.writeFile(K,ne)}X(null)},formatMessages:({callName:ye,refs:ae,messages:K,options:D,callback:H})=>{if(!D)throw new Error(`Missing second argument in ${ye}() call`);let J={},he=A(D,J,"kind",b),ge=A(D,J,"color",R),X=A(D,J,"terminalWidth",Q);if(De(D,J,`in ${ye}() call`),he===void 0)throw new Error(`Missing "kind" in ${ye}() call`);if(he!=="error"&&he!=="warning")throw new Error(`Expected "kind" to be "error" or "warning" in ${ye}() call`);let ne={command:"format-msgs",messages:Xt(K,"messages",null,"",X),isWarning:he==="warning"};ge!==void 0&&(ne.color=ge),X!==void 0&&(ne.terminalWidth=X),Fe(ae,ne,(x,L)=>{if(x)return H(new Error(x),null);H(null,L.messages)})},analyzeMetafile:({callName:ye,refs:ae,metafile:K,options:D,callback:H})=>{D===void 0&&(D={});let J={},he=A(D,J,"color",R),ge=A(D,J,"verbose",R);De(D,J,`in ${ye}() call`);let X={command:"analyze-metafile",metafile:K};he!==void 0&&(X.color=he),ge!==void 0&&(X.verbose=ge),Fe(ae,X,(ne,x)=>{if(ne)return H(new Error(ne),null);H(null,x.result)})}}}}function kr(m,w,S,z,ie,ce,te,xe,Y,Pe,Fe){const Re=hr(),Be=m==="context",Se=(ve,Qe)=>{const we=[];try{_t(we,xe,{},Y,N)}catch{}const ye=an(ve,ce,Re,void 0,Qe);S(ie,{command:"error",flags:we,error:ye},()=>{ye.detail=Re.load(ye.detail),Fe(cn(Be?"Context failed":"Build failed",[ye],[]),null)})};let Le;if(typeof xe=="object"){const ve=xe.plugins;if(ve!==void 0){if(!Array.isArray(ve))return Se(new Error('"plugins" must be an array'),"");Le=ve}}if(Le&&Le.length>0){if(ce.isSync)return Se(new Error("Cannot use plugins in synchronous API calls"),"");ms(w,S,z,ie,ce,te,xe,Le,Re).then(ve=>{if(!ve.ok)return Se(ve.error,ve.pluginName);try{$e(ve.requestPlugins,ve.runOnEndCallbacks,ve.scheduleOnDisposeCallbacks)}catch(Qe){Se(Qe,"")}},ve=>Se(ve,""));return}try{$e(null,(ve,Qe)=>Qe([],[]),()=>{})}catch(ve){Se(ve,"")}function $e(ve,Qe,we){const ye=ce.hasFS,{entries:ae,flags:K,write:D,stdinContents:H,stdinResolveDir:J,absWorkingDir:he,nodePaths:ge,mangleCache:X}=Mt(m,xe,Y,N,ye);if(D&&!ce.hasFS)throw new Error('The "write" option is unavailable in this environment');const ne={command:"build",key:w,entries:ae,flags:K,write:D,stdinContents:H,stdinResolveDir:J,absWorkingDir:he||Pe,nodePaths:ge,context:Be};ve&&(ne.plugins=ve),X&&(ne.mangleCache=X);const x=(de,_e)=>{const Oe={errors:gt(de.errors,Re),warnings:gt(de.warnings,Re),outputFiles:void 0,metafile:void 0,mangleCache:void 0},Ke=Oe.errors.slice(),pe=Oe.warnings.slice();de.outputFiles&&(Oe.outputFiles=de.outputFiles.map(Ts)),de.metafile&&(Oe.metafile=JSON.parse(de.metafile)),de.mangleCache&&(Oe.mangleCache=de.mangleCache),de.writeToStdout!==void 0&&console.log(G(de.writeToStdout).replace(/\n$/,"")),Qe(Oe,(ke,je)=>{if(Ke.length>0||ke.length>0){const Ce=cn("Build failed",Ke.concat(ke),pe.concat(je));return _e(Ce,null,ke,je)}_e(null,Oe,ke,je)})};let L,le;Be&&(te["on-end"]=(de,_e)=>new Promise(Oe=>{x(_e,(Ke,pe,ke,je)=>{const Ce={errors:ke,warnings:je};le&&le(Ke,pe),L=void 0,le=void 0,z(de,Ce),Oe()})})),S(ie,ne,(de,_e)=>{if(de)return Fe(new Error(de),null);if(!Be)return x(_e,(pe,ke)=>(we(),Fe(pe,ke)));if(_e.errors.length>0)return Fe(cn("Context failed",_e.errors,_e.warnings),null);let Oe=!1;const Ke={rebuild:()=>(L||(L=new Promise((pe,ke)=>{let je;le=(dt,nt)=>{je||(je=()=>dt?ke(dt):pe(nt))};const Ce=()=>{S(ie,{command:"rebuild",key:w},(nt,Lt)=>{nt?ke(new Error(nt)):je?je():Ce()})};Ce()})),L),watch:(pe={})=>new Promise((ke,je)=>{if(!ce.hasFS)throw new Error('Cannot use the "watch" API in this environment');const Ce={},dt=A(pe,Ce,"delay",Q);De(pe,Ce,"in watch() call");const nt={command:"watch",key:w};dt&&(nt.delay=dt),S(ie,nt,Lt=>{Lt?je(new Error(Lt)):ke(void 0)})}),serve:(pe={})=>new Promise((ke,je)=>{if(!ce.hasFS)throw new Error('Cannot use the "serve" API in this environment');const Ce={},dt=A(pe,Ce,"port",ee),nt=A(pe,Ce,"host",b),Lt=A(pe,Ce,"servedir",b),Te=A(pe,Ce,"keyfile",b),qt=A(pe,Ce,"certfile",b),Rt=A(pe,Ce,"fallback",b),Dt=A(pe,Ce,"cors",be),Ct=A(pe,Ce,"onRequest",fe);De(pe,Ce,"in serve() call");const Nt={command:"serve",key:w,onRequest:!!Ct};if(dt!==void 0&&(Nt.port=dt),nt!==void 0&&(Nt.host=nt),Lt!==void 0&&(Nt.servedir=Lt),Te!==void 0&&(Nt.keyfile=Te),qt!==void 0&&(Nt.certfile=qt),Rt!==void 0&&(Nt.fallback=Rt),Dt){const dn={},pn=A(Dt,dn,"origin",Tt);De(Dt,dn,'on "cors" object'),Array.isArray(pn)?Nt.corsOrigin=pn:pn!==void 0&&(Nt.corsOrigin=[pn])}S(ie,Nt,(dn,pn)=>{if(dn)return je(new Error(dn));Ct&&(te["serve-request"]=(Lr,bs)=>{Ct(bs.args),z(Lr,{})}),ke(pn)})}),cancel:()=>new Promise(pe=>{if(Oe)return pe();S(ie,{command:"cancel",key:w},()=>{pe()})}),dispose:()=>new Promise(pe=>{if(Oe)return pe();Oe=!0,S(ie,{command:"dispose",key:w},()=>{pe(),we(),ie.unref()})})};ie.ref(),Fe(null,Ke)})}}var ms=(m,w,S,z,ie,ce,te,xe,Y)=>h(null,null,function*(){let Pe=[],Fe=[],Re={},Be={},Se=[],Le=0,$e=0,ve=[],Qe=!1;xe=[...xe];for(let ae of xe){let K={};if(typeof ae!="object")throw new Error(`Plugin at index ${$e} must be an object`);const D=A(ae,K,"name",b);if(typeof D!="string"||D==="")throw new Error(`Plugin at index ${$e} is missing a name`);try{let H=A(ae,K,"setup",fe);if(typeof H!="function")throw new Error("Plugin is missing a setup function");De(ae,K,`on plugin ${_(D)}`);let J={name:D,onStart:!1,onEnd:!1,onResolve:[],onLoad:[]};$e++;let ge=H({initialOptions:te,resolve:(X,ne={})=>{if(!Qe)throw new Error('Cannot call "resolve" before plugin setup has completed');if(typeof X!="string")throw new Error("The path to resolve must be a string");let x=Object.create(null),L=A(ne,x,"pluginName",b),le=A(ne,x,"importer",b),de=A(ne,x,"namespace",b),_e=A(ne,x,"resolveDir",b),Oe=A(ne,x,"kind",b),Ke=A(ne,x,"pluginData",d),pe=A(ne,x,"with",be);return De(ne,x,"in resolve() call"),new Promise((ke,je)=>{const Ce={command:"resolve",path:X,key:m,pluginName:D};if(L!=null&&(Ce.pluginName=L),le!=null&&(Ce.importer=le),de!=null&&(Ce.namespace=de),_e!=null&&(Ce.resolveDir=_e),Oe!=null)Ce.kind=Oe;else throw new Error('Must specify "kind" when calling "resolve"');Ke!=null&&(Ce.pluginData=Y.store(Ke)),pe!=null&&(Ce.with=ys(pe,"with")),w(z,Ce,(dt,nt)=>{dt!==null?je(new Error(dt)):ke({errors:gt(nt.errors,Y),warnings:gt(nt.warnings,Y),path:nt.path,external:nt.external,sideEffects:nt.sideEffects,namespace:nt.namespace,suffix:nt.suffix,pluginData:Y.load(nt.pluginData)})})})},onStart(X){let ne='This error came from the "onStart" callback registered here:',x=Jn(new Error(ne),ie,"onStart");Pe.push({name:D,callback:X,note:x}),J.onStart=!0},onEnd(X){let ne='This error came from the "onEnd" callback registered here:',x=Jn(new Error(ne),ie,"onEnd");Fe.push({name:D,callback:X,note:x}),J.onEnd=!0},onResolve(X,ne){let x='This error came from the "onResolve" callback registered here:',L=Jn(new Error(x),ie,"onResolve"),le={},de=A(X,le,"filter",$),_e=A(X,le,"namespace",b);if(De(X,le,`in onResolve() call for plugin ${_(D)}`),de==null)throw new Error("onResolve() call is missing a filter");let Oe=Le++;Re[Oe]={name:D,callback:ne,note:L},J.onResolve.push({id:Oe,filter:un(de),namespace:_e||""})},onLoad(X,ne){let x='This error came from the "onLoad" callback registered here:',L=Jn(new Error(x),ie,"onLoad"),le={},de=A(X,le,"filter",$),_e=A(X,le,"namespace",b);if(De(X,le,`in onLoad() call for plugin ${_(D)}`),de==null)throw new Error("onLoad() call is missing a filter");let Oe=Le++;Be[Oe]={name:D,callback:ne,note:L},J.onLoad.push({id:Oe,filter:un(de),namespace:_e||""})},onDispose(X){Se.push(X)},esbuild:ie.esbuild});ge&&(yield ge),ve.push(J)}catch(H){return{ok:!1,error:H,pluginName:D}}}ce["on-start"]=(ae,K)=>h(null,null,function*(){Y.clear();let D={errors:[],warnings:[]};yield Promise.all(Pe.map(H=>h(null,[H],function*({name:J,callback:he,note:ge}){try{let X=yield he();if(X!=null){if(typeof X!="object")throw new Error(`Expected onStart() callback in plugin ${_(J)} to return an object`);let ne={},x=A(X,ne,"errors",Ee),L=A(X,ne,"warnings",Ee);De(X,ne,`from onStart() callback in plugin ${_(J)}`),x!=null&&D.errors.push(...Xt(x,"errors",Y,J,void 0)),L!=null&&D.warnings.push(...Xt(L,"warnings",Y,J,void 0))}}catch(X){D.errors.push(an(X,ie,Y,ge&&ge(),J))}}))),S(ae,D)}),ce["on-resolve"]=(ae,K)=>h(null,null,function*(){let D={},H="",J,he;for(let ge of K.ids)try{({name:H,callback:J,note:he}=Re[ge]);let X=yield J({path:K.path,importer:K.importer,namespace:K.namespace,resolveDir:K.resolveDir,kind:K.kind,pluginData:Y.load(K.pluginData),with:K.with});if(X!=null){if(typeof X!="object")throw new Error(`Expected onResolve() callback in plugin ${_(H)} to return an object`);let ne={},x=A(X,ne,"pluginName",b),L=A(X,ne,"path",b),le=A(X,ne,"namespace",b),de=A(X,ne,"suffix",b),_e=A(X,ne,"external",R),Oe=A(X,ne,"sideEffects",R),Ke=A(X,ne,"pluginData",d),pe=A(X,ne,"errors",Ee),ke=A(X,ne,"warnings",Ee),je=A(X,ne,"watchFiles",me),Ce=A(X,ne,"watchDirs",me);De(X,ne,`from onResolve() callback in plugin ${_(H)}`),D.id=ge,x!=null&&(D.pluginName=x),L!=null&&(D.path=L),le!=null&&(D.namespace=le),de!=null&&(D.suffix=de),_e!=null&&(D.external=_e),Oe!=null&&(D.sideEffects=Oe),Ke!=null&&(D.pluginData=Y.store(Ke)),pe!=null&&(D.errors=Xt(pe,"errors",Y,H,void 0)),ke!=null&&(D.warnings=Xt(ke,"warnings",Y,H,void 0)),je!=null&&(D.watchFiles=Vn(je,"watchFiles")),Ce!=null&&(D.watchDirs=Vn(Ce,"watchDirs"));break}}catch(X){D={id:ge,errors:[an(X,ie,Y,he&&he(),H)]};break}S(ae,D)}),ce["on-load"]=(ae,K)=>h(null,null,function*(){let D={},H="",J,he;for(let ge of K.ids)try{({name:H,callback:J,note:he}=Be[ge]);let X=yield J({path:K.path,namespace:K.namespace,suffix:K.suffix,pluginData:Y.load(K.pluginData),with:K.with});if(X!=null){if(typeof X!="object")throw new Error(`Expected onLoad() callback in plugin ${_(H)} to return an object`);let ne={},x=A(X,ne,"pluginName",b),L=A(X,ne,"contents",Et),le=A(X,ne,"resolveDir",b),de=A(X,ne,"pluginData",d),_e=A(X,ne,"loader",b),Oe=A(X,ne,"errors",Ee),Ke=A(X,ne,"warnings",Ee),pe=A(X,ne,"watchFiles",me),ke=A(X,ne,"watchDirs",me);De(X,ne,`from onLoad() callback in plugin ${_(H)}`),D.id=ge,x!=null&&(D.pluginName=x),L instanceof Uint8Array?D.contents=L:L!=null&&(D.contents=C(L)),le!=null&&(D.resolveDir=le),de!=null&&(D.pluginData=Y.store(de)),_e!=null&&(D.loader=_e),Oe!=null&&(D.errors=Xt(Oe,"errors",Y,H,void 0)),Ke!=null&&(D.warnings=Xt(Ke,"warnings",Y,H,void 0)),pe!=null&&(D.watchFiles=Vn(pe,"watchFiles")),ke!=null&&(D.watchDirs=Vn(ke,"watchDirs"));break}}catch(X){D={id:ge,errors:[an(X,ie,Y,he&&he(),H)]};break}S(ae,D)});let we=(ae,K)=>K([],[]);Fe.length>0&&(we=(ae,K)=>{h(null,null,function*(){const D=[],H=[];for(const{name:J,callback:he,note:ge}of Fe){let X,ne;try{const x=yield he(ae);if(x!=null){if(typeof x!="object")throw new Error(`Expected onEnd() callback in plugin ${_(J)} to return an object`);let L={},le=A(x,L,"errors",Ee),de=A(x,L,"warnings",Ee);De(x,L,`from onEnd() callback in plugin ${_(J)}`),le!=null&&(X=Xt(le,"errors",Y,J,void 0)),de!=null&&(ne=Xt(de,"warnings",Y,J,void 0))}}catch(x){X=[an(x,ie,Y,ge&&ge(),J)]}if(X){D.push(...X);try{ae.errors.push(...X)}catch{}}if(ne){H.push(...ne);try{ae.warnings.push(...ne)}catch{}}}K(D,H)})});let ye=()=>{for(const ae of Se)setTimeout(()=>ae(),0)};return Qe=!0,{ok:!0,requestPlugins:ve,runOnEndCallbacks:we,scheduleOnDisposeCallbacks:ye}});function hr(){const m=new Map;let w=0;return{clear(){m.clear()},load(S){return m.get(S)},store(S){if(S===void 0)return-1;const z=w++;return m.set(z,S),z}}}function Jn(m,w,S){let z,ie=!1;return()=>{if(ie)return z;ie=!0;try{let ce=(m.stack+"").split(`
`);ce.splice(1,1);let te=jr(w,ce,S);if(te)return z={text:m.message,location:te},z}catch{}}}function an(m,w,S,z,ie){let ce="Internal error",te=null;try{ce=(m&&m.message||m)+""}catch{}try{te=jr(w,(m.stack+"").split(`
`),"")}catch{}return{id:"",pluginName:ie,text:ce,location:te,notes:z?[z]:[],detail:S?S.store(m):-1}}function jr(m,w,S){let z="    at ";if(m.readFileSync&&!w[0].startsWith(z)&&w[1].startsWith(z))for(let ie=1;ie<w.length;ie++){let ce=w[ie];if(ce.startsWith(z))for(ce=ce.slice(z.length);;){let te=/^(?:new |async )?\S+ \((.*)\)$/.exec(ce);if(te){ce=te[1];continue}if(te=/^eval at \S+ \((.*)\)(?:, \S+:\d+:\d+)?$/.exec(ce),te){ce=te[1];continue}if(te=/^(\S+):(\d+):(\d+)$/.exec(ce),te){let xe;try{xe=m.readFileSync(te[1],"utf8")}catch{break}let Y=xe.split(/\r\n|\r|\n|\u2028|\u2029/)[+te[2]-1]||"",Pe=+te[3]-1,Fe=Y.slice(Pe,Pe+S.length)===S?S.length:0;return{file:te[1],namespace:"file",line:+te[2],column:C(Y.slice(0,Pe)).length,length:C(Y.slice(Pe,Pe+Fe)).length,lineText:Y+`
`+w.slice(1).join(`
`),suggestion:""}}break}}return null}function cn(m,w,S){let z=5;m+=w.length<1?"":` with ${w.length} error${w.length<2?"":"s"}:`+w.slice(0,z+1).map((ce,te)=>{if(te===z)return`
...`;if(!ce.location)return`
error: ${ce.text}`;let{file:xe,line:Y,column:Pe}=ce.location,Fe=ce.pluginName?`[plugin: ${ce.pluginName}] `:"";return`
${xe}:${Y}:${Pe}: ERROR: ${Fe}${ce.text}`}).join("");let ie=new Error(m);for(const[ce,te]of[["errors",w],["warnings",S]])Object.defineProperty(ie,ce,{configurable:!0,enumerable:!0,get:()=>te,set:xe=>Object.defineProperty(ie,ce,{configurable:!0,enumerable:!0,value:xe})});return ie}function gt(m,w){for(const S of m)S.detail=w.load(S.detail);return m}function ln(m,w,S){if(m==null)return null;let z={},ie=A(m,z,"file",b),ce=A(m,z,"namespace",b),te=A(m,z,"line",Q),xe=A(m,z,"column",Q),Y=A(m,z,"length",Q),Pe=A(m,z,"lineText",b),Fe=A(m,z,"suggestion",b);if(De(m,z,w),Pe){const Re=Pe.slice(0,(xe&&xe>0?xe:0)+(Y&&Y>0?Y:0)+(S&&S>0?S:80));!/[\x7F-\uFFFF]/.test(Re)&&!/\n/.test(Pe)&&(Pe=Re)}return{file:ie||"",namespace:ce||"",line:te||0,column:xe||0,length:Y||0,lineText:Pe||"",suggestion:Fe||""}}function Xt(m,w,S,z,ie){let ce=[],te=0;for(const xe of m){let Y={},Pe=A(xe,Y,"id",b),Fe=A(xe,Y,"pluginName",b),Re=A(xe,Y,"text",b),Be=A(xe,Y,"location",We),Se=A(xe,Y,"notes",Ee),Le=A(xe,Y,"detail",d),$e=`in element ${te} of "${w}"`;De(xe,Y,$e);let ve=[];if(Se)for(const Qe of Se){let we={},ye=A(Qe,we,"text",b),ae=A(Qe,we,"location",We);De(Qe,we,$e),ve.push({text:ye||"",location:ln(ae,$e,ie)})}ce.push({id:Pe||"",pluginName:Fe||z,text:Re||"",location:ln(Be,$e,ie),notes:ve,detail:S?S.store(Le):-1}),te++}return ce}function Vn(m,w){const S=[];for(const z of m){if(typeof z!="string")throw new Error(`${_(w)} must be an array of strings`);S.push(z)}return S}function ys(m,w){const S=Object.create(null);for(const z in m){const ie=m[z];if(typeof ie!="string")throw new Error(`key ${_(z)} in object ${_(w)} must be a string`);S[z]=ie}return S}function Ts({path:m,contents:w,hash:S}){let z=null;return{path:m,contents:w,hash:S,get text(){const ie=this.contents;return(z===null||ie!==w)&&(w=ie,z=G(ie)),z}}}function un(m){let w=m.source;return m.flags&&(w=`(?${m.flags})${w}`),w}var dr="0.25.11",Gn=m=>Ue().build(m),Pn=m=>Ue().context(m),fn=(m,w)=>Ue().transform(m,w),Zn=(m,w)=>Ue().formatMessages(m,w),Br=(m,w)=>Ue().analyzeMetafile(m,w),Qn=()=>{throw new Error('The "buildSync" API only works in node')},hn=()=>{throw new Error('The "transformSync" API only works in node')},xs=()=>{throw new Error('The "formatMessagesSync" API only works in node')},vs=()=>{throw new Error('The "analyzeMetafileSync" API only works in node')},Es=()=>(ot&&ot(),Promise.resolve()),nn,ot,Kt,Ue=()=>{if(Kt)return Kt;throw nn?new Error('You need to wait for the promise returned from "initialize" to be resolved before calling this'):new Error('You need to call "initialize" before calling this')},ws=m=>{m=Dn(m||{});let w=m.wasmURL,S=m.wasmModule,z=m.worker!==!1;if(!w&&!S)throw new Error('Must provide either the "wasmURL" option or the "wasmModule" option');if(nn)throw new Error('Cannot call "initialize" more than once');return nn=jt(w||"",S,z),nn.catch(()=>{nn=void 0}),nn},jt=(m,w,S)=>h(null,null,function*(){let z,ie;const ce=new Promise(Re=>ie=Re);if(S){let Re=new Blob([`onmessage=((postMessage) => {
      // Copyright 2018 The Go Authors. All rights reserved.
      // Use of this source code is governed by a BSD-style
      // license that can be found in the LICENSE file.
      var __async = (__this, __arguments, generator) => {
        return new Promise((resolve, reject) => {
          var fulfilled = (value) => {
            try {
              step(generator.next(value));
            } catch (e) {
              reject(e);
            }
          };
          var rejected = (value) => {
            try {
              step(generator.throw(value));
            } catch (e) {
              reject(e);
            }
          };
          var step = (x) => x.done ? resolve(x.value) : Promise.resolve(x.value).then(fulfilled, rejected);
          step((generator = generator.apply(__this, __arguments)).next());
        });
      };
      let onmessage;
      let globalThis = {};
      for (let o = self; o; o = Object.getPrototypeOf(o))
        for (let k of Object.getOwnPropertyNames(o))
          if (!(k in globalThis))
            Object.defineProperty(globalThis, k, { get: () => self[k] });
      "use strict";
      (() => {
        const enosys = () => {
          const err = new Error("not implemented");
          err.code = "ENOSYS";
          return err;
        };
        if (!globalThis.fs) {
          let outputBuf = "";
          globalThis.fs = {
            constants: { O_WRONLY: -1, O_RDWR: -1, O_CREAT: -1, O_TRUNC: -1, O_APPEND: -1, O_EXCL: -1 },
            // unused
            writeSync(fd, buf) {
              outputBuf += decoder.decode(buf);
              const nl = outputBuf.lastIndexOf("\\n");
              if (nl != -1) {
                console.log(outputBuf.substring(0, nl));
                outputBuf = outputBuf.substring(nl + 1);
              }
              return buf.length;
            },
            write(fd, buf, offset, length, position, callback) {
              if (offset !== 0 || length !== buf.length || position !== null) {
                callback(enosys());
                return;
              }
              const n = this.writeSync(fd, buf);
              callback(null, n);
            },
            chmod(path, mode, callback) {
              callback(enosys());
            },
            chown(path, uid, gid, callback) {
              callback(enosys());
            },
            close(fd, callback) {
              callback(enosys());
            },
            fchmod(fd, mode, callback) {
              callback(enosys());
            },
            fchown(fd, uid, gid, callback) {
              callback(enosys());
            },
            fstat(fd, callback) {
              callback(enosys());
            },
            fsync(fd, callback) {
              callback(null);
            },
            ftruncate(fd, length, callback) {
              callback(enosys());
            },
            lchown(path, uid, gid, callback) {
              callback(enosys());
            },
            link(path, link, callback) {
              callback(enosys());
            },
            lstat(path, callback) {
              callback(enosys());
            },
            mkdir(path, perm, callback) {
              callback(enosys());
            },
            open(path, flags, mode, callback) {
              callback(enosys());
            },
            read(fd, buffer, offset, length, position, callback) {
              callback(enosys());
            },
            readdir(path, callback) {
              callback(enosys());
            },
            readlink(path, callback) {
              callback(enosys());
            },
            rename(from, to, callback) {
              callback(enosys());
            },
            rmdir(path, callback) {
              callback(enosys());
            },
            stat(path, callback) {
              callback(enosys());
            },
            symlink(path, link, callback) {
              callback(enosys());
            },
            truncate(path, length, callback) {
              callback(enosys());
            },
            unlink(path, callback) {
              callback(enosys());
            },
            utimes(path, atime, mtime, callback) {
              callback(enosys());
            }
          };
        }
        if (!globalThis.process) {
          globalThis.process = {
            getuid() {
              return -1;
            },
            getgid() {
              return -1;
            },
            geteuid() {
              return -1;
            },
            getegid() {
              return -1;
            },
            getgroups() {
              throw enosys();
            },
            pid: -1,
            ppid: -1,
            umask() {
              throw enosys();
            },
            cwd() {
              throw enosys();
            },
            chdir() {
              throw enosys();
            }
          };
        }
        if (!globalThis.crypto) {
          throw new Error("globalThis.crypto is not available, polyfill required (crypto.getRandomValues only)");
        }
        if (!globalThis.performance) {
          throw new Error("globalThis.performance is not available, polyfill required (performance.now only)");
        }
        if (!globalThis.TextEncoder) {
          throw new Error("globalThis.TextEncoder is not available, polyfill required");
        }
        if (!globalThis.TextDecoder) {
          throw new Error("globalThis.TextDecoder is not available, polyfill required");
        }
        const encoder = new TextEncoder("utf-8");
        const decoder = new TextDecoder("utf-8");
        globalThis.Go = class {
          constructor() {
            this.argv = ["js"];
            this.env = {};
            this.exit = (code) => {
              if (code !== 0) {
                console.warn("exit code:", code);
              }
            };
            this._exitPromise = new Promise((resolve) => {
              this._resolveExitPromise = resolve;
            });
            this._pendingEvent = null;
            this._scheduledTimeouts = /* @__PURE__ */ new Map();
            this._nextCallbackTimeoutID = 1;
            const setInt64 = (addr, v) => {
              this.mem.setUint32(addr + 0, v, true);
              this.mem.setUint32(addr + 4, Math.floor(v / 4294967296), true);
            };
            const setInt32 = (addr, v) => {
              this.mem.setUint32(addr + 0, v, true);
            };
            const getInt64 = (addr) => {
              const low = this.mem.getUint32(addr + 0, true);
              const high = this.mem.getInt32(addr + 4, true);
              return low + high * 4294967296;
            };
            const loadValue = (addr) => {
              const f = this.mem.getFloat64(addr, true);
              if (f === 0) {
                return void 0;
              }
              if (!isNaN(f)) {
                return f;
              }
              const id = this.mem.getUint32(addr, true);
              return this._values[id];
            };
            const storeValue = (addr, v) => {
              const nanHead = 2146959360;
              if (typeof v === "number" && v !== 0) {
                if (isNaN(v)) {
                  this.mem.setUint32(addr + 4, nanHead, true);
                  this.mem.setUint32(addr, 0, true);
                  return;
                }
                this.mem.setFloat64(addr, v, true);
                return;
              }
              if (v === void 0) {
                this.mem.setFloat64(addr, 0, true);
                return;
              }
              let id = this._ids.get(v);
              if (id === void 0) {
                id = this._idPool.pop();
                if (id === void 0) {
                  id = this._values.length;
                }
                this._values[id] = v;
                this._goRefCounts[id] = 0;
                this._ids.set(v, id);
              }
              this._goRefCounts[id]++;
              let typeFlag = 0;
              switch (typeof v) {
                case "object":
                  if (v !== null) {
                    typeFlag = 1;
                  }
                  break;
                case "string":
                  typeFlag = 2;
                  break;
                case "symbol":
                  typeFlag = 3;
                  break;
                case "function":
                  typeFlag = 4;
                  break;
              }
              this.mem.setUint32(addr + 4, nanHead | typeFlag, true);
              this.mem.setUint32(addr, id, true);
            };
            const loadSlice = (addr) => {
              const array = getInt64(addr + 0);
              const len = getInt64(addr + 8);
              return new Uint8Array(this._inst.exports.mem.buffer, array, len);
            };
            const loadSliceOfValues = (addr) => {
              const array = getInt64(addr + 0);
              const len = getInt64(addr + 8);
              const a = new Array(len);
              for (let i = 0; i < len; i++) {
                a[i] = loadValue(array + i * 8);
              }
              return a;
            };
            const loadString = (addr) => {
              const saddr = getInt64(addr + 0);
              const len = getInt64(addr + 8);
              return decoder.decode(new DataView(this._inst.exports.mem.buffer, saddr, len));
            };
            const timeOrigin = Date.now() - performance.now();
            this.importObject = {
              _gotest: {
                add: (a, b) => a + b
              },
              gojs: {
                // Go's SP does not change as long as no Go code is running. Some operations (e.g. calls, getters and setters)
                // may synchronously trigger a Go event handler. This makes Go code get executed in the middle of the imported
                // function. A goroutine can switch to a new stack if the current stack is too small (see morestack function).
                // This changes the SP, thus we have to update the SP used by the imported function.
                // func wasmExit(code int32)
                "runtime.wasmExit": (sp) => {
                  sp >>>= 0;
                  const code = this.mem.getInt32(sp + 8, true);
                  this.exited = true;
                  delete this._inst;
                  delete this._values;
                  delete this._goRefCounts;
                  delete this._ids;
                  delete this._idPool;
                  this.exit(code);
                },
                // func wasmWrite(fd uintptr, p unsafe.Pointer, n int32)
                "runtime.wasmWrite": (sp) => {
                  sp >>>= 0;
                  const fd = getInt64(sp + 8);
                  const p = getInt64(sp + 16);
                  const n = this.mem.getInt32(sp + 24, true);
                  globalThis.fs.writeSync(fd, new Uint8Array(this._inst.exports.mem.buffer, p, n));
                },
                // func resetMemoryDataView()
                "runtime.resetMemoryDataView": (sp) => {
                  sp >>>= 0;
                  this.mem = new DataView(this._inst.exports.mem.buffer);
                },
                // func nanotime1() int64
                "runtime.nanotime1": (sp) => {
                  sp >>>= 0;
                  setInt64(sp + 8, (timeOrigin + performance.now()) * 1e6);
                },
                // func walltime() (sec int64, nsec int32)
                "runtime.walltime": (sp) => {
                  sp >>>= 0;
                  const msec = (/* @__PURE__ */ new Date()).getTime();
                  setInt64(sp + 8, msec / 1e3);
                  this.mem.setInt32(sp + 16, msec % 1e3 * 1e6, true);
                },
                // func scheduleTimeoutEvent(delay int64) int32
                "runtime.scheduleTimeoutEvent": (sp) => {
                  sp >>>= 0;
                  const id = this._nextCallbackTimeoutID;
                  this._nextCallbackTimeoutID++;
                  this._scheduledTimeouts.set(id, setTimeout(
                    () => {
                      this._resume();
                      while (this._scheduledTimeouts.has(id)) {
                        console.warn("scheduleTimeoutEvent: missed timeout event");
                        this._resume();
                      }
                    },
                    getInt64(sp + 8)
                  ));
                  this.mem.setInt32(sp + 16, id, true);
                },
                // func clearTimeoutEvent(id int32)
                "runtime.clearTimeoutEvent": (sp) => {
                  sp >>>= 0;
                  const id = this.mem.getInt32(sp + 8, true);
                  clearTimeout(this._scheduledTimeouts.get(id));
                  this._scheduledTimeouts.delete(id);
                },
                // func getRandomData(r []byte)
                "runtime.getRandomData": (sp) => {
                  sp >>>= 0;
                  crypto.getRandomValues(loadSlice(sp + 8));
                },
                // func finalizeRef(v ref)
                "syscall/js.finalizeRef": (sp) => {
                  sp >>>= 0;
                  const id = this.mem.getUint32(sp + 8, true);
                  this._goRefCounts[id]--;
                  if (this._goRefCounts[id] === 0) {
                    const v = this._values[id];
                    this._values[id] = null;
                    this._ids.delete(v);
                    this._idPool.push(id);
                  }
                },
                // func stringVal(value string) ref
                "syscall/js.stringVal": (sp) => {
                  sp >>>= 0;
                  storeValue(sp + 24, loadString(sp + 8));
                },
                // func valueGet(v ref, p string) ref
                "syscall/js.valueGet": (sp) => {
                  sp >>>= 0;
                  const result = Reflect.get(loadValue(sp + 8), loadString(sp + 16));
                  sp = this._inst.exports.getsp() >>> 0;
                  storeValue(sp + 32, result);
                },
                // func valueSet(v ref, p string, x ref)
                "syscall/js.valueSet": (sp) => {
                  sp >>>= 0;
                  Reflect.set(loadValue(sp + 8), loadString(sp + 16), loadValue(sp + 32));
                },
                // func valueDelete(v ref, p string)
                "syscall/js.valueDelete": (sp) => {
                  sp >>>= 0;
                  Reflect.deleteProperty(loadValue(sp + 8), loadString(sp + 16));
                },
                // func valueIndex(v ref, i int) ref
                "syscall/js.valueIndex": (sp) => {
                  sp >>>= 0;
                  storeValue(sp + 24, Reflect.get(loadValue(sp + 8), getInt64(sp + 16)));
                },
                // valueSetIndex(v ref, i int, x ref)
                "syscall/js.valueSetIndex": (sp) => {
                  sp >>>= 0;
                  Reflect.set(loadValue(sp + 8), getInt64(sp + 16), loadValue(sp + 24));
                },
                // func valueCall(v ref, m string, args []ref) (ref, bool)
                "syscall/js.valueCall": (sp) => {
                  sp >>>= 0;
                  try {
                    const v = loadValue(sp + 8);
                    const m = Reflect.get(v, loadString(sp + 16));
                    const args = loadSliceOfValues(sp + 32);
                    const result = Reflect.apply(m, v, args);
                    sp = this._inst.exports.getsp() >>> 0;
                    storeValue(sp + 56, result);
                    this.mem.setUint8(sp + 64, 1);
                  } catch (err) {
                    sp = this._inst.exports.getsp() >>> 0;
                    storeValue(sp + 56, err);
                    this.mem.setUint8(sp + 64, 0);
                  }
                },
                // func valueInvoke(v ref, args []ref) (ref, bool)
                "syscall/js.valueInvoke": (sp) => {
                  sp >>>= 0;
                  try {
                    const v = loadValue(sp + 8);
                    const args = loadSliceOfValues(sp + 16);
                    const result = Reflect.apply(v, void 0, args);
                    sp = this._inst.exports.getsp() >>> 0;
                    storeValue(sp + 40, result);
                    this.mem.setUint8(sp + 48, 1);
                  } catch (err) {
                    sp = this._inst.exports.getsp() >>> 0;
                    storeValue(sp + 40, err);
                    this.mem.setUint8(sp + 48, 0);
                  }
                },
                // func valueNew(v ref, args []ref) (ref, bool)
                "syscall/js.valueNew": (sp) => {
                  sp >>>= 0;
                  try {
                    const v = loadValue(sp + 8);
                    const args = loadSliceOfValues(sp + 16);
                    const result = Reflect.construct(v, args);
                    sp = this._inst.exports.getsp() >>> 0;
                    storeValue(sp + 40, result);
                    this.mem.setUint8(sp + 48, 1);
                  } catch (err) {
                    sp = this._inst.exports.getsp() >>> 0;
                    storeValue(sp + 40, err);
                    this.mem.setUint8(sp + 48, 0);
                  }
                },
                // func valueLength(v ref) int
                "syscall/js.valueLength": (sp) => {
                  sp >>>= 0;
                  setInt64(sp + 16, parseInt(loadValue(sp + 8).length));
                },
                // valuePrepareString(v ref) (ref, int)
                "syscall/js.valuePrepareString": (sp) => {
                  sp >>>= 0;
                  const str = encoder.encode(String(loadValue(sp + 8)));
                  storeValue(sp + 16, str);
                  setInt64(sp + 24, str.length);
                },
                // valueLoadString(v ref, b []byte)
                "syscall/js.valueLoadString": (sp) => {
                  sp >>>= 0;
                  const str = loadValue(sp + 8);
                  loadSlice(sp + 16).set(str);
                },
                // func valueInstanceOf(v ref, t ref) bool
                "syscall/js.valueInstanceOf": (sp) => {
                  sp >>>= 0;
                  this.mem.setUint8(sp + 24, loadValue(sp + 8) instanceof loadValue(sp + 16) ? 1 : 0);
                },
                // func copyBytesToGo(dst []byte, src ref) (int, bool)
                "syscall/js.copyBytesToGo": (sp) => {
                  sp >>>= 0;
                  const dst = loadSlice(sp + 8);
                  const src = loadValue(sp + 32);
                  if (!(src instanceof Uint8Array || src instanceof Uint8ClampedArray)) {
                    this.mem.setUint8(sp + 48, 0);
                    return;
                  }
                  const toCopy = src.subarray(0, dst.length);
                  dst.set(toCopy);
                  setInt64(sp + 40, toCopy.length);
                  this.mem.setUint8(sp + 48, 1);
                },
                // func copyBytesToJS(dst ref, src []byte) (int, bool)
                "syscall/js.copyBytesToJS": (sp) => {
                  sp >>>= 0;
                  const dst = loadValue(sp + 8);
                  const src = loadSlice(sp + 16);
                  if (!(dst instanceof Uint8Array || dst instanceof Uint8ClampedArray)) {
                    this.mem.setUint8(sp + 48, 0);
                    return;
                  }
                  const toCopy = src.subarray(0, dst.length);
                  dst.set(toCopy);
                  setInt64(sp + 40, toCopy.length);
                  this.mem.setUint8(sp + 48, 1);
                },
                "debug": (value) => {
                  console.log(value);
                }
              }
            };
          }
          run(instance) {
            return __async(this, null, function* () {
              if (!(instance instanceof WebAssembly.Instance)) {
                throw new Error("Go.run: WebAssembly.Instance expected");
              }
              this._inst = instance;
              this.mem = new DataView(this._inst.exports.mem.buffer);
              this._values = [
                // JS values that Go currently has references to, indexed by reference id
                NaN,
                0,
                null,
                true,
                false,
                globalThis,
                this
              ];
              this._goRefCounts = new Array(this._values.length).fill(Infinity);
              this._ids = /* @__PURE__ */ new Map([
                // mapping from JS values to reference ids
                [0, 1],
                [null, 2],
                [true, 3],
                [false, 4],
                [globalThis, 5],
                [this, 6]
              ]);
              this._idPool = [];
              this.exited = false;
              let offset = 4096;
              const strPtr = (str) => {
                const ptr = offset;
                const bytes = encoder.encode(str + "\\0");
                new Uint8Array(this.mem.buffer, offset, bytes.length).set(bytes);
                offset += bytes.length;
                if (offset % 8 !== 0) {
                  offset += 8 - offset % 8;
                }
                return ptr;
              };
              const argc = this.argv.length;
              const argvPtrs = [];
              this.argv.forEach((arg) => {
                argvPtrs.push(strPtr(arg));
              });
              argvPtrs.push(0);
              const keys = Object.keys(this.env).sort();
              keys.forEach((key) => {
                argvPtrs.push(strPtr(\`\${key}=\${this.env[key]}\`));
              });
              argvPtrs.push(0);
              const argv = offset;
              argvPtrs.forEach((ptr) => {
                this.mem.setUint32(offset, ptr, true);
                this.mem.setUint32(offset + 4, 0, true);
                offset += 8;
              });
              const wasmMinDataAddr = 4096 + 8192;
              if (offset >= wasmMinDataAddr) {
                throw new Error("total length of command line and environment variables exceeds limit");
              }
              this._inst.exports.run(argc, argv);
              if (this.exited) {
                this._resolveExitPromise();
              }
              yield this._exitPromise;
            });
          }
          _resume() {
            if (this.exited) {
              throw new Error("Go program has already exited");
            }
            this._inst.exports.resume();
            if (this.exited) {
              this._resolveExitPromise();
            }
          }
          _makeFuncWrapper(id) {
            const go = this;
            return function() {
              const event = { id, this: this, args: arguments };
              go._pendingEvent = event;
              go._resume();
              return event.result;
            };
          }
        };
      })();
      onmessage = ({ data: wasm }) => {
        let decoder = new TextDecoder();
        let fs = globalThis.fs;
        let stderr = "";
        fs.writeSync = (fd, buffer) => {
          if (fd === 1) {
            postMessage(buffer);
          } else if (fd === 2) {
            stderr += decoder.decode(buffer);
            let parts = stderr.split("\\n");
            if (parts.length > 1) console.log(parts.slice(0, -1).join("\\n"));
            stderr = parts[parts.length - 1];
          } else {
            throw new Error("Bad write");
          }
          return buffer.length;
        };
        let stdin = [];
        let resumeStdin;
        let stdinPos = 0;
        onmessage = ({ data }) => {
          if (data.length > 0) {
            stdin.push(data);
            if (resumeStdin) resumeStdin();
          }
          return go;
        };
        fs.read = (fd, buffer, offset, length, position, callback) => {
          if (fd !== 0 || offset !== 0 || length !== buffer.length || position !== null) {
            throw new Error("Bad read");
          }
          if (stdin.length === 0) {
            resumeStdin = () => fs.read(fd, buffer, offset, length, position, callback);
            return;
          }
          let first = stdin[0];
          let count = Math.max(0, Math.min(length, first.length - stdinPos));
          buffer.set(first.subarray(stdinPos, stdinPos + count), offset);
          stdinPos += count;
          if (stdinPos === first.length) {
            stdin.shift();
            stdinPos = 0;
          }
          callback(null, count);
        };
        let go = new globalThis.Go();
        go.argv = ["", \`--service=\${"0.25.11"}\`];
        tryToInstantiateModule(wasm, go).then(
          (instance) => {
            postMessage(null);
            go.run(instance);
          },
          (error) => {
            postMessage(error);
          }
        );
        return go;
      };
      function tryToInstantiateModule(wasm, go) {
        return __async(this, null, function* () {
          if (wasm instanceof WebAssembly.Module) {
            return WebAssembly.instantiate(wasm, go.importObject);
          }
          const res = yield fetch(wasm);
          if (!res.ok) throw new Error(\`Failed to download \${JSON.stringify(wasm)}\`);
          if ("instantiateStreaming" in WebAssembly && /^application\\/wasm($|;)/i.test(res.headers.get("Content-Type") || "")) {
            const result2 = yield WebAssembly.instantiateStreaming(res, go.importObject);
            return result2.instance;
          }
          const bytes = yield res.arrayBuffer();
          const result = yield WebAssembly.instantiate(bytes, go.importObject);
          return result.instance;
        });
      }
      return (m) => onmessage(m);
    })(postMessage)`],{type:"text/javascript"});z=new Worker(URL.createObjectURL(Re))}else{let Re=(Se=>{var Le=(we,ye,ae)=>new Promise((K,D)=>{var H=ge=>{try{he(ae.next(ge))}catch(X){D(X)}},J=ge=>{try{he(ae.throw(ge))}catch(X){D(X)}},he=ge=>ge.done?K(ge.value):Promise.resolve(ge.value).then(H,J);he((ae=ae.apply(we,ye)).next())});let $e,ve={};for(let we=self;we;we=Object.getPrototypeOf(we))for(let ye of Object.getOwnPropertyNames(we))ye in ve||Object.defineProperty(ve,ye,{get:()=>self[ye]});(()=>{const we=()=>{const K=new Error("not implemented");return K.code="ENOSYS",K};if(!ve.fs){let K="";ve.fs={constants:{O_WRONLY:-1,O_RDWR:-1,O_CREAT:-1,O_TRUNC:-1,O_APPEND:-1,O_EXCL:-1},writeSync(D,H){K+=ae.decode(H);const J=K.lastIndexOf(`
`);return J!=-1&&(console.log(K.substring(0,J)),K=K.substring(J+1)),H.length},write(D,H,J,he,ge,X){if(J!==0||he!==H.length||ge!==null){X(we());return}const ne=this.writeSync(D,H);X(null,ne)},chmod(D,H,J){J(we())},chown(D,H,J,he){he(we())},close(D,H){H(we())},fchmod(D,H,J){J(we())},fchown(D,H,J,he){he(we())},fstat(D,H){H(we())},fsync(D,H){H(null)},ftruncate(D,H,J){J(we())},lchown(D,H,J,he){he(we())},link(D,H,J){J(we())},lstat(D,H){H(we())},mkdir(D,H,J){J(we())},open(D,H,J,he){he(we())},read(D,H,J,he,ge,X){X(we())},readdir(D,H){H(we())},readlink(D,H){H(we())},rename(D,H,J){J(we())},rmdir(D,H){H(we())},stat(D,H){H(we())},symlink(D,H,J){J(we())},truncate(D,H,J){J(we())},unlink(D,H){H(we())},utimes(D,H,J,he){he(we())}}}if(ve.process||(ve.process={getuid(){return-1},getgid(){return-1},geteuid(){return-1},getegid(){return-1},getgroups(){throw we()},pid:-1,ppid:-1,umask(){throw we()},cwd(){throw we()},chdir(){throw we()}}),!ve.crypto)throw new Error("globalThis.crypto is not available, polyfill required (crypto.getRandomValues only)");if(!ve.performance)throw new Error("globalThis.performance is not available, polyfill required (performance.now only)");if(!ve.TextEncoder)throw new Error("globalThis.TextEncoder is not available, polyfill required");if(!ve.TextDecoder)throw new Error("globalThis.TextDecoder is not available, polyfill required");const ye=new TextEncoder("utf-8"),ae=new TextDecoder("utf-8");ve.Go=class{constructor(){this.argv=["js"],this.env={},this.exit=x=>{x!==0&&console.warn("exit code:",x)},this._exitPromise=new Promise(x=>{this._resolveExitPromise=x}),this._pendingEvent=null,this._scheduledTimeouts=new Map,this._nextCallbackTimeoutID=1;const K=(x,L)=>{this.mem.setUint32(x+0,L,!0),this.mem.setUint32(x+4,Math.floor(L/4294967296),!0)},D=x=>{const L=this.mem.getUint32(x+0,!0),le=this.mem.getInt32(x+4,!0);return L+le*4294967296},H=x=>{const L=this.mem.getFloat64(x,!0);if(L===0)return;if(!isNaN(L))return L;const le=this.mem.getUint32(x,!0);return this._values[le]},J=(x,L)=>{if(typeof L=="number"&&L!==0){if(isNaN(L)){this.mem.setUint32(x+4,2146959360,!0),this.mem.setUint32(x,0,!0);return}this.mem.setFloat64(x,L,!0);return}if(L===void 0){this.mem.setFloat64(x,0,!0);return}let de=this._ids.get(L);de===void 0&&(de=this._idPool.pop(),de===void 0&&(de=this._values.length),this._values[de]=L,this._goRefCounts[de]=0,this._ids.set(L,de)),this._goRefCounts[de]++;let _e=0;switch(typeof L){case"object":L!==null&&(_e=1);break;case"string":_e=2;break;case"symbol":_e=3;break;case"function":_e=4;break}this.mem.setUint32(x+4,2146959360|_e,!0),this.mem.setUint32(x,de,!0)},he=x=>{const L=D(x+0),le=D(x+8);return new Uint8Array(this._inst.exports.mem.buffer,L,le)},ge=x=>{const L=D(x+0),le=D(x+8),de=new Array(le);for(let _e=0;_e<le;_e++)de[_e]=H(L+_e*8);return de},X=x=>{const L=D(x+0),le=D(x+8);return ae.decode(new DataView(this._inst.exports.mem.buffer,L,le))},ne=Date.now()-performance.now();this.importObject={_gotest:{add:(x,L)=>x+L},gojs:{"runtime.wasmExit":x=>{x>>>=0;const L=this.mem.getInt32(x+8,!0);this.exited=!0,delete this._inst,delete this._values,delete this._goRefCounts,delete this._ids,delete this._idPool,this.exit(L)},"runtime.wasmWrite":x=>{x>>>=0;const L=D(x+8),le=D(x+16),de=this.mem.getInt32(x+24,!0);ve.fs.writeSync(L,new Uint8Array(this._inst.exports.mem.buffer,le,de))},"runtime.resetMemoryDataView":x=>{this.mem=new DataView(this._inst.exports.mem.buffer)},"runtime.nanotime1":x=>{x>>>=0,K(x+8,(ne+performance.now())*1e6)},"runtime.walltime":x=>{x>>>=0;const L=new Date().getTime();K(x+8,L/1e3),this.mem.setInt32(x+16,L%1e3*1e6,!0)},"runtime.scheduleTimeoutEvent":x=>{x>>>=0;const L=this._nextCallbackTimeoutID;this._nextCallbackTimeoutID++,this._scheduledTimeouts.set(L,setTimeout(()=>{for(this._resume();this._scheduledTimeouts.has(L);)console.warn("scheduleTimeoutEvent: missed timeout event"),this._resume()},D(x+8))),this.mem.setInt32(x+16,L,!0)},"runtime.clearTimeoutEvent":x=>{x>>>=0;const L=this.mem.getInt32(x+8,!0);clearTimeout(this._scheduledTimeouts.get(L)),this._scheduledTimeouts.delete(L)},"runtime.getRandomData":x=>{x>>>=0,crypto.getRandomValues(he(x+8))},"syscall/js.finalizeRef":x=>{x>>>=0;const L=this.mem.getUint32(x+8,!0);if(this._goRefCounts[L]--,this._goRefCounts[L]===0){const le=this._values[L];this._values[L]=null,this._ids.delete(le),this._idPool.push(L)}},"syscall/js.stringVal":x=>{x>>>=0,J(x+24,X(x+8))},"syscall/js.valueGet":x=>{x>>>=0;const L=Reflect.get(H(x+8),X(x+16));x=this._inst.exports.getsp()>>>0,J(x+32,L)},"syscall/js.valueSet":x=>{x>>>=0,Reflect.set(H(x+8),X(x+16),H(x+32))},"syscall/js.valueDelete":x=>{x>>>=0,Reflect.deleteProperty(H(x+8),X(x+16))},"syscall/js.valueIndex":x=>{x>>>=0,J(x+24,Reflect.get(H(x+8),D(x+16)))},"syscall/js.valueSetIndex":x=>{x>>>=0,Reflect.set(H(x+8),D(x+16),H(x+24))},"syscall/js.valueCall":x=>{x>>>=0;try{const L=H(x+8),le=Reflect.get(L,X(x+16)),de=ge(x+32),_e=Reflect.apply(le,L,de);x=this._inst.exports.getsp()>>>0,J(x+56,_e),this.mem.setUint8(x+64,1)}catch(L){x=this._inst.exports.getsp()>>>0,J(x+56,L),this.mem.setUint8(x+64,0)}},"syscall/js.valueInvoke":x=>{x>>>=0;try{const L=H(x+8),le=ge(x+16),de=Reflect.apply(L,void 0,le);x=this._inst.exports.getsp()>>>0,J(x+40,de),this.mem.setUint8(x+48,1)}catch(L){x=this._inst.exports.getsp()>>>0,J(x+40,L),this.mem.setUint8(x+48,0)}},"syscall/js.valueNew":x=>{x>>>=0;try{const L=H(x+8),le=ge(x+16),de=Reflect.construct(L,le);x=this._inst.exports.getsp()>>>0,J(x+40,de),this.mem.setUint8(x+48,1)}catch(L){x=this._inst.exports.getsp()>>>0,J(x+40,L),this.mem.setUint8(x+48,0)}},"syscall/js.valueLength":x=>{x>>>=0,K(x+16,parseInt(H(x+8).length))},"syscall/js.valuePrepareString":x=>{x>>>=0;const L=ye.encode(String(H(x+8)));J(x+16,L),K(x+24,L.length)},"syscall/js.valueLoadString":x=>{x>>>=0;const L=H(x+8);he(x+16).set(L)},"syscall/js.valueInstanceOf":x=>{x>>>=0,this.mem.setUint8(x+24,H(x+8)instanceof H(x+16)?1:0)},"syscall/js.copyBytesToGo":x=>{x>>>=0;const L=he(x+8),le=H(x+32);if(!(le instanceof Uint8Array||le instanceof Uint8ClampedArray)){this.mem.setUint8(x+48,0);return}const de=le.subarray(0,L.length);L.set(de),K(x+40,de.length),this.mem.setUint8(x+48,1)},"syscall/js.copyBytesToJS":x=>{x>>>=0;const L=H(x+8),le=he(x+16);if(!(L instanceof Uint8Array||L instanceof Uint8ClampedArray)){this.mem.setUint8(x+48,0);return}const de=le.subarray(0,L.length);L.set(de),K(x+40,de.length),this.mem.setUint8(x+48,1)},debug:x=>{console.log(x)}}}}run(K){return Le(this,null,function*(){if(!(K instanceof WebAssembly.Instance))throw new Error("Go.run: WebAssembly.Instance expected");this._inst=K,this.mem=new DataView(this._inst.exports.mem.buffer),this._values=[NaN,0,null,!0,!1,ve,this],this._goRefCounts=new Array(this._values.length).fill(1/0),this._ids=new Map([[0,1],[null,2],[!0,3],[!1,4],[ve,5],[this,6]]),this._idPool=[],this.exited=!1;let D=4096;const H=x=>{const L=D,le=ye.encode(x+"\0");return new Uint8Array(this.mem.buffer,D,le.length).set(le),D+=le.length,D%8!==0&&(D+=8-D%8),L},J=this.argv.length,he=[];this.argv.forEach(x=>{he.push(H(x))}),he.push(0),Object.keys(this.env).sort().forEach(x=>{he.push(H(`${x}=${this.env[x]}`))}),he.push(0);const X=D;if(he.forEach(x=>{this.mem.setUint32(D,x,!0),this.mem.setUint32(D+4,0,!0),D+=8}),D>=12288)throw new Error("total length of command line and environment variables exceeds limit");this._inst.exports.run(J,X),this.exited&&this._resolveExitPromise(),yield this._exitPromise})}_resume(){if(this.exited)throw new Error("Go program has already exited");this._inst.exports.resume(),this.exited&&this._resolveExitPromise()}_makeFuncWrapper(K){const D=this;return function(){const H={id:K,this:this,args:arguments};return D._pendingEvent=H,D._resume(),H.result}}}})(),$e=({data:we})=>{let ye=new TextDecoder,ae=ve.fs,K="";ae.writeSync=(ge,X)=>{if(ge===1)Se(X);else if(ge===2){K+=ye.decode(X);let ne=K.split(`
`);ne.length>1&&console.log(ne.slice(0,-1).join(`
`)),K=ne[ne.length-1]}else throw new Error("Bad write");return X.length};let D=[],H,J=0;$e=({data:ge})=>(ge.length>0&&(D.push(ge),H&&H()),he),ae.read=(ge,X,ne,x,L,le)=>{if(ge!==0||ne!==0||x!==X.length||L!==null)throw new Error("Bad read");if(D.length===0){H=()=>ae.read(ge,X,ne,x,L,le);return}let de=D[0],_e=Math.max(0,Math.min(x,de.length-J));X.set(de.subarray(J,J+_e),ne),J+=_e,J===de.length&&(D.shift(),J=0),le(null,_e)};let he=new ve.Go;return he.argv=["","--service=0.25.11"],Qe(we,he).then(ge=>{Se(null),he.run(ge)},ge=>{Se(ge)}),he};function Qe(we,ye){return Le(this,null,function*(){if(we instanceof WebAssembly.Module)return WebAssembly.instantiate(we,ye.importObject);const ae=yield fetch(we);if(!ae.ok)throw new Error(`Failed to download ${JSON.stringify(we)}`);if("instantiateStreaming"in WebAssembly&&/^application\/wasm($|;)/i.test(ae.headers.get("Content-Type")||""))return(yield WebAssembly.instantiateStreaming(ae,ye.importObject)).instance;const K=yield ae.arrayBuffer();return(yield WebAssembly.instantiate(K,ye.importObject)).instance})}return we=>$e(we)})(Se=>z.onmessage({data:Se})),Be;z={onmessage:null,postMessage:Se=>setTimeout(()=>{try{Be=Re({data:Se})}catch(Le){ie(Le)}}),terminate(){if(Be)for(let Se of Be._scheduledTimeouts.values())clearTimeout(Se)}}}let te,xe;const Y=new Promise((Re,Be)=>{te=Re,xe=Be});z.onmessage=({data:Re})=>{z.onmessage=({data:Be})=>Pe(Be),Re?xe(Re):te()},z.postMessage(w||new URL(m,location.href).toString());let{readFromStdout:Pe,service:Fe}=Ot({writeToStdin(Re){z.postMessage(Re)},isSync:!1,hasFS:!1,esbuild:y});yield Y,ot=()=>{z.terminate(),nn=void 0,ot=void 0,Kt=void 0},Kt={build:Re=>new Promise((Be,Se)=>{ce.then(Se),Fe.buildOrContext({callName:"build",refs:null,options:Re,isTTY:!1,defaultWD:"/",callback:(Le,$e)=>Le?Se(Le):Be($e)})}),context:Re=>new Promise((Be,Se)=>{ce.then(Se),Fe.buildOrContext({callName:"context",refs:null,options:Re,isTTY:!1,defaultWD:"/",callback:(Le,$e)=>Le?Se(Le):Be($e)})}),transform:(Re,Be)=>new Promise((Se,Le)=>{ce.then(Le),Fe.transform({callName:"transform",refs:null,input:Re,options:Be||{},isTTY:!1,fs:{readFile($e,ve){ve(new Error("Internal error"),null)},writeFile($e,ve){ve(null)}},callback:($e,ve)=>$e?Le($e):Se(ve)})}),formatMessages:(Re,Be)=>new Promise((Se,Le)=>{ce.then(Le),Fe.formatMessages({callName:"formatMessages",refs:null,messages:Re,options:Be,callback:($e,ve)=>$e?Le($e):Se(ve)})}),analyzeMetafile:(Re,Be)=>new Promise((Se,Le)=>{ce.then(Le),Fe.analyzeMetafile({callName:"analyzeMetafile",refs:null,metafile:typeof Re=="string"?Re:JSON.stringify(Re),options:Be,callback:($e,ve)=>$e?Le($e):Se(ve)})})}}),Bt=y})(r)})(Us)),Us.exports}var No=Vl();class Gl extends Error{location;error;manifoldStack;constructor(e,t){if(super(void 0,t),this.cause=e,this.error=e.errors[0],this.error.location){const{file:n,line:s,column:i}=this.error.location;this.manifoldStack=`${this.toString()}
    at ${n}:${s}:${i}`}}get name(){return"BundlerError"}get message(){return this.error.text}}class ks extends Error{manifoldStack;cause;constructor(e,t,n){super(t??e.message,n),this.cause=e}get name(){return this.cause.name}}var Hl=44,Ui="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",zl=new Uint8Array(64),Oo=new Uint8Array(128);for(let r=0;r<Ui.length;r++){const e=Ui.charCodeAt(r);zl[r]=e,Oo[e]=r}function mr(r,e){let t=0,n=0,s=0;do{const o=r.next();s=Oo[o],t|=(s&31)<<n,n+=5}while(s&32);const i=t&1;return t>>>=1,i&&(t=-2147483648|-t),e+t}function ki(r,e){return r.pos>=e?!1:r.peek()!==Hl}var Wl=class{constructor(r){this.pos=0,this.buffer=r}next(){return this.buffer.charCodeAt(this.pos++)}peek(){return this.buffer.charCodeAt(this.pos)}indexOf(r){const{buffer:e,pos:t}=this,n=e.indexOf(r,t);return n===-1?e.length:n}};function Xl(r){const{length:e}=r,t=new Wl(r),n=[];let s=0,i=0,o=0,a=0,u=0;do{const h=t.indexOf(";"),y=[];let v=!0,p=0;for(s=0;t.pos<h;){let T;s=mr(t,s),s<p&&(v=!1),p=s,ki(t,h)?(i=mr(t,i),o=mr(t,o),a=mr(t,a),ki(t,h)?(u=mr(t,u),T=[s,i,o,a,u]):T=[s,i,o,a]):T=[s],y.push(T),t.pos++}v||Kl(y),n.push(y),t.pos=h+1}while(t.pos<=e);return n}function Kl(r){r.sort(ql)}function ql(r,e){return r[0]-e[0]}var Yr={exports:{}},Yl=Yr.exports,ji;function Jl(){return ji||(ji=1,(function(r,e){(function(t,n){r.exports=n()})(Yl,(function(){const t=/^[\w+.-]+:\/\//,n=/^([\w+.-]+:)\/\/([^@/#?]*@)?([^:/#?]*)(:\d+)?(\/[^#?]*)?(\?[^#]*)?(#.*)?/,s=/^file:(?:\/\/((?![a-z]:)[^/#?]*)?)?(\/?[^#?]*)(\?[^#]*)?(#.*)?/i;function i(F){return t.test(F)}function o(F){return F.startsWith("//")}function a(F){return F.startsWith("/")}function u(F){return F.startsWith("file:")}function h(F){return/^[.?#]/.test(F)}function y(F){const _=n.exec(F);return p(_[1],_[2]||"",_[3],_[4]||"",_[5]||"/",_[6]||"",_[7]||"")}function v(F){const _=s.exec(F),N=_[2];return p("file:","",_[1]||"","",a(N)?N:"/"+N,_[3]||"",_[4]||"")}function p(F,_,N,P,B,d,R){return{scheme:F,user:_,host:N,port:P,path:B,query:d,hash:R,type:7}}function T(F){if(o(F)){const N=y("http:"+F);return N.scheme="",N.type=6,N}if(a(F)){const N=y("http://foo.com"+F);return N.scheme="",N.host="",N.type=5,N}if(u(F))return v(F);if(i(F))return y(F);const _=y("http://foo.com/"+F);return _.scheme="",_.host="",_.type=F?F.startsWith("?")?3:F.startsWith("#")?2:4:1,_}function C(F){if(F.endsWith("/.."))return F;const _=F.lastIndexOf("/");return F.slice(0,_+1)}function G(F,_){V(_,_.type),F.path==="/"?F.path=_.path:F.path=C(_.path)+F.path}function V(F,_){const N=_<=4,P=F.path.split("/");let B=1,d=0,R=!1;for(let $=1;$<P.length;$++){const Q=P[$];if(!Q){R=!0;continue}if(R=!1,Q!=="."){if(Q===".."){d?(R=!0,d--,B--):N&&(P[B++]=Q);continue}P[B++]=Q,d++}}let b="";for(let $=1;$<B;$++)b+="/"+P[$];(!b||R&&!b.endsWith("/.."))&&(b+="/"),F.path=b}function E(F,_){if(!F&&!_)return"";const N=T(F);let P=N.type;if(_&&P!==7){const d=T(_),R=d.type;switch(P){case 1:N.hash=d.hash;case 2:N.query=d.query;case 3:case 4:G(N,d);case 5:N.user=d.user,N.host=d.host,N.port=d.port;case 6:N.scheme=d.scheme}R>P&&(P=R)}V(N,P);const B=N.query+N.hash;switch(P){case 2:case 3:return B;case 4:{const d=N.path.slice(1);return d?h(_||F)&&!h(d)?"./"+d+B:d+B:B||"."}case 5:return N.path+B;default:return N.scheme+"//"+N.user+N.host+N.port+N.path+B}}return E}))})(Yr)),Yr.exports}var Zl=Jl(),Ql=Co(Zl);function eu(r){if(!r)return"";const e=r.lastIndexOf("/");return r.slice(0,e+1)}function tu(r,e){const t=eu(r),n=e?e+"/":"";return s=>Ql(n+(s||""),t)}var $n=0,nu=1,ru=2,su=3,iu=4;function ou(r,e){const t=Bi(r,0);if(t===r.length)return r;e||(r=r.slice());for(let n=t;n<r.length;n=Bi(r,n+1))r[n]=cu(r[n],e);return r}function Bi(r,e){for(let t=e;t<r.length;t++)if(!au(r[t]))return t;return r.length}function au(r){for(let e=1;e<r.length;e++)if(r[e][$n]<r[e-1][$n])return!1;return!0}function cu(r,e){return e||(r=r.slice()),r.sort(lu)}function lu(r,e){return r[$n]-e[$n]}var os=!1;function uu(r,e,t,n){for(;t<=n;){const s=t+(n-t>>1),i=r[s][$n]-e;if(i===0)return os=!0,s;i<0?t=s+1:n=s-1}return os=!1,t-1}function fu(r,e,t){for(let n=t+1;n<r.length&&r[n][$n]===e;t=n++);return t}function hu(r,e,t){for(let n=t-1;n>=0&&r[n][$n]===e;t=n--);return t}function du(){return{lastKey:-1,lastNeedle:-1,lastIndex:-1}}function pu(r,e,t,n){const{lastKey:s,lastNeedle:i,lastIndex:o}=t;let a=0,u=r.length-1;if(n===s){if(e===i)return os=o!==-1&&r[o][$n]===e,o;e>=i?a=o===-1?0:o:u=o}return t.lastKey=n,t.lastNeedle=e,t.lastIndex=uu(r,e,a,u)}function gu(r){return typeof r=="string"?JSON.parse(r):r}var mu="`line` must be greater than 0 (lines start at line 1)",yu="`column` must be greater than or equal to 0 (columns start at column 0)",Li=-1,Tu=1,xu=class{constructor(r,e){const t=typeof r=="string";if(!t&&r._decodedMemo)return r;const n=gu(r),{version:s,file:i,names:o,sourceRoot:a,sources:u,sourcesContent:h}=n;this.version=s,this.file=i,this.names=o||[],this.sourceRoot=a,this.sources=u,this.sourcesContent=h,this.ignoreList=n.ignoreList||n.x_google_ignoreList||void 0;const y=tu(e,a);this.resolvedSources=u.map(y);const{mappings:v}=n;if(typeof v=="string")this._encoded=v,this._decoded=void 0;else if(Array.isArray(v))this._encoded=void 0,this._decoded=ou(v,t);else throw n.sections?new Error("TraceMap passed sectioned source map, please use FlattenMap export instead"):new Error(`invalid source map: ${JSON.stringify(n)}`);this._decodedMemo=du(),this._bySources=void 0,this._bySourceMemos=void 0}};function vu(r){var e;return(e=r)._decoded||(e._decoded=Xl(r._encoded))}function Eu(r,e){let{line:t,column:n,bias:s}=e;if(t--,t<0)throw new Error(mu);if(n<0)throw new Error(yu);const i=vu(r);if(t>=i.length)return Xr(null,null,null,null);const o=i[t],a=wu(o,r._decodedMemo,t,n,s||Tu);if(a===-1)return Xr(null,null,null,null);const u=o[a];if(u.length===1)return Xr(null,null,null,null);const{names:h,resolvedSources:y}=r;return Xr(y[u[nu]],u[ru]+1,u[su],u.length===5?h[u[iu]]:null)}function Xr(r,e,t,n){return{source:r,line:e,column:t,name:n}}function wu(r,e,t,n,s){let i=pu(r,n,e,t);return os?i=(s===Li?fu:hu)(r,n,i):s===Li&&i++,i===-1||i===r.length?-1:i}var js={},$i;function bu(){return $i||($i=1,(function(r){Object.defineProperty(r,"commentRegex",{get:function(){return/^\s*?\/[\/\*][@#]\s+?sourceMappingURL=data:(((?:application|text)\/json)(?:;charset=([^;,]+?)?)?)?(?:;(base64))?,(.*?)$/mg}}),Object.defineProperty(r,"mapFileCommentRegex",{get:function(){return/(?:\/\/[@#][ \t]+?sourceMappingURL=([^\s'"`]+?)[ \t]*?$)|(?:\/\*[@#][ \t]+sourceMappingURL=([^*]+?)[ \t]*?(?:\*\/){1}[ \t]*?$)/mg}});var e;typeof Buffer<"u"?typeof Buffer.from=="function"?e=t:e=n:e=s;function t(p){return Buffer.from(p,"base64").toString()}function n(p){if(typeof value=="number")throw new TypeError("The value to decode must not be of type number.");return new Buffer(p,"base64").toString()}function s(p){return decodeURIComponent(escape(atob(p)))}function i(p){return p.split(",").pop()}function o(p,T){var C=r.mapFileCommentRegex.exec(p),G=C[1]||C[2];try{var p=T(G);return p!=null&&typeof p.catch=="function"?p.catch(V):p}catch(E){V(E)}function V(E){throw new Error("An error occurred while trying to read the map file at "+G+`
`+E.stack)}}function a(p,T){T=T||{},T.hasComment&&(p=i(p)),T.encoding==="base64"?p=e(p):T.encoding==="uri"&&(p=decodeURIComponent(p)),(T.isJSON||T.encoding)&&(p=JSON.parse(p)),this.sourcemap=p}a.prototype.toJSON=function(p){return JSON.stringify(this.sourcemap,null,p)},typeof Buffer<"u"?typeof Buffer.from=="function"?a.prototype.toBase64=u:a.prototype.toBase64=h:a.prototype.toBase64=y;function u(){var p=this.toJSON();return Buffer.from(p,"utf8").toString("base64")}function h(){var p=this.toJSON();if(typeof p=="number")throw new TypeError("The json to encode must not be of type number.");return new Buffer(p,"utf8").toString("base64")}function y(){var p=this.toJSON();return btoa(unescape(encodeURIComponent(p)))}a.prototype.toURI=function(){var p=this.toJSON();return encodeURIComponent(p)},a.prototype.toComment=function(p){var T,C,G;return p!=null&&p.encoding==="uri"?(T="",C=this.toURI()):(T=";base64",C=this.toBase64()),G="sourceMappingURL=data:application/json;charset=utf-8"+T+","+C,p!=null&&p.multiline?"/*# "+G+" */":"//# "+G},a.prototype.toObject=function(){return JSON.parse(this.toJSON())},a.prototype.addProperty=function(p,T){if(this.sourcemap.hasOwnProperty(p))throw new Error('property "'+p+'" already exists on the sourcemap, use set property instead');return this.setProperty(p,T)},a.prototype.setProperty=function(p,T){return this.sourcemap[p]=T,this},a.prototype.getProperty=function(p){return this.sourcemap[p]},r.fromObject=function(p){return new a(p)},r.fromJSON=function(p){return new a(p,{isJSON:!0})},r.fromURI=function(p){return new a(p,{encoding:"uri"})},r.fromBase64=function(p){return new a(p,{encoding:"base64"})},r.fromComment=function(p){var T,C;return p=p.replace(/^\/\*/g,"//").replace(/\*\/$/g,""),T=r.commentRegex.exec(p),C=T&&T[4]||"uri",new a(p,{encoding:C,hasComment:!0})};function v(p){return new a(p,{isJSON:!0})}r.fromMapFileComment=function(p,T){if(typeof T=="string")throw new Error("String directory paths are no longer supported with `fromMapFileComment`\nPlease review the Upgrading documentation at https://github.com/thlorenz/convert-source-map#upgrading");var C=o(p,T);return C!=null&&typeof C.then=="function"?C.then(v):v(C)},r.fromSource=function(p){var T=p.match(r.commentRegex);return T?r.fromComment(T.pop()):null},r.fromMapFileSource=function(p,T){if(typeof T=="string")throw new Error("String directory paths are no longer supported with `fromMapFileSource`\nPlease review the Upgrading documentation at https://github.com/thlorenz/convert-source-map#upgrading");var C=p.match(r.mapFileCommentRegex);return C?r.fromMapFileComment(C.pop(),T):null},r.removeComments=function(p){return p.replace(r.commentRegex,"")},r.removeMapFileComments=function(p){return p.replace(r.mapFileCommentRegex,"")},r.generateMapFileComment=function(p,T){var C="sourceMappingURL="+p;return T&&T.multiline?"/*# "+C+" */":"//# "+C}})(js)),js}var _u=bu(),Ru=Co(_u);const Iu=()=>typeof self<"u"&&typeof self.document>"u",Do=()=>typeof process<"u"&&!!process?.versions?.node,Su=r=>r.split(`
`).filter(e=>e.match(/<anonymous>/)).map(e=>{const t=e.matchAll(/:([0-9]+):([0-9]+)\)$/g).next().value,[n,s]=[parseInt(t[1]),parseInt(t[2])],i=e.match(/^\s+at\s([^\s]+)/)[1];return{line:n,column:s,methodName:i==="eval"?null:i}}),Au=r=>r.split(`
`).filter(e=>e.match(/AsyncFunction/)).map(e=>{const t=e.matchAll(/AsyncFunction:([0-9]+):([0-9]+)/g).next().value,[n,s]=[parseInt(t[1]),parseInt(t[2])],i=e.match(/^[^@]+/)[0];return{line:n,column:s,methodName:i==="anonymous"?null:i}}),Mu=r=>r.match(/^\s+at\s/gm)?Su(r):r.match(/^([^@]+)@/gm)?Au(r):[],Cu=(r,e,t=0)=>{const n=Ru.fromSource(r);if(!n||!e.stack)return e.stack;const s=Mu(e.stack);if(!s.length)return e.stack;const i=new xu(n.toObject()),o=s.map(a=>{if(a.line+t<1)return a;const{line:u,column:h,source:y}=Eu(i,{line:a.line+t,column:a.column}),{methodName:v}=a;return{line:u,column:h+1,file:y,methodName:v}});return[e.toString(),...o.map(a=>{const u=`${a.file}:${a.line}:${a.column}`;return a.methodName?`    at ${a.methodName} (${u})`:`    at ${u}`})].reduce((a,u)=>`${a}
${u}`)};let Jr=null,Po=!1;const Nu=r=>{Jr=r},Ou=r=>{Po=r},Du={"esm.sh":r=>`https://esm.sh/${r}`,jsDelivr:r=>`https://cdn.jsdelivr.net/npm/${r}/+esm`,skypack:r=>`https://cdn.skypack.dev/${r}`},Vi=(r,e)=>{if(!e)return r;const t=Du[e];return t?t(r):`${e}${r}`};function Pu(...r){typeof self<"u"&&self.console&&self.console.log(...r)}const Fu=(r={})=>({name:"esbuild-manifold-plugin",async setup(e){let t=null;const n="manifold-3d/manifoldCAD",s=/^manifold-3d\/manifoldCAD(.ts|.js)?$/,i=["Mesh","Manifold","CrossSection","setMinCircularAngle","setMinCircularEdgeLength","setCircularSegments","getCircularSegments","resetToCircularDefaults","triangulate","show","only","setMaterial","setMorphStart","setMorphEnd","GLTFNode","getGLTFNodes","resetGLTFNodes","isManifoldCAD"];Do()&&(async()=>{const{resolve:a,dirname:u}=await Promise.resolve().then(function(){return ls}),{fileURLToPath:h}=await Promise.resolve().then(function(){return ls}),y=__dirname??import.meta?.dirname??u(h(import.meta.url));t=a(y,"./manifoldCAD.ts")})();const o={};e.onResolve({filter:/.*/},async a=>{if(a.pluginData===o||a.namespace==="http-url"||a.path.match(/^https?:\/\//))return null;const u={toplevel:a.importer===r.filename||a.importer==="<stdin>"};if(a.path.match(s))return{namespace:"manifold-cad-globals",path:a.path,pluginData:u};if(r.files&&Object.keys(r.files).includes(a.path))return{namespace:"virtual-file",path:a.path};const h=await e.resolve(a.path,{resolveDir:a.resolveDir,kind:"import-statement",pluginData:o});return h.errors.length===0?t&&t===h.path?{namespace:"manifold-cad-globals",path:a.path,pluginData:u}:h:r.fetchRemotePackages!==!1&&r.jsCDN?{path:Vi(a.path,r.jsCDN),namespace:"http-url"}:null}),e.onLoad({filter:/.*/,namespace:"manifold-cad-globals"},a=>{const u=a.pluginData?.toplevel?"_manifold_cad_top_level":"_manifold_cad_library";return{contents:`export const {${i}} = ${u};`}}),e.onLoad({filter:/.*/,namespace:"virtual-file"},a=>({contents:r.files[a.path]})),r.fetchRemotePackages!==!1&&(e.onResolve({filter:/^https?:\/\//},a=>({path:a.path,namespace:"http-url"})),e.onResolve({filter:/.*/,namespace:"http-url"},a=>{const u=new URL(a.path,a.importer).toString();return u===Vi(n,r.jsCDN)?{path:u,namespace:"manifold-cad-globals",pluginData:{toplevel:!1}}:{path:u,namespace:"http-url"}}),e.onLoad({filter:/.*/,namespace:"http-url"},async a=>{const u=await fetch(a.path);return u.ok?(Pu(`Fetching ${a.path}.`),{contents:await u.text()}):{errors:[{text:await u.text()}]}}))}});let Gi=!1;const Uu=async(r={})=>{if(!Gi){const e={};typeof Jr=="string"&&Jr&&(e.wasmURL=Jr,e.worker=Po===!0),await No.initialize(e),Gi=!0}return{bundle:!0,write:!1,platform:"neutral",treeShaking:!1,sourcemap:"inline",sourcesContent:!1,format:"cjs",logLevel:"silent",plugins:[Fu(r)],logOverride:{"empty-import-meta":"info"}}},ku=async(r,e={})=>{try{let t;if(Do()&&e.filename){const{dirname:s}=await Promise.resolve().then(function(){return ls});t=s(e.filename)}return(await No.build({...await Uu(e),stdin:{contents:r,sourcefile:e.filename,resolveDir:t,loader:"ts"}})).outputFiles[0].text}catch(t){throw t.errors?.length?new Gl(t):t}},Fo=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],Uo=r=>{let e="";for(let t=0;t<16;t++)t%4!=3&&(t>0&&(e+=" "),e+=r[t]||0);return e},ju=(r=1,e=Fo)=>`    <item objectid="${r}" transform="${Uo(e)}" />
`,Hi=r=>r?r.toISOString().substring(0,10):"";function Bu(r,{unit:e="millimeter",title:t="jscad model",author:n="",description:s="",application:i="jscad",creationDate:o=new Date,license:a="",modificationDate:u}={}){r.push(`<?xml version="1.0" encoding="UTF-8"?>
<model unit="${e}" xml:lang="en-US" xmlns="http://schemas.microsoft.com/3dmanufacturing/core/2015/02" xmlns:slic3rpe="http://schemas.slic3r.org/3mf/2017/06">
  <metadata name="slic3rpe:Version3mf">1</metadata>
  <metadata name="Title">${t}</metadata>
  <metadata name="Designer">${n}</metadata>
  <metadata name="Description">${s||t}</metadata>
  <metadata name="Copyright"></metadata>
  <metadata name="LicenseTerms">${a}</metadata>
  <metadata name="Rating"></metadata>
  <metadata name="CreationDate">${Hi(o)}</metadata>
  <metadata name="ModificationDate">${Hi(u||o)}</metadata>
  <metadata name="Application">${i}</metadata>
   `)}function Lu(r,e,t,n){r.push(`<object id="${e}" type="model"${n==null?"":' name="'+n+'"'}>
`),r.push(` <components>
`),t.forEach(({objectID:s,transform:i})=>{$u(r,s,i)}),r.push(` </components>
`),r.push(`</object>
`)}const $u=(r,e=1,t=Fo)=>{r.push(`    <component objectid="${e}" transform="${Uo(t)}" />
`)};function Vu(r,e,t,n,s,i){r.push(`  <object id="${e}" type="model"${i?' name="'+i+'"':""}>
   <mesh>
    <vertices>
`);for(let o=0;o<t.length;o+=3)r.push(`     <vertex x="${t[o].toPrecision(s)}" y="${t[o+1].toPrecision(s)}" z="${t[o+2].toPrecision(s)}" />
`);r.push(`    </vertices>
    <triangles>
`);for(let o=0;o<n.length;o+=3)r.push(`     <triangle v1="${n[o]}" v2="${n[o+1]}" v3="${n[o+2]}" />
`);return r.push(`    </triangles>
   </mesh>
  </object>
`),r}const zi={name:"[Content_Types].xml",content:`<?xml version="1.0" encoding="UTF-8"?>
<Types xmlns="http://schemas.openxmlformats.org/package/2006/content-types">
<Default Extension="rels" ContentType="application/vnd.openxmlformats-package.relationships+xml" />
<Default Extension="model" ContentType="application/vnd.ms-package.3dmanufacturing-3dmodel+xml" />
<Default Extension="png" ContentType="image/png" />
</Types>`};function Gu({meshes:r=[],components:e=[],items:t=[],precision:n=17,header:s}){const i=[];return Bu(i,s),i.push(`  <resources>
`),t.length==0&&console.error("3MF empty build! Include items or simple."),r.forEach(({id:o,vertices:a,indices:u,name:h})=>Vu(i,o,a,u,n,h)),e.forEach(({id:o,children:a,name:u})=>{Lu(i,o,a,u)}),i.push(`  </resources>
`),i.push(`<build>
`),t.forEach(({objectID:o,transform:a})=>{i.push(ju(o,a))}),i.push(`</build>
`),i.push(`</model>
`),i.join("")}class Hu{constructor(){this.idSeq=0,this.lines=['<?xml version="1.0" encoding="UTF-8"?>','<Relationships xmlns="http://schemas.openxmlformats.org/package/2006/relationships">']}get name(){return"_rels/.rels"}addRel(e,t){this.lines.push(`  <Relationship Target="${e}" Id="rel-${++this.idSeq}" Type="${t}" />`)}add3dModel(e){this.addRel(e,"http://schemas.microsoft.com/3dmanufacturing/2013/01/3dmodel")}addThumbnail(e){this.addRel(e,"http://schemas.openxmlformats.org/package/2006/relationships/metadata/thumbnail")}get content(){return this.lines.join(`
`)+`
</Relationships>`}}var bt=Uint8Array,Ft=Uint16Array,oi=Int32Array,ai=new bt([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),ci=new bt([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Wi=new bt([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),ko=function(r,e){for(var t=new Ft(31),n=0;n<31;++n)t[n]=e+=1<<r[n-1];for(var s=new oi(t[30]),n=1;n<30;++n)for(var i=t[n];i<t[n+1];++i)s[i]=i-t[n]<<5|n;return{b:t,r:s}},jo=ko(ai,2),zu=jo.b,Xs=jo.r;zu[28]=258,Xs[258]=28;var Wu=ko(ci,0),Xi=Wu.r,Ks=new Ft(32768);for(var et=0;et<32768;++et){var Fn=(et&43690)>>1|(et&21845)<<1;Fn=(Fn&52428)>>2|(Fn&13107)<<2,Fn=(Fn&61680)>>4|(Fn&3855)<<4,Ks[et]=((Fn&65280)>>8|(Fn&255)<<8)>>1}var Sr=(function(r,e,t){for(var n=r.length,s=0,i=new Ft(e);s<n;++s)r[s]&&++i[r[s]-1];var o=new Ft(e);for(s=1;s<e;++s)o[s]=o[s-1]+i[s-1]<<1;var a;if(t){a=new Ft(1<<e);var u=15-e;for(s=0;s<n;++s)if(r[s])for(var h=s<<4|r[s],y=e-r[s],v=o[r[s]-1]++<<y,p=v|(1<<y)-1;v<=p;++v)a[Ks[v]>>u]=h}else for(a=new Ft(n),s=0;s<n;++s)r[s]&&(a[s]=Ks[o[r[s]-1]++]>>15-r[s]);return a}),qn=new bt(288);for(var et=0;et<144;++et)qn[et]=8;for(var et=144;et<256;++et)qn[et]=9;for(var et=256;et<280;++et)qn[et]=7;for(var et=280;et<288;++et)qn[et]=8;var as=new bt(32);for(var et=0;et<32;++et)as[et]=5;var Xu=Sr(qn,9,0),Ku=Sr(as,5,0),Bo=function(r){return(r+7)/8|0},Lo=function(r,e,t){return(t==null||t>r.length)&&(t=r.length),new bt(r.subarray(e,t))},qu=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],ps=function(r,e,t){var n=new Error(e||qu[r]);if(n.code=r,Error.captureStackTrace&&Error.captureStackTrace(n,ps),!t)throw n;return n},yn=function(r,e,t){t<<=e&7;var n=e/8|0;r[n]|=t,r[n+1]|=t>>8},yr=function(r,e,t){t<<=e&7;var n=e/8|0;r[n]|=t,r[n+1]|=t>>8,r[n+2]|=t>>16},Bs=function(r,e){for(var t=[],n=0;n<r.length;++n)r[n]&&t.push({s:n,f:r[n]});var s=t.length,i=t.slice();if(!s)return{t:Vo,l:0};if(s==1){var o=new bt(t[0].s+1);return o[t[0].s]=1,{t:o,l:1}}t.sort(function(P,B){return P.f-B.f}),t.push({s:-1,f:25001});var a=t[0],u=t[1],h=0,y=1,v=2;for(t[0]={s:-1,f:a.f+u.f,l:a,r:u};y!=s-1;)a=t[t[h].f<t[v].f?h++:v++],u=t[h!=y&&t[h].f<t[v].f?h++:v++],t[y++]={s:-1,f:a.f+u.f,l:a,r:u};for(var p=i[0].s,n=1;n<s;++n)i[n].s>p&&(p=i[n].s);var T=new Ft(p+1),C=qs(t[y-1],T,0);if(C>e){var n=0,G=0,V=C-e,E=1<<V;for(i.sort(function(B,d){return T[d.s]-T[B.s]||B.f-d.f});n<s;++n){var F=i[n].s;if(T[F]>e)G+=E-(1<<C-T[F]),T[F]=e;else break}for(G>>=V;G>0;){var _=i[n].s;T[_]<e?G-=1<<e-T[_]++-1:++n}for(;n>=0&&G;--n){var N=i[n].s;T[N]==e&&(--T[N],++G)}C=e}return{t:new bt(T),l:C}},qs=function(r,e,t){return r.s==-1?Math.max(qs(r.l,e,t+1),qs(r.r,e,t+1)):e[r.s]=t},Ki=function(r){for(var e=r.length;e&&!r[--e];);for(var t=new Ft(++e),n=0,s=r[0],i=1,o=function(u){t[n++]=u},a=1;a<=e;++a)if(r[a]==s&&a!=e)++i;else{if(!s&&i>2){for(;i>138;i-=138)o(32754);i>2&&(o(i>10?i-11<<5|28690:i-3<<5|12305),i=0)}else if(i>3){for(o(s),--i;i>6;i-=6)o(8304);i>2&&(o(i-3<<5|8208),i=0)}for(;i--;)o(s);i=1,s=r[a]}return{c:t.subarray(0,n),n:e}},Tr=function(r,e){for(var t=0,n=0;n<e.length;++n)t+=r[n]*e[n];return t},$o=function(r,e,t){var n=t.length,s=Bo(e+2);r[s]=n&255,r[s+1]=n>>8,r[s+2]=r[s]^255,r[s+3]=r[s+1]^255;for(var i=0;i<n;++i)r[s+i+4]=t[i];return(s+4+n)*8},qi=function(r,e,t,n,s,i,o,a,u,h,y){yn(e,y++,t),++s[256];for(var v=Bs(s,15),p=v.t,T=v.l,C=Bs(i,15),G=C.t,V=C.l,E=Ki(p),F=E.c,_=E.n,N=Ki(G),P=N.c,B=N.n,d=new Ft(19),R=0;R<F.length;++R)++d[F[R]&31];for(var R=0;R<P.length;++R)++d[P[R]&31];for(var b=Bs(d,7),$=b.t,Q=b.l,ee=19;ee>4&&!$[Wi[ee-1]];--ee);var fe=h+5<<3,Ee=Tr(s,qn)+Tr(i,as)+o,me=Tr(s,p)+Tr(i,G)+o+14+3*ee+Tr(d,$)+2*d[16]+3*d[17]+7*d[18];if(u>=0&&fe<=Ee&&fe<=me)return $o(e,y,r.subarray(u,u+h));var be,Ie,He,We;if(yn(e,y,1+(me<Ee)),y+=2,me<Ee){be=Sr(p,T,0),Ie=p,He=Sr(G,V,0),We=G;var kt=Sr($,Q,0);yn(e,y,_-257),yn(e,y+5,B-1),yn(e,y+10,ee-4),y+=14;for(var R=0;R<ee;++R)yn(e,y+3*R,$[Wi[R]]);y+=3*ee;for(var lt=[F,P],Tt=0;Tt<2;++Tt)for(var Et=lt[Tt],R=0;R<Et.length;++R){var tt=Et[R]&31;yn(e,y,kt[tt]),y+=$[tt],tt>15&&(yn(e,y,Et[R]>>5&127),y+=Et[R]>>12)}}else be=Xu,Ie=qn,He=Ku,We=as;for(var R=0;R<a;++R){var A=n[R];if(A>255){var tt=A>>18&31;yr(e,y,be[tt+257]),y+=Ie[tt+257],tt>7&&(yn(e,y,A>>23&31),y+=ai[tt]);var De=A&31;yr(e,y,He[De]),y+=We[De],De>3&&(yr(e,y,A>>5&8191),y+=ci[De])}else yr(e,y,be[A]),y+=Ie[A]}return yr(e,y,be[256]),y+Ie[256]},Yu=new oi([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),Vo=new bt(0),Ju=function(r,e,t,n,s,i){var o=i.z||r.length,a=new bt(n+o+5*(1+Math.ceil(o/7e3))+s),u=a.subarray(n,a.length-s),h=i.l,y=(i.r||0)&7;if(e){y&&(u[0]=i.r>>3);for(var v=Yu[e-1],p=v>>13,T=v&8191,C=(1<<t)-1,G=i.p||new Ft(32768),V=i.h||new Ft(C+1),E=Math.ceil(t/3),F=2*E,_=function(Ot){return(r[Ot]^r[Ot+1]<<E^r[Ot+2]<<F)&C},N=new oi(25e3),P=new Ft(288),B=new Ft(32),d=0,R=0,b=i.i||0,$=0,Q=i.w||0,ee=0;b+2<o;++b){var fe=_(b),Ee=b&32767,me=V[fe];if(G[Ee]=me,V[fe]=Ee,Q<=b){var be=o-b;if((d>7e3||$>24576)&&(be>423||!h)){y=qi(r,u,0,N,P,B,R,$,ee,b-ee,y),$=d=R=0,ee=b;for(var Ie=0;Ie<286;++Ie)P[Ie]=0;for(var Ie=0;Ie<30;++Ie)B[Ie]=0}var He=2,We=0,kt=T,lt=Ee-me&32767;if(be>2&&fe==_(b-lt))for(var Tt=Math.min(p,be)-1,Et=Math.min(32767,b),tt=Math.min(258,be);lt<=Et&&--kt&&Ee!=me;){if(r[b+He]==r[b+He-lt]){for(var A=0;A<tt&&r[b+A]==r[b+A-lt];++A);if(A>He){if(He=A,We=lt,A>Tt)break;for(var De=Math.min(lt,A-2),Dn=0,Ie=0;Ie<De;++Ie){var tn=b-lt+Ie&32767,_t=G[tn],Ve=tn-_t&32767;Ve>Dn&&(Dn=Ve,me=tn)}}}Ee=me,me=G[Ee],lt+=Ee-me&32767}if(We){N[$++]=268435456|Xs[He]<<18|Xi[We];var it=Xs[He]&31,Mt=Xi[We]&31;R+=ai[it]+ci[Mt],++P[257+it],++B[Mt],Q=b+He,++d}else N[$++]=r[b],++P[r[b]]}}for(b=Math.max(b,Q);b<o;++b)N[$++]=r[b],++P[r[b]];y=qi(r,u,h,N,P,B,R,$,ee,b-ee,y),h||(i.r=y&7|u[y/8|0]<<3,y-=7,i.h=V,i.p=G,i.i=b,i.w=Q)}else{for(var b=i.w||0;b<o+h;b+=65535){var on=b+65535;on>=o&&(u[y/8|0]=h,on=o),y=$o(u,y+1,r.subarray(b,on))}i.i=o}return Lo(a,0,n+Bo(y)+s)},Zu=(function(){for(var r=new Int32Array(256),e=0;e<256;++e){for(var t=e,n=9;--n;)t=(t&1&&-306674912)^t>>>1;r[e]=t}return r})(),Qu=function(){var r=-1;return{p:function(e){for(var t=r,n=0;n<e.length;++n)t=Zu[t&255^e[n]]^t>>>8;r=t},d:function(){return~r}}},ef=function(r,e,t,n,s){if(!s&&(s={l:1},e.dictionary)){var i=e.dictionary.subarray(-32768),o=new bt(i.length+r.length);o.set(i),o.set(r,i.length),r=o,s.w=i.length}return Ju(r,e.level==null?6:e.level,e.mem==null?s.l?Math.ceil(Math.max(8,Math.min(13,Math.log(r.length)))*1.5):20:12+e.mem,t,n,s)},Go=function(r,e){var t={};for(var n in r)t[n]=r[n];for(var n in e)t[n]=e[n];return t},vt=function(r,e,t){for(;t;++e)r[e]=t,t>>>=8};function tf(r,e){return ef(r,e||{},0,0)}var Ho=function(r,e,t,n){for(var s in r){var i=r[s],o=e+s,a=n;Array.isArray(i)&&(a=Go(n,i[1]),i=i[0]),i instanceof bt?t[o]=[i,a]:(t[o+="/"]=[new bt(0),a],Ho(i,o,t,n))}},Yi=typeof TextEncoder<"u"&&new TextEncoder,nf=typeof TextDecoder<"u"&&new TextDecoder,rf=0;try{nf.decode(Vo,{stream:!0}),rf=1}catch{}function Ar(r,e){var t;if(Yi)return Yi.encode(r);for(var n=r.length,s=new bt(r.length+(r.length>>1)),i=0,o=function(h){s[i++]=h},t=0;t<n;++t){if(i+5>s.length){var a=new bt(i+8+(n-t<<1));a.set(s),s=a}var u=r.charCodeAt(t);u<128||e?o(u):u<2048?(o(192|u>>6),o(128|u&63)):u>55295&&u<57344?(u=65536+(u&1047552)|r.charCodeAt(++t)&1023,o(240|u>>18),o(128|u>>12&63),o(128|u>>6&63),o(128|u&63)):(o(224|u>>12),o(128|u>>6&63),o(128|u&63))}return Lo(s,0,i)}var Ys=function(r){var e=0;if(r)for(var t in r){var n=r[t].length;n>65535&&ps(9),e+=n+4}return e},Ji=function(r,e,t,n,s,i,o,a){var u=n.length,h=t.extra,y=a&&a.length,v=Ys(h);vt(r,e,o!=null?33639248:67324752),e+=4,o!=null&&(r[e++]=20,r[e++]=t.os),r[e]=20,e+=2,r[e++]=t.flag<<1|(i<0&&8),r[e++]=s&&8,r[e++]=t.compression&255,r[e++]=t.compression>>8;var p=new Date(t.mtime==null?Date.now():t.mtime),T=p.getFullYear()-1980;if((T<0||T>119)&&ps(10),vt(r,e,T<<25|p.getMonth()+1<<21|p.getDate()<<16|p.getHours()<<11|p.getMinutes()<<5|p.getSeconds()>>1),e+=4,i!=-1&&(vt(r,e,t.crc),vt(r,e+4,i<0?-i-2:i),vt(r,e+8,t.size)),vt(r,e+12,u),vt(r,e+14,v),e+=16,o!=null&&(vt(r,e,y),vt(r,e+6,t.attrs),vt(r,e+10,o),e+=14),r.set(n,e),e+=u,v)for(var C in h){var G=h[C],V=G.length;vt(r,e,+C),vt(r,e+2,V),r.set(G,e+4),e+=4+V}return y&&(r.set(a,e),e+=y),e},sf=function(r,e,t,n,s){vt(r,e,101010256),vt(r,e+8,t),vt(r,e+10,t),vt(r,e+12,n),vt(r,e+16,s)};function of(r,e){e||(e={});var t={},n=[];Ho(r,"",t,e);var s=0,i=0;for(var o in t){var a=t[o],u=a[0],h=a[1],y=h.level==0?0:8,v=Ar(o),p=v.length,T=h.comment,C=T&&Ar(T),G=C&&C.length,V=Ys(h.extra);p>65535&&ps(11);var E=y?tf(u,h):u,F=E.length,_=Qu();_.p(u),n.push(Go(h,{size:u.length,crc:_.d(),c:E,f:v,m:C,u:p!=o.length||C&&T.length!=G,o:s,compression:y})),s+=30+p+V+F,i+=76+2*(p+V)+(G||0)+F}for(var N=new bt(i+22),P=s,B=i-s,d=0;d<n.length;++d){var v=n[d];Ji(N,v.o,v,v.f,v.u,v.c.length);var R=30+v.f.length+Ys(v.extra);N.set(v.c,v.o+R),Ji(N,s,v,v.f,v.u,v.c.length,v.o,v.m),s+=16+R+(v.m?v.m.length:0)}return sf(N,s,n.length,B,P),N}class af{extensions=["3mf"];unit="millimeter";title="ManifoldCAD.org model";author;description="ManifoldCAD.org model";application="ManifoldCAD.org";creationDate;license;modificationDate;async asBlob(e){const t={meshes:[],components:[],items:[],precision:7,header:{unit:this.unit,title:this.title,description:this.description,application:this.application,creationDate:this.creationDate,license:this.license,modificationDate:this.modificationDate}};let n=1;const s=new Map,i=T=>`${s.get(T)}`,o=T=>{const{clonedFrom:C}=T.getExtras();return C?s.get(C):s.get(T)},a=T=>{const C=`${n++}`;return s.set(T,C),C};for(const T of e.getRoot().listMeshes()){const C=T.getExtension("EXT_mesh_manifold");if(C){const V=C.getIndices(),E=T.listPrimitives()[0].getAttribute("POSITION"),F=a(T);t.meshes.push({vertices:E.getArray(),indices:V.getArray(),id:F})}const{clonedFrom:G}=T.getExtras();!C&&G||!C&&!G&&console.log("skipping non-ManifoldCAD mesh")}const u=e.getRoot().listNodes().reverse();for(const T of u){const C=T.getMesh()&&o(T.getMesh());t.components.push({id:a(T),name:T.getName(),children:C?[{objectID:C}]:[],transform:T.getMatrix().map(G=>G.toFixed(t.precision))})}for(const T of e.getRoot().listNodes()){const C=i(T);if(!C){console.log(`Could not find object ID for ${T.getName()}`);continue}const G={objectID:C,transform:T.getMatrix().map(E=>E.toFixed(t?.precision))},V=T.getParentNode();if(V){const E=i(V);t.components.find(_=>_.id==E).children.push(G)}else t.items.push({objectID:C})}const h=new Hu;h.add3dModel("3D/3dmodel.model");const y=Gu(t),v={};v["3D/3dmodel.model"]=Ar(y),v[zi.name]=Ar(zi.content),v[h.name]=Ar(h.content);const p=of(v);return new Blob([p],{type:"application/vnd.ms-package.3dmanufacturing-3dmodel+xml"})}}const cf=0,lf=0,uf=0,ff=2,hf=0,df=163,pf=166,gf=0,mf=2,yf=1,Tf=64,xf=0;function vf(){return{vkFormat:xf,typeSize:1,pixelWidth:0,pixelHeight:0,pixelDepth:0,layerCount:0,faceCount:1,levelCount:0,supercompressionScheme:cf,levels:[],dataFormatDescriptor:[{vendorId:uf,descriptorType:lf,versionNumber:ff,colorModel:hf,colorPrimaries:yf,transferFunction:mf,flags:gf,texelBlockDimension:[0,0,0,0],bytesPlane:[0,0,0,0,0,0,0,0],samples:[]}],keyValue:{},globalData:null}}class xr{constructor(e,t,n,s){this._dataView=void 0,this._littleEndian=void 0,this._offset=void 0,this._dataView=new DataView(e.buffer,e.byteOffset+t,n),this._littleEndian=s,this._offset=0}_nextUint8(){const e=this._dataView.getUint8(this._offset);return this._offset+=1,e}_nextUint16(){const e=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,e}_nextUint32(){const e=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint64(){const e=this._dataView.getUint32(this._offset,this._littleEndian),t=this._dataView.getUint32(this._offset+4,this._littleEndian),n=e+2**32*t;return this._offset+=8,n}_nextInt32(){const e=this._dataView.getInt32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint8Array(e){const t=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._offset,e);return this._offset+=e,t}_skip(e){return this._offset+=e,this}_scan(e,t=0){const n=this._offset;let s=0;for(;this._dataView.getUint8(this._offset)!==t&&s<e;)s++,this._offset++;return s<e&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+n,s)}}const It=[171,75,84,88,32,50,48,187,13,10,26,10];function Zi(r){return new TextDecoder().decode(r)}function Ls(r){const e=new Uint8Array(r.buffer,r.byteOffset,It.length);if(e[0]!==It[0]||e[1]!==It[1]||e[2]!==It[2]||e[3]!==It[3]||e[4]!==It[4]||e[5]!==It[5]||e[6]!==It[6]||e[7]!==It[7]||e[8]!==It[8]||e[9]!==It[9]||e[10]!==It[10]||e[11]!==It[11])throw new Error("Missing KTX 2.0 identifier.");const t=vf(),n=17*Uint32Array.BYTES_PER_ELEMENT,s=new xr(r,It.length,n,!0);t.vkFormat=s._nextUint32(),t.typeSize=s._nextUint32(),t.pixelWidth=s._nextUint32(),t.pixelHeight=s._nextUint32(),t.pixelDepth=s._nextUint32(),t.layerCount=s._nextUint32(),t.faceCount=s._nextUint32(),t.levelCount=s._nextUint32(),t.supercompressionScheme=s._nextUint32();const i=s._nextUint32(),o=s._nextUint32(),a=s._nextUint32(),u=s._nextUint32(),h=s._nextUint64(),y=s._nextUint64(),v=Math.max(t.levelCount,1)*3*8,p=new xr(r,It.length+n,v,!0);for(let Ve=0,it=Math.max(t.levelCount,1);Ve<it;Ve++)t.levels.push({levelData:new Uint8Array(r.buffer,r.byteOffset+p._nextUint64(),p._nextUint64()),uncompressedByteLength:p._nextUint64()});const T=new xr(r,i,o,!0);T._skip(4);const C=T._nextUint16(),G=T._nextUint16(),V=T._nextUint16(),E=T._nextUint16(),F=T._nextUint8(),_=T._nextUint8(),N=T._nextUint8(),P=T._nextUint8(),B=[T._nextUint8(),T._nextUint8(),T._nextUint8(),T._nextUint8()],d=[T._nextUint8(),T._nextUint8(),T._nextUint8(),T._nextUint8(),T._nextUint8(),T._nextUint8(),T._nextUint8(),T._nextUint8()],b={vendorId:C,descriptorType:G,versionNumber:V,colorModel:F,colorPrimaries:_,transferFunction:N,flags:P,texelBlockDimension:B,bytesPlane:d,samples:[]},ee=(E/4-6)/4;for(let Ve=0;Ve<ee;Ve++){const it={bitOffset:T._nextUint16(),bitLength:T._nextUint8(),channelType:T._nextUint8(),samplePosition:[T._nextUint8(),T._nextUint8(),T._nextUint8(),T._nextUint8()],sampleLower:Number.NEGATIVE_INFINITY,sampleUpper:Number.POSITIVE_INFINITY};it.channelType&Tf?(it.sampleLower=T._nextInt32(),it.sampleUpper=T._nextInt32()):(it.sampleLower=T._nextUint32(),it.sampleUpper=T._nextUint32()),b.samples[Ve]=it}t.dataFormatDescriptor.length=0,t.dataFormatDescriptor.push(b);const fe=new xr(r,a,u,!0);for(;fe._offset<u;){const Ve=fe._nextUint32(),it=fe._scan(Ve),Mt=Zi(it);if(t.keyValue[Mt]=fe._nextUint8Array(Ve-it.byteLength-1),Mt.match(/^ktx/i)){const Ot=Zi(t.keyValue[Mt]);t.keyValue[Mt]=Ot.substring(0,Ot.lastIndexOf("\0"))}const on=Ve%4?4-Ve%4:0;fe._skip(on)}if(y<=0)return t;const Ee=new xr(r,h,y,!0),me=Ee._nextUint16(),be=Ee._nextUint16(),Ie=Ee._nextUint32(),He=Ee._nextUint32(),We=Ee._nextUint32(),kt=Ee._nextUint32(),lt=[];for(let Ve=0,it=Math.max(t.levelCount,1);Ve<it;Ve++)lt.push({imageFlags:Ee._nextUint32(),rgbSliceByteOffset:Ee._nextUint32(),rgbSliceByteLength:Ee._nextUint32(),alphaSliceByteOffset:Ee._nextUint32(),alphaSliceByteLength:Ee._nextUint32()});const Tt=h+Ee._offset,Et=Tt+Ie,tt=Et+He,A=tt+We,De=new Uint8Array(r.buffer,r.byteOffset+Tt,Ie),Dn=new Uint8Array(r.buffer,r.byteOffset+Et,He),tn=new Uint8Array(r.buffer,r.byteOffset+tt,We),_t=new Uint8Array(r.buffer,r.byteOffset+A,kt);return t.globalData={endpointCount:me,selectorCount:be,imageDescs:lt,endpointsData:De,selectorsData:Dn,tablesData:tn,extendedData:_t},t}const Tn="EXT_mesh_gpu_instancing",xt="EXT_meshopt_compression",Er="EXT_texture_webp",wr="EXT_texture_avif",rt="KHR_draco_mesh_compression",Vt="KHR_lights_punctual",xn="KHR_materials_anisotropy",vn="KHR_materials_clearcoat",En="KHR_materials_diffuse_transmission",wn="KHR_materials_dispersion",bn="KHR_materials_emissive_strength",_n="KHR_materials_ior",Rn="KHR_materials_iridescence",In="KHR_materials_pbrSpecularGlossiness",Sn="KHR_materials_sheen",An="KHR_materials_specular",Mn="KHR_materials_transmission",Un="KHR_materials_unlit",Cn="KHR_materials_volume",wt="KHR_materials_variants",zo="KHR_mesh_quantization",br="KHR_texture_basisu",Nn="KHR_texture_transform",Gt="KHR_xmp_json_ld",Js="INSTANCE_ATTRIBUTE";class Wo extends st{init(){this.extensionName=Tn,this.propertyType="InstancedMesh",this.parentTypes=[k.NODE]}getDefaults(){return Object.assign(super.getDefaults(),{attributes:new Qt})}getAttribute(e){return this.getRefMap("attributes",e)}setAttribute(e,t){return this.setRefMap("attributes",e,t,{usage:Js})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}}Wo.EXTENSION_NAME=Tn;class Xo extends Ze{constructor(...e){super(...e),this.extensionName=Tn,this.provideTypes=[k.NODE],this.prewriteTypes=[k.ACCESSOR]}createInstancedMesh(){return new Wo(this.document.getGraph())}read(e){return(e.jsonDoc.json.nodes||[]).forEach((s,i)=>{if(!s.extensions||!s.extensions[Tn])return;const o=s.extensions[Tn],a=this.createInstancedMesh();for(const u in o.attributes)a.setAttribute(u,e.accessors[o.attributes[u]]);e.nodes[i].setExtension(Tn,a)}),this}prewrite(e){e.accessorUsageGroupedByParent.add(Js);for(const t of this.properties)for(const n of t.listAttributes())e.addAccessorToUsageGroup(n,Js);return this}write(e){const t=e.jsonDoc;return this.document.getRoot().listNodes().forEach(n=>{const s=n.getExtension(Tn);if(s){const i=e.nodeIndexMap.get(n),o=t.json.nodes[i],a={attributes:{}};s.listSemantics().forEach(u=>{const h=s.getAttribute(u);a.attributes[u]=e.accessorIndexMap.get(h)}),o.extensions=o.extensions||{},o.extensions[Tn]=a}}),this}}Xo.EXTENSION_NAME=Tn;function On(){return On=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)({}).hasOwnProperty.call(t,n)&&(r[n]=t[n])}return r},On.apply(null,arguments)}var Or;(function(r){r.QUANTIZE="quantize",r.FILTER="filter"})(Or||(Or={}));var sr;(function(r){r.ATTRIBUTES="ATTRIBUTES",r.TRIANGLES="TRIANGLES",r.INDICES="INDICES"})(sr||(sr={}));var ct;(function(r){r.NONE="NONE",r.OCTAHEDRAL="OCTAHEDRAL",r.QUATERNION="QUATERNION",r.EXPONENTIAL="EXPONENTIAL"})(ct||(ct={}));function Ef(r){return!r.extensions||!r.extensions[xt]?!1:!!r.extensions[xt].fallback}const{BYTE:wf,SHORT:Qi,FLOAT:bf}=oe.ComponentType,{encodeNormalizedInt:eo,decodeNormalizedInt:Zs}=Xe;function _f(r,e,t,n){const{filter:s,bits:i}=n,o={array:r.getArray(),byteStride:r.getElementSize()*r.getComponentSize(),componentType:r.getComponentType(),normalized:r.getNormalized()};if(t!==sr.ATTRIBUTES)return o;if(s!==ct.NONE){let a=r.getNormalized()?Rf(r):new Float32Array(o.array);switch(s){case ct.EXPONENTIAL:o.byteStride=r.getElementSize()*4,o.componentType=bf,o.normalized=!1,o.array=e.encodeFilterExp(a,r.getCount(),o.byteStride,i);break;case ct.OCTAHEDRAL:o.byteStride=i>8?8:4,o.componentType=i>8?Qi:wf,o.normalized=!0,a=r.getElementSize()===3?Sf(a):a,o.array=e.encodeFilterOct(a,r.getCount(),o.byteStride,i);break;case ct.QUATERNION:o.byteStride=8,o.componentType=Qi,o.normalized=!0,o.array=e.encodeFilterQuat(a,r.getCount(),o.byteStride,i);break;default:throw new Error("Invalid filter.")}o.min=r.getMin([]),o.max=r.getMax([]),r.getNormalized()&&(o.min=o.min.map(u=>Zs(u,r.getComponentType())),o.max=o.max.map(u=>Zs(u,r.getComponentType()))),o.normalized&&(o.min=o.min.map(u=>eo(u,o.componentType)),o.max=o.max.map(u=>eo(u,o.componentType)))}else o.byteStride%4&&(o.array=If(o.array,r.getElementSize()),o.byteStride=o.array.byteLength/r.getCount());return o}function Rf(r){const e=r.getComponentType(),t=r.getArray(),n=new Float32Array(t.length);for(let s=0;s<t.length;s++)n[s]=Zs(t[s],e);return n}function If(r,e){const n=Ne.padNumber(r.BYTES_PER_ELEMENT*e)/r.BYTES_PER_ELEMENT,s=r.length/e,i=new r.constructor(s*n);for(let o=0;o*e<r.length;o++)for(let a=0;a<e;a++)i[o*n+a]=r[o*e+a];return i}function Sf(r){const e=new Float32Array(r.length*4/3);for(let t=0,n=r.length/3;t<n;t++)e[t*4]=r[t*3],e[t*4+1]=r[t*3+1],e[t*4+2]=r[t*3+2];return e}function Af(r,e){return e===en.BufferViewUsage.ELEMENT_ARRAY_BUFFER?r.listParents().some(n=>n instanceof Xn&&n.getMode()===Xn.Mode.TRIANGLES)?sr.TRIANGLES:sr.INDICES:sr.ATTRIBUTES}function Mf(r,e){const t=e.getGraph().listParentEdges(r).filter(n=>!(n.getParent()instanceof Ao));for(const n of t){const s=n.getName(),i=n.getAttributes().key||"",o=n.getParent().propertyType===k.PRIMITIVE_TARGET;if(s==="indices")return{filter:ct.NONE};if(s==="attributes"){if(i==="POSITION")return{filter:ct.NONE};if(i==="TEXCOORD_0")return{filter:ct.NONE};if(i.startsWith("JOINTS_"))return{filter:ct.NONE};if(i.startsWith("WEIGHTS_"))return{filter:ct.NONE};if(i==="NORMAL"||i==="TANGENT")return o?{filter:ct.NONE}:{filter:ct.OCTAHEDRAL,bits:8}}if(s==="output"){const a=Ko(r);return a==="rotation"?{filter:ct.QUATERNION,bits:16}:a==="translation"?{filter:ct.EXPONENTIAL,bits:12}:a==="scale"?{filter:ct.EXPONENTIAL,bits:12}:{filter:ct.NONE}}if(s==="input")return{filter:ct.NONE};if(s==="inverseBindMatrices")return{filter:ct.NONE}}return{filter:ct.NONE}}function Ko(r){for(const e of r.listParents())if(e instanceof fr){for(const t of e.listParents())if(t instanceof ii)return t.getTargetPath()}return null}const to={method:Or.QUANTIZE};class li extends Ze{constructor(...e){super(...e),this.extensionName=xt,this.prereadTypes=[k.BUFFER,k.PRIMITIVE],this.prewriteTypes=[k.BUFFER,k.ACCESSOR],this.readDependencies=["meshopt.decoder"],this.writeDependencies=["meshopt.encoder"],this._decoder=null,this._decoderFallbackBufferMap=new Map,this._encoder=null,this._encoderOptions=to,this._encoderFallbackBuffer=null,this._encoderBufferViews={},this._encoderBufferViewData={},this._encoderBufferViewAccessors={}}install(e,t){return e==="meshopt.decoder"&&(this._decoder=t),e==="meshopt.encoder"&&(this._encoder=t),this}setEncoderOptions(e){return this._encoderOptions=On({},to,e),this}preread(e,t){if(!this._decoder){if(!this.isRequired())return this;throw new Error(`[${xt}] Please install extension dependency, "meshopt.decoder".`)}if(!this._decoder.supported){if(!this.isRequired())return this;throw new Error(`[${xt}]: Missing WASM support.`)}return t===k.BUFFER?this._prereadBuffers(e):t===k.PRIMITIVE&&this._prereadPrimitives(e),this}_prereadBuffers(e){const t=e.jsonDoc;(t.json.bufferViews||[]).forEach((s,i)=>{if(!s.extensions||!s.extensions[xt])return;const o=s.extensions[xt],a=o.byteOffset||0,u=o.byteLength||0,h=o.count,y=o.byteStride,v=new Uint8Array(h*y),p=t.json.buffers[o.buffer],T=p.uri?t.resources[p.uri]:t.resources[ir],C=Ne.toView(T,a,u);this._decoder.decodeGltfBuffer(v,h,y,C,o.mode,o.filter),e.bufferViews[i]=v})}_prereadPrimitives(e){const t=e.jsonDoc;(t.json.bufferViews||[]).forEach(s=>{if(!s.extensions||!s.extensions[xt])return;const i=s.extensions[xt],o=e.buffers[i.buffer],a=e.buffers[s.buffer],u=t.json.buffers[s.buffer];Ef(u)&&this._decoderFallbackBufferMap.set(a,o)})}read(e){if(!this.isRequired())return this;for(const[t,n]of this._decoderFallbackBufferMap){for(const s of t.listParents())s instanceof oe&&s.swap(t,n);t.dispose()}return this}prewrite(e,t){return t===k.ACCESSOR?this._prewriteAccessors(e):t===k.BUFFER&&this._prewriteBuffers(e),this}_prewriteAccessors(e){const t=e.jsonDoc.json,n=this._encoder,s=this._encoderOptions,i=this.document.getGraph(),o=this.document.createBuffer(),a=this.document.getRoot().listBuffers().indexOf(o);let u=1;const h=new Map,y=v=>{for(const p of i.listParents(v)){if(p.propertyType===k.ROOT)continue;let T=h.get(v);return T===void 0&&h.set(v,T=u++),T}return-1};this._encoderFallbackBuffer=o,this._encoderBufferViews={},this._encoderBufferViewData={},this._encoderBufferViewAccessors={};for(const v of this.document.getRoot().listAccessors()){if(Ko(v)==="weights"||v.getSparse())continue;const p=e.getAccessorUsage(v),T=e.accessorUsageGroupedByParent.has(p)?y(v):null,C=Af(v,p),G=s.method===Or.FILTER?Mf(v,this.document):{filter:ct.NONE},V=_f(v,n,C,G),{array:E,byteStride:F}=V,_=v.getBuffer();if(!_)throw new Error(`${xt}: Missing buffer for accessor.`);const N=this.document.getRoot().listBuffers().indexOf(_),P=[p,T,C,G.filter,F,N].join(":");let B=this._encoderBufferViews[P],d=this._encoderBufferViewData[P],R=this._encoderBufferViewAccessors[P];(!B||!d)&&(R=this._encoderBufferViewAccessors[P]=[],d=this._encoderBufferViewData[P]=[],B=this._encoderBufferViews[P]={buffer:a,target:en.USAGE_TO_TARGET[p],byteOffset:0,byteLength:0,byteStride:p===en.BufferViewUsage.ARRAY_BUFFER?F:void 0,extensions:{[xt]:{buffer:N,byteOffset:0,byteLength:0,mode:C,filter:G.filter!==ct.NONE?G.filter:void 0,byteStride:F,count:0}}});const b=e.createAccessorDef(v);b.componentType=V.componentType,b.normalized=V.normalized,b.byteOffset=B.byteLength,b.min&&V.min&&(b.min=V.min),b.max&&V.max&&(b.max=V.max),e.accessorIndexMap.set(v,t.accessors.length),t.accessors.push(b),R.push(b),d.push(new Uint8Array(E.buffer,E.byteOffset,E.byteLength)),B.byteLength+=E.byteLength,B.extensions.EXT_meshopt_compression.count+=v.getCount()}}_prewriteBuffers(e){const t=this._encoder;for(const n in this._encoderBufferViews){const s=this._encoderBufferViews[n],i=this._encoderBufferViewData[n],o=this.document.getRoot().listBuffers()[s.extensions[xt].buffer],a=e.otherBufferViews.get(o)||[],{count:u,byteStride:h,mode:y}=s.extensions[xt],v=Ne.concat(i),p=t.encodeGltfBuffer(v,u,h,y),T=Ne.pad(p);s.extensions[xt].byteLength=p.byteLength,i.length=0,i.push(T),a.push(T),e.otherBufferViews.set(o,a)}}write(e){let t=0;for(const o in this._encoderBufferViews){const a=this._encoderBufferViews[o],u=this._encoderBufferViewData[o][0],h=e.otherBufferViewsIndexMap.get(u),y=this._encoderBufferViewAccessors[o];for(const C of y)C.bufferView=h;const v=e.jsonDoc.json.bufferViews[h],p=v.byteOffset||0;Object.assign(v,a),v.byteOffset=t;const T=v.extensions[xt];T.byteOffset=p,t+=Ne.padNumber(a.byteLength)}const n=this._encoderFallbackBuffer,s=e.bufferIndexMap.get(n),i=e.jsonDoc.json.buffers[s];return i.byteLength=t,i.extensions={[xt]:{fallback:!0}},n.dispose(),this}}li.EXTENSION_NAME=xt;li.EncoderMethod=Or;class Cf{match(e){return e.length>=12&&Ne.decodeText(e.slice(4,12))==="ftypavif"}getSize(e){if(!this.match(e))return null;const t=new DataView(e.buffer,e.byteOffset,e.byteLength);let n=no(t,0);if(!n)return null;let s=n.end;for(;n=no(t,s);)if(n.type==="meta")s=n.start+4;else if(n.type==="iprp"||n.type==="ipco")s=n.start;else{if(n.type==="ispe")return[t.getUint32(n.start+4),t.getUint32(n.start+8)];if(n.type==="mdat")break;s=n.end}return null}getChannels(e){return 4}}class qo extends Ze{constructor(...e){super(...e),this.extensionName=wr,this.prereadTypes=[k.TEXTURE]}static register(){sn.registerFormat("image/avif",new Cf)}preread(e){return(e.jsonDoc.json.textures||[]).forEach(n=>{n.extensions&&n.extensions[wr]&&(n.source=n.extensions[wr].source)}),this}read(e){return this}write(e){const t=e.jsonDoc;return this.document.getRoot().listTextures().forEach(n=>{if(n.getMimeType()==="image/avif"){const s=e.imageIndexMap.get(n);(t.json.textures||[]).forEach(o=>{o.source===s&&(o.extensions=o.extensions||{},o.extensions[wr]={source:o.source},delete o.source)})}}),this}}qo.EXTENSION_NAME=wr;function no(r,e){if(r.byteLength<4+e)return null;const t=r.getUint32(e);return r.byteLength<t+e||t<8?null:{type:Ne.decodeText(new Uint8Array(r.buffer,r.byteOffset+e+4,4)),start:e+8,end:e+t}}class Nf{match(e){return e.length>=12&&e[8]===87&&e[9]===69&&e[10]===66&&e[11]===80}getSize(e){const t=Ne.decodeText(e.slice(0,4)),n=Ne.decodeText(e.slice(8,12));if(t!=="RIFF"||n!=="WEBP")return null;const s=new DataView(e.buffer,e.byteOffset);let i=12;for(;i<s.byteLength;){const o=Ne.decodeText(new Uint8Array([s.getUint8(i),s.getUint8(i+1),s.getUint8(i+2),s.getUint8(i+3)])),a=s.getUint32(i+4,!0);if(o==="VP8 "){const u=s.getInt16(i+14,!0)&16383,h=s.getInt16(i+16,!0)&16383;return[u,h]}else if(o==="VP8L"){const u=s.getUint8(i+9),h=s.getUint8(i+10),y=s.getUint8(i+11),v=s.getUint8(i+12),p=1+((h&63)<<8|u),T=1+((v&15)<<10|y<<2|(h&192)>>6);return[p,T]}i+=8+a+a%2}return null}getChannels(e){return 4}}class Yo extends Ze{constructor(...e){super(...e),this.extensionName=Er,this.prereadTypes=[k.TEXTURE]}static register(){sn.registerFormat("image/webp",new Nf)}preread(e){return(e.jsonDoc.json.textures||[]).forEach(n=>{n.extensions&&n.extensions[Er]&&(n.source=n.extensions[Er].source)}),this}read(e){return this}write(e){const t=e.jsonDoc;return this.document.getRoot().listTextures().forEach(n=>{if(n.getMimeType()==="image/webp"){const s=e.imageIndexMap.get(n);(t.json.textures||[]).forEach(o=>{o.source===s&&(o.extensions=o.extensions||{},o.extensions[Er]={source:o.source},delete o.source)})}}),this}}Yo.EXTENSION_NAME=Er;let pt,Jo,Zo;function Of(r,e){const t=new pt.DecoderBuffer;try{if(t.Init(e,e.length),r.GetEncodedGeometryType(t)!==pt.TRIANGULAR_MESH)throw new Error(`[${rt}] Unknown geometry type.`);const s=new pt.Mesh;if(!r.DecodeBufferToMesh(t,s).ok()||s.ptr===0)throw new Error(`[${rt}] Decoding failure.`);return s}finally{pt.destroy(t)}}function Df(r,e){const n=e.num_faces()*3;let s,i;if(e.num_points()<=65534){const o=n*Uint16Array.BYTES_PER_ELEMENT;s=pt._malloc(o),r.GetTrianglesUInt16Array(e,o,s),i=new Uint16Array(pt.HEAPU16.buffer,s,n).slice()}else{const o=n*Uint32Array.BYTES_PER_ELEMENT;s=pt._malloc(o),r.GetTrianglesUInt32Array(e,o,s),i=new Uint32Array(pt.HEAPU32.buffer,s,n).slice()}return pt._free(s),i}function Pf(r,e,t,n){const s=Zo[n.componentType],i=Jo[n.componentType],o=t.num_components(),u=e.num_points()*o,h=u*i.BYTES_PER_ELEMENT,y=pt._malloc(h);r.GetAttributeDataArrayForAllPoints(e,t,s,h,y);const v=new i(pt.HEAPF32.buffer,y,u).slice();return pt._free(y),v}function Ff(r){pt=r,Jo={[oe.ComponentType.FLOAT]:Float32Array,[oe.ComponentType.UNSIGNED_INT]:Uint32Array,[oe.ComponentType.UNSIGNED_SHORT]:Uint16Array,[oe.ComponentType.UNSIGNED_BYTE]:Uint8Array,[oe.ComponentType.SHORT]:Int16Array,[oe.ComponentType.BYTE]:Int8Array},Zo={[oe.ComponentType.FLOAT]:pt.DT_FLOAT32,[oe.ComponentType.UNSIGNED_INT]:pt.DT_UINT32,[oe.ComponentType.UNSIGNED_SHORT]:pt.DT_UINT16,[oe.ComponentType.UNSIGNED_BYTE]:pt.DT_UINT8,[oe.ComponentType.SHORT]:pt.DT_INT16,[oe.ComponentType.BYTE]:pt.DT_INT8}}let $t;var Dr;(function(r){r[r.EDGEBREAKER=1]="EDGEBREAKER",r[r.SEQUENTIAL=0]="SEQUENTIAL"})(Dr||(Dr={}));var Ht;(function(r){r.POSITION="POSITION",r.NORMAL="NORMAL",r.COLOR="COLOR",r.TEX_COORD="TEX_COORD",r.GENERIC="GENERIC"})(Ht||(Ht={}));const Qo={[Ht.POSITION]:14,[Ht.NORMAL]:10,[Ht.COLOR]:8,[Ht.TEX_COORD]:12,[Ht.GENERIC]:12},ro={decodeSpeed:5,encodeSpeed:5,method:Dr.EDGEBREAKER,quantizationBits:Qo,quantizationVolume:"mesh"};function Uf(r){$t=r}function kf(r,e=ro){const t=On({},ro,e);t.quantizationBits=On({},Qo,e.quantizationBits);const n=new $t.MeshBuilder,s=new $t.Mesh,i=new $t.ExpertEncoder(s),o={},a=new $t.DracoInt8Array,u=r.listTargets().length>0;let h=!1;for(const G of r.listSemantics()){const V=r.getAttribute(G);if(V.getSparse()){h=!0;continue}const E=jf(G),F=Bf(n,V.getComponentType(),s,$t[E],V.getCount(),V.getElementSize(),V.getArray());if(F===-1)throw new Error(`Error compressing "${G}" attribute.`);if(o[G]=F,t.quantizationVolume==="mesh"||G!=="POSITION")i.SetAttributeQuantization(F,t.quantizationBits[E]);else if(typeof t.quantizationVolume=="object"){const{quantizationVolume:_}=t,N=Math.max(_.max[0]-_.min[0],_.max[1]-_.min[1],_.max[2]-_.min[2]);i.SetAttributeExplicitQuantization(F,t.quantizationBits[E],V.getElementSize(),_.min,N)}else throw new Error("Invalid quantization volume state.")}const y=r.getIndices();if(!y)throw new Qs("Primitive must have indices.");n.AddFacesToMesh(s,y.getCount()/3,y.getArray()),i.SetSpeedOptions(t.encodeSpeed,t.decodeSpeed),i.SetTrackEncodedProperties(!0),t.method===Dr.SEQUENTIAL||u||h?i.SetEncodingMethod($t.MESH_SEQUENTIAL_ENCODING):i.SetEncodingMethod($t.MESH_EDGEBREAKER_ENCODING);const v=i.EncodeToDracoBuffer(!(u||h),a);if(v<=0)throw new Qs("Error applying Draco compression.");const p=new Uint8Array(v);for(let G=0;G<v;++G)p[G]=a.GetValue(G);const T=i.GetNumberOfEncodedPoints(),C=i.GetNumberOfEncodedFaces()*3;return $t.destroy(a),$t.destroy(s),$t.destroy(n),$t.destroy(i),{numVertices:T,numIndices:C,data:p,attributeIDs:o}}function jf(r){return r==="POSITION"?Ht.POSITION:r==="NORMAL"?Ht.NORMAL:r.startsWith("COLOR_")?Ht.COLOR:r.startsWith("TEXCOORD_")?Ht.TEX_COORD:Ht.GENERIC}function Bf(r,e,t,n,s,i,o){switch(e){case oe.ComponentType.UNSIGNED_BYTE:return r.AddUInt8Attribute(t,n,s,i,o);case oe.ComponentType.BYTE:return r.AddInt8Attribute(t,n,s,i,o);case oe.ComponentType.UNSIGNED_SHORT:return r.AddUInt16Attribute(t,n,s,i,o);case oe.ComponentType.SHORT:return r.AddInt16Attribute(t,n,s,i,o);case oe.ComponentType.UNSIGNED_INT:return r.AddUInt32Attribute(t,n,s,i,o);case oe.ComponentType.FLOAT:return r.AddFloatAttribute(t,n,s,i,o);default:throw new Error(`Unexpected component type, "${e}".`)}}class Qs extends Error{}class ui extends Ze{constructor(...e){super(...e),this.extensionName=rt,this.prereadTypes=[k.PRIMITIVE],this.prewriteTypes=[k.ACCESSOR],this.readDependencies=["draco3d.decoder"],this.writeDependencies=["draco3d.encoder"],this._decoderModule=null,this._encoderModule=null,this._encoderOptions={}}install(e,t){return e==="draco3d.decoder"&&(this._decoderModule=t,Ff(this._decoderModule)),e==="draco3d.encoder"&&(this._encoderModule=t,Uf(this._encoderModule)),this}setEncoderOptions(e){return this._encoderOptions=e,this}preread(e){if(!this._decoderModule)throw new Error(`[${rt}] Please install extension dependency, "draco3d.decoder".`);const t=this.document.getLogger(),n=e.jsonDoc,s=new Map;try{const i=n.json.meshes||[];for(const o of i)for(const a of o.primitives){if(!a.extensions||!a.extensions[rt])continue;const u=a.extensions[rt];let[h,y]=s.get(u.bufferView)||[];if(!y||!h){const v=n.json.bufferViews[u.bufferView],p=n.json.buffers[v.buffer],T=p.uri?n.resources[p.uri]:n.resources[ir],C=v.byteOffset||0,G=v.byteLength,V=Ne.toView(T,C,G);h=new this._decoderModule.Decoder,y=Of(h,V),s.set(u.bufferView,[h,y]),t.debug(`[${rt}] Decompressed ${V.byteLength} bytes.`)}for(const v in u.attributes){const p=e.jsonDoc.json.accessors[a.attributes[v]],T=h.GetAttributeByUniqueId(y,u.attributes[v]),C=Pf(h,y,T,p);e.accessors[a.attributes[v]].setArray(C)}a.indices!==void 0&&e.accessors[a.indices].setArray(Df(h,y))}}finally{for(const[i,o]of Array.from(s.values()))this._decoderModule.destroy(i),this._decoderModule.destroy(o)}return this}read(e){return this}prewrite(e,t){if(!this._encoderModule)throw new Error(`[${rt}] Please install extension dependency, "draco3d.encoder".`);const n=this.document.getLogger();n.debug(`[${rt}] Compression options: ${JSON.stringify(this._encoderOptions)}`);const s=Lf(this.document),i=new Map;let o="mesh";this._encoderOptions.quantizationVolume==="scene"&&(this.document.getRoot().listScenes().length!==1?n.warn(`[${rt}]: quantizationVolume=scene requires exactly 1 scene.`):o=Zc(this.document.getRoot().listScenes().pop()));for(const a of Array.from(s.keys())){const u=s.get(a);if(!u)throw new Error("Unexpected primitive.");if(i.has(u)){i.set(u,i.get(u));continue}const h=a.getIndices(),y=e.jsonDoc.json.accessors;let v;try{v=kf(a,On({},this._encoderOptions,{quantizationVolume:o}))}catch(C){if(C instanceof Qs){n.warn(`[${rt}]: ${C.message} Skipping primitive compression.`);continue}throw C}i.set(u,v);const p=e.createAccessorDef(h);p.count=v.numIndices,e.accessorIndexMap.set(h,y.length),y.push(p),v.numVertices>65534&&oe.getComponentSize(p.componentType)<=2?p.componentType=oe.ComponentType.UNSIGNED_INT:v.numVertices>254&&oe.getComponentSize(p.componentType)<=1&&(p.componentType=oe.ComponentType.UNSIGNED_SHORT);for(const C of a.listSemantics()){const G=a.getAttribute(C);if(v.attributeIDs[C]===void 0)continue;const V=e.createAccessorDef(G);V.count=v.numVertices,e.accessorIndexMap.set(G,y.length),y.push(V)}const T=a.getAttribute("POSITION").getBuffer()||this.document.getRoot().listBuffers()[0];e.otherBufferViews.has(T)||e.otherBufferViews.set(T,[]),e.otherBufferViews.get(T).push(v.data)}return n.debug(`[${rt}] Compressed ${s.size} primitives.`),e.extensionData[rt]={primitiveHashMap:s,primitiveEncodingMap:i},this}write(e){const t=e.extensionData[rt];for(const n of this.document.getRoot().listMeshes()){const s=e.jsonDoc.json.meshes[e.meshIndexMap.get(n)];for(let i=0;i<n.listPrimitives().length;i++){const o=n.listPrimitives()[i],a=s.primitives[i],u=t.primitiveHashMap.get(o);if(!u)continue;const h=t.primitiveEncodingMap.get(u);h&&(a.extensions=a.extensions||{},a.extensions[rt]={bufferView:e.otherBufferViewsIndexMap.get(h.data),attributes:h.attributeIDs})}}if(!t.primitiveHashMap.size){const n=e.jsonDoc.json;n.extensionsUsed=(n.extensionsUsed||[]).filter(s=>s!==rt),n.extensionsRequired=(n.extensionsRequired||[]).filter(s=>s!==rt)}return this}}ui.EXTENSION_NAME=rt;ui.EncoderMethod=Dr;function Lf(r){const e=r.getLogger(),t=new Set,n=new Set;let s=0,i=0;for(const v of r.getRoot().listMeshes())for(const p of v.listPrimitives())p.getIndices()?p.getMode()!==Xn.Mode.TRIANGLES?(n.add(p),i++):t.add(p):(n.add(p),s++);s>0&&e.warn(`[${rt}] Skipping Draco compression of ${s} non-indexed primitives.`),i>0&&e.warn(`[${rt}] Skipping Draco compression of ${i} non-TRIANGLES primitives.`);const o=r.getRoot().listAccessors(),a=new Map;for(let v=0;v<o.length;v++)a.set(o[v],v);const u=new Map,h=new Set,y=new Map;for(const v of Array.from(t)){let p=so(v,a);if(h.has(p)){y.set(v,p);continue}if(u.has(v.getIndices())){const T=v.getIndices(),C=T.clone();a.set(C,r.getRoot().listAccessors().length-1),v.swap(T,C)}for(const T of v.listAttributes())if(u.has(T)){const C=T.clone();a.set(C,r.getRoot().listAccessors().length-1),v.swap(T,C)}p=so(v,a),h.add(p),y.set(v,p),u.set(v.getIndices(),p);for(const T of v.listAttributes())u.set(T,p)}for(const v of Array.from(u.keys())){const p=new Set(v.listParents().map(T=>T.propertyType));if(p.size!==2||!p.has(k.PRIMITIVE)||!p.has(k.ROOT))throw new Error(`[${rt}] Compressed accessors must only be used as indices or vertex attributes.`)}for(const v of Array.from(t)){const p=y.get(v),T=v.getIndices();if(u.get(T)!==p||v.listAttributes().some(C=>u.get(C)!==p))throw new Error(`[${rt}] Draco primitives must share all, or no, accessors.`)}for(const v of Array.from(n)){const p=v.getIndices();if(u.has(p)||v.listAttributes().some(T=>u.has(T)))throw new Error(`[${rt}] Accessor cannot be shared by compressed and uncompressed primitives.`)}return y}function so(r,e){const t=[],n=r.getIndices();t.push(e.get(n));for(const s of r.listAttributes())t.push(e.get(s));return t.sort().join("|")}class lr extends st{init(){this.extensionName=Vt,this.propertyType="Light",this.parentTypes=[k.NODE]}getDefaults(){return Object.assign(super.getDefaults(),{color:[1,1,1],intensity:1,type:lr.Type.POINT,range:null,innerConeAngle:0,outerConeAngle:Math.PI/4})}getColor(){return this.get("color")}setColor(e){return this.set("color",e)}getIntensity(){return this.get("intensity")}setIntensity(e){return this.set("intensity",e)}getType(){return this.get("type")}setType(e){return this.set("type",e)}getRange(){return this.get("range")}setRange(e){return this.set("range",e)}getInnerConeAngle(){return this.get("innerConeAngle")}setInnerConeAngle(e){return this.set("innerConeAngle",e)}getOuterConeAngle(){return this.get("outerConeAngle")}setOuterConeAngle(e){return this.set("outerConeAngle",e)}}lr.EXTENSION_NAME=Vt;lr.Type={POINT:"point",SPOT:"spot",DIRECTIONAL:"directional"};class ea extends Ze{constructor(...e){super(...e),this.extensionName=Vt}createLight(e=""){return new lr(this.document.getGraph(),e)}read(e){const t=e.jsonDoc;if(!t.json.extensions||!t.json.extensions[Vt])return this;const i=(t.json.extensions[Vt].lights||[]).map(o=>{var a,u;const h=this.createLight().setName(o.name||"").setType(o.type);return o.color!==void 0&&h.setColor(o.color),o.intensity!==void 0&&h.setIntensity(o.intensity),o.range!==void 0&&h.setRange(o.range),((a=o.spot)==null?void 0:a.innerConeAngle)!==void 0&&h.setInnerConeAngle(o.spot.innerConeAngle),((u=o.spot)==null?void 0:u.outerConeAngle)!==void 0&&h.setOuterConeAngle(o.spot.outerConeAngle),h});return t.json.nodes.forEach((o,a)=>{if(!o.extensions||!o.extensions[Vt])return;const u=o.extensions[Vt];e.nodes[a].setExtension(Vt,i[u.light])}),this}write(e){const t=e.jsonDoc;if(this.properties.size===0)return this;const n=[],s=new Map;for(const i of this.properties){const o=i,a={type:o.getType()};Xe.eq(o.getColor(),[1,1,1])||(a.color=o.getColor()),o.getIntensity()!==1&&(a.intensity=o.getIntensity()),o.getRange()!=null&&(a.range=o.getRange()),o.getName()&&(a.name=o.getName()),o.getType()===lr.Type.SPOT&&(a.spot={innerConeAngle:o.getInnerConeAngle(),outerConeAngle:o.getOuterConeAngle()}),n.push(a),s.set(o,n.length-1)}return this.document.getRoot().listNodes().forEach(i=>{const o=i.getExtension(Vt);if(o){const a=e.nodeIndexMap.get(i),u=t.json.nodes[a];u.extensions=u.extensions||{},u.extensions[Vt]={light:s.get(o)}}}),t.json.extensions=t.json.extensions||{},t.json.extensions[Vt]={lights:n},this}}ea.EXTENSION_NAME=Vt;const{R:$f,G:Vf,B:Gf}=Wt;class ta extends st{init(){this.extensionName=xn,this.propertyType="Anisotropy",this.parentTypes=[k.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{anisotropyStrength:0,anisotropyRotation:0,anisotropyTexture:null,anisotropyTextureInfo:new Ye(this.graph,"anisotropyTextureInfo")})}getAnisotropyStrength(){return this.get("anisotropyStrength")}setAnisotropyStrength(e){return this.set("anisotropyStrength",e)}getAnisotropyRotation(){return this.get("anisotropyRotation")}setAnisotropyRotation(e){return this.set("anisotropyRotation",e)}getAnisotropyTexture(){return this.getRef("anisotropyTexture")}getAnisotropyTextureInfo(){return this.getRef("anisotropyTexture")?this.getRef("anisotropyTextureInfo"):null}setAnisotropyTexture(e){return this.setRef("anisotropyTexture",e,{channels:$f|Vf|Gf})}}ta.EXTENSION_NAME=xn;class na extends Ze{constructor(...e){super(...e),this.extensionName=xn,this.prereadTypes=[k.MESH],this.prewriteTypes=[k.MESH]}createAnisotropy(){return new ta(this.document.getGraph())}read(e){return this}write(e){return this}preread(e){const t=e.jsonDoc,n=t.json.materials||[],s=t.json.textures||[];return n.forEach((i,o)=>{if(i.extensions&&i.extensions[xn]){const a=this.createAnisotropy();e.materials[o].setExtension(xn,a);const u=i.extensions[xn];if(u.anisotropyStrength!==void 0&&a.setAnisotropyStrength(u.anisotropyStrength),u.anisotropyRotation!==void 0&&a.setAnisotropyRotation(u.anisotropyRotation),u.anisotropyTexture!==void 0){const h=u.anisotropyTexture,y=e.textures[s[h.index].source];a.setAnisotropyTexture(y),e.setTextureInfo(a.getAnisotropyTextureInfo(),h)}}}),this}prewrite(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const s=n.getExtension(xn);if(s){const i=e.materialIndexMap.get(n),o=t.json.materials[i];o.extensions=o.extensions||{};const a=o.extensions[xn]={};if(s.getAnisotropyStrength()>0&&(a.anisotropyStrength=s.getAnisotropyStrength()),s.getAnisotropyRotation()!==0&&(a.anisotropyRotation=s.getAnisotropyRotation()),s.getAnisotropyTexture()){const u=s.getAnisotropyTexture(),h=s.getAnisotropyTextureInfo();a.anisotropyTexture=e.createTextureInfoDef(u,h)}}}),this}}na.EXTENSION_NAME=xn;const{R:io,G:oo,B:Hf}=Wt;class ra extends st{init(){this.extensionName=vn,this.propertyType="Clearcoat",this.parentTypes=[k.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{clearcoatFactor:0,clearcoatTexture:null,clearcoatTextureInfo:new Ye(this.graph,"clearcoatTextureInfo"),clearcoatRoughnessFactor:0,clearcoatRoughnessTexture:null,clearcoatRoughnessTextureInfo:new Ye(this.graph,"clearcoatRoughnessTextureInfo"),clearcoatNormalScale:1,clearcoatNormalTexture:null,clearcoatNormalTextureInfo:new Ye(this.graph,"clearcoatNormalTextureInfo")})}getClearcoatFactor(){return this.get("clearcoatFactor")}setClearcoatFactor(e){return this.set("clearcoatFactor",e)}getClearcoatTexture(){return this.getRef("clearcoatTexture")}getClearcoatTextureInfo(){return this.getRef("clearcoatTexture")?this.getRef("clearcoatTextureInfo"):null}setClearcoatTexture(e){return this.setRef("clearcoatTexture",e,{channels:io})}getClearcoatRoughnessFactor(){return this.get("clearcoatRoughnessFactor")}setClearcoatRoughnessFactor(e){return this.set("clearcoatRoughnessFactor",e)}getClearcoatRoughnessTexture(){return this.getRef("clearcoatRoughnessTexture")}getClearcoatRoughnessTextureInfo(){return this.getRef("clearcoatRoughnessTexture")?this.getRef("clearcoatRoughnessTextureInfo"):null}setClearcoatRoughnessTexture(e){return this.setRef("clearcoatRoughnessTexture",e,{channels:oo})}getClearcoatNormalScale(){return this.get("clearcoatNormalScale")}setClearcoatNormalScale(e){return this.set("clearcoatNormalScale",e)}getClearcoatNormalTexture(){return this.getRef("clearcoatNormalTexture")}getClearcoatNormalTextureInfo(){return this.getRef("clearcoatNormalTexture")?this.getRef("clearcoatNormalTextureInfo"):null}setClearcoatNormalTexture(e){return this.setRef("clearcoatNormalTexture",e,{channels:io|oo|Hf})}}ra.EXTENSION_NAME=vn;class sa extends Ze{constructor(...e){super(...e),this.extensionName=vn,this.prereadTypes=[k.MESH],this.prewriteTypes=[k.MESH]}createClearcoat(){return new ra(this.document.getGraph())}read(e){return this}write(e){return this}preread(e){const t=e.jsonDoc,n=t.json.materials||[],s=t.json.textures||[];return n.forEach((i,o)=>{if(i.extensions&&i.extensions[vn]){const a=this.createClearcoat();e.materials[o].setExtension(vn,a);const u=i.extensions[vn];if(u.clearcoatFactor!==void 0&&a.setClearcoatFactor(u.clearcoatFactor),u.clearcoatRoughnessFactor!==void 0&&a.setClearcoatRoughnessFactor(u.clearcoatRoughnessFactor),u.clearcoatTexture!==void 0){const h=u.clearcoatTexture,y=e.textures[s[h.index].source];a.setClearcoatTexture(y),e.setTextureInfo(a.getClearcoatTextureInfo(),h)}if(u.clearcoatRoughnessTexture!==void 0){const h=u.clearcoatRoughnessTexture,y=e.textures[s[h.index].source];a.setClearcoatRoughnessTexture(y),e.setTextureInfo(a.getClearcoatRoughnessTextureInfo(),h)}if(u.clearcoatNormalTexture!==void 0){const h=u.clearcoatNormalTexture,y=e.textures[s[h.index].source];a.setClearcoatNormalTexture(y),e.setTextureInfo(a.getClearcoatNormalTextureInfo(),h),h.scale!==void 0&&a.setClearcoatNormalScale(h.scale)}}}),this}prewrite(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const s=n.getExtension(vn);if(s){const i=e.materialIndexMap.get(n),o=t.json.materials[i];o.extensions=o.extensions||{};const a=o.extensions[vn]={clearcoatFactor:s.getClearcoatFactor(),clearcoatRoughnessFactor:s.getClearcoatRoughnessFactor()};if(s.getClearcoatTexture()){const u=s.getClearcoatTexture(),h=s.getClearcoatTextureInfo();a.clearcoatTexture=e.createTextureInfoDef(u,h)}if(s.getClearcoatRoughnessTexture()){const u=s.getClearcoatRoughnessTexture(),h=s.getClearcoatRoughnessTextureInfo();a.clearcoatRoughnessTexture=e.createTextureInfoDef(u,h)}if(s.getClearcoatNormalTexture()){const u=s.getClearcoatNormalTexture(),h=s.getClearcoatNormalTextureInfo();a.clearcoatNormalTexture=e.createTextureInfoDef(u,h),s.getClearcoatNormalScale()!==1&&(a.clearcoatNormalTexture.scale=s.getClearcoatNormalScale())}}}),this}}sa.EXTENSION_NAME=vn;const{R:zf,G:Wf,B:Xf,A:Kf}=Wt;class ia extends st{init(){this.extensionName=En,this.propertyType="DiffuseTransmission",this.parentTypes=[k.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{diffuseTransmissionFactor:0,diffuseTransmissionTexture:null,diffuseTransmissionTextureInfo:new Ye(this.graph,"diffuseTransmissionTextureInfo"),diffuseTransmissionColorFactor:[1,1,1],diffuseTransmissionColorTexture:null,diffuseTransmissionColorTextureInfo:new Ye(this.graph,"diffuseTransmissionColorTextureInfo")})}getDiffuseTransmissionFactor(){return this.get("diffuseTransmissionFactor")}setDiffuseTransmissionFactor(e){return this.set("diffuseTransmissionFactor",e)}getDiffuseTransmissionTexture(){return this.getRef("diffuseTransmissionTexture")}getDiffuseTransmissionTextureInfo(){return this.getRef("diffuseTransmissionTexture")?this.getRef("diffuseTransmissionTextureInfo"):null}setDiffuseTransmissionTexture(e){return this.setRef("diffuseTransmissionTexture",e,{channels:Kf})}getDiffuseTransmissionColorFactor(){return this.get("diffuseTransmissionColorFactor")}setDiffuseTransmissionColorFactor(e){return this.set("diffuseTransmissionColorFactor",e)}getDiffuseTransmissionColorTexture(){return this.getRef("diffuseTransmissionColorTexture")}getDiffuseTransmissionColorTextureInfo(){return this.getRef("diffuseTransmissionColorTexture")?this.getRef("diffuseTransmissionColorTextureInfo"):null}setDiffuseTransmissionColorTexture(e){return this.setRef("diffuseTransmissionColorTexture",e,{channels:zf|Wf|Xf})}}ia.EXTENSION_NAME=En;class oa extends Ze{constructor(...e){super(...e),this.extensionName=En}createDiffuseTransmission(){return new ia(this.document.getGraph())}read(e){const t=e.jsonDoc,n=t.json.materials||[],s=t.json.textures||[];return n.forEach((i,o)=>{if(i.extensions&&i.extensions[En]){const a=this.createDiffuseTransmission();e.materials[o].setExtension(En,a);const u=i.extensions[En];if(u.diffuseTransmissionFactor!==void 0&&a.setDiffuseTransmissionFactor(u.diffuseTransmissionFactor),u.diffuseTransmissionColorFactor!==void 0&&a.setDiffuseTransmissionColorFactor(u.diffuseTransmissionColorFactor),u.diffuseTransmissionTexture!==void 0){const h=u.diffuseTransmissionTexture,y=e.textures[s[h.index].source];a.setDiffuseTransmissionTexture(y),e.setTextureInfo(a.getDiffuseTransmissionTextureInfo(),h)}if(u.diffuseTransmissionColorTexture!==void 0){const h=u.diffuseTransmissionColorTexture,y=e.textures[s[h.index].source];a.setDiffuseTransmissionColorTexture(y),e.setTextureInfo(a.getDiffuseTransmissionColorTextureInfo(),h)}}}),this}write(e){const t=e.jsonDoc;for(const n of this.document.getRoot().listMaterials()){const s=n.getExtension(En);if(!s)continue;const i=e.materialIndexMap.get(n),o=t.json.materials[i];o.extensions=o.extensions||{};const a=o.extensions[En]={diffuseTransmissionFactor:s.getDiffuseTransmissionFactor(),diffuseTransmissionColorFactor:s.getDiffuseTransmissionColorFactor()};if(s.getDiffuseTransmissionTexture()){const u=s.getDiffuseTransmissionTexture(),h=s.getDiffuseTransmissionTextureInfo();a.diffuseTransmissionTexture=e.createTextureInfoDef(u,h)}if(s.getDiffuseTransmissionColorTexture()){const u=s.getDiffuseTransmissionColorTexture(),h=s.getDiffuseTransmissionColorTextureInfo();a.diffuseTransmissionColorTexture=e.createTextureInfoDef(u,h)}}return this}}oa.EXTENSION_NAME=En;class aa extends st{init(){this.extensionName=wn,this.propertyType="Dispersion",this.parentTypes=[k.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{dispersion:0})}getDispersion(){return this.get("dispersion")}setDispersion(e){return this.set("dispersion",e)}}aa.EXTENSION_NAME=wn;class ca extends Ze{constructor(...e){super(...e),this.extensionName=wn,this.prereadTypes=[k.MESH],this.prewriteTypes=[k.MESH]}createDispersion(){return new aa(this.document.getGraph())}read(e){return this}write(e){return this}preread(e){return(e.jsonDoc.json.materials||[]).forEach((s,i)=>{if(s.extensions&&s.extensions[wn]){const o=this.createDispersion();e.materials[i].setExtension(wn,o);const a=s.extensions[wn];a.dispersion!==void 0&&o.setDispersion(a.dispersion)}}),this}prewrite(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const s=n.getExtension(wn);if(s){const i=e.materialIndexMap.get(n),o=t.json.materials[i];o.extensions=o.extensions||{},o.extensions[wn]={dispersion:s.getDispersion()}}}),this}}ca.EXTENSION_NAME=wn;class la extends st{init(){this.extensionName=bn,this.propertyType="EmissiveStrength",this.parentTypes=[k.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{emissiveStrength:1})}getEmissiveStrength(){return this.get("emissiveStrength")}setEmissiveStrength(e){return this.set("emissiveStrength",e)}}la.EXTENSION_NAME=bn;class ua extends Ze{constructor(...e){super(...e),this.extensionName=bn,this.prereadTypes=[k.MESH],this.prewriteTypes=[k.MESH]}createEmissiveStrength(){return new la(this.document.getGraph())}read(e){return this}write(e){return this}preread(e){return(e.jsonDoc.json.materials||[]).forEach((s,i)=>{if(s.extensions&&s.extensions[bn]){const o=this.createEmissiveStrength();e.materials[i].setExtension(bn,o);const a=s.extensions[bn];a.emissiveStrength!==void 0&&o.setEmissiveStrength(a.emissiveStrength)}}),this}prewrite(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const s=n.getExtension(bn);if(s){const i=e.materialIndexMap.get(n),o=t.json.materials[i];o.extensions=o.extensions||{},o.extensions[bn]={emissiveStrength:s.getEmissiveStrength()}}}),this}}ua.EXTENSION_NAME=bn;class fa extends st{init(){this.extensionName=_n,this.propertyType="IOR",this.parentTypes=[k.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{ior:1.5})}getIOR(){return this.get("ior")}setIOR(e){return this.set("ior",e)}}fa.EXTENSION_NAME=_n;class ha extends Ze{constructor(...e){super(...e),this.extensionName=_n,this.prereadTypes=[k.MESH],this.prewriteTypes=[k.MESH]}createIOR(){return new fa(this.document.getGraph())}read(e){return this}write(e){return this}preread(e){return(e.jsonDoc.json.materials||[]).forEach((s,i)=>{if(s.extensions&&s.extensions[_n]){const o=this.createIOR();e.materials[i].setExtension(_n,o);const a=s.extensions[_n];a.ior!==void 0&&o.setIOR(a.ior)}}),this}prewrite(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const s=n.getExtension(_n);if(s){const i=e.materialIndexMap.get(n),o=t.json.materials[i];o.extensions=o.extensions||{},o.extensions[_n]={ior:s.getIOR()}}}),this}}ha.EXTENSION_NAME=_n;const{R:qf,G:Yf}=Wt;class da extends st{init(){this.extensionName=Rn,this.propertyType="Iridescence",this.parentTypes=[k.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{iridescenceFactor:0,iridescenceTexture:null,iridescenceTextureInfo:new Ye(this.graph,"iridescenceTextureInfo"),iridescenceIOR:1.3,iridescenceThicknessMinimum:100,iridescenceThicknessMaximum:400,iridescenceThicknessTexture:null,iridescenceThicknessTextureInfo:new Ye(this.graph,"iridescenceThicknessTextureInfo")})}getIridescenceFactor(){return this.get("iridescenceFactor")}setIridescenceFactor(e){return this.set("iridescenceFactor",e)}getIridescenceTexture(){return this.getRef("iridescenceTexture")}getIridescenceTextureInfo(){return this.getRef("iridescenceTexture")?this.getRef("iridescenceTextureInfo"):null}setIridescenceTexture(e){return this.setRef("iridescenceTexture",e,{channels:qf})}getIridescenceIOR(){return this.get("iridescenceIOR")}setIridescenceIOR(e){return this.set("iridescenceIOR",e)}getIridescenceThicknessMinimum(){return this.get("iridescenceThicknessMinimum")}setIridescenceThicknessMinimum(e){return this.set("iridescenceThicknessMinimum",e)}getIridescenceThicknessMaximum(){return this.get("iridescenceThicknessMaximum")}setIridescenceThicknessMaximum(e){return this.set("iridescenceThicknessMaximum",e)}getIridescenceThicknessTexture(){return this.getRef("iridescenceThicknessTexture")}getIridescenceThicknessTextureInfo(){return this.getRef("iridescenceThicknessTexture")?this.getRef("iridescenceThicknessTextureInfo"):null}setIridescenceThicknessTexture(e){return this.setRef("iridescenceThicknessTexture",e,{channels:Yf})}}da.EXTENSION_NAME=Rn;class pa extends Ze{constructor(...e){super(...e),this.extensionName=Rn,this.prereadTypes=[k.MESH],this.prewriteTypes=[k.MESH]}createIridescence(){return new da(this.document.getGraph())}read(e){return this}write(e){return this}preread(e){const t=e.jsonDoc,n=t.json.materials||[],s=t.json.textures||[];return n.forEach((i,o)=>{if(i.extensions&&i.extensions[Rn]){const a=this.createIridescence();e.materials[o].setExtension(Rn,a);const u=i.extensions[Rn];if(u.iridescenceFactor!==void 0&&a.setIridescenceFactor(u.iridescenceFactor),u.iridescenceIor!==void 0&&a.setIridescenceIOR(u.iridescenceIor),u.iridescenceThicknessMinimum!==void 0&&a.setIridescenceThicknessMinimum(u.iridescenceThicknessMinimum),u.iridescenceThicknessMaximum!==void 0&&a.setIridescenceThicknessMaximum(u.iridescenceThicknessMaximum),u.iridescenceTexture!==void 0){const h=u.iridescenceTexture,y=e.textures[s[h.index].source];a.setIridescenceTexture(y),e.setTextureInfo(a.getIridescenceTextureInfo(),h)}if(u.iridescenceThicknessTexture!==void 0){const h=u.iridescenceThicknessTexture,y=e.textures[s[h.index].source];a.setIridescenceThicknessTexture(y),e.setTextureInfo(a.getIridescenceThicknessTextureInfo(),h)}}}),this}prewrite(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const s=n.getExtension(Rn);if(s){const i=e.materialIndexMap.get(n),o=t.json.materials[i];o.extensions=o.extensions||{};const a=o.extensions[Rn]={};if(s.getIridescenceFactor()>0&&(a.iridescenceFactor=s.getIridescenceFactor()),s.getIridescenceIOR()!==1.3&&(a.iridescenceIor=s.getIridescenceIOR()),s.getIridescenceThicknessMinimum()!==100&&(a.iridescenceThicknessMinimum=s.getIridescenceThicknessMinimum()),s.getIridescenceThicknessMaximum()!==400&&(a.iridescenceThicknessMaximum=s.getIridescenceThicknessMaximum()),s.getIridescenceTexture()){const u=s.getIridescenceTexture(),h=s.getIridescenceTextureInfo();a.iridescenceTexture=e.createTextureInfoDef(u,h)}if(s.getIridescenceThicknessTexture()){const u=s.getIridescenceThicknessTexture(),h=s.getIridescenceThicknessTextureInfo();a.iridescenceThicknessTexture=e.createTextureInfoDef(u,h)}}}),this}}pa.EXTENSION_NAME=Rn;const{R:ao,G:co,B:lo,A:uo}=Wt;class ga extends st{init(){this.extensionName=In,this.propertyType="PBRSpecularGlossiness",this.parentTypes=[k.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{diffuseFactor:[1,1,1,1],diffuseTexture:null,diffuseTextureInfo:new Ye(this.graph,"diffuseTextureInfo"),specularFactor:[1,1,1],glossinessFactor:1,specularGlossinessTexture:null,specularGlossinessTextureInfo:new Ye(this.graph,"specularGlossinessTextureInfo")})}getDiffuseFactor(){return this.get("diffuseFactor")}setDiffuseFactor(e){return this.set("diffuseFactor",e)}getDiffuseTexture(){return this.getRef("diffuseTexture")}getDiffuseTextureInfo(){return this.getRef("diffuseTexture")?this.getRef("diffuseTextureInfo"):null}setDiffuseTexture(e){return this.setRef("diffuseTexture",e,{channels:ao|co|lo|uo,isColor:!0})}getSpecularFactor(){return this.get("specularFactor")}setSpecularFactor(e){return this.set("specularFactor",e)}getGlossinessFactor(){return this.get("glossinessFactor")}setGlossinessFactor(e){return this.set("glossinessFactor",e)}getSpecularGlossinessTexture(){return this.getRef("specularGlossinessTexture")}getSpecularGlossinessTextureInfo(){return this.getRef("specularGlossinessTexture")?this.getRef("specularGlossinessTextureInfo"):null}setSpecularGlossinessTexture(e){return this.setRef("specularGlossinessTexture",e,{channels:ao|co|lo|uo})}}ga.EXTENSION_NAME=In;class ma extends Ze{constructor(...e){super(...e),this.extensionName=In,this.prereadTypes=[k.MESH],this.prewriteTypes=[k.MESH]}createPBRSpecularGlossiness(){return new ga(this.document.getGraph())}read(e){return this}write(e){return this}preread(e){const t=e.jsonDoc,n=t.json.materials||[],s=t.json.textures||[];return n.forEach((i,o)=>{if(i.extensions&&i.extensions[In]){const a=this.createPBRSpecularGlossiness();e.materials[o].setExtension(In,a);const u=i.extensions[In];if(u.diffuseFactor!==void 0&&a.setDiffuseFactor(u.diffuseFactor),u.specularFactor!==void 0&&a.setSpecularFactor(u.specularFactor),u.glossinessFactor!==void 0&&a.setGlossinessFactor(u.glossinessFactor),u.diffuseTexture!==void 0){const h=u.diffuseTexture,y=e.textures[s[h.index].source];a.setDiffuseTexture(y),e.setTextureInfo(a.getDiffuseTextureInfo(),h)}if(u.specularGlossinessTexture!==void 0){const h=u.specularGlossinessTexture,y=e.textures[s[h.index].source];a.setSpecularGlossinessTexture(y),e.setTextureInfo(a.getSpecularGlossinessTextureInfo(),h)}}}),this}prewrite(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const s=n.getExtension(In);if(s){const i=e.materialIndexMap.get(n),o=t.json.materials[i];o.extensions=o.extensions||{};const a=o.extensions[In]={diffuseFactor:s.getDiffuseFactor(),specularFactor:s.getSpecularFactor(),glossinessFactor:s.getGlossinessFactor()};if(s.getDiffuseTexture()){const u=s.getDiffuseTexture(),h=s.getDiffuseTextureInfo();a.diffuseTexture=e.createTextureInfoDef(u,h)}if(s.getSpecularGlossinessTexture()){const u=s.getSpecularGlossinessTexture(),h=s.getSpecularGlossinessTextureInfo();a.specularGlossinessTexture=e.createTextureInfoDef(u,h)}}}),this}}ma.EXTENSION_NAME=In;const{R:Jf,G:Zf,B:Qf,A:eh}=Wt;class ya extends st{init(){this.extensionName=Sn,this.propertyType="Sheen",this.parentTypes=[k.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{sheenColorFactor:[0,0,0],sheenColorTexture:null,sheenColorTextureInfo:new Ye(this.graph,"sheenColorTextureInfo"),sheenRoughnessFactor:0,sheenRoughnessTexture:null,sheenRoughnessTextureInfo:new Ye(this.graph,"sheenRoughnessTextureInfo")})}getSheenColorFactor(){return this.get("sheenColorFactor")}setSheenColorFactor(e){return this.set("sheenColorFactor",e)}getSheenColorTexture(){return this.getRef("sheenColorTexture")}getSheenColorTextureInfo(){return this.getRef("sheenColorTexture")?this.getRef("sheenColorTextureInfo"):null}setSheenColorTexture(e){return this.setRef("sheenColorTexture",e,{channels:Jf|Zf|Qf,isColor:!0})}getSheenRoughnessFactor(){return this.get("sheenRoughnessFactor")}setSheenRoughnessFactor(e){return this.set("sheenRoughnessFactor",e)}getSheenRoughnessTexture(){return this.getRef("sheenRoughnessTexture")}getSheenRoughnessTextureInfo(){return this.getRef("sheenRoughnessTexture")?this.getRef("sheenRoughnessTextureInfo"):null}setSheenRoughnessTexture(e){return this.setRef("sheenRoughnessTexture",e,{channels:eh})}}ya.EXTENSION_NAME=Sn;class Ta extends Ze{constructor(...e){super(...e),this.extensionName=Sn,this.prereadTypes=[k.MESH],this.prewriteTypes=[k.MESH]}createSheen(){return new ya(this.document.getGraph())}read(e){return this}write(e){return this}preread(e){const t=e.jsonDoc,n=t.json.materials||[],s=t.json.textures||[];return n.forEach((i,o)=>{if(i.extensions&&i.extensions[Sn]){const a=this.createSheen();e.materials[o].setExtension(Sn,a);const u=i.extensions[Sn];if(u.sheenColorFactor!==void 0&&a.setSheenColorFactor(u.sheenColorFactor),u.sheenRoughnessFactor!==void 0&&a.setSheenRoughnessFactor(u.sheenRoughnessFactor),u.sheenColorTexture!==void 0){const h=u.sheenColorTexture,y=e.textures[s[h.index].source];a.setSheenColorTexture(y),e.setTextureInfo(a.getSheenColorTextureInfo(),h)}if(u.sheenRoughnessTexture!==void 0){const h=u.sheenRoughnessTexture,y=e.textures[s[h.index].source];a.setSheenRoughnessTexture(y),e.setTextureInfo(a.getSheenRoughnessTextureInfo(),h)}}}),this}prewrite(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const s=n.getExtension(Sn);if(s){const i=e.materialIndexMap.get(n),o=t.json.materials[i];o.extensions=o.extensions||{};const a=o.extensions[Sn]={sheenColorFactor:s.getSheenColorFactor(),sheenRoughnessFactor:s.getSheenRoughnessFactor()};if(s.getSheenColorTexture()){const u=s.getSheenColorTexture(),h=s.getSheenColorTextureInfo();a.sheenColorTexture=e.createTextureInfoDef(u,h)}if(s.getSheenRoughnessTexture()){const u=s.getSheenRoughnessTexture(),h=s.getSheenRoughnessTextureInfo();a.sheenRoughnessTexture=e.createTextureInfoDef(u,h)}}}),this}}Ta.EXTENSION_NAME=Sn;const{R:th,G:nh,B:rh,A:sh}=Wt;class xa extends st{init(){this.extensionName=An,this.propertyType="Specular",this.parentTypes=[k.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{specularFactor:1,specularTexture:null,specularTextureInfo:new Ye(this.graph,"specularTextureInfo"),specularColorFactor:[1,1,1],specularColorTexture:null,specularColorTextureInfo:new Ye(this.graph,"specularColorTextureInfo")})}getSpecularFactor(){return this.get("specularFactor")}setSpecularFactor(e){return this.set("specularFactor",e)}getSpecularColorFactor(){return this.get("specularColorFactor")}setSpecularColorFactor(e){return this.set("specularColorFactor",e)}getSpecularTexture(){return this.getRef("specularTexture")}getSpecularTextureInfo(){return this.getRef("specularTexture")?this.getRef("specularTextureInfo"):null}setSpecularTexture(e){return this.setRef("specularTexture",e,{channels:sh})}getSpecularColorTexture(){return this.getRef("specularColorTexture")}getSpecularColorTextureInfo(){return this.getRef("specularColorTexture")?this.getRef("specularColorTextureInfo"):null}setSpecularColorTexture(e){return this.setRef("specularColorTexture",e,{channels:th|nh|rh,isColor:!0})}}xa.EXTENSION_NAME=An;class va extends Ze{constructor(...e){super(...e),this.extensionName=An,this.prereadTypes=[k.MESH],this.prewriteTypes=[k.MESH]}createSpecular(){return new xa(this.document.getGraph())}read(e){return this}write(e){return this}preread(e){const t=e.jsonDoc,n=t.json.materials||[],s=t.json.textures||[];return n.forEach((i,o)=>{if(i.extensions&&i.extensions[An]){const a=this.createSpecular();e.materials[o].setExtension(An,a);const u=i.extensions[An];if(u.specularFactor!==void 0&&a.setSpecularFactor(u.specularFactor),u.specularColorFactor!==void 0&&a.setSpecularColorFactor(u.specularColorFactor),u.specularTexture!==void 0){const h=u.specularTexture,y=e.textures[s[h.index].source];a.setSpecularTexture(y),e.setTextureInfo(a.getSpecularTextureInfo(),h)}if(u.specularColorTexture!==void 0){const h=u.specularColorTexture,y=e.textures[s[h.index].source];a.setSpecularColorTexture(y),e.setTextureInfo(a.getSpecularColorTextureInfo(),h)}}}),this}prewrite(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const s=n.getExtension(An);if(s){const i=e.materialIndexMap.get(n),o=t.json.materials[i];o.extensions=o.extensions||{};const a=o.extensions[An]={};if(s.getSpecularFactor()!==1&&(a.specularFactor=s.getSpecularFactor()),Xe.eq(s.getSpecularColorFactor(),[1,1,1])||(a.specularColorFactor=s.getSpecularColorFactor()),s.getSpecularTexture()){const u=s.getSpecularTexture(),h=s.getSpecularTextureInfo();a.specularTexture=e.createTextureInfoDef(u,h)}if(s.getSpecularColorTexture()){const u=s.getSpecularColorTexture(),h=s.getSpecularColorTextureInfo();a.specularColorTexture=e.createTextureInfoDef(u,h)}}}),this}}va.EXTENSION_NAME=An;const{R:ih}=Wt;class Ea extends st{init(){this.extensionName=Mn,this.propertyType="Transmission",this.parentTypes=[k.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{transmissionFactor:0,transmissionTexture:null,transmissionTextureInfo:new Ye(this.graph,"transmissionTextureInfo")})}getTransmissionFactor(){return this.get("transmissionFactor")}setTransmissionFactor(e){return this.set("transmissionFactor",e)}getTransmissionTexture(){return this.getRef("transmissionTexture")}getTransmissionTextureInfo(){return this.getRef("transmissionTexture")?this.getRef("transmissionTextureInfo"):null}setTransmissionTexture(e){return this.setRef("transmissionTexture",e,{channels:ih})}}Ea.EXTENSION_NAME=Mn;class wa extends Ze{constructor(...e){super(...e),this.extensionName=Mn,this.prereadTypes=[k.MESH],this.prewriteTypes=[k.MESH]}createTransmission(){return new Ea(this.document.getGraph())}read(e){return this}write(e){return this}preread(e){const t=e.jsonDoc,n=t.json.materials||[],s=t.json.textures||[];return n.forEach((i,o)=>{if(i.extensions&&i.extensions[Mn]){const a=this.createTransmission();e.materials[o].setExtension(Mn,a);const u=i.extensions[Mn];if(u.transmissionFactor!==void 0&&a.setTransmissionFactor(u.transmissionFactor),u.transmissionTexture!==void 0){const h=u.transmissionTexture,y=e.textures[s[h.index].source];a.setTransmissionTexture(y),e.setTextureInfo(a.getTransmissionTextureInfo(),h)}}}),this}prewrite(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const s=n.getExtension(Mn);if(s){const i=e.materialIndexMap.get(n),o=t.json.materials[i];o.extensions=o.extensions||{};const a=o.extensions[Mn]={transmissionFactor:s.getTransmissionFactor()};if(s.getTransmissionTexture()){const u=s.getTransmissionTexture(),h=s.getTransmissionTextureInfo();a.transmissionTexture=e.createTextureInfoDef(u,h)}}}),this}}wa.EXTENSION_NAME=Mn;class ba extends st{init(){this.extensionName=Un,this.propertyType="Unlit",this.parentTypes=[k.MATERIAL]}}ba.EXTENSION_NAME=Un;class fi extends Ze{constructor(...e){super(...e),this.extensionName=Un,this.prereadTypes=[k.MESH],this.prewriteTypes=[k.MESH]}createUnlit(){return new ba(this.document.getGraph())}read(e){return this}write(e){return this}preread(e){return(e.jsonDoc.json.materials||[]).forEach((n,s)=>{n.extensions&&n.extensions[Un]&&e.materials[s].setExtension(Un,this.createUnlit())}),this}prewrite(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{if(n.getExtension(Un)){const s=e.materialIndexMap.get(n),i=t.json.materials[s];i.extensions=i.extensions||{},i.extensions[Un]={}}}),this}}fi.EXTENSION_NAME=Un;class _a extends st{init(){this.extensionName=wt,this.propertyType="Mapping",this.parentTypes=["MappingList"]}getDefaults(){return Object.assign(super.getDefaults(),{material:null,variants:new Je})}getMaterial(){return this.getRef("material")}setMaterial(e){return this.setRef("material",e)}addVariant(e){return this.addRef("variants",e)}removeVariant(e){return this.removeRef("variants",e)}listVariants(){return this.listRefs("variants")}}_a.EXTENSION_NAME=wt;class Ra extends st{init(){this.extensionName=wt,this.propertyType="MappingList",this.parentTypes=[k.PRIMITIVE]}getDefaults(){return Object.assign(super.getDefaults(),{mappings:new Je})}addMapping(e){return this.addRef("mappings",e)}removeMapping(e){return this.removeRef("mappings",e)}listMappings(){return this.listRefs("mappings")}}Ra.EXTENSION_NAME=wt;class ei extends st{init(){this.extensionName=wt,this.propertyType="Variant",this.parentTypes=["MappingList"]}}ei.EXTENSION_NAME=wt;class Ia extends Ze{constructor(...e){super(...e),this.extensionName=wt}createMappingList(){return new Ra(this.document.getGraph())}createVariant(e=""){return new ei(this.document.getGraph(),e)}createMapping(){return new _a(this.document.getGraph())}listVariants(){return Array.from(this.properties).filter(e=>e instanceof ei)}read(e){const t=e.jsonDoc;if(!t.json.extensions||!t.json.extensions[wt])return this;const i=(t.json.extensions[wt].variants||[]).map(a=>this.createVariant().setName(a.name||""));return(t.json.meshes||[]).forEach((a,u)=>{const h=e.meshes[u];(a.primitives||[]).forEach((v,p)=>{if(!v.extensions||!v.extensions[wt])return;const T=this.createMappingList(),C=v.extensions[wt];for(const G of C.mappings){const V=this.createMapping();G.material!==void 0&&V.setMaterial(e.materials[G.material]);for(const E of G.variants||[])V.addVariant(i[E]);T.addMapping(V)}h.listPrimitives()[p].setExtension(wt,T)})}),this}write(e){const t=e.jsonDoc,n=this.listVariants();if(!n.length)return this;const s=[],i=new Map;for(const o of n)i.set(o,s.length),s.push(e.createPropertyDef(o));for(const o of this.document.getRoot().listMeshes()){const a=e.meshIndexMap.get(o);o.listPrimitives().forEach((u,h)=>{const y=u.getExtension(wt);if(!y)return;const v=e.jsonDoc.json.meshes[a].primitives[h],p=y.listMappings().map(T=>{const C=e.createPropertyDef(T),G=T.getMaterial();return G&&(C.material=e.materialIndexMap.get(G)),C.variants=T.listVariants().map(V=>i.get(V)),C});v.extensions=v.extensions||{},v.extensions[wt]={mappings:p}})}return t.json.extensions=t.json.extensions||{},t.json.extensions[wt]={variants:s},this}}Ia.EXTENSION_NAME=wt;const{G:oh}=Wt;class Sa extends st{init(){this.extensionName=Cn,this.propertyType="Volume",this.parentTypes=[k.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{thicknessFactor:0,thicknessTexture:null,thicknessTextureInfo:new Ye(this.graph,"thicknessTexture"),attenuationDistance:1/0,attenuationColor:[1,1,1]})}getThicknessFactor(){return this.get("thicknessFactor")}setThicknessFactor(e){return this.set("thicknessFactor",e)}getThicknessTexture(){return this.getRef("thicknessTexture")}getThicknessTextureInfo(){return this.getRef("thicknessTexture")?this.getRef("thicknessTextureInfo"):null}setThicknessTexture(e){return this.setRef("thicknessTexture",e,{channels:oh})}getAttenuationDistance(){return this.get("attenuationDistance")}setAttenuationDistance(e){return this.set("attenuationDistance",e)}getAttenuationColor(){return this.get("attenuationColor")}setAttenuationColor(e){return this.set("attenuationColor",e)}}Sa.EXTENSION_NAME=Cn;class Aa extends Ze{constructor(...e){super(...e),this.extensionName=Cn,this.prereadTypes=[k.MESH],this.prewriteTypes=[k.MESH]}createVolume(){return new Sa(this.document.getGraph())}read(e){return this}write(e){return this}preread(e){const t=e.jsonDoc,n=t.json.materials||[],s=t.json.textures||[];return n.forEach((i,o)=>{if(i.extensions&&i.extensions[Cn]){const a=this.createVolume();e.materials[o].setExtension(Cn,a);const u=i.extensions[Cn];if(u.thicknessFactor!==void 0&&a.setThicknessFactor(u.thicknessFactor),u.attenuationDistance!==void 0&&a.setAttenuationDistance(u.attenuationDistance),u.attenuationColor!==void 0&&a.setAttenuationColor(u.attenuationColor),u.thicknessTexture!==void 0){const h=u.thicknessTexture,y=e.textures[s[h.index].source];a.setThicknessTexture(y),e.setTextureInfo(a.getThicknessTextureInfo(),h)}}}),this}prewrite(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const s=n.getExtension(Cn);if(s){const i=e.materialIndexMap.get(n),o=t.json.materials[i];o.extensions=o.extensions||{};const a=o.extensions[Cn]={};if(s.getThicknessFactor()>0&&(a.thicknessFactor=s.getThicknessFactor()),Number.isFinite(s.getAttenuationDistance())&&(a.attenuationDistance=s.getAttenuationDistance()),Xe.eq(s.getAttenuationColor(),[1,1,1])||(a.attenuationColor=s.getAttenuationColor()),s.getThicknessTexture()){const u=s.getThicknessTexture(),h=s.getThicknessTextureInfo();a.thicknessTexture=e.createTextureInfoDef(u,h)}}}),this}}Aa.EXTENSION_NAME=Cn;class Ma extends Ze{constructor(...e){super(...e),this.extensionName=zo}read(e){return this}write(e){return this}}Ma.EXTENSION_NAME=zo;class ah{match(e){return e[0]===171&&e[1]===75&&e[2]===84&&e[3]===88&&e[4]===32&&e[5]===50&&e[6]===48&&e[7]===187&&e[8]===13&&e[9]===10&&e[10]===26&&e[11]===10}getSize(e){const t=Ls(e);return[t.pixelWidth,t.pixelHeight]}getChannels(e){const n=Ls(e).dataFormatDescriptor[0];if(n.colorModel===df)return n.samples.length===2&&(n.samples[1].channelType&15)===15?4:3;if(n.colorModel===pf)return(n.samples[0].channelType&15)===3?4:3;throw new Error(`Unexpected KTX2 colorModel, "${n.colorModel}".`)}getVRAMByteLength(e){const t=Ls(e),n=this.getChannels(e)>3;let s=0;for(let i=0;i<t.levels.length;i++){const o=t.levels[i];if(o.uncompressedByteLength)s+=o.uncompressedByteLength;else{const a=Math.max(1,Math.floor(t.pixelWidth/Math.pow(2,i))),u=Math.max(1,Math.floor(t.pixelHeight/Math.pow(2,i))),h=n?16:8;s+=a/4*(u/4)*h}}return s}}class Ca extends Ze{constructor(...e){super(...e),this.extensionName=br,this.prereadTypes=[k.TEXTURE]}static register(){sn.registerFormat("image/ktx2",new ah)}preread(e){return e.jsonDoc.json.textures.forEach(t=>{if(t.extensions&&t.extensions[br]){const n=t.extensions[br];t.source=n.source}}),this}read(e){return this}write(e){const t=e.jsonDoc;return this.document.getRoot().listTextures().forEach(n=>{if(n.getMimeType()==="image/ktx2"){const s=e.imageIndexMap.get(n);t.json.textures.forEach(i=>{i.source===s&&(i.extensions=i.extensions||{},i.extensions[br]={source:i.source},delete i.source)})}}),this}}Ca.EXTENSION_NAME=br;class Na extends st{init(){this.extensionName=Nn,this.propertyType="Transform",this.parentTypes=[k.TEXTURE_INFO]}getDefaults(){return Object.assign(super.getDefaults(),{offset:[0,0],rotation:0,scale:[1,1],texCoord:null})}getOffset(){return this.get("offset")}setOffset(e){return this.set("offset",e)}getRotation(){return this.get("rotation")}setRotation(e){return this.set("rotation",e)}getScale(){return this.get("scale")}setScale(e){return this.set("scale",e)}getTexCoord(){return this.get("texCoord")}setTexCoord(e){return this.set("texCoord",e)}}Na.EXTENSION_NAME=Nn;class Oa extends Ze{constructor(...e){super(...e),this.extensionName=Nn}createTransform(){return new Na(this.document.getGraph())}read(e){for(const[t,n]of Array.from(e.textureInfos.entries())){if(!n.extensions||!n.extensions[Nn])continue;const s=this.createTransform(),i=n.extensions[Nn];i.offset!==void 0&&s.setOffset(i.offset),i.rotation!==void 0&&s.setRotation(i.rotation),i.scale!==void 0&&s.setScale(i.scale),i.texCoord!==void 0&&s.setTexCoord(i.texCoord),t.setExtension(Nn,s)}return this}write(e){const t=Array.from(e.textureInfoDefMap.entries());for(const[n,s]of t){const i=n.getExtension(Nn);if(!i)continue;s.extensions=s.extensions||{};const o={},a=Xe.eq;a(i.getOffset(),[0,0])||(o.offset=i.getOffset()),i.getRotation()!==0&&(o.rotation=i.getRotation()),a(i.getScale(),[1,1])||(o.scale=i.getScale()),i.getTexCoord()!=null&&(o.texCoord=i.getTexCoord()),s.extensions[Nn]=o}return this}}Oa.EXTENSION_NAME=Nn;const ch=[k.ROOT,k.SCENE,k.NODE,k.MESH,k.MATERIAL,k.TEXTURE,k.ANIMATION];class Da extends st{init(){this.extensionName=Gt,this.propertyType="Packet",this.parentTypes=ch}getDefaults(){return Object.assign(super.getDefaults(),{context:{},properties:{}})}getContext(){return this.get("context")}setContext(e){return this.set("context",On({},e))}listProperties(){return Object.keys(this.get("properties"))}getProperty(e){const t=this.get("properties");return e in t?t[e]:null}setProperty(e,t){this._assertContext(e);const n=On({},this.get("properties"));return t?n[e]=t:delete n[e],this.set("properties",n)}toJSONLD(){const e=$s(this.get("context")),t=$s(this.get("properties"));return On({"@context":e},t)}fromJSONLD(e){e=$s(e);const t=e["@context"];return t&&this.set("context",t),delete e["@context"],this.set("properties",e)}_assertContext(e){if(!(e.split(":")[0]in this.get("context")))throw new Error(`${Gt}: Missing context for term, "${e}".`)}}Da.EXTENSION_NAME=Gt;function $s(r){return JSON.parse(JSON.stringify(r))}class Pa extends Ze{constructor(...e){super(...e),this.extensionName=Gt}createPacket(){return new Da(this.document.getGraph())}listPackets(){return Array.from(this.properties)}read(e){var t;const n=(t=e.jsonDoc.json.extensions)==null?void 0:t[Gt];if(!n||!n.packets)return this;const s=e.jsonDoc.json,i=this.document.getRoot(),o=n.packets.map(h=>this.createPacket().fromJSONLD(h)),a=[[s.asset],s.scenes,s.nodes,s.meshes,s.materials,s.images,s.animations],u=[[i],i.listScenes(),i.listNodes(),i.listMeshes(),i.listMaterials(),i.listTextures(),i.listAnimations()];for(let h=0;h<a.length;h++){const y=a[h]||[];for(let v=0;v<y.length;v++){const p=y[v];if(p.extensions&&p.extensions[Gt]){const T=p.extensions[Gt];u[h][v].setExtension(Gt,o[T.packet])}}}return this}write(e){const{json:t}=e.jsonDoc,n=[];for(const s of this.properties){n.push(s.toJSONLD());for(const i of s.listParents()){let o;switch(i.propertyType){case k.ROOT:o=t.asset;break;case k.SCENE:o=t.scenes[e.sceneIndexMap.get(i)];break;case k.NODE:o=t.nodes[e.nodeIndexMap.get(i)];break;case k.MESH:o=t.meshes[e.meshIndexMap.get(i)];break;case k.MATERIAL:o=t.materials[e.materialIndexMap.get(i)];break;case k.TEXTURE:o=t.images[e.imageIndexMap.get(i)];break;case k.ANIMATION:o=t.animations[e.animationIndexMap.get(i)];break;default:o=null,this.document.getLogger().warn(`[${Gt}]: Unsupported parent property, "${i.propertyType}"`);break}o&&(o.extensions=o.extensions||{},o.extensions[Gt]={packet:n.length-1})}}return n.length>0&&(t.extensions=t.extensions||{},t.extensions[Gt]={packets:n}),this}}Pa.EXTENSION_NAME=Gt;const Fa=[ui,ea,na,sa,oa,ca,ua,ha,pa,ma,va,Ta,wa,fi,Ia,Aa,Ma,Ca,Oa,Pa];[...Fa];const rn="EXT_mesh_manifold",fo="MERGE";class hi extends st{static EXTENSION_NAME=rn;init(){hi.EXTENSION_NAME=rn,this.propertyType="ManifoldPrimitive",this.parentTypes=[k.MESH]}getDefaults(){return Object.assign(super.getDefaults(),{manifoldPrimitive:null,mergeIndices:null,mergeValues:null})}getMergeIndices(){return this.getRef("mergeIndices")}getMergeValues(){return this.getRef("mergeValues")}setMerge(e,t){if(e.getCount()!==t.getCount())throw new Error("merge vectors must be the same length.");return this.setRef("mergeIndices",e),this.setRef("mergeValues",t)}getRunIndex(){return this.get("runIndex")}setRunIndex(e){return this.set("runIndex",e)}setIndices(e){return this.setRef("indices",e)}getIndices(){return this.getRef("indices")}}class Ua extends Ze{extensionName=rn;prewriteTypes=[k.ACCESSOR];static EXTENSION_NAME=rn;createManifoldPrimitive(){return new hi(this.document.getGraph())}read(e){const{json:t}=e.jsonDoc;return(t.meshes||[]).forEach((s,i)=>{if(!s.extensions||!s.extensions[rn])return;const o=e.meshes[i],a=this.createManifoldPrimitive();o.setExtension(rn,a);const u=s.extensions[rn];if(u.manifoldPrimitive){let h=0;const y=Array();y.push(h);for(const v of o.listPrimitives()){const p=v.getIndices();if(!p){console.log("Skipping non-indexed primitive ",v.getName());continue}h+=p.getCount(),y.push(h)}a.setRunIndex(y),a.setIndices(e.accessors[u.manifoldPrimitive.indices])}u.mergeIndices!=null&&u.mergeValues!=null&&a.setMerge(e.accessors[u.mergeIndices],e.accessors[u.mergeValues])}),this}prewrite(e){return this.document.getRoot().listMeshes().forEach(t=>{const n=t.getExtension(rn);if(!n)return;const s=n.getIndices();e.addAccessorToUsageGroup(s,en.BufferViewUsage.ELEMENT_ARRAY_BUFFER);const i=n.getMergeIndices(),o=n.getMergeValues();!i||!o||(e.addAccessorToUsageGroup(i,fo),e.addAccessorToUsageGroup(o,fo))}),this}write(e){const{json:t}=e.jsonDoc;return this.document.getRoot().listMeshes().forEach(n=>{const s=n.getExtension(rn);if(!s)return;const i=e.meshIndexMap.get(n),o=t.meshes[i],a=s.getRunIndex(),u=a.length-1;if(u!==o.primitives.length)throw new Error("The number of primitives must be exactly one less than the length of runIndex.");const h=e.accessorIndexMap.get(s.getMergeIndices()),y=e.accessorIndexMap.get(s.getMergeValues()),v=t.accessors[h],p=t.accessors[y],T=o.primitives[0],C={indices:e.accessorIndexMap.get(s.getIndices()),mode:T.mode,attributes:{POSITION:T.attributes.POSITION}},G=t.accessors[C.indices];if(G){v&&p&&(G.sparse={count:v.count,indices:{bufferView:v.bufferView,byteOffset:v.byteOffset,componentType:v.componentType},values:{bufferView:p.bufferView,byteOffset:p.byteOffset}});for(let V=0;V<u;++V){const E=t.accessors[o.primitives[V].indices];E.bufferView=G.bufferView,E.byteOffset=G.byteOffset+4*a[V],E.count=a[V+1]-a[V]}o.extensions=o.extensions||{},o.extensions[rn]={manifoldPrimitive:C,mergeIndices:h,mergeValues:y}}}),this}}const vr={POSITION:{type:oe.Type.VEC3,components:3},NORMAL:{type:oe.Type.VEC3,components:3},TANGENT:{type:oe.Type.VEC4,components:4},TEXCOORD_0:{type:oe.Type.VEC2,components:2},TEXCOORD_1:{type:oe.Type.VEC2,components:2},COLOR_0:{type:oe.Type.VEC3,components:3},JOINTS_0:{type:oe.Type.VEC4,components:4},WEIGHTS_0:{type:oe.Type.VEC4,components:4},SKIP_1:{type:null,components:1},SKIP_2:{type:null,components:2},SKIP_3:{type:null,components:3},SKIP_4:{type:null,components:4}};function lh(r){return r.registerExtensions([Ua])}function ka(r,e,t){r.getRoot().listBuffers().length===0&&r.createBuffer();const n=r.getRoot().listBuffers()[0],s=r.createExtension(Ua),i=r.createMesh(),o=Array(),a=Array(),u=new Map,h=e.runIndex.length-1;let y=-1;for(let _=0;_<h;++_){const N=e.runOriginalID[_];if(N==y)continue;y=N,o.push(e.runIndex[_]);const P=r.createAccessor("primitive indices of ID "+N).setBuffer(n).setType(oe.Type.SCALAR).setArray(new Uint32Array(1)),B=r.createPrimitive().setIndices(P),d=t.get(N);if(d){const{material:R,attributes:b}=d;if(b.length<1||b[0]!=="POSITION")throw new Error('First attribute must be "POSITION".');B.setMaterial(R),u.set(B,b),d.attributes.forEach(($,Q)=>{if(Q>=a.length)a.push($);else{const ee=vr[$].components,fe=vr[a[Q]].components;if(ee!=fe)throw new Error("Attribute sizes do not correspond: "+$+" and "+a[Q]);vr[a[Q]].type==null&&(a[Q]=$)}})}else u.set(B,["POSITION"]);i.addPrimitive(B)}o.push(e.runIndex[h]);const v=e.numVert,p=e.numProp;let T=0;a.forEach((_,N)=>{const P=vr[_];if(P==null)throw new Error(_+" is not a recognized attribute.");if(P.type==null){++T;return}const B=P.components;if(T+B>p)throw new Error("Too many attribute channels.");const d=new Float32Array(B*v);for(let b=0;b<v;++b)for(let $=0;$<B;++$){let Q=e.vertProperties[p*b+T+$];_=="COLOR_0"&&(Q=Math.max(0,Math.min(1,Q))),d[B*b+$]=Q}const R=r.createAccessor(_).setBuffer(n).setType(P.type).setArray(d);for(const b of i.listPrimitives()){const $=u.get(b);$.length>N&&vr[$[N]].type!=null&&b.setAttribute(_,R)}T+=B});const C=s.createManifoldPrimitive();i.setExtension("EXT_mesh_manifold",C);const G=r.createAccessor("manifold indices").setBuffer(n).setType(oe.Type.SCALAR).setArray(e.triVerts);C.setIndices(G),C.setRunIndex(o);const V=[...Array(e.numVert).keys()],E=Array(),F=Array();if(e.mergeFromVert&&e.mergeToVert){for(const[_,N]of e.mergeFromVert.entries())V[N]=e.mergeToVert[_];for(const[_,N]of e.triVerts.entries()){const P=V[N];N!==P&&(E.push(_),F.push(P))}}if(E.length>0){const _=r.createAccessor("merge from").setBuffer(n).setType(oe.Type.SCALAR).setArray(new Uint32Array(E)),N=r.createAccessor("merge to").setBuffer(n).setType(oe.Type.SCALAR).setArray(new Uint32Array(F));C.setMerge(_,N)}return i}class uh{extensions=["glb","gltf"];async asBlob(e){const t=lh(new Cl);t.registerExtensions(Fa);const n=await t.writeBinary(e);return new Blob([n],{type:"application/octet-stream"})}}const ti=Array(),fh=["cube","cylinder","sphere","tetrahedron","extrude","revolve","compose","union","difference","intersection","levelSet","smooth","ofMesh","hull"],hh=["add","subtract","intersect","decompose","warp","transform","translate","rotate","scale","mirror","calculateCurvature","calculateNormals","smoothByNormals","smoothOut","refine","refineToLength","refineToTolerance","setProperties","setTolerance","simplify","asOriginal","trimByPlane","split","splitByPlane","slice","project","hull"],dh=["square","circle","union","difference","intersection","compose","ofPolygons","hull"],ph=["add","subtract","intersect","rectClip","decompose","transform","translate","rotate","scale","mirror","simplify","offset","hull"],gh=()=>{for(const r of ti)if(r instanceof Array)for(const e of r)e.delete();else r.delete();ti.length=0},mh=r=>(...e)=>{const t=r(...e);return ti.push(t),t},Kr=(r,e)=>{for(const t of e){const n=r[t];r[t]=mh(n)}},ed=r=>(Kr(r.Manifold,fh),Kr(r.Manifold.prototype,hh),Kr(r.CrossSection,dh),Kr(r.CrossSection.prototype,ph),r);class td{attributes;roughness;metallic;baseColorFactor;alpha;unlit;name}class Pr{_parent;manifold;translation;rotation;scale;material;name;constructor(e){this._parent=e}clone(e){const t=new Pr(e??this.parent);return Object.assign(t,this),t}get parent(){return this._parent}}const di=new Array;class yh extends Pr{constructor(e){super(e),di.push(this)}}const ho=()=>di,ja=()=>{di.length=0},Th=()=>{ja()};async function ni(r){if(Array.isArray(r))return await r.map(ni).reduce(async(e,t)=>[...await e,...await t],new Promise(e=>e([])));if(r instanceof Pr){const e=r;return e.parent?[await ni(e.parent),e].flat():[e]}else if(r.constructor.name==="Manifold"){const e=new Pr;return e.manifold=r,[e]}throw new Error("Cannot convert model to GLTFNode!")}var po=(()=>{var r=import.meta.url;return(async function(e={}){var t,n=e,s,i,o=new Promise((c,l)=>{s=c,i=l}),a=typeof window=="object",u=typeof importScripts=="function",h=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string";if(h){const{createRequire:c}=await Promise.resolve().then(function(){return ls});var y=c(import.meta.url)}var v=!1;n.setup=function(){if(v)return;v=!0,n.initTBB();function c(I,O,W=(se=>se)){if(O)for(let se of O)I.push_back(W(se));return I}function l(I,O=(W=>W)){const W=[],se=I.size();for(let Me=0;Me<se;Me++)W.push(O(I.get(Me)));return W}function f(I,O=(W=>W)){const W=[],se=I.size();for(let Me=0;Me<se;Me++){const qe=I.get(Me),ut=qe.size(),Pt=[];for(let yt=0;yt<ut;yt++)Pt.push(O(qe.get(yt)));W.push(Pt)}return W}function g(I){return I[0].length<3&&(I=[I]),c(new n.Vector2_vec2,I,O=>c(new n.Vector_vec2,O,W=>W instanceof Array?{x:W[0],y:W[1]}:W))}function M(I){for(let O=0;O<I.size();O++)I.get(O).delete();I.delete()}function U(I){return I[0]instanceof Array?{x:I[0][0],y:I[0][1]}:typeof I[0]=="number"?{x:I[0]||0,y:I[1]||0}:I[0]}function q(I){return I[0]instanceof Array?{x:I[0][0],y:I[0][1],z:I[0][2]}:typeof I[0]=="number"?{x:I[0]||0,y:I[1]||0,z:I[2]||0}:I[0]}function j(I){return I=="EvenOdd"?0:I=="NonZero"?1:I=="Negative"?3:2}function Z(I){return I=="Round"?1:I=="Miter"?2:0}const re=n.CrossSection;function ue(I,O="Positive"){if(I instanceof re)return I;{const W=g(I),se=new re(W,j(O));return M(W),se}}n.CrossSection.prototype.translate=function(...I){return this._Translate(U(I))},n.CrossSection.prototype.scale=function(I){return typeof I=="number"?this._Scale({x:I,y:I}):this._Scale(U([I]))},n.CrossSection.prototype.mirror=function(I){return this._Mirror(U([I]))},n.CrossSection.prototype.warp=function(I){const O=pr(function(se){const Me=gt(se,"double"),qe=gt(se+8,"double"),ut=[Me,qe];I(ut),ln(se,ut[0],"double"),ln(se+8,ut[1],"double")},"vi"),W=this._Warp(O);return gr(O),W},n.CrossSection.prototype.decompose=function(){const I=this._Decompose(),O=l(I);return I.delete(),O},n.CrossSection.prototype.bounds=function(){const I=this._Bounds();return{min:["x","y"].map(O=>I.min[O]),max:["x","y"].map(O=>I.max[O])}},n.CrossSection.prototype.offset=function(I,O="Round",W=2,se=0){return this._Offset(I,Z(O),W,se)},n.CrossSection.prototype.simplify=function(I=1e-6){return this._Simplify(I)},n.CrossSection.prototype.extrude=function(I,O=0,W=0,se=[1,1],Me=!1){se=U([se]);const qe=n._Extrude(this._ToPolygons(),I,O,W,se);return Me?qe.translate([0,0,-I/2]):qe},n.CrossSection.prototype.revolve=function(I=0,O=360){return n._Revolve(this._ToPolygons(),I,O)},n.CrossSection.prototype.add=function(I){return this._add(ue(I))},n.CrossSection.prototype.subtract=function(I){return this._subtract(ue(I))},n.CrossSection.prototype.intersect=function(I){return this._intersect(ue(I))},n.CrossSection.prototype.toPolygons=function(){const I=this._ToPolygons(),O=f(I,W=>[W.x,W.y]);return I.delete(),O},n.Manifold.prototype.smoothOut=function(I=60,O=0){return this._SmoothOut(I,O)},n.Manifold.prototype.warp=function(I){const O=pr(function(Me){const qe=gt(Me,"double"),ut=gt(Me+8,"double"),Pt=gt(Me+16,"double"),yt=[qe,ut,Pt];I(yt),ln(Me,yt[0],"double"),ln(Me+8,yt[1],"double"),ln(Me+16,yt[2],"double")},"vi"),W=this._Warp(O);gr(O);const se=W.status();if(se!=="NoError")throw new n.ManifoldError(se);return W},n.Manifold.prototype.calculateNormals=function(I,O=60){return this._CalculateNormals(I,O)},n.Manifold.prototype.setProperties=function(I,O){const W=this.numProp(),se=pr(function(qe,ut,Pt){const yt=[];for(let ft=0;ft<I;++ft)yt[ft]=gt(qe+8*ft,"double");const er=[];for(let ft=0;ft<3;++ft)er[ft]=gt(ut+8*ft,"double");const tr=[];for(let ft=0;ft<W;++ft)tr[ft]=gt(Pt+8*ft,"double");O(yt,er,tr);for(let ft=0;ft<I;++ft)ln(qe+8*ft,yt[ft],"double")},"viii"),Me=this._SetProperties(I,se);return gr(se),Me},n.Manifold.prototype.translate=function(...I){return this._Translate(q(I))},n.Manifold.prototype.rotate=function(I,O,W){return Array.isArray(I)?this._Rotate(...I):this._Rotate(I,O||0,W||0)},n.Manifold.prototype.scale=function(I){return typeof I=="number"?this._Scale({x:I,y:I,z:I}):this._Scale(q([I]))},n.Manifold.prototype.mirror=function(I){return this._Mirror(q([I]))},n.Manifold.prototype.trimByPlane=function(I,O=0){return this._TrimByPlane(q([I]),O)},n.Manifold.prototype.slice=function(I=0){const O=this._Slice(I),W=new re(O,j("Positive"));return M(O),W},n.Manifold.prototype.project=function(){const I=this._Project(),O=new re(I,j("Positive"));return M(I),O},n.Manifold.prototype.split=function(I){const O=this._Split(I),W=l(O);return O.delete(),W},n.Manifold.prototype.splitByPlane=function(I,O=0){const W=this._SplitByPlane(q([I]),O),se=l(W);return W.delete(),se},n.Manifold.prototype.decompose=function(){const I=this._Decompose(),O=l(I);return I.delete(),O},n.Manifold.prototype.boundingBox=function(){const I=this._boundingBox();return{min:["x","y","z"].map(O=>I.min[O]),max:["x","y","z"].map(O=>I.max[O])}};class Ae{constructor({numProp:O=3,triVerts:W=new Uint32Array,vertProperties:se=new Float32Array,mergeFromVert:Me,mergeToVert:qe,runIndex:ut,runOriginalID:Pt,faceID:yt,halfedgeTangent:er,runTransform:tr}={}){this.numProp=O,this.triVerts=W,this.vertProperties=se,this.mergeFromVert=Me,this.mergeToVert=qe,this.runIndex=ut,this.runOriginalID=Pt,this.faceID=yt,this.halfedgeTangent=er,this.runTransform=tr}get numTri(){return this.triVerts.length/3}get numVert(){return this.vertProperties.length/this.numProp}get numRun(){return this.runOriginalID.length}merge(){const{changed:O,mesh:W}=n._Merge(this);return Object.assign(this,{...W}),O}verts(O){return this.triVerts.subarray(3*O,3*(O+1))}position(O){return this.vertProperties.subarray(this.numProp*O,this.numProp*O+3)}extras(O){return this.vertProperties.subarray(this.numProp*O+3,this.numProp*(O+1))}tangent(O){return this.halfedgeTangent.subarray(4*O,4*(O+1))}transform(O){const W=new Array(16);for(const se of[0,1,2,3])for(const Me of[0,1,2])W[4*se+Me]=this.runTransform[12*O+3*se+Me];return W[15]=1,W}}n.Mesh=Ae,n.Manifold.prototype.getMesh=function(I=-1){return new Ae(this._GetMeshJS(I))},n.ManifoldError=function(O,...W){let se="Unknown error";switch(O){case"NonFiniteVertex":se="Non-finite vertex";break;case"NotManifold":se="Not manifold";break;case"VertexOutOfBounds":se="Vertex index out of bounds";break;case"PropertiesWrongLength":se="Properties have wrong length";break;case"MissingPositionProperties":se="Less than three properties";break;case"MergeVectorsDifferentLengths":se="Merge vectors have different lengths";break;case"MergeIndexOutOfBounds":se="Merge index out of bounds";break;case"TransformWrongLength":se="Transform vector has wrong length";break;case"RunIndexWrongLength":se="Run index vector has wrong length";break;case"FaceIDWrongLength":se="Face ID vector has wrong length";case"InvalidConstruction":se="Manifold constructed with invalid parameters"}const Me=Error.apply(this,[se,...W]);Me.name=this.name="ManifoldError",this.message=Me.message,this.stack=Me.stack,this.code=O},n.ManifoldError.prototype=Object.create(Error.prototype,{constructor:{value:n.ManifoldError,writable:!0,configurable:!0}}),n.CrossSection=function(I,O="Positive"){const W=g(I),se=new re(W,j(O));return M(W),se},n.CrossSection.ofPolygons=function(I,O="Positive"){return new n.CrossSection(I,O)},n.CrossSection.square=function(...I){let O;I.length==0?O={x:1,y:1}:typeof I[0]=="number"?O={x:I[0],y:I[0]}:O=U(I);const W=I[1]||!1;return n._Square(O,W)},n.CrossSection.circle=function(I,O=0){return n._Circle(I,O)};function Ge(I){return function(...O){O.length==1&&(O=O[0]);const W=new n.Vector_crossSection;for(const Me of O)W.push_back(ue(Me));const se=n["_crossSection"+I](W);return W.delete(),se}}n.CrossSection.compose=Ge("Compose"),n.CrossSection.union=Ge("UnionN"),n.CrossSection.difference=Ge("DifferenceN"),n.CrossSection.intersection=Ge("IntersectionN");function ht(I,O){c(I,O,W=>W instanceof Array?{x:W[0],y:W[1]}:W)}n.CrossSection.hull=function(...I){I.length==1&&(I=I[0]);let O=new n.Vector_vec2;for(const se of I)if(se instanceof re)n._crossSectionCollectVertices(O,se);else if(se instanceof Array&&se.length==2&&typeof se[0]=="number")O.push_back({x:se[0],y:se[1]});else if(se.x)O.push_back(se);else{const qe=se[0].length==2&&typeof se[0][0]=="number"||se[0].x?[se]:se;for(const ut of qe)ht(O,ut)}const W=n._crossSectionHullPoints(O);return O.delete(),W},n.CrossSection.prototype=Object.create(re.prototype),Object.defineProperty(n.CrossSection,Symbol.hasInstance,{get:()=>I=>I instanceof re});const at=n.Manifold;n.Manifold=function(I){const O=new at(I),W=O.status();if(W!=="NoError")throw new n.ManifoldError(W);return O},n.Manifold.ofMesh=function(I){return new n.Manifold(I)},n.Manifold.tetrahedron=function(){return n._Tetrahedron()},n.Manifold.cube=function(...I){let O;I.length==0?O={x:1,y:1,z:1}:typeof I[0]=="number"?O={x:I[0],y:I[0],z:I[0]}:O=q(I);const W=I[1]||!1;return n._Cube(O,W)},n.Manifold.cylinder=function(I,O,W=-1,se=0,Me=!1){return n._Cylinder(I,O,W,se,Me)},n.Manifold.sphere=function(I,O=0){return n._Sphere(I,O)},n.Manifold.smooth=function(I,O=[]){const W=new n.Vector_smoothness;c(W,O);const se=n._Smooth(I,W);return W.delete(),se},n.Manifold.extrude=function(I,O,W=0,se=0,Me=[1,1],qe=!1){return(I instanceof re?I:n.CrossSection(I,"Positive")).extrude(O,W,se,Me,qe)},n.Manifold.revolve=function(I,O=0,W=360){return(I instanceof re?I:n.CrossSection(I,"Positive")).revolve(O,W)},n.Manifold.reserveIDs=function(I){return n._ReserveIDs(I)},n.Manifold.compose=function(I){const O=new n.Vector_manifold;c(O,I);const W=n._manifoldCompose(O);return O.delete(),W};function Jt(I){return function(...O){O.length==1&&(O=O[0]);const W=new n.Vector_manifold;for(const Me of O)W.push_back(Me);const se=n["_manifold"+I+"N"](W);return W.delete(),se}}n.Manifold.union=Jt("Union"),n.Manifold.difference=Jt("Difference"),n.Manifold.intersection=Jt("Intersection"),n.Manifold.levelSet=function(I,O,W,se=0,Me=-1){const qe={min:{x:O.min[0],y:O.min[1],z:O.min[2]},max:{x:O.max[0],y:O.max[1],z:O.max[2]}},ut=pr(function(yt){const er=gt(yt,"double"),tr=gt(yt+8,"double"),ft=gt(yt+16,"double");return I([er,tr,ft])},"di"),Pt=n._LevelSet(ut,qe,W,se,Me);return gr(ut),Pt};function Zt(I,O){c(I,O,W=>W instanceof Array?{x:W[0],y:W[1],z:W[2]}:W)}n.Manifold.hull=function(...I){I.length==1&&(I=I[0]);let O=new n.Vector_vec3;for(const se of I)se instanceof at?n._manifoldCollectVertices(O,se):se instanceof Array&&se.length==3&&typeof se[0]=="number"?O.push_back({x:se[0],y:se[1],z:se[2]}):se.x?O.push_back(se):Zt(O,se);const W=n._manifoldHullPoints(O);return O.delete(),W},n.Manifold.prototype=Object.create(at.prototype),Object.defineProperty(n.Manifold,Symbol.hasInstance,{get:()=>I=>I instanceof at}),n.triangulate=function(I,O=-1,W=!0){const se=g(I),Me=l(n._Triangulate(se,O,W),qe=>[qe[0],qe[1],qe[2]]);return M(se),Me}};var p=Object.assign({},n),T="";function C(c){return n.locateFile?n.locateFile(c,T):T+c}var G,V;if(h){var E=y("fs"),F=y("path");T=y("url").fileURLToPath(new URL("/assets/manifold-B8h_vZ5O.js",import.meta.url)),V=c=>{c=Mt(c)?new URL(c):F.normalize(c);var l=E.readFileSync(c);return l},G=(c,l=!0)=>(c=Mt(c)?new URL(c):F.normalize(c),new Promise((f,g)=>{E.readFile(c,l?void 0:"utf8",(M,U)=>{M?g(M):f(l?U.buffer:U)})})),!n.thisProgram&&process.argv.length>1&&process.argv[1].replace(/\\/g,"/"),process.argv.slice(2)}else(a||u)&&(u?T=self.location.href:typeof document<"u"&&document.currentScript&&(T=document.currentScript.src),r&&(T=r),T.startsWith("blob:")?T="":T=T.substr(0,T.replace(/[?#].*/,"").lastIndexOf("/")+1),u&&(V=c=>{var l=new XMLHttpRequest;return l.open("GET",c,!1),l.responseType="arraybuffer",l.send(null),new Uint8Array(l.response)}),G=c=>Mt(c)?new Promise((l,f)=>{var g=new XMLHttpRequest;g.open("GET",c,!0),g.responseType="arraybuffer",g.onload=()=>{(g.status==200||g.status==0&&g.response)&&f(g.response),l(g.status)},g.onerror=l,g.send(null)}):fetch(c,{credentials:"same-origin"}).then(l=>l.ok?l.arrayBuffer():Promise.reject(new Error(l.status+" : "+l.url))));n.print||console.log.bind(console);var _=n.printErr||console.error.bind(console);Object.assign(n,p),p=null,n.arguments&&n.arguments,n.thisProgram&&n.thisProgram,n.quit&&n.quit;var N;n.wasmBinary&&(N=n.wasmBinary);var P,B=!1,d,R,b,$,Q,ee,fe,Ee;function me(){var c=P.buffer;n.HEAP8=d=new Int8Array(c),n.HEAP16=b=new Int16Array(c),n.HEAPU8=R=new Uint8Array(c),n.HEAPU16=$=new Uint16Array(c),n.HEAP32=Q=new Int32Array(c),n.HEAPU32=ee=new Uint32Array(c),n.HEAPF32=fe=new Float32Array(c),n.HEAPF64=Ee=new Float64Array(c)}var be=[],Ie=[],He=[];function We(){if(n.preRun)for(typeof n.preRun=="function"&&(n.preRun=[n.preRun]);n.preRun.length;)Tt(n.preRun.shift());cn(be)}function kt(){cn(Ie)}function lt(){if(n.postRun)for(typeof n.postRun=="function"&&(n.postRun=[n.postRun]);n.postRun.length;)tt(n.postRun.shift());cn(He)}function Tt(c){be.unshift(c)}function Et(c){Ie.unshift(c)}function tt(c){He.unshift(c)}var A=0,De=null;function Dn(c){A++,n.monitorRunDependencies?.(A)}function tn(c){if(A--,n.monitorRunDependencies?.(A),A==0&&De){var l=De;De=null,l()}}function _t(c){n.onAbort?.(c),c="Aborted("+c+")",_(c),B=!0,c+=". Build with -sASSERTIONS for more info.";var l=new WebAssembly.RuntimeError(c);throw i(l),l}var Ve="data:application/octet-stream;base64,",it=c=>c.startsWith(Ve),Mt=c=>c.startsWith("file://");function on(){if(n.locateFile){var c="manifold.wasm";return it(c)?c:C(c)}return new URL("/assets/manifold-D9yvTBHx.wasm",import.meta.url).href}var Ot;function kr(c){if(c==Ot&&N)return new Uint8Array(N);if(V)return V(c);throw"both async and sync fetching of the wasm failed"}function ms(c){return N?Promise.resolve().then(()=>kr(c)):G(c).then(l=>new Uint8Array(l),()=>kr(c))}function hr(c,l,f){return ms(c).then(g=>WebAssembly.instantiate(g,l)).then(f,g=>{_(`failed to asynchronously prepare wasm: ${g}`),_t(g)})}function Jn(c,l,f,g){return!c&&typeof WebAssembly.instantiateStreaming=="function"&&!it(l)&&!Mt(l)&&!h&&typeof fetch=="function"?fetch(l,{credentials:"same-origin"}).then(M=>{var U=WebAssembly.instantiateStreaming(M,f);return U.then(g,function(q){return _(`wasm streaming compile failed: ${q}`),_("falling back to ArrayBuffer instantiation"),hr(l,f,g)})}):hr(l,f,g)}function an(){return{a:zc}}function jr(){var c=an();function l(g,M){return Yt=g.exports,Yt=Wc(Yt),P=Yt.J,me(),Ce=Yt.M,Et(Yt.K),tn(),Yt}Dn();function f(g){l(g.instance)}if(n.instantiateWasm)try{return n.instantiateWasm(c,l)}catch(g){_(`Module.instantiateWasm callback failed with error: ${g}`),i(g)}return Ot||(Ot=on()),Jn(N,Ot,c,f).catch(i),{}}var cn=c=>{for(;c.length>0;)c.shift()(n)};function gt(c,l="i8"){switch(l.endsWith("*")&&(l="*"),l){case"i1":return d[c>>>0];case"i8":return d[c>>>0];case"i16":return b[c>>>1>>>0];case"i32":return Q[c>>>2>>>0];case"i64":_t("to do getValue(i64) use WASM_BIGINT");case"float":return fe[c>>>2>>>0];case"double":return Ee[c>>>3>>>0];case"*":return ee[c>>>2>>>0];default:_t(`invalid type for getValue: ${l}`)}}n.noExitRuntime;function ln(c,l,f="i8"){switch(f.endsWith("*")&&(f="*"),f){case"i1":d[c>>>0]=l;break;case"i8":d[c>>>0]=l;break;case"i16":b[c>>>1>>>0]=l;break;case"i32":Q[c>>>2>>>0]=l;break;case"i64":_t("to do setValue(i64) use WASM_BIGINT");case"float":fe[c>>>2>>>0]=l;break;case"double":Ee[c>>>3>>>0]=l;break;case"*":ee[c>>>2>>>0]=l;break;default:_t(`invalid type for setValue: ${f}`)}}class Xt{constructor(l){this.excPtr=l,this.ptr=l-24}set_type(l){ee[this.ptr+4>>>2>>>0]=l}get_type(){return ee[this.ptr+4>>>2>>>0]}set_destructor(l){ee[this.ptr+8>>>2>>>0]=l}get_destructor(){return ee[this.ptr+8>>>2>>>0]}set_caught(l){l=l?1:0,d[this.ptr+12>>>0]=l}get_caught(){return d[this.ptr+12>>>0]!=0}set_rethrown(l){l=l?1:0,d[this.ptr+13>>>0]=l}get_rethrown(){return d[this.ptr+13>>>0]!=0}init(l,f){this.set_adjusted_ptr(0),this.set_type(l),this.set_destructor(f)}set_adjusted_ptr(l){ee[this.ptr+16>>>2>>>0]=l}get_adjusted_ptr(){return ee[this.ptr+16>>>2>>>0]}get_exception_ptr(){var l=Ii(this.get_type());if(l)return ee[this.excPtr>>>2>>>0];var f=this.get_adjusted_ptr();return f!==0?f:this.excPtr}}var Vn=0;function ys(c,l,f){c>>>=0,l>>>=0,f>>>=0;var g=new Xt(c);throw g.init(l,f),Vn=c,Vn}var Ts=()=>{_t("")},un={},dr=c=>{for(;c.length;){var l=c.pop(),f=c.pop();f(l)}};function Gn(c){return this.fromWireType(ee[c>>>2>>>0])}var Pn={},fn={},Zn={},Br,Qn=c=>{throw new Br(c)},hn=(c,l,f)=>{c.forEach(function(j){Zn[j]=l});function g(j){var Z=f(j);Z.length!==c.length&&Qn("Mismatched type converter count");for(var re=0;re<c.length;++re)jt(c[re],Z[re])}var M=new Array(l.length),U=[],q=0;l.forEach((j,Z)=>{fn.hasOwnProperty(j)?M[Z]=fn[j]:(U.push(j),Pn.hasOwnProperty(j)||(Pn[j]=[]),Pn[j].push(()=>{M[Z]=fn[j],++q,q===U.length&&g(M)}))}),U.length===0&&g(M)},xs=function(c){c>>>=0;var l=un[c];delete un[c];var f=l.rawConstructor,g=l.rawDestructor,M=l.fields,U=M.map(q=>q.getterReturnType).concat(M.map(q=>q.setterArgumentType));hn([c],U,q=>{var j={};return M.forEach((Z,re)=>{var ue=Z.fieldName,Ae=q[re],Ge=Z.getter,ht=Z.getterContext,at=q[re+M.length],Jt=Z.setter,Zt=Z.setterContext;j[ue]={read:I=>Ae.fromWireType(Ge(ht,I)),write:(I,O)=>{var W=[];Jt(Zt,I,at.toWireType(W,O)),dr(W)}}}),[{name:l.name,fromWireType:Z=>{var re={};for(var ue in j)re[ue]=j[ue].read(Z);return g(Z),re},toWireType:(Z,re)=>{for(var ue in j)if(!(ue in re))throw new TypeError(`Missing field: "${ue}"`);var Ae=f();for(ue in j)j[ue].write(Ae,re[ue]);return Z!==null&&Z.push(g,Ae),Ae},argPackAdvance:Bt,readValueFromPointer:Gn,destructorFunction:g}]})};function vs(c,l,f,g,M){}var Es=()=>{for(var c=new Array(256),l=0;l<256;++l)c[l]=String.fromCharCode(l);nn=c},nn,ot=c=>{for(var l="",f=c;R[f>>>0];)l+=nn[R[f++>>>0]];return l},Kt,Ue=c=>{throw new Kt(c)};function ws(c,l,f={}){var g=l.name;if(c||Ue(`type "${g}" must have a positive integer typeid pointer`),fn.hasOwnProperty(c)){if(f.ignoreDuplicateRegistrations)return;Ue(`Cannot register type '${g}' twice`)}if(fn[c]=l,delete Zn[c],Pn.hasOwnProperty(c)){var M=Pn[c];delete Pn[c],M.forEach(U=>U())}}function jt(c,l,f={}){if(!("argPackAdvance"in l))throw new TypeError("registerType registeredInstance requires argPackAdvance");return ws(c,l,f)}var Bt=8;function m(c,l,f,g){c>>>=0,l>>>=0,l=ot(l),jt(c,{name:l,fromWireType:function(M){return!!M},toWireType:function(M,U){return U?f:g},argPackAdvance:Bt,readValueFromPointer:function(M){return this.fromWireType(R[M>>>0])},destructorFunction:null})}var w=c=>({count:c.count,deleteScheduled:c.deleteScheduled,preservePointerOnDelete:c.preservePointerOnDelete,ptr:c.ptr,ptrType:c.ptrType,smartPtr:c.smartPtr,smartPtrType:c.smartPtrType}),S=c=>{function l(f){return f.$$.ptrType.registeredClass.name}Ue(l(c)+" instance already deleted")},z=!1,ie=c=>{},ce=c=>{c.smartPtr?c.smartPtrType.rawDestructor(c.smartPtr):c.ptrType.registeredClass.rawDestructor(c.ptr)},te=c=>{c.count.value-=1;var l=c.count.value===0;l&&ce(c)},xe=(c,l,f)=>{if(l===f)return c;if(f.baseClass===void 0)return null;var g=xe(c,l,f.baseClass);return g===null?null:f.downcast(g)},Y={},Pe=()=>Object.keys(ve).length,Fe=()=>{var c=[];for(var l in ve)ve.hasOwnProperty(l)&&c.push(ve[l]);return c},Re=[],Be=()=>{for(;Re.length;){var c=Re.pop();c.$$.deleteScheduled=!1,c.delete()}},Se,Le=c=>{Se=c,Re.length&&Se&&Se(Be)},$e=()=>{n.getInheritedInstanceCount=Pe,n.getLiveInheritedInstances=Fe,n.flushPendingDeletes=Be,n.setDelayFunction=Le},ve={},Qe=(c,l)=>{for(l===void 0&&Ue("ptr should not be undefined");c.baseClass;)l=c.upcast(l),c=c.baseClass;return l},we=(c,l)=>(l=Qe(c,l),ve[l]),ye=(c,l)=>{(!l.ptrType||!l.ptr)&&Qn("makeClassHandle requires ptr and ptrType");var f=!!l.smartPtrType,g=!!l.smartPtr;return f!==g&&Qn("Both smartPtrType and smartPtr must be specified"),l.count={value:1},K(Object.create(c,{$$:{value:l,writable:!0}}))};function ae(c){var l=this.getPointee(c);if(!l)return this.destructor(c),null;var f=we(this.registeredClass,l);if(f!==void 0){if(f.$$.count.value===0)return f.$$.ptr=l,f.$$.smartPtr=c,f.clone();var g=f.clone();return this.destructor(c),g}function M(){return this.isSmartPointer?ye(this.registeredClass.instancePrototype,{ptrType:this.pointeeType,ptr:l,smartPtrType:this,smartPtr:c}):ye(this.registeredClass.instancePrototype,{ptrType:this,ptr:c})}var U=this.registeredClass.getActualType(l),q=Y[U];if(!q)return M.call(this);var j;this.isConst?j=q.constPointerType:j=q.pointerType;var Z=xe(l,this.registeredClass,j.registeredClass);return Z===null?M.call(this):this.isSmartPointer?ye(j.registeredClass.instancePrototype,{ptrType:j,ptr:Z,smartPtrType:this,smartPtr:c}):ye(j.registeredClass.instancePrototype,{ptrType:j,ptr:Z})}var K=c=>typeof FinalizationRegistry>"u"?(K=l=>l,c):(z=new FinalizationRegistry(l=>{te(l.$$)}),K=l=>{var f=l.$$,g=!!f.smartPtr;if(g){var M={$$:f};z.register(l,M,l)}return l},ie=l=>z.unregister(l),K(c)),D=()=>{Object.assign(H.prototype,{isAliasOf(c){if(!(this instanceof H)||!(c instanceof H))return!1;var l=this.$$.ptrType.registeredClass,f=this.$$.ptr;c.$$=c.$$;for(var g=c.$$.ptrType.registeredClass,M=c.$$.ptr;l.baseClass;)f=l.upcast(f),l=l.baseClass;for(;g.baseClass;)M=g.upcast(M),g=g.baseClass;return l===g&&f===M},clone(){if(this.$$.ptr||S(this),this.$$.preservePointerOnDelete)return this.$$.count.value+=1,this;var c=K(Object.create(Object.getPrototypeOf(this),{$$:{value:w(this.$$)}}));return c.$$.count.value+=1,c.$$.deleteScheduled=!1,c},delete(){this.$$.ptr||S(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&Ue("Object already scheduled for deletion"),ie(this),te(this.$$),this.$$.preservePointerOnDelete||(this.$$.smartPtr=void 0,this.$$.ptr=void 0)},isDeleted(){return!this.$$.ptr},deleteLater(){return this.$$.ptr||S(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&Ue("Object already scheduled for deletion"),Re.push(this),Re.length===1&&Se&&Se(Be),this.$$.deleteScheduled=!0,this}})};function H(){}var J=(c,l)=>Object.defineProperty(l,"name",{value:c}),he=(c,l,f)=>{if(c[l].overloadTable===void 0){var g=c[l];c[l]=function(...M){return c[l].overloadTable.hasOwnProperty(M.length)||Ue(`Function '${f}' called with an invalid number of arguments (${M.length}) - expects one of (${c[l].overloadTable})!`),c[l].overloadTable[M.length].apply(this,M)},c[l].overloadTable=[],c[l].overloadTable[g.argCount]=g}},ge=(c,l,f)=>{n.hasOwnProperty(c)?((f===void 0||n[c].overloadTable!==void 0&&n[c].overloadTable[f]!==void 0)&&Ue(`Cannot register public name '${c}' twice`),he(n,c,c),n.hasOwnProperty(f)&&Ue(`Cannot register multiple overloads of a function with the same number of arguments (${f})!`),n[c].overloadTable[f]=l):(n[c]=l,f!==void 0&&(n[c].numArguments=f))},X=48,ne=57,x=c=>{if(c===void 0)return"_unknown";c=c.replace(/[^a-zA-Z0-9_]/g,"$");var l=c.charCodeAt(0);return l>=X&&l<=ne?`_${c}`:c};function L(c,l,f,g,M,U,q,j){this.name=c,this.constructor=l,this.instancePrototype=f,this.rawDestructor=g,this.baseClass=M,this.getActualType=U,this.upcast=q,this.downcast=j,this.pureVirtualFunctions=[]}var le=(c,l,f)=>{for(;l!==f;)l.upcast||Ue(`Expected null or instance of ${f.name}, got an instance of ${l.name}`),c=l.upcast(c),l=l.baseClass;return c};function de(c,l){if(l===null)return this.isReference&&Ue(`null is not a valid ${this.name}`),0;l.$$||Ue(`Cannot pass "${Ss(l)}" as a ${this.name}`),l.$$.ptr||Ue(`Cannot pass deleted object as a pointer of type ${this.name}`);var f=l.$$.ptrType.registeredClass,g=le(l.$$.ptr,f,this.registeredClass);return g}function _e(c,l){var f;if(l===null)return this.isReference&&Ue(`null is not a valid ${this.name}`),this.isSmartPointer?(f=this.rawConstructor(),c!==null&&c.push(this.rawDestructor,f),f):0;(!l||!l.$$)&&Ue(`Cannot pass "${Ss(l)}" as a ${this.name}`),l.$$.ptr||Ue(`Cannot pass deleted object as a pointer of type ${this.name}`),!this.isConst&&l.$$.ptrType.isConst&&Ue(`Cannot convert argument of type ${l.$$.smartPtrType?l.$$.smartPtrType.name:l.$$.ptrType.name} to parameter type ${this.name}`);var g=l.$$.ptrType.registeredClass;if(f=le(l.$$.ptr,g,this.registeredClass),this.isSmartPointer)switch(l.$$.smartPtr===void 0&&Ue("Passing raw pointer to smart pointer is illegal"),this.sharingPolicy){case 0:l.$$.smartPtrType===this?f=l.$$.smartPtr:Ue(`Cannot convert argument of type ${l.$$.smartPtrType?l.$$.smartPtrType.name:l.$$.ptrType.name} to parameter type ${this.name}`);break;case 1:f=l.$$.smartPtr;break;case 2:if(l.$$.smartPtrType===this)f=l.$$.smartPtr;else{var M=l.clone();f=this.rawShare(f,mt.toHandle(()=>M.delete())),c!==null&&c.push(this.rawDestructor,f)}break;default:Ue("Unsupporting sharing policy")}return f}function Oe(c,l){if(l===null)return this.isReference&&Ue(`null is not a valid ${this.name}`),0;l.$$||Ue(`Cannot pass "${Ss(l)}" as a ${this.name}`),l.$$.ptr||Ue(`Cannot pass deleted object as a pointer of type ${this.name}`),l.$$.ptrType.isConst&&Ue(`Cannot convert argument of type ${l.$$.ptrType.name} to parameter type ${this.name}`);var f=l.$$.ptrType.registeredClass,g=le(l.$$.ptr,f,this.registeredClass);return g}var Ke=()=>{Object.assign(pe.prototype,{getPointee(c){return this.rawGetPointee&&(c=this.rawGetPointee(c)),c},destructor(c){this.rawDestructor?.(c)},argPackAdvance:Bt,readValueFromPointer:Gn,fromWireType:ae})};function pe(c,l,f,g,M,U,q,j,Z,re,ue){this.name=c,this.registeredClass=l,this.isReference=f,this.isConst=g,this.isSmartPointer=M,this.pointeeType=U,this.sharingPolicy=q,this.rawGetPointee=j,this.rawConstructor=Z,this.rawShare=re,this.rawDestructor=ue,!M&&l.baseClass===void 0?g?(this.toWireType=de,this.destructorFunction=null):(this.toWireType=Oe,this.destructorFunction=null):this.toWireType=_e}var ke=(c,l,f)=>{n.hasOwnProperty(c)||Qn("Replacing nonexistent public symbol"),n[c].overloadTable!==void 0&&f!==void 0?n[c].overloadTable[f]=l:(n[c]=l,n[c].argCount=f)},je=(c,l,f)=>{c=c.replace(/p/g,"i");var g=n["dynCall_"+c];return g(l,...f)},Ce,dt=c=>Ce.get(c),nt=(c,l,f=[])=>{if(c.includes("j"))return je(c,l,f);var g=dt(l)(...f);return c[0]=="p"?g>>>0:g},Lt=(c,l)=>(...f)=>nt(c,l,f),Te=(c,l)=>{c=ot(c);function f(){return c.includes("j")||c.includes("p")?Lt(c,l):dt(l)}var g=f();return typeof g!="function"&&Ue(`unknown function pointer with signature ${c}: ${l}`),g},qt=(c,l)=>{var f=J(l,function(g){this.name=l,this.message=g;var M=new Error(g).stack;M!==void 0&&(this.stack=this.toString()+`
`+M.replace(/^Error(:[^\n]*)?\n/,""))});return f.prototype=Object.create(c.prototype),f.prototype.constructor=f,f.prototype.toString=function(){return this.message===void 0?this.name:`${this.name}: ${this.message}`},f},Rt,Dt=c=>{var l=Ri(c),f=ot(l);return mn(l),f},Ct=(c,l)=>{var f=[],g={};function M(U){if(!g[U]&&!fn[U]){if(Zn[U]){Zn[U].forEach(M);return}f.push(U),g[U]=!0}}throw l.forEach(M),new Rt(`${c}: `+f.map(Dt).join([", "]))};function Nt(c,l,f,g,M,U,q,j,Z,re,ue,Ae,Ge){c>>>=0,l>>>=0,f>>>=0,g>>>=0,M>>>=0,U>>>=0,q>>>=0,j>>>=0,Z>>>=0,re>>>=0,ue>>>=0,Ae>>>=0,Ge>>>=0,ue=ot(ue),U=Te(M,U),j&&=Te(q,j),re&&=Te(Z,re),Ge=Te(Ae,Ge);var ht=x(ue);ge(ht,function(){Ct(`Cannot construct ${ue} due to unbound types`,[g])}),hn([c,l,f],g?[g]:[],at=>{at=at[0];var Jt,Zt;g?(Jt=at.registeredClass,Zt=Jt.instancePrototype):Zt=H.prototype;var I=J(ue,function(...ut){if(Object.getPrototypeOf(this)!==O)throw new Kt("Use 'new' to construct "+ue);if(W.constructor_body===void 0)throw new Kt(ue+" has no accessible constructor");var Pt=W.constructor_body[ut.length];if(Pt===void 0)throw new Kt(`Tried to invoke ctor of ${ue} with invalid number of parameters (${ut.length}) - expected (${Object.keys(W.constructor_body).toString()}) parameters instead!`);return Pt.apply(this,ut)}),O=Object.create(Zt,{constructor:{value:I}});I.prototype=O;var W=new L(ue,I,O,Ge,Jt,U,j,re);W.baseClass&&(W.baseClass.__derivedClasses??=[],W.baseClass.__derivedClasses.push(W));var se=new pe(ue,W,!0,!1,!1),Me=new pe(ue+"*",W,!1,!1,!1),qe=new pe(ue+" const*",W,!1,!0,!1);return Y[c]={pointerType:Me,constPointerType:qe},ke(ht,I),[se,Me,qe]})}var dn=(c,l)=>{for(var f=[],g=0;g<c;g++)f.push(ee[l+g*4>>>2>>>0]);return f};function pn(c){for(var l=1;l<c.length;++l)if(c[l]!==null&&c[l].destructorFunction===void 0)return!0;return!1}function Lr(c,l){if(!(c instanceof Function))throw new TypeError(`new_ called with constructor type ${typeof c} which is not a function`);var f=J(c.name||"unknownFunctionName",function(){});f.prototype=c.prototype;var g=new f,M=c.apply(g,l);return M instanceof Object?M:g}function bs(c,l,f,g){for(var M=pn(c),U=c.length,q="",j="",Z=0;Z<U-2;++Z)q+=(Z!==0?", ":"")+"arg"+Z,j+=(Z!==0?", ":"")+"arg"+Z+"Wired";var re=`
        return function (${q}) {
        if (arguments.length !== ${U-2}) {
          throwBindingError('function ' + humanName + ' called with ' + arguments.length + ' arguments, expected ${U-2}');
        }`;M&&(re+=`var destructors = [];
`);var ue=M?"destructors":"null",Ae=["humanName","throwBindingError","invoker","fn","runDestructors","retType","classParam"];l&&(re+="var thisWired = classParam['toWireType']("+ue+`, this);
`);for(var Z=0;Z<U-2;++Z)re+="var arg"+Z+"Wired = argType"+Z+"['toWireType']("+ue+", arg"+Z+`);
`,Ae.push("argType"+Z);if(l&&(j="thisWired"+(j.length>0?", ":"")+j),re+=(f||g?"var rv = ":"")+"invoker(fn"+(j.length>0?", ":"")+j+`);
`,M)re+=`runDestructors(destructors);
`;else for(var Z=l?1:2;Z<c.length;++Z){var Ge=Z===1?"thisWired":"arg"+(Z-2)+"Wired";c[Z].destructorFunction!==null&&(re+=`${Ge}_dtor(${Ge});
`,Ae.push(`${Ge}_dtor`))}return f&&(re+=`var ret = retType['fromWireType'](rv);
return ret;
`),re+=`}
`,[Ae,re]}function _s(c,l,f,g,M,U){var q=l.length;q<2&&Ue("argTypes array size mismatch! Must at least get return value and 'this' types!");for(var j=l[1]!==null&&f!==null,Z=pn(l),re=l[0].name!=="void",ue=[c,Ue,g,M,dr,l[0],l[1]],Ae=0;Ae<q-2;++Ae)ue.push(l[Ae+2]);if(!Z)for(var Ae=j?1:2;Ae<l.length;++Ae)l[Ae].destructorFunction!==null&&ue.push(l[Ae].destructorFunction);let[Ge,ht]=bs(l,j,re,U);Ge.push(ht);var at=Lr(Function,Ge)(...ue);return J(c,at)}var Ha=function(c,l,f,g,M,U){c>>>=0,f>>>=0,g>>>=0,M>>>=0,U>>>=0;var q=dn(l,f);M=Te(g,M),hn([],[c],j=>{j=j[0];var Z=`constructor ${j.name}`;if(j.registeredClass.constructor_body===void 0&&(j.registeredClass.constructor_body=[]),j.registeredClass.constructor_body[l-1]!==void 0)throw new Kt(`Cannot register multiple constructors with identical number of parameters (${l-1}) for class '${j.name}'! Overload resolution is currently only performed using the parameter count, not actual type info!`);return j.registeredClass.constructor_body[l-1]=()=>{Ct(`Cannot construct ${j.name} due to unbound types`,q)},hn([],q,re=>(re.splice(1,0,null),j.registeredClass.constructor_body[l-1]=_s(Z,re,null,M,U),[])),[]})},Ti=c=>{c=c.trim();const l=c.indexOf("(");return l!==-1?c.substr(0,l):c},za=function(c,l,f,g,M,U,q,j,Z){c>>>=0,l>>>=0,g>>>=0,M>>>=0,U>>>=0,q>>>=0;var re=dn(f,g);l=ot(l),l=Ti(l),U=Te(M,U),hn([],[c],ue=>{ue=ue[0];var Ae=`${ue.name}.${l}`;l.startsWith("@@")&&(l=Symbol[l.substring(2)]),j&&ue.registeredClass.pureVirtualFunctions.push(l);function Ge(){Ct(`Cannot call ${Ae} due to unbound types`,re)}var ht=ue.registeredClass.instancePrototype,at=ht[l];return at===void 0||at.overloadTable===void 0&&at.className!==ue.name&&at.argCount===f-2?(Ge.argCount=f-2,Ge.className=ue.name,ht[l]=Ge):(he(ht,l,Ae),ht[l].overloadTable[f-2]=Ge),hn([],re,Jt=>{var Zt=_s(Ae,Jt,ue,U,q,Z);return ht[l].overloadTable===void 0?(Zt.argCount=f-2,ht[l]=Zt):ht[l].overloadTable[f-2]=Zt,[]}),[]})},Rs=[],gn=[];function Is(c){c>>>=0,c>9&&--gn[c+1]===0&&(gn[c]=void 0,Rs.push(c))}var Wa=()=>gn.length/2-5-Rs.length,Xa=()=>{gn.push(0,1,void 0,1,null,1,!0,1,!1,1),n.count_emval_handles=Wa},mt={toValue:c=>(c||Ue("Cannot use deleted val. handle = "+c),gn[c]),toHandle:c=>{switch(c){case void 0:return 2;case null:return 4;case!0:return 6;case!1:return 8;default:{const l=Rs.pop()||gn.length;return gn[l]=c,gn[l+1]=1,l}}}},Ka={name:"emscripten::val",fromWireType:c=>{var l=mt.toValue(c);return Is(c),l},toWireType:(c,l)=>mt.toHandle(l),argPackAdvance:Bt,readValueFromPointer:Gn,destructorFunction:null};function xi(c){return c>>>=0,jt(c,Ka)}var qa=(c,l,f)=>{switch(l){case 1:return f?function(g){return this.fromWireType(d[g>>>0])}:function(g){return this.fromWireType(R[g>>>0])};case 2:return f?function(g){return this.fromWireType(b[g>>>1>>>0])}:function(g){return this.fromWireType($[g>>>1>>>0])};case 4:return f?function(g){return this.fromWireType(Q[g>>>2>>>0])}:function(g){return this.fromWireType(ee[g>>>2>>>0])};default:throw new TypeError(`invalid integer width (${l}): ${c}`)}};function Ya(c,l,f,g){c>>>=0,l>>>=0,f>>>=0,l=ot(l);function M(){}M.values={},jt(c,{name:l,constructor:M,fromWireType:function(U){return this.constructor.values[U]},toWireType:(U,q)=>q.value,argPackAdvance:Bt,readValueFromPointer:qa(l,f,g),destructorFunction:null}),ge(l,M)}var $r=(c,l)=>{var f=fn[c];return f===void 0&&Ue(`${l} has unknown type ${Dt(c)}`),f};function Ja(c,l,f){c>>>=0,l>>>=0;var g=$r(c,"enum");l=ot(l);var M=g.constructor,U=Object.create(g.constructor.prototype,{value:{value:f},constructor:{value:J(`${g.name}_${l}`,function(){})}});M.values[f]=U,M[l]=U}var Ss=c=>{if(c===null)return"null";var l=typeof c;return l==="object"||l==="array"||l==="function"?c.toString():""+c},Za=(c,l)=>{switch(l){case 4:return function(f){return this.fromWireType(fe[f>>>2>>>0])};case 8:return function(f){return this.fromWireType(Ee[f>>>3>>>0])};default:throw new TypeError(`invalid float width (${l}): ${c}`)}},Qa=function(c,l,f){c>>>=0,l>>>=0,f>>>=0,l=ot(l),jt(c,{name:l,fromWireType:g=>g,toWireType:(g,M)=>M,argPackAdvance:Bt,readValueFromPointer:Za(l,f),destructorFunction:null})};function ec(c,l,f,g,M,U,q){c>>>=0,f>>>=0,g>>>=0,M>>>=0,U>>>=0;var j=dn(l,f);c=ot(c),c=Ti(c),M=Te(g,M),ge(c,function(){Ct(`Cannot call ${c} due to unbound types`,j)},l-1),hn([],j,Z=>{var re=[Z[0],null].concat(Z.slice(1));return ke(c,_s(c,re,null,M,U,q),l-1),[]})}var tc=(c,l,f)=>{switch(l){case 1:return f?g=>d[g>>>0]:g=>R[g>>>0];case 2:return f?g=>b[g>>>1>>>0]:g=>$[g>>>1>>>0];case 4:return f?g=>Q[g>>>2>>>0]:g=>ee[g>>>2>>>0];default:throw new TypeError(`invalid integer width (${l}): ${c}`)}};function nc(c,l,f,g,M){c>>>=0,l>>>=0,f>>>=0,l=ot(l);var U=ue=>ue;if(g===0){var q=32-8*f;U=ue=>ue<<q>>>q}var j=l.includes("unsigned"),Z=(ue,Ae)=>{},re;j?re=function(ue,Ae){return Z(Ae,this.name),Ae>>>0}:re=function(ue,Ae){return Z(Ae,this.name),Ae},jt(c,{name:l,fromWireType:U,toWireType:re,argPackAdvance:Bt,readValueFromPointer:tc(l,f,g!==0),destructorFunction:null})}function rc(c,l,f){c>>>=0,f>>>=0;var g=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],M=g[l];function U(q){var j=ee[q>>>2>>>0],Z=ee[q+4>>>2>>>0];return new M(d.buffer,Z,j)}f=ot(f),jt(c,{name:f,fromWireType:U,argPackAdvance:Bt,readValueFromPointer:U},{ignoreDuplicateRegistrations:!0})}function sc(c,l){c>>>=0,xi(c)}var ic=(c,l,f,g)=>{if(f>>>=0,!(g>0))return 0;for(var M=f,U=f+g-1,q=0;q<c.length;++q){var j=c.charCodeAt(q);if(j>=55296&&j<=57343){var Z=c.charCodeAt(++q);j=65536+((j&1023)<<10)|Z&1023}if(j<=127){if(f>=U)break;l[f++>>>0]=j}else if(j<=2047){if(f+1>=U)break;l[f++>>>0]=192|j>>6,l[f++>>>0]=128|j&63}else if(j<=65535){if(f+2>=U)break;l[f++>>>0]=224|j>>12,l[f++>>>0]=128|j>>6&63,l[f++>>>0]=128|j&63}else{if(f+3>=U)break;l[f++>>>0]=240|j>>18,l[f++>>>0]=128|j>>12&63,l[f++>>>0]=128|j>>6&63,l[f++>>>0]=128|j&63}}return l[f>>>0]=0,f-M},oc=(c,l,f)=>ic(c,R,l,f),ac=c=>{for(var l=0,f=0;f<c.length;++f){var g=c.charCodeAt(f);g<=127?l++:g<=2047?l+=2:g>=55296&&g<=57343?(l+=4,++f):l+=3}return l},vi=typeof TextDecoder<"u"?new TextDecoder:void 0,cc=(c,l,f)=>{l>>>=0;for(var g=l+f,M=l;c[M]&&!(M>=g);)++M;if(M-l>16&&c.buffer&&vi)return vi.decode(c.subarray(l,M));for(var U="";l<M;){var q=c[l++];if(!(q&128)){U+=String.fromCharCode(q);continue}var j=c[l++]&63;if((q&224)==192){U+=String.fromCharCode((q&31)<<6|j);continue}var Z=c[l++]&63;if((q&240)==224?q=(q&15)<<12|j<<6|Z:q=(q&7)<<18|j<<12|Z<<6|c[l++]&63,q<65536)U+=String.fromCharCode(q);else{var re=q-65536;U+=String.fromCharCode(55296|re>>10,56320|re&1023)}}return U},lc=(c,l)=>(c>>>=0,c?cc(R,c,l):"");function uc(c,l){c>>>=0,l>>>=0,l=ot(l);var f=l==="std::string";jt(c,{name:l,fromWireType(g){var M=ee[g>>>2>>>0],U=g+4,q;if(f)for(var j=U,Z=0;Z<=M;++Z){var re=U+Z;if(Z==M||R[re>>>0]==0){var ue=re-j,Ae=lc(j,ue);q===void 0?q=Ae:(q+="\0",q+=Ae),j=re+1}}else{for(var Ge=new Array(M),Z=0;Z<M;++Z)Ge[Z]=String.fromCharCode(R[U+Z>>>0]);q=Ge.join("")}return mn(g),q},toWireType(g,M){M instanceof ArrayBuffer&&(M=new Uint8Array(M));var U,q=typeof M=="string";q||M instanceof Uint8Array||M instanceof Uint8ClampedArray||M instanceof Int8Array||Ue("Cannot pass non-string to std::string"),f&&q?U=ac(M):U=M.length;var j=Ns(4+U+1),Z=j+4;if(ee[j>>>2>>>0]=U,f&&q)oc(M,Z,U+1);else if(q)for(var re=0;re<U;++re){var ue=M.charCodeAt(re);ue>255&&(mn(Z),Ue("String has UTF-16 code units that do not fit in 8 bits")),R[Z+re>>>0]=ue}else for(var re=0;re<U;++re)R[Z+re>>>0]=M[re];return g!==null&&g.push(mn,j),j},argPackAdvance:Bt,readValueFromPointer:Gn,destructorFunction(g){mn(g)}})}var Ei=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0,fc=(c,l)=>{for(var f=c,g=f>>1,M=g+l/2;!(g>=M)&&$[g>>>0];)++g;if(f=g<<1,f-c>32&&Ei)return Ei.decode(R.subarray(c>>>0,f>>>0));for(var U="",q=0;!(q>=l/2);++q){var j=b[c+q*2>>>1>>>0];if(j==0)break;U+=String.fromCharCode(j)}return U},hc=(c,l,f)=>{if(f??=2147483647,f<2)return 0;f-=2;for(var g=l,M=f<c.length*2?f/2:c.length,U=0;U<M;++U){var q=c.charCodeAt(U);b[l>>>1>>>0]=q,l+=2}return b[l>>>1>>>0]=0,l-g},dc=c=>c.length*2,pc=(c,l)=>{for(var f=0,g="";!(f>=l/4);){var M=Q[c+f*4>>>2>>>0];if(M==0)break;if(++f,M>=65536){var U=M-65536;g+=String.fromCharCode(55296|U>>10,56320|U&1023)}else g+=String.fromCharCode(M)}return g},gc=(c,l,f)=>{if(l>>>=0,f??=2147483647,f<4)return 0;for(var g=l,M=g+f-4,U=0;U<c.length;++U){var q=c.charCodeAt(U);if(q>=55296&&q<=57343){var j=c.charCodeAt(++U);q=65536+((q&1023)<<10)|j&1023}if(Q[l>>>2>>>0]=q,l+=4,l+4>M)break}return Q[l>>>2>>>0]=0,l-g},mc=c=>{for(var l=0,f=0;f<c.length;++f){var g=c.charCodeAt(f);g>=55296&&g<=57343&&++f,l+=4}return l},yc=function(c,l,f){c>>>=0,l>>>=0,f>>>=0,f=ot(f);var g,M,U,q;l===2?(g=fc,M=hc,q=dc,U=j=>$[j>>>1>>>0]):l===4&&(g=pc,M=gc,q=mc,U=j=>ee[j>>>2>>>0]),jt(c,{name:f,fromWireType:j=>{for(var Z=ee[j>>>2>>>0],re,ue=j+4,Ae=0;Ae<=Z;++Ae){var Ge=j+4+Ae*l;if(Ae==Z||U(Ge)==0){var ht=Ge-ue,at=g(ue,ht);re===void 0?re=at:(re+="\0",re+=at),ue=Ge+l}}return mn(j),re},toWireType:(j,Z)=>{typeof Z!="string"&&Ue(`Cannot pass non-string to C++ string type ${f}`);var re=q(Z),ue=Ns(4+re+l);return ee[ue>>>2>>>0]=re/l,M(Z,ue+4,re+l),j!==null&&j.push(mn,ue),ue},argPackAdvance:Bt,readValueFromPointer:Gn,destructorFunction(j){mn(j)}})};function Tc(c,l,f,g,M,U){c>>>=0,l>>>=0,f>>>=0,g>>>=0,M>>>=0,U>>>=0,un[c]={name:ot(l),rawConstructor:Te(f,g),rawDestructor:Te(M,U),fields:[]}}function xc(c,l,f,g,M,U,q,j,Z,re){c>>>=0,l>>>=0,f>>>=0,g>>>=0,M>>>=0,U>>>=0,q>>>=0,j>>>=0,Z>>>=0,re>>>=0,un[c].fields.push({fieldName:ot(l),getterReturnType:f,getter:Te(g,M),getterContext:U,setterArgumentType:q,setter:Te(j,Z),setterContext:re})}var vc=function(c,l){c>>>=0,l>>>=0,l=ot(l),jt(c,{isVoid:!0,name:l,argPackAdvance:0,fromWireType:()=>{},toWireType:(f,g)=>{}})};function Ec(c,l,f){return c>>>=0,l>>>=0,f>>>=0,R.copyWithin(c>>>0,l>>>0,l+f>>>0)}var wi=(c,l,f)=>{var g=[],M=c.toWireType(g,f);return g.length&&(ee[l>>>2>>>0]=mt.toHandle(g)),M};function wc(c,l,f){return c>>>=0,l>>>=0,f>>>=0,c=mt.toValue(c),l=$r(l,"emval::as"),wi(l,f,c)}var bc={},bi=c=>{var l=bc[c];return l===void 0?ot(c):l},As=[];function _c(c,l,f,g,M){return c>>>=0,l>>>=0,f>>>=0,g>>>=0,M>>>=0,c=As[c],l=mt.toValue(l),f=bi(f),c(l,l[f],g,M)}function Rc(c,l){return c>>>=0,l>>>=0,c=mt.toValue(c),l=mt.toValue(l),c==l}var Ic=c=>{var l=As.length;return As.push(c),l},Sc=(c,l)=>{for(var f=new Array(c),g=0;g<c;++g)f[g]=$r(ee[l+g*4>>>2>>>0],"parameter "+g);return f};function Ac(c,l,f){l>>>=0;var g=Sc(c,l),M=g.shift();c--;var U=`return function (obj, func, destructorsRef, args) {
`,q=0,j=[];f===0&&j.push("obj");for(var Z=["retType"],re=[M],ue=0;ue<c;++ue)j.push("arg"+ue),Z.push("argType"+ue),re.push(g[ue]),U+=`  var arg${ue} = argType${ue}.readValueFromPointer(args${q?"+"+q:""});
`,q+=g[ue].argPackAdvance;var Ae=f===1?"new func":"func.call";U+=`  var rv = ${Ae}(${j.join(", ")});
`,M.isVoid||(Z.push("emval_returnValue"),re.push(wi),U+=`  return emval_returnValue(retType, destructorsRef, rv);
`),U+=`};
`,Z.push(U);var Ge=Lr(Function,Z)(...re),ht=`methodCaller<(${g.map(at=>at.name).join(", ")}) => ${M.name}>`;return Ic(J(ht,Ge))}function Mc(c,l){return c>>>=0,l>>>=0,c=mt.toValue(c),l=mt.toValue(l),mt.toHandle(c[l])}function Cc(c){c>>>=0,c>9&&(gn[c+1]+=1)}function Nc(c){return c>>>=0,mt.toHandle(bi(c))}function Oc(){return mt.toHandle({})}function Dc(c){c>>>=0;var l=mt.toValue(c);dr(l),Is(c)}function Pc(c,l,f){c>>>=0,l>>>=0,f>>>=0,c=mt.toValue(c),l=mt.toValue(l),f=mt.toValue(f),c[l]=f}function Fc(c,l){c>>>=0,l>>>=0,c=$r(c,"_emval_take_value");var f=c.readValueFromPointer(l);return mt.toHandle(f)}var Uc=()=>4294901760,kc=c=>{var l=P.buffer,f=(c-l.byteLength+65535)/65536;try{return P.grow(f),me(),1}catch{}};function jc(c){c>>>=0;var l=R.length,f=Uc();if(c>f)return!1;for(var g=(Z,re)=>Z+(re-Z%re)%re,M=1;M<=4;M*=2){var U=l*(1+.2/M);U=Math.min(U,c+100663296);var q=Math.min(f,g(Math.max(c,U),65536)),j=kc(q);if(j)return!0}return!1}var _i=(c,l)=>{c<128?l.push(c):l.push(c%128|128,c>>7)},Bc=c=>{for(var l={i:"i32",j:"i64",f:"f32",d:"f64",e:"externref",p:"i32"},f={parameters:[],results:c[0]=="v"?[]:[l[c[0]]]},g=1;g<c.length;++g)f.parameters.push(l[c[g]]);return f},Lc=(c,l)=>{var f=c.slice(0,1),g=c.slice(1),M={i:127,p:127,j:126,f:125,d:124,e:111};l.push(96),_i(g.length,l);for(var U=0;U<g.length;++U)l.push(M[g[U]]);f=="v"?l.push(0):l.push(1,M[f])},$c=(c,l)=>{if(typeof WebAssembly.Function=="function")return new WebAssembly.Function(Bc(l),c);var f=[1];Lc(l,f);var g=[0,97,115,109,1,0,0,0,1];_i(f.length,g),g.push(...f),g.push(2,7,1,1,101,1,102,0,0,7,5,1,1,102,0,0);var M=new WebAssembly.Module(new Uint8Array(g)),U=new WebAssembly.Instance(M,{e:{f:c}}),q=U.exports.f;return q},Vc=(c,l)=>{if(Hn)for(var f=c;f<c+l;f++){var g=dt(f);g&&Hn.set(g,f)}},Hn,Gc=c=>(Hn||(Hn=new WeakMap,Vc(0,Ce.length)),Hn.get(c)||0),Ms=[],Hc=()=>{if(Ms.length)return Ms.pop();try{Ce.grow(1)}catch(c){throw c instanceof RangeError?"Unable to grow wasm table. Set ALLOW_TABLE_GROWTH.":c}return Ce.length-1},Cs=(c,l)=>Ce.set(c,l),pr=(c,l)=>{var f=Gc(c);if(f)return f;var g=Hc();try{Cs(g,c)}catch(U){if(!(U instanceof TypeError))throw U;var M=$c(c,l);Cs(g,M)}return Hn.set(c,g),g},gr=c=>{Hn.delete(dt(c)),Cs(c,null),Ms.push(c)};Br=n.InternalError=class extends Error{constructor(l){super(l),this.name="InternalError"}},Es(),Kt=n.BindingError=class extends Error{constructor(l){super(l),this.name="BindingError"}},D(),$e(),Ke(),Rt=n.UnboundTypeError=qt(Error,"UnboundTypeError"),Xa();var zc={i:ys,D:Ts,n:xs,C:vs,H:m,h:Nt,g:Ha,a:za,G:xi,t:Ya,e:Ja,x:Qa,c:ec,j:nc,f:rc,k:sc,w:uc,s:yc,o:Tc,l:xc,I:vc,F:Ec,v:wc,z:_c,b:Is,m:Rc,y:Ac,B:Mc,u:Cc,q:Nc,A:Oc,p:Dc,r:Pc,d:Fc,E:jc},Yt=jr(),Ri=c=>(Ri=Yt.L)(c),Ns=c=>(Ns=Yt.N)(c),mn=c=>(mn=Yt.O)(c),Ii=c=>(Ii=Yt.P)(c);function Wc(c){c=Object.assign({},c);var l=g=>M=>g(M)>>>0,f=g=>()=>g()>>>0;return c.L=l(c.L),c.N=l(c.N),c._emscripten_stack_alloc=l(c._emscripten_stack_alloc),c.emscripten_stack_get_current=f(c.emscripten_stack_get_current),c}n.addFunction=pr,n.removeFunction=gr;var Vr;De=function c(){Vr||Si(),Vr||(De=c)};function Si(){if(A>0||(We(),A>0))return;function c(){Vr||(Vr=!0,n.calledRun=!0,!B&&(kt(),s(n),n.onRuntimeInitialized?.(),lt()))}n.setStatus?(n.setStatus("Running..."),setTimeout(function(){setTimeout(function(){n.setStatus("")},1),c()},1)):c()}if(n.preInit)for(typeof n.preInit=="function"&&(n.preInit=[n.preInit]);n.preInit.length>0;)n.preInit.pop()();return Si(),t=o,t})})();let Zr=null,Qr=null;function xh(r){Qr=r}async function vh(){console.log("Instatiate manifoldwasm");let r=null;return typeof Qr=="string"&&Qr?r=await po({locateFile:()=>Qr}):r=await po(),r.setup(),r}async function Eh(){return Zr||(Zr=await vh()),Zr}function Ur(){return Zr}let pi=10,gi=1;const wh=r=>{pi=r,Ur()?.setMinCircularAngle(r)},bh=r=>{gi=r,Ur()?.setMinCircularEdgeLength(r)},_h=r=>Ur()?.setCircularSegments(r),Ba=()=>{Ur()?.resetToCircularDefaults(),pi=10,gi=1},sd=()=>pi,id=()=>gi,od=r=>Ur()?.getCircularSegments(r),Rh=()=>{Ba()},Ih={roughness:.2,metallic:1,baseColorFactor:[1,1,0],alpha:1,unlit:!1},mi=new Map,es=new Map;function Sh(){mi.clear(),es.clear()}const ad=(r,e)=>{const t=r.asOriginal();return mi.set(t.originalID(),e),t},La=r=>mi.get(r);function $a(r){return r==null?{}:(r.material==null&&(r.material=$a(r.parent)),r.material)}function Ah(r,e={}){const{roughness:t,metallic:n,baseColorFactor:s,alpha:i,unlit:o}={...Ih,...e},a=r.createMaterial(e.name??"");if(o){const u=r.createExtension(fi).createUnlit();a.setExtension("KHR_materials_unlit",u)}return i<1&&a.setAlphaMode(Ln.AlphaMode.BLEND).setDoubleSided(!0),a.setRoughnessFactor(t).setMetallicFactor(n).setBaseColorFactor([...s,i])}function cs(r,e){return es.has(e)||es.set(e,Ah(r,e)),es.get(e)}let yi=!1;const ur=new Map,gs=new Map,Mh={baseColorFactor:[1,0,0],alpha:.25,roughness:1,metallic:0},Ch={baseColorFactor:[.5,.5,.5],alpha:.25,roughness:1,metallic:0};function Nh(){yi=!1,ur.clear(),gs.clear()}const Oh=r=>ur.has(r)?ur.get(r):gs.get(r),Dh=r=>{const e=ur.has(r),t=e?ur.get(r):gs.get(r);return e&&t?Mh:La(r)},Ph=r=>yi?Ch:La(r),Va=(r,e)=>{let t=r.asOriginal();return e.set(t.originalID(),t.getMesh()),t},cd=r=>Va(r,ur),ld=r=>(yi=!0,Va(r,gs)),Fh=(r,e,t,n={})=>{const s=[];for(const[i,o]of e.runOriginalID.entries()){const a=Oh(o);if(!a)continue;const u=Dh(o)||n;t.get(o).material=cs(r,u);const h=r.createNode("debug").setMesh(ka(r,a,t)).setMatrix(e.transform(i));s.push(h)}return s};function Uh(){Fl(),Nh(),Sh()}function _r(...r){typeof self<"u"&&self.console&&self.console.log(...r)}function kh(r,e){const t=r.createNode(e.name),n=Fs(r,"translation",e,t);n!=null&&t.setTranslation(n);const s=Fs(r,"rotation",e,t);s!=null&&t.setRotation(Mo(s));const i=Fs(r,"scale",e,t);return i!=null&&t.setScale(i),t}function jh(r,e,t,n={}){const s=t.numTri();if(s==0){_r("Empty manifold, skipping.");return}_r(`Triangles: ${s.toLocaleString()}`);const i=t.boundingBox(),o=[0,0,0];for(let C=0;C<3;C++)o[C]=Math.round((i.max[C]-i.min[C])*10)/10;_r(`Bounding Box: X = ${o[0].toLocaleString()} mm, Y = ${o[1].toLocaleString()} mm, Z = ${o[2].toLocaleString()} mm`);const a=Math.round(t.volume()/10);_r(`Genus: ${t.genus().toLocaleString()}, Volume: ${(a/100).toLocaleString()} cm^3`);const u=t.getMesh(),h=new Map;for(const C of u.runOriginalID){const G=Ph(C)||n;h.set(C,{material:cs(r,G),attributes:["POSITION",...G.attributes??[]]})}const y=kl(t),v=jl(u,y),p=ka(r,u,h);e.setMesh(p),Bl(r,u,p,v,y);const T=Fh(r,u,h,n);for(const C of T)e.addChild(C)}function Ga(r,e){r.setMesh(e.getMesh()),e.listChildren().forEach(t=>{const n=t.clone();r.addChild(n)})}function Bh(r,e,t,n,s){Ga(e,t);const i=t.getMesh(),o=r.createMesh();e.setMesh(o),i.listPrimitives().forEach(a=>{const u=a.clone();a.getMaterial()===s&&u.setMaterial(n),o.addPrimitive(u)}),o.setExtras({clonedFrom:i})}function Lh(r,e,t){const n=kh(r,e),{manifold:s}=e;if(s){Ul(r,n,s);const i=$a(e),o=t.get(s);if(o==null){jh(r,n,s,i);const a=new Map;a.set(i,n),t.set(s,a)}else{const a=o.get(i);if(a==null){const[u,h]=o.entries().next().value;Bh(r,n,h,cs(r,i),cs(r,u)),o.set(i,n)}else Ga(n,a)}}return n}function $h(r){const e=Math.sqrt(2)/2,t=1/1e3,n=r.createNode("wrapper").setRotation([-e,0,0,e]).setScale([t,t,t]);return r.createScene().addChild(n),n}function Vh(r){if(r.length==0)throw new TypeError("nodes[] must contain at least one GLTFNode.");const e=new ar,t=$h(e);Ll(e);const n=new Map,s=new Map;let i=0;for(const o of r)n.set(o,Lh(e,o,s)),o.manifold&&++i;for(const o of r){const a=n.get(o),{parent:u}=o;u?n.get(u).addChild(a):t.addChild(a)}return _r("Total glTF nodes: ",r.length,", Total mesh references: ",i),$l(),e}let go;const Gh=Object.getPrototypeOf(async function(){}).constructor;function ts(...r){typeof self<"u"&&self.console&&self.console.log(...r)}function Hh(){gh(),Uh(),Rh(),Th()}async function zh(r,e={}){Hh();const t=performance.now(),{doNotBundle:n,...s}=e,i=n===!0?r:await ku(r,s),o=performance.now();n!==!0&&ts(`Bundling code took ${((o-t)/1e3).toFixed(2)} seconds`);const u={...await import("./manifoldCAD-_uxpsh_H.js"),isManifoldCAD:()=>!0},h={...u,GLTFNode:yh,getGLTFNodes:ho,resetGLTFNodes:ja},y={setCircularSegments:_h,setMinCircularAngle:wh,setMinCircularEdgeLength:bh,resetToCircularDefaults:Ba,setAnimationDuration:Dl,setAnimationFPS:Pl,setAnimationMode:Ol,_manifold_cad_top_level:h,_manifold_cad_library:u,exports:{},module:{exports:{default:null}}};let v=null;try{await new Gh(...Object.keys(y),i)(...Object.values(y)),v=y.module?.exports?.default,typeof v=="function"&&(v=await v())}catch(V){const E=Cu(i,V,-2);let F=null;const _=Object.keys(h).find(N=>V.message.match(N));throw V.name==="ReferenceError"&&_?F=new ks(V,V.message+`.  Import it by adding \`import {${_}} from 'manifold-3d/manifoldCAD';\` to the top of your model.`):V.name==="ReferenceError"&&V.message.match(/glMatrix/)?F=new ks(V,"ManifoldCAD no longer includes gl-matrix directly.  Import it by adding `import * as glMatrix from 'gl-matrix';` to the top of your model."):F=new ks(V),F.manifoldStack=E,F}const p=performance.now();if(ts(`Manifold took ${((p-o)/1e3).toFixed(2)} seconds`),!v||Array.isArray(v)&&!v.length)throw ho().length?new Error("GLTF Nodes were created, but not exported.  Add `const nodes = getGLTFNodes();` and `export default nodes;` to the end of your model."):new Error("No output as no model was exported.  Add a default export (e.g.: `export default result;`) to the bottom of your model.  The default export must be a `Manifold` or `GLTFNode` object, an array of `Manifold` or `GLTFNode` objects, or a function that returns any of the above.");const T=await ni(v),C=Vh(T),G=performance.now();return ts(`Creating GLTF Document took ${((G-p)/1e3).toFixed(2)} seconds`),C}const Wh=async(r,e)=>{const t=performance.now();go=[new af,new uh];const n=await go.find(o=>o.extensions.includes(e)).asBlob(r),s=URL.createObjectURL(n),i=performance.now();return ts(`Exporting ${e.toUpperCase()} took ${(Math.round((i-t)/10)/100).toLocaleString()} seconds`),s},Xh=()=>{const r=()=>{if(console.debug("Intercepting console.log() in manifoldCAD worker."),self.console){const o=self.console.log;self.console.log=function(...a){let u="";for(const h of a)h==null?u+="undefined":typeof h=="object"?u+=JSON.stringify(h,null,4):u+=h.toString();self.postMessage({type:"log",message:u}),o(...a)}}},e=o=>{console.error(o),o.cause&&console.error("Caused by:",o.cause),o.manifoldStack&&console.error("manifoldStack:",o.manifoldStack),self.postMessage({type:"error",name:o.name,message:o.message,stack:o.manifoldStack??o.stack})},t=async o=>{try{console.debug("Initializing ManifoldCAD worker."),o.manifoldWasmUrl&&xh(o.manifoldWasmUrl),o.esbuildWasmUrl&&Nu(o.esbuildWasmUrl),Ou(o.esbuildHasOwnWorker===!0),await Eh(),r(),self.postMessage({type:"ready"}),console.debug("Successfully initialized ManifoldCAD worker!")}catch(a){e(a)}};let n=null;const s=async o=>{try{const{code:a,...u}=o;n=await zh(o.code,u),self.postMessage({type:"done"})}catch(a){e(a)}},i=async o=>{try{self.postMessage({type:"blob",extension:o.extension,blobURL:await Wh(n,o.extension)})}catch(a){e(a)}};self.onmessage=async o=>{const a=o.data;a.type==="initialize"?t(a):a.type==="evaluate"?s(a):a.type==="export"&&i(a)}};Iu()&&Xh();var ls=Object.freeze({__proto__:null});export{td as G,mh as a,Eh as b,cd as c,Yh as d,Jh as e,qh as f,ed as g,Qh as h,Zh as i,Pr as j,od as k,sd as l,id as m,ld as o,ad as s};
